{"version":3,"file":"battle-tooltips.js","names":["ModifiableValue","battle","pokemon","serverPokemon","value","maxValue","comment","itemName","abilityName","weatherName","isAccuracy","dex","items","get","item","name","ability","baseAbility","abilities","moves","weather","exists","_proto","prototype","reset","arguments","length","undefined","tryItem","_this$pokemon","hasPseudoWeather","push","volatiles","ignoreKlutz","tryAbility","includes","_this$pokemon2","_this$pokemon3","effectiveAbility","tryWeather","_i2","_this$battle$sides2","sides","side","_i4","_side$active2","active","itemModify","factor","modify","abilityModify","weatherModify","round","tier","set","reason","setRange","Number","toFixed","toString","valueString","join","BattleTooltips","_this","clickTooltipEvent","e","isLocked","preventDefault","stopImmediatePropagation","holdLockTooltipEvent","hideTooltip","target","currentTarget","showTooltip","isClick","type","tagName","longTapTimeout","setTimeout","lockTooltip","LONG_CLICK_DELAY","LONG_TAP_DELAY","$","addClass","showTooltipEvent","_proto2","renderStatusIcon","status","file","STATUS_ICON_FILE","STATUS_ICON_PATH","cancelLongTap","elem","parentNode","removeChild","parentElem","removeClass","clearTimeout","isPressed","handleTouchEnd","listen","_this2","$elem","on","unshowTooltip","click","args","dataset","tooltip","split","ownHeight","ownheight","buf","move","teamIndex","parseInt","nearSide","pokemonControlled","Math","floor","mySide","n","gmaxMove","myPokemon","showMoveTooltip","sideIndex","species","getBaseSpecies","baseSpecies","index","_i6","_side$pokemon2","otherPokemon","showPokemonTooltip","viewpointSwitched","activeIndex","pokemonIndex","ally","myAllyPokemon","showFieldTooltip","Promise","resolve","Error","stack","placeTooltip","innerHTML","hoveredElem","notRelativeToParent","scene","$turn","hoveredX1","offset","left","parent","hoveredY1","top","hoveredY2","outerHeight","x","max","y","$wrapper","document","body","append","selection","window","getSelection","_unused","css","min","documentElement","clientWidth","html","appendTo","find","height","clientHeight","width","outerWidth","availableWidth","scrollX","getStatusZMoveEffect","zMove","effect","zMoveEffects","boostText","boost","Object","entries","map","_ref","stat","BattleTextParser","getMaxMoveFromType","maxMoveTable","isZOrMax","text","zEffect","foeActive","foe","gameType","concat","filter","toID","_this$getMoveType","getMoveType","moveType","category","categoryDiff","zMoveFrom","Move","id","assign","moveName","zMoveTable","zMoveType","movePower","basePower","startsWith","maxMove","Dex","getTypeIcon","getCategoryIcon","showingMultipleBasePowers","prevBasePower","difference","basePowers","_i8","_foeActive2","getMoveBasePower","activeTarget","accuracy","getMoveAccuracy","calls","gen","calledMove","hardcoreMode","shortDesc","priority","desc","flags","defrost","protect","bypasssub","reflectable","contact","sound","powder","punch","pulse","bite","recoil","hasCrashDamage","bullet","slicing","wind","hpValues","hp","maxhp","failMessage","selfKO","clientPokemon","isActive","illusionIndex","_this3","genderBuf","gender","fxPrefix","toLowerCase","ignoreNicks","ignoreOpponent","nickname","speciesForme","BattleLog","escapeHTML","levelBuf","level","formechange","transform","types","terastallized","teraType","getPokemonTypes","knownPokemon","typechange","typeadd","rules","fainted","auraTurns","auraTime","exacthp","Pokemon","getHPText","reportExactHP","statusData","toxicTurns","sleepTurns","supportsAbilities","abilityText","getPokemonAbilityText","itemText","itemEffect","prevItem","prevItemEffect","renderStats","battlePokemon","findCorrespondingPokemon","_i10","_serverPokemon$moves2","moveid","moveTrack","_i12","_battlePokemon$moveTr2","row","getPPUseText","_i14","_clientPokemon$moveTr2","_ref2","isZ","isMax","pokemonHasClones","atLeastOne","_i16","_this$battle$sides4","sideConditions","sideConditionsLeft","weatherbuf","weatherLeft","slice","speciesClause","_i18","_side$pokemon4","searchid","calculateModifiedStats","statStagesOnly","_clientPokemon$effect","_clientPokemon$volati","stats","isPowerTrick","_i20","_Dex$statNamesExceptH2","statNamesExceptHP","statName","sourceStatName","clientStatName","boosts","spc","boostLevel","boostTable","atk","spe","_i22","_Dex$statNamesExceptH4","speedHalvingEVItems","isTransform","speciesName","speedModifiers","spa","def","spd","abilityActive","pokemonHasType","allyActive","_i24","allyAbility","getAllyAbility","getSpecies","_i26","_Dex$statNamesExceptH6","nfe","_i28","chainedSpeedModifier","_i30","modifier","ceil","short","isTransformed","_this$getSpeedRange","getSpeedRange","modifiedStats","hasModifiedStat","_i32","_Dex$statNamesExceptH8","_BattleText","_BattleText2","_ref3","_entry$statShortName","statLabel","fallbackShort","entry","globalThis","BattleText","shortName","statShortName","toUpperCase","_i34","_Dex$statNamesExceptH10","_BattleText3","_BattleText4","_ref4","_entry$statShortName2","moveTrackRow","showKnown","ppUsed","maxpp","substr","pp","noPPBoosts","Infinity","_i36","_pokemon$moveTrack2","_ref5","_pokemon$volatiles$tr","tr","trunc","baseSpe","baseStats","bstWithoutHp","bst","scale","fusionSpecies","isCGT","isRandomBattle","minNature","maxNature","maxIv","maxIvEvOffset","forMaxMove","pokemonTypes","getTypeList","onMemory","onPlate","onDrive","naturalGift","isGrounded","getSpeciesForme","noTypeOverride","allowTypeOverride","_pokemon$getTypes","getTypes","i","isSound","ohko","accuracyModifiers","_i38","_pokemon$side$active2","chain","_i40","mod","accuracyAfterChain","variableBPCap","multiplier","ratios","ratio","faintCounter","boostCount","_i42","_Object$values2","values","_i44","_Object$values4","ppLeft","_this$getSpeedRange2","minSpe","maxSpe","minRatio","maxRatio","_this$getSpeedRange3","fling","isGKLK","targetWeight","getWeightKg","pokemonWeight","timesAttacked","secondaries","auraBoosted","auraBroken","_i46","_pokemon$side$active4","_i48","_pokemon$side$foe$act2","getItemBoost","multihit","basePowerCallback","_value$pokemon$volati","_BattleTooltips$orbUs","_BattleTooltips$orbTy","incenseTypes","itemTypes","orbUsers","orbTypes","noGemMoves","preterastallized","_i50","_types2","curType","slot","getPokemonAbilityData","abilityData","ability2","baseAbility2","possibilities","cp","_i52","_Object$values6","newAbility","sp","hidePossible","_this4","isISLFormat","cur1","base1","cur2","base2","nameOf","cur1Name","cur2Name","base2Name","out","sets","a1","a2","known","possible","every","k","s","Boolean","_i54","a","setNum","setClass","_i56","_possible$_s2","baseAbilityName","resourcePrefix","brn","psn","tox","slp","par","frz","aura","bubbleblight","dragonblight","drowsy","fear","frostbite","Poison","Fighting","Dark","Grass","Normal","Rock","Steel","Dragon","Electric","Water","Fire","Ghost","Bug","Psychic","Ice","Flying","Ground","Fairy","Stellar","BattleStatGuesser","formatid","moveCount","hasMove","ignoreEVLimits","supportsEVs","supportsAVs","endsWith","_proto3","guess","role","guessRole","comboEVs","guessEVs","evs","plusStat","minusStat","itemid","abilityid","megaEvolves","megaStone","needsFourMoves","hasFourValidMoves","moveids","len","heal","isFast","physicalBulk","specialBulk","bulk","ultrafast","offenseBias","ensureMinEVs","evTotal","diff","change","evPriority","prioStat","ensureMaxEVs","statChart","primaryStat","getStat","ev","secondaryStat","SRweaknesses","SRresistances","SRweak","hpDivisibility","hpShouldBeDivisible","remaining","evOverride","natureOverride","_set$ivs","_set$evs","_BattleNatures","_BattleNatures2","baseStat","iv","ivs","val","BattleNatures","nature","plus","minus","friendshipValue","BattleStatOptimizer","_origSpread$evs2","_set$ivs2","origNature","origStats","getMinEVs","origSpread","origLeftoverEVs","_i58","_Dex$statNames2","statNames","_origSpread$evs","plusTooHigh","minusTooLow","bestPlus","bestPlusMinEVs","bestMinus","bestMinusMinEVs","savedEVs","_i60","_Dex$statNamesExceptH12","minEVs","_i62","_Dex$statNamesExceptH14","plusEVsSaved","newSpread","_i64","_Dex$statNames4","_i66","_Dex$statNames6","require","global"],"sources":["../src/battle-tooltips.ts"],"sourcesContent":["/**\r\n * Pokemon Showdown Tooltips\r\n *\r\n * A file for generating tooltips for battles. This should be IE7+ and\r\n * use the DOM directly.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\nimport { Pokemon, type Battle, type ServerPokemon } from \"./battle\";\r\nimport { Dex, type ModdedDex, toID, type ID } from \"./battle-dex\";\r\nimport type { BattleScene } from \"./battle-animations\";\r\nimport { BattleLog } from \"./battle-log\";\r\nimport { Move, BattleNatures } from \"./battle-dex-data\";\r\nimport { BattleTextParser } from \"./battle-text-parser\";\r\nexport class ModifiableValue {\r\n\tvalue = 0;\r\n\tmaxValue = 0;\r\n\tcomment: string[];\r\n\tbattle: Battle;\r\n\tpokemon: Pokemon;\r\n\tserverPokemon: ServerPokemon;\r\n\titemName: string;\r\n\tabilityName: string;\r\n\tweatherName: string;\r\n\tisAccuracy = false;\r\n\tconstructor(battle: Battle, pokemon: Pokemon, serverPokemon: ServerPokemon) {\r\n\t\tthis.comment = [];\r\n\t\tthis.battle = battle;\r\n\t\tthis.pokemon = pokemon;\r\n\t\tthis.serverPokemon = serverPokemon;\r\n\t\tthis.itemName = this.battle.dex.items.get(serverPokemon.item).name;\r\n\t\tconst ability = serverPokemon.ability || pokemon?.ability || serverPokemon.baseAbility;\r\n\t\tthis.abilityName = this.battle.dex.abilities.get(ability).name;\r\n\t\tthis.weatherName = this.battle.dex.moves.get(battle.weather).exists ?\r\n\t\tthis.battle.dex.moves.get(battle.weather).name : this.battle.dex.abilities.get(battle.weather).name;\r\n\t}\r\n\treset(value = 0, isAccuracy?: boolean) {\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\tthis.isAccuracy = !!isAccuracy;\r\n\t\tthis.comment = [];\r\n\t}\r\n\ttryItem(itemName: string) {\r\n\t\tif (itemName !== this.itemName) return false;\r\n\t\tif (this.battle.hasPseudoWeather('Magic Room')) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Magic Room)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.pokemon?.volatiles['embargo']) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Embargo)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst ignoreKlutz = [\r\n\t\t\t\"Macho Brace\", \"Power Anklet\", \"Power Band\", \"Power Belt\", \"Power Bracer\", \"Power Lens\", \"Power Weight\",\r\n\t\t];\r\n\t\tif (this.tryAbility('Klutz') && !ignoreKlutz.includes(itemName)) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Klutz)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\ttryAbility(abilityName: string) {\r\n\t\tif (abilityName !== this.abilityName) return false;\r\n\t\tif (this.pokemon?.volatiles['gastroacid']) {\r\n\t\t\tthis.comment.push(` (${abilityName} suppressed by Gastro Acid)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Check for Neutralizing Gas\r\n\t\tif (!this.pokemon?.effectiveAbility(this.serverPokemon)) return false;\r\n\t\treturn true;\r\n\t}\r\n\ttryWeather(weatherName?: string) {\r\n\t\tif (!this.weatherName) return false;\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\telse if (weatherName !== this.weatherName) return false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tfor (const active of side.active) {\r\n\t\t\t\tif (active && ['Air Lock', 'Cloud Nine'].includes(active.ability)) {\r\n\t\t\t\t\tthis.comment.push(` (${weatherName} suppressed by ${active.ability})`);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\titemModify(factor: number, itemName?: string) {\r\n\t\tif (!itemName) itemName = this.itemName;\r\n\t\tif (!itemName) return false;\r\n\t\tif (!this.tryItem(itemName)) return false;\r\n\t\treturn this.modify(factor, itemName);\r\n\t}\r\n\tabilityModify(factor: number, abilityName: string) {\r\n\t\tif (!this.tryAbility(abilityName)) return false;\r\n\t\treturn this.modify(factor, abilityName);\r\n\t}\r\n\tweatherModify(factor: number, weatherName?: string, name?: string) {\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\tif (!weatherName) return false;\r\n\t\tif (!this.tryWeather(weatherName)) return false;\r\n\t\treturn this.modify(factor, name || weatherName);\r\n\t}\r\n\tmodify(factor: number, name?: string) {\r\n\t\tif (factor === 0) {\r\n\t\t\tif (name) this.comment.push(` (${name})`);\r\n\t\t\tthis.value = 0;\r\n\t\t\tthis.maxValue = 0;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (name) this.comment.push(` (${this.round(factor)}&times; from ${name})`);\r\n\t\tthis.value *= factor;\r\n\t\tif (!(name === 'Technician' && this.maxValue > 60)) this.maxValue *= factor;\r\n\t\tif (this.battle.tier.includes('Super Staff Bros') && !(name === 'Confirmed Town' && this.maxValue > 60)) this.maxValue *= factor;\r\n\t\treturn true;\r\n\t}\r\n\tset(value: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\treturn true;\r\n\t}\r\n\tsetRange(value: number, maxValue: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = maxValue;\r\n\t\treturn true;\r\n\t}\r\n\tround(value: number) { return value ? Number(value.toFixed(2)) : 0; }\r\n\ttoString() {\r\n\t\tlet valueString;\r\n\t\tif (this.isAccuracy) { valueString = this.value ? `${this.round(this.value)}%` : `can't miss`; } \r\n\t\telse { valueString = this.value ? `${this.round(this.value)}` : ``; }\r\n\t\tif (this.maxValue) { valueString += ` to ${this.round(this.maxValue)}` + (this.isAccuracy ? '%' : ''); }\r\n\t\treturn valueString + this.comment.join('');\r\n\t}\r\n}\r\nexport class BattleTooltips {\r\n\tbattle: Battle;\r\n\tconstructor(battle: Battle) { this.battle = battle; }\r\n\tprivate static STATUS_ICON_PATH = Dex.resourcePrefix + \"sprites/status-is/\";\r\n\r\n\tprivate static STATUS_ICON_FILE: Record<string, string> = {\r\n\t\tbrn: \"Burn_IS.png\",\r\n\t\tpsn: \"Poison_IS.png\",\r\n\t\ttox: \"Toxic_IS.png\",\r\n\t\tslp: \"Sleep_IS.png\",\r\n\t\tpar: \"Paralysis_IS.png\",\r\n\t\tfrz: \"Frozen_IS.png\",\r\n\r\n\t\t// ISL/custom statuses\r\n\t\taura: \"Aura_IS.png\",\r\n\t\tbubbleblight: \"Bubbleblight_IS.png\",\r\n\t\tdragonblight: \"Dragonblight_IS.png\",\r\n\t\tdrowsy: \"Drowsy_IS.png\",\r\n\t\tfear: \"Fear_IS.png\",\r\n\t\tfrostbite: \"Frostbite_IS.png\",\r\n\t};\r\n\r\nprivate renderStatusIcon(status: string): string {\r\n\tconst file = BattleTooltips.STATUS_ICON_FILE[status];\r\n\tif (!file) return '';\r\n\treturn `<img class=\"status-icon tooltip-status-icon\" src=\"${BattleTooltips.STATUS_ICON_PATH}${file}\" alt=\"${status}\" />`;\r\n}\r\n\t// tooltips\r\n\t// Touch delay, pressing finger more than that time will cause the tooltip to open.\r\n\t// Shorter time will cause the button to click\r\n\tstatic LONG_TAP_DELAY = 500; // ms\r\n\tstatic LONG_CLICK_DELAY = 700; // ms\r\n\tstatic longTapTimeout = 0;\r\n\tstatic elem: HTMLDivElement | null = null;\r\n\tstatic parentElem: HTMLElement | null = null;\r\n\tstatic isLocked = false;\r\n\tstatic isPressed = false;\r\n\tstatic hideTooltip() {\r\n\t\tBattleTooltips.cancelLongTap();\r\n\t\tif (!BattleTooltips.elem) return;\r\n\t\tBattleTooltips.elem.parentNode!.removeChild(BattleTooltips.elem);\r\n\t\tBattleTooltips.elem = null;\r\n\t\tBattleTooltips.parentElem = null;\r\n\t\tBattleTooltips.isLocked = false;\r\n\t\t$('#tooltipwrapper').removeClass('tooltip-locked tooltip-locking-click tooltip-locking-tap');\r\n\t}\r\n\tstatic cancelLongTap() {\r\n\t\tif (BattleTooltips.longTapTimeout) {\r\n\t\t\tclearTimeout(BattleTooltips.longTapTimeout);\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t}\r\n\t\t$('#tooltipwrapper').removeClass('tooltip-locking-click tooltip-locking-tap');\r\n\t}\r\n\tlockTooltip() {\r\n\t\tif (BattleTooltips.elem && !BattleTooltips.isLocked) {\r\n\t\t\tBattleTooltips.isLocked = true;\r\n\t\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\t\tBattleTooltips.isPressed = false;\r\n\t\t\t}\r\n\t\t\t// $('#tooltipwrapper').removeClass('tooltip-locking');\r\n\t\t\t$('#tooltipwrapper').addClass('tooltip-locked');\r\n\t\t}\r\n\t}\r\n\thandleTouchEnd(e: TouchEvent) {\r\n\t\tBattleTooltips.cancelLongTap();\r\n\t\tif (!BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t}\r\n\tlisten(elem: HTMLElement | JQuery) {\r\n\t\tconst $elem = $(elem);\r\n\t\t$elem.on('mouseover', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('click', '.has-tooltip', this.clickTooltipEvent);\r\n\t\t$elem.on('focus', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('mouseout', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mousedown', '.has-tooltip', this.holdLockTooltipEvent);\r\n\t\t$elem.on('blur', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mouseup', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('touchstart', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.holdLockTooltipEvent(e);\r\n\t\t\tif (!BattleTooltips.parentElem) { BattleTooltips.parentElem = e.currentTarget; } // should never happen, but in case there's a bug in the tooltip handler\r\n\t\t\t$(BattleTooltips.parentElem!).addClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = true;\r\n\t\t});\r\n\t\t$elem.on('touchend', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tif (e.currentTarget === BattleTooltips.parentElem && BattleTooltips.isPressed) { BattleTooltips.parentElem!.click(); }\r\n\t\t\tBattleTooltips.unshowTooltip();\r\n\t\t});\r\n\t\t$elem.on('touchleave', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('touchcancel', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t}\r\n\tclickTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\t//* An event that will lock a tooltip if held down (Namely, a long-tap or long-click)\r\n\tholdLockTooltipEvent = (e: JQuery.TriggeredEvent) => {\r\n\t\tif (BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t\tconst target = e.currentTarget as HTMLElement;\r\n\t\tthis.showTooltip(target);\r\n\t\tconst isClick = (e.type === 'mousedown' && target.tagName === 'BUTTON');\r\n\t\tBattleTooltips.longTapTimeout = setTimeout(() => {\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t\tthis.lockTooltip();\r\n\t\t}, isClick ? BattleTooltips.LONG_CLICK_DELAY : BattleTooltips.LONG_TAP_DELAY);\r\n\t\tif (isClick) { $('#tooltipwrapper').addClass('tooltip-locking-click'); } \r\n\t\telse { $('#tooltipwrapper').addClass('tooltip-locking-tap'); }\r\n\t};\r\n\tshowTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tthis.showTooltip(e.currentTarget as HTMLElement);\r\n\t};\r\n\t// Only hides tooltips if they're not locked\r\n\tstatic unshowTooltip() {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = false;\r\n\t\t}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\tshowTooltip(elem: HTMLElement) {\r\n\t\tconst args = (elem.dataset.tooltip || '').split('|');\r\n\t\tconst [type] = args;\r\n\t\t/**\r\n\t\t * If false, we instead attach the tooltip above the parent element.\r\n\t\t * This is important for the move/switch menus so the tooltip doesn't\r\n\t\t * cover up buttons above the hovered button.\r\n\t\t */\r\n\t\tlet ownHeight = !!elem.dataset.ownheight;\r\n\t\tlet buf: string;\r\n\t\tswitch (type) {\r\n\t\tcase 'move':\r\n\t\tcase 'zmove':\r\n\t\tcase 'maxmove': { // move|MOVE|ACTIVEPOKEMON|[GMAXMOVE]\r\n\t\t\tlet move = this.battle.dex.moves.get(args[1]);\r\n\t\t\tlet teamIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemon = this.battle.nearSide.active[teamIndex + this.battle.pokemonControlled * Math.floor(this.battle.mySide.n / 2)];\r\n\t\t\tlet gmaxMove = args[3] ? this.battle.dex.moves.get(args[3]) : undefined;\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![teamIndex];\r\n\t\t\tbuf = this.showMoveTooltip(move, type, pokemon, serverPokemon, gmaxMove);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'pokemon': { // pokemon|SIDE|POKEMON\r\n\t\t\t// mouse over sidebar pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon always ignored\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[sideIndex];\r\n\t\t\tlet pokemon = side.pokemon[parseInt(args[2], 10)];\r\n\t\t\tif (args[3] === 'illusion') {\r\n\t\t\t\tbuf = '';\r\n\t\t\t\tconst species = pokemon.getBaseSpecies().baseSpecies;\r\n\t\t\t\tlet index = 1;\r\n\t\t\t\tfor (const otherPokemon of side.pokemon) {\r\n\t\t\t\t\tif (otherPokemon.getBaseSpecies().baseSpecies === species) {\r\n\t\t\t\t\t\tbuf += this.showPokemonTooltip(otherPokemon, null, false, index);\r\n\t\t\t\t\t\tindex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else { buf = this.showPokemonTooltip(pokemon); }\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'activepokemon': { // activepokemon|SIDE|ACTIVE\r\n\t\t\t// mouse over active pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon maybe\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[+this.battle.viewpointSwitched ^ sideIndex];\r\n\t\t\tlet activeIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemonIndex = activeIndex;\r\n\t\t\tif (activeIndex >= 1 && this.battle.sides.length > 2) {\r\n\t\t\t\tpokemonIndex -= 1;\r\n\t\t\t\tside = this.battle.sides[side.n + 2];\r\n\t\t\t}\r\n\t\t\tlet pokemon = side.active[activeIndex];\r\n\t\t\tlet serverPokemon = null;\r\n\t\t\tif (side === this.battle.mySide && this.battle.myPokemon) { serverPokemon = this.battle.myPokemon[pokemonIndex]; }\r\n\t\t\tif (side === this.battle.mySide.ally && this.battle.myAllyPokemon) { serverPokemon = this.battle.myAllyPokemon[pokemonIndex]; }\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon, true);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'switchpokemon': { // switchpokemon|POKEMON\r\n\t\t\t// mouse over switchable pokemon\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/* if (activeIndex < side.active.length && activeIndex < this.battle.pokemonControlled) {\r\n\t\t\t\tpokemon = side.active[activeIndex];\r\n\t\t\t\tif (pokemon && pokemon.side === side.ally) pokemon = null;\r\n\t\t\t} */\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![activeIndex];\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'allypokemon': { // allypokemon|POKEMON\r\n\t\t\t// mouse over ally's pokemon in multi battles\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide.ally;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/* if (activeIndex < side.pokemon.length) {\r\n\t\t\t\tpokemon = side.pokemon[activeIndex] || side.ally ? side.ally.pokemon[activeIndex] : null;\r\n\t\t\t} */\r\n\t\t\tlet serverPokemon = this.battle.myAllyPokemon ? this.battle.myAllyPokemon[activeIndex] : null;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'field': {\r\n\t\t\tbuf = this.showFieldTooltip();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\t// \"throws\" an error without crashing\r\n\t\t\tPromise.resolve(new Error(`unrecognized type`));\r\n\t\t\tbuf = `<p class=\"message-error\" style=\"white-space: pre-wrap\">${new Error(`unrecognized type`).stack!}</p>`;\r\n\t\t}\r\n\t\tthis.placeTooltip(buf, elem, ownHeight, type);\r\n\t\treturn true;\r\n\t}\r\n\tplaceTooltip(innerHTML: string, hoveredElem?: HTMLElement, notRelativeToParent?: boolean, type?: string) {\r\n\t\tlet $elem;\r\n\t\tif (hoveredElem) { $elem = $(hoveredElem); } \r\n\t\telse {\r\n\t\t\t$elem = (this.battle.scene as BattleScene).$turn;\r\n\t\t\tnotRelativeToParent = true;\r\n\t\t}\r\n\t\tlet hoveredX1 = $elem.offset()!.left;\r\n\t\tif (!notRelativeToParent) { $elem = $elem.parent(); }\r\n\t\tlet hoveredY1 = $elem.offset()!.top;\r\n\t\tlet hoveredY2 = hoveredY1 + $elem.outerHeight()!;\r\n\t\t// (x, y) are the left and top offsets of #tooltipwrapper, which mark the\r\n\t\t// BOTTOM LEFT CORNER of the tooltip\r\n\t\tlet x = Math.max(hoveredX1 - 2, 0);\r\n\t\tlet y = Math.max(hoveredY1 - 5, 0);\r\n\t\tlet $wrapper = $('#tooltipwrapper');\r\n\t\tif (!$wrapper.length) {\r\n\t\t\t$wrapper = $(`<div id=\"tooltipwrapper\" role=\"tooltip\"></div>`);\r\n\t\t\t$(document.body).append($wrapper);\r\n\t\t\t$wrapper.on('click', e => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst selection = window.getSelection()!;\r\n\t\t\t\t\tif (selection.type === 'Range') return;\r\n\t\t\t\t} catch {}\r\n\t\t\t\tBattleTooltips.hideTooltip();\r\n\t\t\t});\r\n\t\t} else { $wrapper.removeClass('tooltip-locked'); }\r\n\t\t$wrapper.css({\r\n\t\t\tleft: Math.min(x, document.documentElement.clientWidth - 400),\r\n\t\t\ttop: y,\r\n\t\t});\r\n\t\tinnerHTML = `<div class=\"tooltipinner\"><div class=\"tooltip tooltip-${type!}\">${innerHTML}</div></div>`;\r\n\t\t$wrapper.html(innerHTML).appendTo(document.body);\r\n\t\tBattleTooltips.elem = $wrapper.find('.tooltip')[0] as HTMLDivElement;\r\n\t\tBattleTooltips.isLocked = false;\r\n\t\tlet height = $(BattleTooltips.elem).outerHeight()!;\r\n\t\tif (y - height < 1) {\r\n\t\t\t// tooltip is too tall to fit above the element:\r\n\t\t\t// try to fit it below it instead\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y > document.documentElement.clientHeight) { y = height + 1; }\r\n\t\t\t$wrapper.css('top', y);\r\n\t\t} else if (y < 75) {\r\n\t\t\t// tooltip is pretty high up, put it below the element if it fits\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y < document.documentElement.clientHeight) { $wrapper.css('top', y); }\r\n\t\t}\r\n\t\tlet width = $(BattleTooltips.elem).outerWidth()!;\r\n\t\tconst availableWidth = document.documentElement.clientWidth + window.scrollX;\r\n\t\tif (x > availableWidth - width - 2) {\r\n\t\t\tx = availableWidth - width - 2;\r\n\t\t\t$wrapper.css('left', x);\r\n\t\t} else if (x > document.documentElement.clientWidth - 400) { $wrapper.css('left', x); }\r\n\t\tBattleTooltips.parentElem = hoveredElem || null;\r\n\t\treturn true;\r\n\t}\r\n\thideTooltip() { BattleTooltips.hideTooltip(); }\r\n\tstatic zMoveEffects: { [zEffect: string]: string } = {\r\n\t\t'clearnegativeboost': \"Restores negative stat stages to 0\",\r\n\t\t'crit2': \"Crit ratio +2\",\r\n\t\t'heal': \"Restores HP 100%\",\r\n\t\t'curse': \"Restores HP 100% if user is Ghost type, otherwise Attack +1\",\r\n\t\t'redirect': \"Redirects opposing attacks to user\",\r\n\t\t'healreplacement': \"Restores replacement's HP 100%\",\r\n\t};\r\n\tgetStatusZMoveEffect(move: Dex.Move) {\r\n\t\tif (move.zMove!.effect! in BattleTooltips.zMoveEffects) { return BattleTooltips.zMoveEffects[move.zMove!.effect!]; }\r\n\t\tlet boostText = '';\r\n\t\tif (move.zMove!.boost) {\r\n\t\t\tboostText = Object.entries(move.zMove!.boost).map(([stat, boost]) => `${BattleTextParser.stat(stat)} +${boost}`).join(', ');\r\n\t\t}\r\n\t\treturn boostText;\r\n\t}\r\n\tstatic zMoveTable: { [type in Dex.TypeName]: string } = {\r\n\t\tPoison: \"Acid Downpour\",\r\n\t\tFighting: \"All-Out Pummeling\",\r\n\t\tDark: \"Black Hole Eclipse\",\r\n\t\tGrass: \"Bloom Doom\",\r\n\t\tNormal: \"Breakneck Blitz\",\r\n\t\tRock: \"Continental Crush\",\r\n\t\tSteel: \"Corkscrew Crash\",\r\n\t\tDragon: \"Devastating Drake\",\r\n\t\tElectric: \"Gigavolt Havoc\",\r\n\t\tWater: \"Hydro Vortex\",\r\n\t\tFire: \"Inferno Overdrive\",\r\n\t\tGhost: \"Never-Ending Nightmare\",\r\n\t\tBug: \"Savage Spin-Out\",\r\n\t\tPsychic: \"Shattered Psyche\",\r\n\t\tIce: \"Subzero Slammer\",\r\n\t\tFlying: \"Supersonic Skystrike\",\r\n\t\tGround: \"Tectonic Rage\",\r\n\t\tFairy: \"Twinkle Tackle\",\r\n\t\tStellar: \"\",\r\n\t\t\"???\": \"\",\r\n\t};\r\n\tstatic maxMoveTable: { [type in Dex.TypeName]: string } = {\r\n\t\tPoison: \"Max Ooze\",\r\n\t\tFighting: \"Max Knuckle\",\r\n\t\tDark: \"Max Darkness\",\r\n\t\tGrass: \"Max Overgrowth\",\r\n\t\tNormal: \"Max Strike\",\r\n\t\tRock: \"Max Rockfall\",\r\n\t\tSteel: \"Max Steelspike\",\r\n\t\tDragon: \"Max Wyrmwind\",\r\n\t\tElectric: \"Max Lightning\",\r\n\t\tWater: \"Max Geyser\",\r\n\t\tFire: \"Max Flare\",\r\n\t\tGhost: \"Max Phantasm\",\r\n\t\tBug: \"Max Flutterby\",\r\n\t\tPsychic: \"Max Mindstorm\",\r\n\t\tIce: \"Max Hailstorm\",\r\n\t\tFlying: \"Max Airstream\",\r\n\t\tGround: \"Max Quake\",\r\n\t\tFairy: \"Max Starfall\",\r\n\t\tStellar: \"\",\r\n\t\t\"???\": \"\",\r\n\t};\r\n\tgetMaxMoveFromType(type: Dex.TypeName, gmaxMove?: string | Dex.Move) {\r\n\t\tif (gmaxMove) {\r\n\t\t\tif (typeof gmaxMove === 'string') gmaxMove = this.battle.dex.moves.get(gmaxMove);\r\n\t\t\tif (type === gmaxMove.type) return gmaxMove;\r\n\t\t}\r\n\t\treturn this.battle.dex.moves.get(BattleTooltips.maxMoveTable[type]);\r\n\t}\r\n\tshowMoveTooltip(move: Dex.Move, isZOrMax: string, pokemon: Pokemon, serverPokemon: ServerPokemon, gmaxMove?: Dex.Move) {\r\n\t\tlet text = '';\r\n\t\tlet zEffect = '';\r\n\t\tlet foeActive = pokemon.side.foe.active;\r\n\t\tif (this.battle.gameType === 'freeforall') { foeActive = [...foeActive, ...pokemon.side.active].filter(active => active !== pokemon); }\r\n\t\t// TODO: move this somewhere it makes more sense\r\n\t\tif (pokemon.ability === '(suppressed)') serverPokemon.ability = '(suppressed)';\r\n\t\tlet ability = toID(serverPokemon.ability || pokemon.ability || serverPokemon.baseAbility);\r\n\t\tlet item = this.battle.dex.items.get(serverPokemon.item);\r\n\t\tlet value = new ModifiableValue(this.battle, pokemon, serverPokemon);\r\n\t\tlet [moveType, category] = this.getMoveType(move, value, gmaxMove || isZOrMax === 'maxmove');\r\n\t\tlet categoryDiff = move.category !== category;\r\n\r\n\t\tif (isZOrMax === 'zmove') {\r\n\t\t\tif (item.zMoveFrom === move.name) {\r\n\t\t\t\tmove = this.battle.dex.moves.get(item.zMove as string);\r\n\t\t\t} else if (move.category === 'Status') {\r\n\t\t\t\tmove = new Move(move.id, \"\", {\r\n\t\t\t\t\t...move,\r\n\t\t\t\t\tname: 'Z-' + move.name,\r\n\t\t\t\t});\r\n\t\t\t\tzEffect = this.getStatusZMoveEffect(move);\r\n\t\t\t} else {\r\n\t\t\t\tlet moveName = BattleTooltips.zMoveTable[item.zMoveType as Dex.TypeName];\r\n\t\t\t\tlet zMove = this.battle.dex.moves.get(moveName);\r\n\t\t\t\tlet movePower = move.zMove!.basePower;\r\n\t\t\t\t// the different Hidden Power types don't have a Z power set, fall back on base move\r\n\t\t\t\tif (!movePower && move.id.startsWith('hiddenpower')) { movePower = this.battle.dex.moves.get('hiddenpower').zMove!.basePower; }\r\n\t\t\t\tif (move.id === 'weatherball') {\r\n\t\t\t\t\tswitch (this.battle.weather) {\r\n\t\t\t\t\tcase 'sunnyday':\r\n\t\t\t\t\tcase 'desolateland':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Fire']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'raindance':\r\n\t\t\t\t\tcase 'primordialsea':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Water']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sandstorm':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Rock']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'hail':\r\n\t\t\t\t\tcase 'snowscape':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Ice']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tmove = new Move(zMove.id, zMove.name, {\r\n\t\t\t\t\t...zMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower: movePower,\r\n\t\t\t\t});\r\n\t\t\t\tcategoryDiff = false;\r\n\t\t\t}\r\n\t\t} else if (isZOrMax === 'maxmove') {\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tmove = this.battle.dex.moves.get('Max Guard');\r\n\t\t\t} else {\r\n\t\t\t\tlet maxMove = this.getMaxMoveFromType(moveType, gmaxMove);\r\n\t\t\t\tconst basePower = ['gmaxdrumsolo', 'gmaxfireball', 'gmaxhydrosnipe'].includes(maxMove.id) ?\r\n\t\t\t\t\tmaxMove.basePower : move.maxMove.basePower;\r\n\t\t\t\tmove = new Move(maxMove.id, maxMove.name, {\r\n\t\t\t\t\t...maxMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower,\r\n\t\t\t\t});\r\n\t\t\t\tcategoryDiff = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (categoryDiff) {\r\n\t\t\tmove = new Move(move.id, move.name, {\r\n\t\t\t\t...move,\r\n\t\t\t\tcategory,\r\n\t\t\t});\r\n\t\t}\r\n\t\ttext += `<h2>${move.name}<br />`;\r\n\t\ttext += Dex.getTypeIcon(moveType);\r\n\t\ttext += ` ${Dex.getCategoryIcon(category)}</h2>`;\r\n\t\t// Check if there are more than one active Pokémon to check for multiple possible BPs.\r\n\t\tlet showingMultipleBasePowers = false;\r\n\t\tif (category !== 'Status' && foeActive.length > 1) {\r\n\t\t\t// We check if there is a difference in base powers to note it.\r\n\t\t\t// Otherwise, it is just shown as in singles.\r\n\t\t\t// The trick is that we need to calculate it first for each Pokémon to see if it changes.\r\n\t\t\tlet prevBasePower: string | null = null;\r\n\t\t\tlet basePower = '';\r\n\t\t\tlet difference = false;\r\n\t\t\tlet basePowers = [];\r\n\t\t\tfor (const active of foeActive) {\r\n\t\t\t\tif (!active) continue;\r\n\t\t\t\tvalue = this.getMoveBasePower(move, moveType, value, active);\r\n\t\t\t\tbasePower = `${value}`;\r\n\t\t\t\tif (prevBasePower === null) prevBasePower = basePower;\r\n\t\t\t\tif (prevBasePower !== basePower) difference = true;\r\n\t\t\t\tbasePowers.push(`Base power vs ${active.name}: ${basePower}`);\r\n\t\t\t}\r\n\t\t\tif (difference) {\r\n\t\t\t\ttext += '<p>' + basePowers.join('<br />') + '</p>';\r\n\t\t\t\tshowingMultipleBasePowers = true;\r\n\t\t\t}\r\n\t\t\t// Falls through to not to repeat code on showing the base power.\r\n\t\t}\r\n\t\tif (!showingMultipleBasePowers && category !== 'Status') {\r\n\t\t\tlet activeTarget = foeActive[0] || foeActive[1] || foeActive[2];\r\n\t\t\tvalue = this.getMoveBasePower(move, moveType, value, activeTarget);\r\n\t\t\ttext += `<p>Base power: ${value}</p>`;\r\n\t\t}\r\n\t\tlet accuracy = this.getMoveAccuracy(move, value);\r\n\t\t// Deal with Nature Power special case, indicating which move it calls.\r\n\t\tif (move.id === 'naturepower') {\r\n\t\t\tlet calls;\r\n\t\t\tif (this.battle.gen > 5) {\r\n\t\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) { calls = 'Thunderbolt'; } \r\n\t\t\t\telse if (this.battle.hasPseudoWeather('Grassy Terrain')) { calls = 'Energy Ball'; } \r\n\t\t\t\telse if (this.battle.hasPseudoWeather('Misty Terrain')) { calls = 'Moonblast'; } \r\n\t\t\t\telse if (this.battle.hasPseudoWeather('Psychic Terrain')) { calls = 'Psychic'; } \r\n\t\t\t\telse { calls = 'Tri Attack'; }\r\n\t\t\t} else if (this.battle.gen > 3) { calls = 'Earthquake'; } \r\n\t\t\telse { calls = 'Swift'; }\r\n\t\t\tlet calledMove = this.battle.dex.moves.get(calls);\r\n\t\t\ttext += `Calls ${Dex.getTypeIcon(this.getMoveType(calledMove, value)[0])} ${calledMove.name}`;\r\n\t\t}\r\n\t\ttext += `<p>Accuracy: ${accuracy}</p>`;\r\n\t\tif (zEffect) text += `<p>Z-Effect: ${zEffect}</p>`;\r\n\t\tif (this.battle.hardcoreMode) { text += `<p class=\"tooltip-section\">${move.shortDesc}</p>`; } \r\n\t\telse {\r\n\t\t\ttext += '<p class=\"tooltip-section\">';\r\n\t\t\tif (move.priority > 1) { text += `Nearly always moves first <em>(priority +${move.priority})</em>.</p><p>`; } \r\n\t\t\telse if (move.priority <= -1) { text += `Nearly always moves last <em>(priority &minus;${-move.priority})</em>.</p><p>`; } \r\n\t\t\telse if (move.priority === 1) { text += `Usually moves first <em>(priority +${move.priority})</em>.</p><p>`; } \r\n\t\t\telse { if (move.id === 'grassyglide' && this.battle.hasPseudoWeather('Grassy Terrain')) {text += 'Usually moves first <em>(priority +1)</em>.</p><p>';} }\r\n\t\t\ttext += '' + (move.desc || move.shortDesc || '') + '</p>';\r\n\t\t\tif (this.battle.gameType === 'doubles' || this.battle.gameType === 'multi') {\r\n\t\t\t\tif (move.target === 'allAdjacent') { text += '<p>&#x25ce; Hits both foes and ally.</p>'; } \r\n\t\t\t\telse if (move.target === 'allAdjacentFoes') { text += '<p>&#x25ce; Hits both foes.</p>'; }\r\n\t\t\t} else if (this.battle.gameType === 'triples') {\r\n\t\t\t\tif (move.target === 'allAdjacent') { text += '<p>&#x25ce; Hits adjacent foes and allies.</p>'; } \r\n\t\t\t\telse if (move.target === 'allAdjacentFoes') { text += '<p>&#x25ce; Hits adjacent foes.</p>'; } \r\n\t\t\t\telse if (move.target === 'any') { text += '<p>&#x25ce; Can target distant Pok&eacute;mon in Triples.</p>'; }\r\n\t\t\t} else if (this.battle.gameType === 'freeforall') {\r\n\t\t\t\tif (move.target === 'allAdjacent' || move.target === 'allAdjacentFoes') { text += '<p>&#x25ce; Hits all foes.</p>'; } \r\n\t\t\t\telse if (move.target === 'adjacentAlly') { text += '<p>&#x25ce; Can target any foe in Free-For-All.</p>'; }\r\n\t\t\t}\r\n\t\t\tif (move.flags.defrost) { text += `<p class=\"movetag\">The user thaws out if it is frozen.</p>`; }\r\n\t\t\tif (!move.flags.protect && !['self', 'allySide'].includes(move.target)) { text += `<p class=\"movetag\">Not blocked by Protect <small>(and Detect, King's Shield, Spiky Shield)</small></p>`; }\r\n\t\t\tif (move.flags.bypasssub) { text += `<p class=\"movetag\">Bypasses Substitute <small>(but does not break it)</small></p>`; }\r\n\t\t\tif (!move.flags.reflectable && !['self', 'allySide'].includes(move.target) && move.category === 'Status') { text += `<p class=\"movetag\">&#x2713; Not bounceable <small>(can't be bounced by Magic Coat/Bounce)</small></p>`; }\r\n\t\t\tif (move.flags.contact) { text += `<p class=\"movetag\">&#x2713; Contact <small>(triggers Iron Barbs, Spiky Shield, etc)</small></p>`; }\r\n\t\t\tif (move.flags.sound) { text += `<p class=\"movetag\">&#x2713; Sound <small>(doesn't affect Soundproof pokemon)</small></p>`; }\r\n\t\t\tif (move.flags.powder && this.battle.gen > 5) { text += `<p class=\"movetag\">&#x2713; Powder <small>(doesn't affect Grass, Overcoat, Safety Goggles)</small></p>`; }\r\n\t\t\tif (move.flags.punch && ability === 'ironfist') { text += `<p class=\"movetag\">&#x2713; Fist <small>(boosted by Iron Fist)</small></p>`; }\r\n\t\t\tif (move.flags.pulse && ability === 'megalauncher') { text += `<p class=\"movetag\">&#x2713; Pulse <small>(boosted by Mega Launcher)</small></p>`; }\r\n\t\t\tif (move.flags.bite && ability === 'strongjaw') { text += `<p class=\"movetag\">&#x2713; Bite <small>(boosted by Strong Jaw)</small></p>`; }\r\n\t\t\tif ((move.recoil || move.hasCrashDamage) && ability === 'reckless') { text += `<p class=\"movetag\">&#x2713; Recoil <small>(boosted by Reckless)</small></p>`; }\r\n\t\t\tif (move.flags.bullet) { text += `<p class=\"movetag\">&#x2713; Bullet-like <small>(doesn't affect Bulletproof pokemon)</small></p>`; }\r\n\t\t\tif (move.flags.slicing) { text += `<p class=\"movetag\">&#x2713; Slicing <small>(boosted by Sharpness)</small></p>`; }\r\n\t\t\tif (move.flags.wind) { text += `<p class=\"movetag\">&#x2713; Wind <small>(activates Wind Power and Wind Rider)</small></p>`; }\r\n\t\t\t// RBY healing move glitch\r\n\t\t\tif (this.battle.gen === 1 && !toID(this.battle.tier).includes('stadium') &&\r\n\t\t\t\t['recover', 'softboiled', 'rest'].includes(move.id)) {\r\n\t\t\t\tconst hpValues = [];\r\n\t\t\t\t// glitches at HP values equal to `maxHP + 1 % 256` unless they are `0 % 256`\r\n\t\t\t\tconst hp = serverPokemon.maxhp - 255;\r\n\t\t\t\tif (hp > 0 && hp % 256 !== 0) {\r\n\t\t\t\t\thpValues.push(hp);\r\n\t\t\t\t\tif (hp - 256 > 0) { hpValues.push(hp - 256); }\r\n\t\t\t\t}\r\n\t\t\t\tlet failMessage = hpValues.length ? `Fails if current HP is ${hpValues.join(' or ')}.` : '';\r\n\t\t\t\tif (hpValues.includes(serverPokemon.hp)) failMessage = `<strong class=\"message-error\">${failMessage}</strong>`;\r\n\t\t\t\tif (failMessage) text += `<p>${failMessage}</p>`;\r\n\t\t\t}\r\n\t\t\tif (this.battle.gen === 1 && !toID(this.battle.tier).includes('stadium') &&\r\n\t\t\t\tmove.id === 'substitute') {\r\n\t\t\t\tconst selfKO = serverPokemon.maxhp % 4 === 0 ? serverPokemon.maxhp / 4 : null;\r\n\t\t\t\tlet failMessage = selfKO ? `KOs yourself if current HP is exactly ${selfKO}.` : '';\r\n\t\t\t\tif (selfKO === serverPokemon.hp) failMessage = `<strong class=\"message-error\">${failMessage}</strong>`;\r\n\t\t\t\tif (failMessage) text += `<p>${failMessage}</p>`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\t/**\r\n\t * Needs either a Pokemon or a ServerPokemon, but note that neither\r\n\t * are guaranteed: If you hover over a possible switch-in that's\r\n\t * never been switched in before, you'll only have a ServerPokemon,\r\n\t * and if you hover over an opponent's pokemon, you'll only have a\r\n\t * Pokemon.\r\n\t * isActive is true if hovering over a pokemon in the battlefield,\r\n\t * and false if hovering over a pokemon in the Switch menu.\r\n\t */\r\n\tshowPokemonTooltip(clientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, isActive?: boolean, illusionIndex?: number) {\r\n\t\tconst pokemon = clientPokemon || serverPokemon!;\r\n\t\tlet text = '';\r\n\t\tlet genderBuf = '';\r\n\t\tconst gender = pokemon.gender;\r\n\t\tif (gender === 'M' || gender === 'F') { genderBuf = ` <img src=\"${Dex.fxPrefix}gender-${gender.toLowerCase()}.png\" alt=\"${gender}\" width=\"7\" height=\"10\" class=\"pixelated\" /> `; }\r\n\r\n\t\tconst ignoreNicks = this.battle.ignoreNicks || this.battle.ignoreOpponent;\r\n\t\tconst nickname = ignoreNicks ? Dex.species.get(pokemon.speciesForme).baseSpecies : pokemon.name;\r\n\t\tlet name = BattleLog.escapeHTML(nickname);\r\n\t\tif (pokemon.speciesForme !== nickname) { name += ` <small>(${BattleLog.escapeHTML(pokemon.speciesForme)})</small>`; }\r\n\t\tlet levelBuf = (pokemon.level !== 100 ? ` <small>L${pokemon.level}</small>` : ``);\r\n\t\tif (!illusionIndex || illusionIndex === 1) {\r\n\t\t\ttext += `<h2>${name}${genderBuf}${illusionIndex ? '' : levelBuf}<br />`;\r\n\t\t\tif (clientPokemon?.volatiles.formechange) {\r\n\t\t\t\tif (clientPokemon.volatiles.transform) { text += `<small>(Transformed into ${clientPokemon.volatiles.formechange[1]})</small><br />`; } \r\n\t\t\t\telse { text += `<small>(Changed forme: ${clientPokemon.volatiles.formechange[1]})</small><br />`; }\r\n\t\t\t}\r\n\t\t\tlet types = serverPokemon?.terastallized ? [serverPokemon.teraType] : this.getPokemonTypes(pokemon);\r\n\t\t\tlet knownPokemon = serverPokemon || clientPokemon!;\r\n\t\t\tif (pokemon.terastallized) { text += `<small>(Terastallized)</small><br />`; } \r\n\t\t\telse if (clientPokemon?.volatiles.typechange || clientPokemon?.volatiles.typeadd) { text += `<small>(Type changed)</small><br />`; }\r\n\t\t\ttext += `<span class=\"textaligned-typeicons\">${types.map(type => Dex.getTypeIcon(type)).join(' ')}</span>`;\r\n\t\t\tif (pokemon.terastallized) { text += `&nbsp; &nbsp; <small>(base: <span class=\"textaligned-typeicons\">${this.getPokemonTypes(pokemon, true).map(type => Dex.getTypeIcon(type)).join(' ')}</span>)</small>`; } \r\n\t\t\telse if (knownPokemon.teraType && !this.battle.rules['Terastal Clause']) { text += `&nbsp; &nbsp; <small>(Tera Type: <span class=\"textaligned-typeicons\">${Dex.getTypeIcon(knownPokemon.teraType)}</span>)</small>`; }\r\n\t\t\ttext += `</h2>`;\r\n\t\t}\r\n\t\tif (illusionIndex) { text += `<p class=\"tooltip-section\"><strong>Possible Illusion #${illusionIndex}</strong>${levelBuf}</p>`; }\r\n\t\tif (pokemon.fainted) { text += '<p><small>HP:</small> (fainted)</p>'; } \r\n\t\telse if (this.battle.hardcoreMode) {\r\n\t\t\tif (serverPokemon) {\r\n\t\t\t\tconst auraTurns = (pokemon.status === 'aura') ? (Number((clientPokemon as any)?.auraTime) || 0) : 0;\r\nconst status = pokemon.status\r\n\t? ` ${this.renderStatusIcon(pokemon.status)}${auraTurns ? ` <small>- ${auraTurns} Turn${auraTurns === 1 ? '' : 's'}</small>` : ''}`\r\n\t: '';\r\n\t\t\t\ttext += `<p><small>HP:</small> ${serverPokemon.hp}/${serverPokemon.maxhp}${status}</p>`;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet exacthp = '';\r\n\t\t\tif (serverPokemon) { exacthp = ` (${serverPokemon.hp}/${serverPokemon.maxhp})`; } \r\n\t\t\telse if (pokemon.maxhp === 48) { exacthp = ` <small>(${pokemon.hp}/${pokemon.maxhp} pixels)</small>`; }\r\n\t\t\tconst auraTurns = (pokemon.status === 'aura') ? (Number((clientPokemon as any)?.auraTime) || 0) : 0;\r\nconst status = pokemon.status\r\n\t? ` ${this.renderStatusIcon(pokemon.status)}${auraTurns ? ` <small>- ${auraTurns} Turn${auraTurns === 1 ? '' : 's'}</small>` : ''}`\r\n\t: '';\r\n\t\t\ttext += `<p><small>HP:</small> ${Pokemon.getHPText(pokemon, this.battle.reportExactHP)}${exacthp}${status}`;\r\n\t\t\tif (clientPokemon) {\r\n\t\t\t\tif (pokemon.status === 'tox') {\r\n\t\t\t\t\tif (pokemon.ability === 'Poison Heal' || pokemon.ability === 'Magic Guard') {\r\n\t\t\t\t\t\ttext += ` <small>Would take if ability removed: ${Math.floor(100 / 16 * Math.min(clientPokemon.statusData.toxicTurns + 1, 15))}%</small>`;\r\n\t\t\t\t\t} else { text += ` Next damage: ${Math.floor(100 / (clientPokemon.volatiles['dynamax'] ? 32 : 16) * Math.min(clientPokemon.statusData.toxicTurns + 1, 15))}%`; }\r\n\t\t\t\t} else if (pokemon.status === 'slp') { text += ` Turns asleep: ${clientPokemon.statusData.sleepTurns}`; }\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\t\tconst supportsAbilities = this.battle.gen > 2 && !this.battle.tier.includes(\"Let's Go\");\r\n\t\tlet abilityText = '';\r\n\t\tif (supportsAbilities) { abilityText = this.getPokemonAbilityText(clientPokemon, serverPokemon, isActive, !!illusionIndex && illusionIndex > 1); }\r\n\t\tlet itemText = '';\r\n\t\tif (serverPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = '';\r\n\t\t\tif (clientPokemon?.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tlet prevItem = this.battle.dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (serverPokemon.item) item = this.battle.dex.items.get(serverPokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t} else if (clientPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = clientPokemon.itemEffect || '';\r\n\t\t\tif (clientPokemon.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tif (itemEffect) itemEffect += '; ';\r\n\t\t\t\tlet prevItem = this.battle.dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (pokemon.item) item = this.battle.dex.items.get(pokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t}\r\n\t\tif (abilityText || itemText) {\r\n\t\t\ttext += '<p>';\r\n\t\t\ttext += abilityText;\r\n\t\t\tif (abilityText && itemText) { text += ' / '; } // ability/item on one line\r\n\t\t\ttext += itemText;\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\t\ttext += this.renderStats(clientPokemon, serverPokemon, !isActive);\r\n\t\tif (serverPokemon && !isActive) {\r\n\t\t\t// move list\r\n\t\t\ttext += `<p class=\"tooltip-section\">`;\r\n\t\t\tconst battlePokemon = clientPokemon || this.battle.findCorrespondingPokemon(pokemon);\r\n\t\t\tfor (const moveid of serverPokemon.moves) {\r\n\t\t\t\tconst move = this.battle.dex.moves.get(moveid);\r\n\t\t\t\tlet moveName = `&#8226; ${move.name}`;\r\n\t\t\t\tif (battlePokemon?.moveTrack) {\r\n\t\t\t\t\tfor (const row of battlePokemon.moveTrack) {\r\n\t\t\t\t\t\tif (moveName === row[0]) {\r\n\t\t\t\t\t\t\tmoveName = this.getPPUseText(row, true);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttext += `${moveName}<br />`;\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t} else if (!this.battle.hardcoreMode && clientPokemon?.moveTrack.length) {\r\n\t\t\t// move list (guessed)\r\n\t\t\ttext += `<p class=\"tooltip-section\">`;\r\n\t\t\tfor (const row of clientPokemon.moveTrack) { text += `${this.getPPUseText(row)}<br />`; }\r\n\t\t\tif (clientPokemon.moveTrack.filter(([moveName]) => {\r\n\t\t\t\tif (moveName.startsWith('*')) return false;\r\n\t\t\t\tconst move = this.battle.dex.moves.get(moveName);\r\n\t\t\t\treturn !move.isZ && !move.isMax && move.name !== 'Mimic';\r\n\t\t\t}).length > 4) { text += `(More than 4 moves is usually a sign of Illusion Zoroark/Zorua.) `; }\r\n\t\t\tif (this.battle.gen === 3) { text += `(Pressure is not visible in Gen 3, so in certain situations, more PP may have been lost than shown here.) `; }\r\n\t\t\tif (this.pokemonHasClones(clientPokemon)) { text += `(Your opponent has two indistinguishable Pokémon, making it impossible for you to tell which one has which moves/ability/item.) `; }\r\n\t\t\ttext += `</p>`;\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\tshowFieldTooltip() {\r\n\t\tconst scene = this.battle.scene as BattleScene;\r\n\t\tlet buf = `<table style=\"border: 0; border-collapse: collapse; vertical-align: top; padding: 0; width: 100%\"><tr>`;\r\n\t\tlet atLeastOne = false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tconst sideConditions = scene.sideConditionsLeft(side, true);\r\n\t\t\tif (sideConditions) atLeastOne = true;\r\n\t\t\tbuf += `<td><p class=\"tooltip-section\"><strong>${BattleLog.escapeHTML(side.name)}</strong>${sideConditions || \"<br />(no conditions)\"}</p></td>`;\r\n\t\t}\r\n\t\tbuf += `</tr><table>`;\r\n\t\tif (!atLeastOne) buf = ``;\r\n\t\tlet weatherbuf = scene.weatherLeft() || `(no weather)`;\r\n\t\tif (weatherbuf.startsWith('<br />')) { weatherbuf = weatherbuf.slice(6); }\r\n\t\tbuf = `<p>${weatherbuf}</p>` + buf;\r\n\t\treturn `<p>${buf}</p>`;\r\n\t}\r\n\t// Does this Pokémon's trainer have two of these Pokémon that are indistinguishable? (Same nickname, species, forme, level, gender, and shininess.)\r\n\tpokemonHasClones(pokemon: Pokemon) {\r\n\t\tconst side = pokemon.side;\r\n\t\tif (side.battle.speciesClause) return false;\r\n\t\tfor (const ally of side.pokemon) { if (pokemon !== ally && pokemon.searchid === ally.searchid) { return true; } }\r\n\t\treturn false;\r\n\t}\r\n\tcalculateModifiedStats(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon, statStagesOnly?: boolean) {\r\n\t\tlet stats = { ...serverPokemon.stats };\r\n\t\tlet pokemon = clientPokemon || serverPokemon;\r\n\t\tconst isPowerTrick = clientPokemon?.volatiles['powertrick'];\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tlet sourceStatName = statName;\r\n\t\t\tif (isPowerTrick) {\r\n\t\t\t\tif (statName === 'atk') sourceStatName = 'def';\r\n\t\t\t\tif (statName === 'def') sourceStatName = 'atk';\r\n\t\t\t}\r\n\t\t\tstats[statName] = serverPokemon.stats[sourceStatName];\r\n\t\t\tif (!clientPokemon) continue;\r\n\t\t\tconst clientStatName = clientPokemon.boosts.spc && (statName === 'spa' || statName === 'spd') ? 'spc' : statName;\r\n\t\t\tconst boostLevel = clientPokemon.boosts[clientStatName];\r\n\t\t\tif (boostLevel) {\r\n\t\t\t\tlet boostTable = [1, 1.5, 2, 2.5, 3, 3.5, 4];\r\n\t\t\t\tif (boostLevel > 0) { stats[statName] *= boostTable[boostLevel]; } \r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this.battle.gen <= 2) boostTable = [1, 100 / 66, 2, 2.5, 100 / 33, 100 / 28, 4];\r\n\t\t\t\t\tstats[statName] /= boostTable[-boostLevel];\r\n\t\t\t\t}\r\n\t\t\t\tstats[statName] = Math.floor(stats[statName]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (statStagesOnly) return stats;\r\n\t\tconst ability = toID(clientPokemon?.effectiveAbility(serverPokemon) ?? (serverPokemon.ability || serverPokemon.baseAbility));\r\n\t\t// check for burn, paralysis, guts, quick feet\r\n\t\tif (pokemon.status) {\r\n\t\t\tif (this.battle.gen > 2 && ability === 'guts') { stats.atk = Math.floor(stats.atk * 1.5); } \r\n\t\t\telse if (this.battle.gen < 2 && pokemon.status === 'brn') { stats.atk = Math.floor(stats.atk * 0.5); }\r\n\t\t\t// Paralysis is calculated later in newer generations, so we need to apply it early here\r\n\t\t\tif (this.battle.gen <= 2 && pokemon.status === 'par') { stats.spe = Math.floor(stats.spe * 0.25); }\r\n\t\t}\r\n\t\t// gen 1 doesn't support items\r\n\t\tif (this.battle.gen <= 1) {\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) { if (stats[statName] > 999) stats[statName] = 999; }\r\n\t\t\treturn stats;\r\n\t\t}\r\n\t\tlet item = toID(serverPokemon.item);\r\n\t\tlet speedHalvingEVItems = ['machobrace', 'poweranklet', 'powerband', 'powerbelt', 'powerbracer', 'powerlens', 'powerweight',];\r\n\t\tif (\r\n\t\t\t(ability === 'klutz' && !speedHalvingEVItems.includes(item)) ||\r\n\t\t\tthis.battle.hasPseudoWeather('Magic Room') ||\r\n\t\t\tclientPokemon?.volatiles['embargo']\r\n\t\t) { item = '' as ID; }\r\n\t\tconst species = this.battle.dex.species.get(serverPokemon.speciesForme).baseSpecies;\r\n\t\tconst isTransform = clientPokemon?.volatiles.transform;\r\n\t\tconst speciesName = isTransform && clientPokemon?.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\t\tthis.battle.dex.species.get(clientPokemon.volatiles.formechange[1]).baseSpecies : species;\r\n\t\tlet speedModifiers = [];\r\n\t\t// check for light ball, thick club, metal/quick powder\r\n\t\t// the only stat modifying items in gen 2 were light ball, thick club, metal powder\r\n\t\tif (item === 'lightball' && speciesName === 'Pikachu' && this.battle.gen !== 4) {\r\n\t\t\tif (this.battle.gen > 4) stats.atk *= 2;\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\t\tif (item === 'thickclub') { if (speciesName === 'Marowak' || speciesName === 'Cubone') { stats.atk *= 2; } }\r\n\t\tif (speciesName === 'Ditto' && !(clientPokemon && 'transform' in clientPokemon.volatiles)) {\r\n\t\t\tif (item === 'quickpowder') { speedModifiers.push(2); }\r\n\t\t\tif (item === 'metalpowder') {\r\n\t\t\t\tif (this.battle.gen === 2) {\r\n\t\t\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t} else { stats.def *= 2; }\r\n\t\t\t}\r\n\t\t}\r\n\t\t// check abilities other than Guts and Quick Feet\r\n\t\t// check items other than light ball, thick club, metal/quick powder\r\n\t\tif (this.battle.gen <= 2) { return stats; }\r\n\t\tlet weather = this.battle.weather;\r\n\t\tif (this.battle.abilityActive(['Air Lock', 'Cloud Nine'])) { weather = '' as ID; }\r\n\t\tif (item === 'choiceband' && !clientPokemon?.volatiles['dynamax']) { stats.atk = Math.floor(stats.atk * 1.5); }\r\n\t\tif (ability === 'purepower' || ability === 'hugepower') { stats.atk *= 2; }\r\n\t\tif (ability === 'hustle' || (ability === 'gorillatactics' && !clientPokemon?.volatiles['dynamax'])) { stats.atk = Math.floor(stats.atk * 1.5); }\r\n\t\tif (weather) {\r\n\t\t\tif (this.battle.gen >= 4 && this.pokemonHasType(pokemon, 'Rock') && weather === 'sandstorm') { stats.spd = Math.floor(stats.spd * 1.5); }\r\n\t\t\tif (this.pokemonHasType(pokemon, 'Ice') && weather === 'snowscape') { stats.def = Math.floor(stats.def * 1.5); }\r\n\t\t\tif (ability === 'sandrush' && weather === 'sandstorm') { speedModifiers.push(2); }\r\n\t\t\tif (ability === 'slushrush' && (weather === 'hail' || weather === 'snowscape')) { speedModifiers.push(2); }\r\n\t\t\tif (item !== 'utilityumbrella') {\r\n\t\t\t\tif (weather === 'sunnyday' || weather === 'desolateland') {\r\n\t\t\t\t\tif (ability === 'chlorophyll') { speedModifiers.push(2); }\r\n\t\t\t\t\tif (ability === 'solarpower') { stats.spa = Math.floor(stats.spa * 1.5); }\r\n\t\t\t\t\tif (ability === 'orichalcumpulse') { stats.atk = Math.floor(stats.atk * 1.3333); }\r\n\t\t\t\t\tlet allyActive = clientPokemon?.side.active;\r\n\t\t\t\t\tif (allyActive) {\r\n\t\t\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\t\t\tif (allyAbility === 'Flower Gift' && (ally.getSpecies().baseSpecies === 'Cherrim' || this.battle.gen <= 4)) {\r\n\t\t\t\t\t\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\t\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (weather === 'raindance' || weather === 'primordialsea') {\r\n\t\t\t\t\tif (ability === 'swiftswim') { speedModifiers.push(2); }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'defeatist' && serverPokemon.hp <= serverPokemon.maxhp / 2) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\tstats.spa = Math.floor(stats.spa * 0.5);\r\n\t\t}\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.volatiles['slowstart']) {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\t\tspeedModifiers.push(0.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'unburden' && clientPokemon.volatiles['itemremoved'] && !item) { speedModifiers.push(2); }\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (clientPokemon.volatiles['protosynthesis' + statName] || clientPokemon.volatiles['quarkdrive' + statName]) {\r\n\t\t\t\t\tif (statName === 'spe') { speedModifiers.push(1.5); }\r\n\t\t\t\t\telse { stats[statName] = Math.floor(stats[statName] * 1.3); }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (pokemon.status) {\r\n\t\t\tif (ability === 'marvelscale') { stats.def = Math.floor(stats.def * 1.5); }\r\n\t\t\tif (ability === 'quickfeet') { speedModifiers.push(1.5); }\r\n\t\t}\r\n\t\tif (item === 'eviolite' && this.battle.dex.species.get(serverPokemon.speciesForme).nfe) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (ability === 'grasspelt' && this.battle.hasPseudoWeather('Grassy Terrain')) { stats.def = Math.floor(stats.def * 1.5); }\r\n\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\tif (ability === 'surgesurfer') { speedModifiers.push(2); }\r\n\t\t\tif (ability === 'hadronengine') { stats.spa = Math.floor(stats.spa * 1.3333); }\r\n\t\t}\r\n\t\tif (item === 'choicespecs' && !clientPokemon?.volatiles['dynamax']) { stats.spa = Math.floor(stats.spa * 1.5); }\r\n\t\tif (item === 'deepseatooth' && species === 'Clamperl') { stats.spa *= 2; }\r\n\t\tif (item === 'souldew' && this.battle.gen <= 6 && (species === 'Latios' || species === 'Latias')) {\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (clientPokemon && (ability === 'plus' || ability === 'minus')) {\r\n\t\t\tlet allyActive = clientPokemon.side.active;\r\n\t\t\tif (allyActive.length > 1) {\r\n\t\t\t\tlet abilityName = (ability === 'plus' ? 'Plus' : 'Minus');\r\n\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\tif (!ally || ally === clientPokemon || ally.fainted) continue;\r\n\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\tif (allyAbility !== 'Plus' && allyAbility !== 'Minus') continue;\r\n\t\t\t\t\tif (this.battle.gen <= 4 && allyAbility === abilityName) continue;\r\n\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'assaultvest') { stats.spd = Math.floor(stats.spd * 1.5); }\r\n\t\tif (item === 'deepseascale' && species === 'Clamperl') { stats.spd *= 2; }\r\n\t\tif (item === 'choicescarf' && !clientPokemon?.volatiles['dynamax']) { speedModifiers.push(1.5); }\r\n\t\tif (item === 'ironball' || speedHalvingEVItems.includes(item)) { speedModifiers.push(0.5); }\r\n\t\tif (ability === 'furcoat') { stats.def *= 2; }\r\n\t\tif (this.battle.abilityActive('Vessel of Ruin')) { if (ability !== 'vesselofruin') { stats.spa = Math.floor(stats.spa * 0.75); } }\r\n\t\tif (this.battle.abilityActive('Sword of Ruin')) { if (ability !== 'swordofruin') { stats.def = Math.floor(stats.def * 0.75); } }\r\n\t\tif (this.battle.abilityActive('Tablets of Ruin')) { if (ability !== 'tabletsofruin') { stats.atk = Math.floor(stats.atk * 0.75); } }\r\n\t\tif (this.battle.abilityActive('Beads of Ruin')) {\r\n\t\tif (ability !== 'beadsofruin') { stats.spd = Math.floor(stats.spd * 0.75); } }\r\n\t\tconst sideConditions = this.battle.mySide.sideConditions;\r\n\t\tif (sideConditions['tailwind']) { speedModifiers.push(2); }\r\n\t\tif (sideConditions['grasspledge']) { speedModifiers.push(0.25); }\r\n\t\tlet chainedSpeedModifier = 1;\r\n\t\tfor (const modifier of speedModifiers) { chainedSpeedModifier *= modifier; }\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tstats.spe *= chainedSpeedModifier;\r\n\t\tstats.spe = stats.spe % 1 > 0.5 ? Math.ceil(stats.spe) : Math.floor(stats.spe);\r\n\t\tif (pokemon.status === 'par' && ability !== 'quickfeet') {\r\n\t\t\tif (this.battle.gen > 6) { stats.spe = Math.floor(stats.spe * 0.5); }\r\n\t\t\telse { stats.spe = Math.floor(stats.spe * 0.25); }\r\n\t\t}\r\n\t\treturn stats;\r\n\t}\r\n\trenderStats(clientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, short?: boolean) {\r\n\t\tconst isTransformed = clientPokemon?.volatiles.transform;\r\n\t\tif (!serverPokemon || isTransformed) {\r\n\t\t\tif (!clientPokemon) throw new Error('Must pass either clientPokemon or serverPokemon');\r\n\t\t\tlet [min, max] = this.getSpeedRange(clientPokemon);\r\n\t\t\treturn `<p><small>Spe</small> ${min} to ${max} <small>(before items/abilities/modifiers)</small></p>`;\r\n\t\t}\r\n\t\tconst stats = serverPokemon.stats;\r\n\t\tconst modifiedStats = this.calculateModifiedStats(clientPokemon, serverPokemon);\r\n\t\tlet buf = '<p>';\r\n\t\tif (!short) {\r\n\t\t\tlet hasModifiedStat = false;\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\t\tconst fallbackShort: Record<string, string> = { hp: 'HP', atk: 'Atk', def: 'Def', spa: 'SpA', spd: 'SpD', spe: 'Spe', spc: 'Spc' };\r\n\r\nconst entry =\r\n  (globalThis as any).BattleText?.[statLabel] ||\r\n  (globalThis as any).BattleText?.stats?.[statLabel];\r\nconst shortName = entry?.statShortName ?? fallbackShort[statLabel] ?? statLabel.toUpperCase();\r\nbuf += `${shortName}&nbsp;</small>`;\r\n\t\t\t\tbuf += `${stats[statName]}`;\r\n\t\t\t\tif (modifiedStats[statName] !== stats[statName]) hasModifiedStat = true;\r\n\t\t\t}\r\n\t\t\tbuf += '</p>';\r\n\t\t\tif (!hasModifiedStat) return buf;\r\n\t\t\tbuf += '<p><small>(After stat modifiers:)</small></p>';\r\n\t\t\tbuf += '<p>';\r\n\t\t}\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\tconst fallbackShort: Record<string, string> = { hp: 'HP', atk: 'Atk', def: 'Def', spa: 'SpA', spd: 'SpD', spe: 'Spe', spc: 'Spc' };\r\nconst entry =\r\n  (globalThis as any).BattleText?.[statLabel] ||\r\n  (globalThis as any).BattleText?.stats?.[statLabel];\r\nconst shortName = entry?.statShortName ?? fallbackShort[statLabel] ?? statLabel.toUpperCase();\r\nbuf += `${shortName}&nbsp;</small>`;\r\n\t\t\tif (modifiedStats[statName] === stats[statName]) { buf += `${modifiedStats[statName]}`; } \r\n\t\t\telse if (modifiedStats[statName] < stats[statName]) { buf += `<strong class=\"stat-lowered\">${modifiedStats[statName]}</strong>`; } \r\n\t\t\telse { buf += `<strong class=\"stat-boosted\">${modifiedStats[statName]}</strong>`; }\r\n\t\t}\r\n\t\tbuf += '</p>';\r\n\t\treturn buf;\r\n\t}\r\n\tgetPPUseText(moveTrackRow: [string, number], showKnown?: boolean) {\r\n\t\tlet [moveName, ppUsed] = moveTrackRow;\r\n\t\tlet move;\r\n\t\tlet maxpp;\r\n\t\tif (moveName.startsWith('*')) {\r\n\t\t\t// Transformed move\r\n\t\t\tmove = this.battle.dex.moves.get(moveName.substr(1));\r\n\t\t\tmaxpp = 5;\r\n\t\t} else {\r\n\t\t\tmove = this.battle.dex.moves.get(moveName);\r\n\t\t\tmaxpp = (move.pp === 1 || move.noPPBoosts ? move.pp : move.pp * 8 / 5);\r\n\t\t\tif (this.battle.gen < 3) maxpp = Math.min(61, maxpp);\r\n\t\t}\r\n\t\tconst bullet = moveName.startsWith('*') || move.isZ ? '<span style=\"color:#888\">&#8226;</span>' : '&#8226;';\r\n\t\tif (ppUsed === Infinity) { return `${bullet} ${move.name} <small>(0/${maxpp})</small>`; }\r\n\t\tif (ppUsed || moveName.startsWith('*')) { return `${bullet} ${move.name} <small>(${maxpp - ppUsed}/${maxpp})</small>`; }\r\n\t\treturn `${bullet} ${move.name} ${showKnown ? ' <small>(revealed)</small>' : ''}`;\r\n\t}\r\n\tppUsed(move: Dex.Move, pokemon: Pokemon) {\r\n\t\tfor (let [moveName, ppUsed] of pokemon.moveTrack) {\r\n\t\t\tif (moveName.startsWith('*')) moveName = moveName.substr(1);\r\n\t\t\tif (move.name === moveName) return ppUsed;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\t// Calculates possible Speed stat range of an opponent\r\n\tgetSpeedRange(pokemon: Pokemon): [number, number] {\r\n\t\tconst tr = Math.trunc || Math.floor;\r\n\t\tconst species = pokemon.getSpecies();\r\n\t\tlet rules = this.battle.rules;\r\n\t\tlet baseSpe = species.baseStats.spe;\r\n\t\tif (rules['Scalemons Mod']) {\r\n\t\t\tconst bstWithoutHp = species.bst - species.baseStats.hp;\r\n\t\t\tconst scale = 600 - species.baseStats.hp;\r\n\t\t\tbaseSpe = tr(baseSpe * scale / bstWithoutHp);\r\n\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t}\r\n\t\tif (rules['Frantic Fusions Mod']) {\r\n\t\t\tconst fusionSpecies = this.battle.dex.species.get(pokemon.name);\r\n\t\t\tif (fusionSpecies.exists && fusionSpecies.name !== species.name) {\r\n\t\t\t\tbaseSpe += tr(fusionSpecies.baseStats.spe / 4);\r\n\t\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rules['Flipped Mod']) {\r\n\t\t\tbaseSpe = species.baseStats.hp;\r\n\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t}\r\n\t\tif (rules['350 Cup Mod'] && species.bst <= 350) {\r\n\t\t\tbaseSpe *= 2;\r\n\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t}\r\n\t\tlet level = pokemon.volatiles.transform?.[4] || pokemon.level;\r\n\t\tlet tier = this.battle.tier;\r\n\t\tlet gen = this.battle.gen;\r\n\t\tlet isCGT = tier.includes('Computer-Generated Teams');\r\n\t\tlet isRandomBattle = tier.includes('Random Battle') ||\r\n\t\t\t(tier.includes('Random') && tier.includes('Battle') && gen >= 6) || isCGT;\r\n\t\tlet minNature = (isRandomBattle || gen < 3) ? 1 : 0.9;\r\n\t\tlet maxNature = (isRandomBattle || gen < 3) ? 1 : 1.1;\r\n\t\tlet maxIv = (gen < 3) ? 30 : 31;\r\n\t\tlet min;\r\n\t\tlet max;\r\n\t\tif (tier.includes(\"Let's Go\")) {\r\n\t\t\tmin = tr(tr(tr(2 * baseSpe * level / 100 + 5) * minNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tmax = tr(tr(tr((2 * baseSpe + maxIv) * level / 100 + 5) * maxNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tif (tier.includes('No Restrictions')) max += 200;\r\n\t\t\telse if (tier.includes('Random')) max += 20;\r\n\t\t} else {\r\n\t\t\tlet maxIvEvOffset = maxIv + ((isRandomBattle && gen >= 3) ? 21 : 63);\r\n\t\t\tmax = tr(tr((2 * baseSpe + maxIvEvOffset) * level / 100 + 5) * maxNature);\r\n\t\t\tmin = isCGT ? max : tr(tr(2 * baseSpe * level / 100 + 5) * minNature);\r\n\t\t}\r\n\t\treturn [min, max];\r\n\t}\r\n\t//Gets the proper current type for moves with a variable type.\r\n\tgetMoveType(move: Dex.Move, value: ModifiableValue, forMaxMove?: boolean | Dex.Move): \r\n\t[Dex.TypeName, 'Physical' | 'Special' | 'Status'] {\r\n\t\tconst pokemon = value.pokemon;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\t\tlet moveType = move.type;\r\n\t\tlet category = move.category;\r\n\t\tif (category === 'Status' && forMaxMove) return ['Normal', 'Status']; // Max Guard\r\n\t\t// can happen in obscure situations\r\n\t\tif (!pokemon) return [moveType, category];\r\n\t\tlet pokemonTypes = pokemon.getTypeList(serverPokemon);\r\n\t\tvalue.reset();\r\n\t\tif (move.id === 'revelationdance') { moveType = pokemonTypes[0]; }\r\n\t\t// Moves that require an item to change their type.\r\n\t\tlet item = this.battle.dex.items.get(value.itemName);\r\n\t\tif (move.id === 'multiattack' && item.onMemory) { if (value.itemModify(0)) moveType = item.onMemory; }\r\n\t\tif (move.id === 'judgment' && item.onPlate && !item.zMoveType) { if (value.itemModify(0)) moveType = item.onPlate; }\r\n\t\tif (move.id === 'technoblast' && item.onDrive) { if (value.itemModify(0)) moveType = item.onDrive; }\r\n\t\tif (move.id === 'naturalgift' && item.naturalGift) { if (value.itemModify(0)) moveType = item.naturalGift.type; }\r\n\t\t// Weather and pseudo-weather type changes.\r\n\t\tif (move.id === 'weatherball' && value.weatherModify(0)) {\r\n\t\t\tswitch (this.battle.weather) {\r\n\t\t\tcase 'sunnyday':\r\n\t\t\tcase 'desolateland':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'raindance':\r\n\t\t\tcase 'primordialsea':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'sandstorm':\r\n\t\t\t\tmoveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hail':\r\n\t\t\tcase 'snowscape':\r\n\t\t\t\tmoveType = 'Ice';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) { moveType = 'Electric'; } \r\n\t\t\telse if (this.battle.hasPseudoWeather('Grassy Terrain')) { moveType = 'Grass'; } \r\n\t\t\telse if (this.battle.hasPseudoWeather('Misty Terrain')) { moveType = 'Fairy'; } \r\n\t\t\telse if (this.battle.hasPseudoWeather('Psychic Terrain')) { moveType = 'Psychic'; }\r\n\t\t}\r\n\t\tif (move.id === 'terablast' && pokemon.terastallized) { moveType = pokemon.terastallized as Dex.TypeName; }\r\n\t\tif (move.id === 'terastarstorm' && pokemon.getSpeciesForme() === 'Terapagos-Stellar') { moveType = 'Stellar'; }\r\n\t\t// Aura Wheel as Morpeko-Hangry changes the type to Dark\r\n\t\tif (move.id === 'aurawheel' && pokemon.getSpeciesForme() === 'Morpeko-Hangry') { moveType = 'Dark'; }\r\n\t\t// Raging Bull's type depends on the Tauros forme\r\n\t\tif (move.id === 'ragingbull') {\r\n\t\t\tswitch (pokemon.getSpeciesForme()) {\r\n\t\t\tcase 'Tauros-Paldea-Combat':\r\n\t\t\t\tmoveType = 'Fighting';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Blaze':\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Aqua':\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Ivy Cudgel's type depends on the Ogerpon forme\r\n\t\tif (move.id === 'ivycudgel') {\r\n\t\t\tswitch (pokemon.getSpeciesForme()) {\r\n\t\t\tcase 'Ogerpon-Wellspring': case 'Ogerpon-Wellspring-Tera':\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Ogerpon-Hearthflame': case 'Ogerpon-Hearthflame-Tera':\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Ogerpon-Cornerstone': case 'Ogerpon-Cornerstone-Tera':\r\n\t\t\t\tmoveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Other abilities that change the move type.\r\n\t\tconst noTypeOverride = ['judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terrainpulse', 'weatherball',];\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (allowTypeOverride) {\r\n\t\t\tif (this.battle.rules['Revelationmons Mod']) {\r\n\t\t\t\tconst [types] = pokemon.getTypes(serverPokemon);\r\n\t\t\t\tfor (let i = 0; i < types.length; i++) { if (serverPokemon.moves[i] && move.id === toID(serverPokemon.moves[i])) { moveType = types[i]; } }\r\n\t\t\t}\r\n\t\t\tif (category !== 'Status' && !move.isZ && !move.id.startsWith('hiddenpower')) {\r\n\t\t\t\tif (moveType === 'Normal') {\r\n\t\t\t\t\tif (value.abilityModify(0, 'Aerilate')) moveType = 'Flying';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Galvanize')) moveType = 'Electric';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Pixilate')) moveType = 'Fairy';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Refrigerate')) moveType = 'Ice';\r\n\t\t\t\t}\r\n\t\t\t\tif (value.abilityModify(0, 'Normalize')) moveType = 'Normal';\r\n\t\t\t}\r\n\t\t\t// There aren't any max moves with the sound flag, but if there were, Liquid Voice would make them water type\r\n\t\t\tconst isSound = !!(\r\n\t\t\t\tforMaxMove ?\r\n\t\t\t\t\tthis.getMaxMoveFromType(moveType, forMaxMove !== true && forMaxMove || undefined) : move\r\n\t\t\t).flags['sound'];\r\n\t\t\tif (isSound && value.abilityModify(0, 'Liquid Voice')) { moveType = 'Water'; }\r\n\t\t}\r\n\t\tif (move.id === 'photongeyser' || move.id === 'lightthatburnsthesky' ||\r\n\t\t\t(move.id === 'terablast' && pokemon.terastallized) ||\r\n\t\t\t(move.id === 'terastarstorm' && pokemon.getSpeciesForme() === 'Terapagos-Stellar')) {\r\n\t\t\tconst stats = this.calculateModifiedStats(pokemon, serverPokemon, true);\r\n\t\t\tif (stats.atk > stats.spa) category = 'Physical';\r\n\t\t}\r\n\t\treturn [moveType, category];\r\n\t}\r\n\t// Gets the current accuracy for a move.\r\n\tgetMoveAccuracy(move: Dex.Move, value: ModifiableValue, target?: Pokemon) {\r\n\t\tvalue.reset(move.accuracy === true ? 0 : move.accuracy, true);\r\n\t\tlet pokemon = value.pokemon;\r\n\t\t// Sure-hit accuracy\r\n\t\tif (move.id === 'toxic' && this.battle.gen >= 6 && this.pokemonHasType(pokemon, 'Poison')) {\r\n\t\t\tvalue.set(0, \"Poison type\");\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif (move.id === 'blizzard' && this.battle.gen >= 4) {\r\n\t\t\tvalue.weatherModify(0, 'Hail');\r\n\t\t\tvalue.weatherModify(0, 'Snowscape');\r\n\t\t}\r\n\t\tif (['hurricane', 'thunder', 'bleakwindstorm', 'wildboltstorm', 'sandsearstorm'].includes(move.id)) {\r\n\t\t\tvalue.weatherModify(0, 'Rain Dance');\r\n\t\t\tvalue.weatherModify(0, 'Primordial Sea');\r\n\t\t}\r\n\t\tvalue.abilityModify(0, 'No Guard');\r\n\t\tif (!value.value) return value;\r\n\t\t// OHKO moves don't use standard accuracy / evasion modifiers\r\n\t\tif (move.ohko) {\r\n\t\t\tif (this.battle.gen === 1) {\r\n\t\t\t\tvalue.set(value.value, `fails if target's Speed is higher`);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tif (move.id === 'sheercold' && this.battle.gen >= 7 && !this.pokemonHasType(pokemon, 'Ice')) { value.set(20, 'not Ice-type'); }\r\n\t\t\tif (target) {\r\n\t\t\t\tif (pokemon.level < target.level) {\r\n\t\t\t\t\tvalue.reset(0);\r\n\t\t\t\t\tvalue.set(0, \"FAILS: target's level is higher\");\r\n\t\t\t\t} else if (pokemon.level > target.level) { value.set(value.value + pokemon.level - target.level, \"+1% per level above target\"); }\r\n\t\t\t} else {\r\n\t\t\t\tif (pokemon.level < 100) value.set(value.value, \"fails if target's level is higher\");\r\n\t\t\t\tif (pokemon.level > 1) value.set(value.value, \"+1% per level above target\");\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t// Accuracy modifiers start\r\n\t\tlet accuracyModifiers = [];\r\n\t\tif (this.battle.hasPseudoWeather('Gravity')) {\r\n\t\t\taccuracyModifiers.push(6840);\r\n\t\t\tvalue.modify(5 / 3, \"Gravity\");\r\n\t\t}\r\n\t\tfor (const active of pokemon.side.active) {\r\n\t\t\tif (!active || active.fainted) continue;\r\n\t\t\tconst ability = this.getAllyAbility(active);\r\n\t\t\tif (ability === 'Victory Star') {\r\n\t\t\t\taccuracyModifiers.push(4506);\r\n\t\t\t\tvalue.modify(1.1, \"Victory Star\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (value.tryAbility('Hustle') && move.category === 'Physical') {\r\n\t\t\taccuracyModifiers.push(3277);\r\n\t\t\tvalue.abilityModify(0.8, \"Hustle\");\r\n\t\t} else if (value.tryAbility('Compound Eyes')) {\r\n\t\t\taccuracyModifiers.push(5325);\r\n\t\t\tvalue.abilityModify(1.3, \"Compound Eyes\");\r\n\t\t}\r\n\t\tif (value.tryItem('Wide Lens')) {\r\n\t\t\taccuracyModifiers.push(4505);\r\n\t\t\tvalue.itemModify(1.1, \"Wide Lens\");\r\n\t\t}\r\n\t\t// Chaining modifiers\r\n\t\tlet chain = 4096;\r\n\t\tfor (const mod of accuracyModifiers) { if (mod !== 4096) { chain = (chain * mod + 2048) >> 12; } }\r\n\t\t// Applying modifiers\r\n\t\tvalue.set(move.accuracy as number);\r\n\t\tif (move.id === 'hurricane' || move.id === 'thunder') {\r\n\t\t\tif (value.tryWeather('Sunny Day')) value.set(50, 'Sunny Day');\r\n\t\t\tif (value.tryWeather('Desolate Land')) value.set(50, 'Desolate Land');\r\n\t\t}\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tlet accuracyAfterChain = (value.value * chain) / 4096;\r\n\t\taccuracyAfterChain = accuracyAfterChain % 1 > 0.5 ? Math.ceil(accuracyAfterChain) : Math.floor(accuracyAfterChain);\r\n\t\tvalue.set(accuracyAfterChain);\r\n\t\t// Unlike for Atk, Def, etc. accuracy and evasion boosts are applied after modifiers\r\n\t\tif (pokemon?.boosts.accuracy) {\r\n\t\t\tif (pokemon.boosts.accuracy > 0) { value.set(Math.floor(value.value * (pokemon.boosts.accuracy + 3) / 3)); } \r\n\t\t\telse { value.set(Math.floor(value.value * 3 / (3 - pokemon.boosts.accuracy))); }\r\n\t\t}\r\n\t\t// 1/256 glitch\r\n\t\tif (this.battle.gen === 1 && !toID(this.battle.tier).includes('stadium')) { value.set((Math.floor(value.value * 255 / 100) / 256) * 100); }\r\n\t\treturn value;\r\n\t}\r\n\t// Gets the proper current base power for moves which have a variable base power.\r\n\t// Takes into account the target for some moves.\r\n\t// If it is unsure of the actual base power, it gives an estimate.\r\n\tgetMoveBasePower(move: Dex.Move, moveType: Dex.TypeName, value: ModifiableValue, target: Pokemon | null = null) {\r\n\t\tconst pokemon = value.pokemon;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\t\t// apply modifiers for moves that depend on the actual stats\r\n\t\tconst modifiedStats = this.calculateModifiedStats(pokemon, serverPokemon);\r\n\t\tvalue.reset(move.basePower);\r\n\t\tif (move.id === 'acrobatics') { if (!serverPokemon.item) { value.modify(2, \"Acrobatics + no item\"); } }\r\n\t\tlet variableBPCap = ['crushgrip', 'wringout'].includes(move.id) ? 120 : move.id === 'hardpress' ? 100 : undefined;\r\n\t\tif (variableBPCap && target) {\r\n\t\t\tvalue.set(\r\n\t\t\t\tMath.floor(Math.floor((variableBPCap * (100 * Math.floor(target.hp * 4096 / target.maxhp)) + 2048 - 1) / 4096) / 100) || 1,\r\n\t\t\t\t'approximate'\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (move.id === 'terablast' && pokemon.terastallized === 'Stellar') { value.set(100, 'Tera Stellar boost'); }\r\n\t\tif (move.id === 'brine' && target && target.hp * 2 <= target.maxhp) { value.modify(2, 'Brine + target below half HP'); }\r\n\t\tif (move.id === 'eruption' || move.id === 'waterspout' || move.id === 'dragonenergy') { value.set(Math.floor(150 * pokemon.hp / pokemon.maxhp) || 1); }\r\n\t\tif (move.id === 'facade' && !['', 'slp', 'frz'].includes(pokemon.status)) { value.modify(2, 'Facade + status'); }\r\n\t\tif (move.id === 'flail' || move.id === 'reversal') {\r\n\t\t\tlet multiplier;\r\n\t\t\tlet ratios;\r\n\t\t\tif (this.battle.gen > 4) {\r\n\t\t\t\tmultiplier = 48;\r\n\t\t\t\tratios = [2, 5, 10, 17, 33];\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = 64;\r\n\t\t\t\tratios = [2, 6, 13, 22, 43];\r\n\t\t\t}\r\n\t\t\tlet ratio = pokemon.hp * multiplier / pokemon.maxhp;\r\n\t\t\tlet basePower;\r\n\t\t\tif (ratio < ratios[0]) basePower = 200;\r\n\t\t\telse if (ratio < ratios[1]) basePower = 150;\r\n\t\t\telse if (ratio < ratios[2]) basePower = 100;\r\n\t\t\telse if (ratio < ratios[3]) basePower = 80;\r\n\t\t\telse if (ratio < ratios[4]) basePower = 40;\r\n\t\t\telse basePower = 20;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (['hex', 'infernalparade'].includes(move.id) && target?.status) { value.modify(2, move.name + ' + status'); }\r\n\t\tif (move.id === 'lastrespects') { value.set(Math.min(50 + 50 * pokemon.side.faintCounter)); }\r\n\t\tif (move.id === 'punishment' && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(target.boosts)) { if (boost > 0) boostCount += boost; }\r\n\t\t\tvalue.set(Math.min(60 + 20 * boostCount, 200));\r\n\t\t}\r\n\t\tif (move.id === 'smellingsalts' && target) { if (target.status === 'par') { value.modify(2, 'Smelling Salts + Paralysis'); } }\r\n\t\tif (['storedpower', 'powertrip'].includes(move.id) && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(pokemon.boosts)) { if (boost > 0) boostCount += boost; }\r\n\t\t\tvalue.set(20 + 20 * boostCount);\r\n\t\t}\r\n\t\tif (move.id === 'trumpcard') {\r\n\t\t\tconst ppLeft = 5 - this.ppUsed(move, pokemon);\r\n\t\t\tlet basePower = 40;\r\n\t\t\tif (ppLeft === 1) basePower = 200;\r\n\t\t\telse if (ppLeft === 2) basePower = 80;\r\n\t\t\telse if (ppLeft === 3) basePower = 60;\r\n\t\t\telse if (ppLeft === 4) basePower = 50;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (move.id === 'magnitude') { value.setRange(10, 150); }\r\n\t\tif (['venoshock', 'barbbarrage'].includes(move.id) && target) { if (['psn', 'tox'].includes(target.status)) { value.modify(2, move.name + ' + Poison'); } }\r\n\t\tif (move.id === 'wakeupslap' && target) { if (target.status === 'slp') { value.modify(2, 'Wake-Up Slap + Sleep'); } }\r\n\t\tif (move.id === 'weatherball') { if (this.battle.weather !== 'deltastream') { value.weatherModify(2); } }\r\n\t\tif (move.id === 'hydrosteam') { value.weatherModify(1.5, 'Sunny Day'); }\r\n\t\tif (move.id === 'psyblade' && this.battle.hasPseudoWeather('Electric Terrain')) { value.modify(1.5, 'Electric Terrain'); }\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (\r\n\t\t\t\tthis.battle.hasPseudoWeather('Electric Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Grassy Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Misty Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t\t) { value.modify(2, 'Terrain Pulse boost'); }\r\n\t\t}\r\n\t\tif (move.id === 'watershuriken' && pokemon.getSpeciesForme() === 'Greninja-Ash' && pokemon.ability === 'Battle Bond') { value.set(20, 'Battle Bond'); }\r\n\t\t// Moves that check opponent speed\r\n\t\tif (move.id === 'electroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet minRatio = (modifiedStats.spe / maxSpe);\r\n\t\t\tlet maxRatio = (modifiedStats.spe / minSpe);\r\n\t\t\tlet min;\r\n\t\t\tlet max;\r\n\t\t\tif (minRatio >= 4) min = 150;\r\n\t\t\telse if (minRatio >= 3) min = 120;\r\n\t\t\telse if (minRatio >= 2) min = 80;\r\n\t\t\telse if (minRatio >= 1) min = 60;\r\n\t\t\telse min = 40;\r\n\t\t\tif (maxRatio >= 4) max = 150;\r\n\t\t\telse if (maxRatio >= 3) max = 120;\r\n\t\t\telse if (maxRatio >= 2) max = 80;\r\n\t\t\telse if (maxRatio >= 1) max = 60;\r\n\t\t\telse max = 40;\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\tif (move.id === 'gyroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet min = (Math.floor(25 * minSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (min > 150) min = 150;\r\n\t\t\tlet max = (Math.floor(25 * maxSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (max > 150) max = 150;\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\t// Moves which have base power changed due to items\r\n\t\tif (serverPokemon.item) {\r\n\t\t\tlet item = this.battle.dex.items.get(serverPokemon.item);\r\n\t\t\tif (move.id === 'fling' && item.fling) { value.itemModify(item.fling.basePower); }\r\n\t\t\tif (move.id === 'naturalgift') { value.itemModify(item.naturalGift.basePower); }\r\n\t\t}\r\n\t\t// Moves which have base power changed according to weight\r\n\t\tif (['lowkick', 'grassknot', 'heavyslam', 'heatcrash'].includes(move.id) && this.battle.gen > 2) {\r\n\t\t\tlet isGKLK = ['lowkick', 'grassknot'].includes(move.id);\r\n\t\t\tif (target) {\r\n\t\t\t\tlet targetWeight = target.getWeightKg();\r\n\t\t\t\tlet pokemonWeight = pokemon.getWeightKg(serverPokemon);\r\n\t\t\t\tlet basePower;\r\n\t\t\t\tif (isGKLK) {\r\n\t\t\t\t\tbasePower = 20;\r\n\t\t\t\t\tif (targetWeight >= 200) basePower = 120;\r\n\t\t\t\t\telse if (targetWeight >= 100) basePower = 100;\r\n\t\t\t\t\telse if (targetWeight >= 50) basePower = 80;\r\n\t\t\t\t\telse if (targetWeight >= 25) basePower = 60;\r\n\t\t\t\t\telse if (targetWeight >= 10) basePower = 40;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbasePower = 40;\r\n\t\t\t\t\tif (pokemonWeight >= targetWeight * 5) basePower = 120;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 4) basePower = 100;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 3) basePower = 80;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 2) basePower = 60;\r\n\t\t\t\t}\r\n\t\t\t\tif (target.volatiles['dynamax']) { value.set(0, 'blocked by target\\'s Dynamax'); } \r\n\t\t\t\telse { value.set(basePower); }\r\n\t\t\t} else { value.setRange(isGKLK ? 20 : 40, 120); }\r\n\t\t}\r\n\t\t// Base power based on times hit\r\n\t\tif (move.id === 'ragefist') {\r\n\t\t\tvalue.set(Math.min(350, 50 + 50 * pokemon.timesAttacked),\r\n\t\t\t\tpokemon.timesAttacked > 0 ?\r\n\t\t\t\t\t`Hit ${pokemon.timesAttacked} time${pokemon.timesAttacked > 1 ? 's' : ''}` :\r\n\t\t\t\t\tundefined);\r\n\t\t}\r\n\t\tif (!value.value) return value;\r\n\t\t// Other ability boosts\r\n\t\tif (pokemon.status === 'brn' && move.category === 'Special') { value.abilityModify(1.5, \"Flare Boost\"); }\r\n\t\tif (move.flags['punch']) { value.abilityModify(1.2, 'Iron Fist'); }\r\n\t\tif (move.flags['pulse']) { value.abilityModify(1.5, \"Mega Launcher\"); }\r\n\t\tif (move.flags['bite']) { value.abilityModify(1.5, \"Strong Jaw\"); }\r\n\t\tif (value.value <= 60) { value.abilityModify(1.5, \"Technician\"); }\r\n\t\tif (['psn', 'tox'].includes(pokemon.status) && move.category === 'Physical') { value.abilityModify(1.5, \"Toxic Boost\"); }\r\n\t\tif (['Rock', 'Ground', 'Steel'].includes(moveType) && this.battle.weather === 'sandstorm') { if (value.tryAbility(\"Sand Force\")) value.weatherModify(1.3, \"Sandstorm\", \"Sand Force\"); }\r\n\t\tif (move.secondaries) { value.abilityModify(1.3, \"Sheer Force\"); }\r\n\t\tif (move.flags['contact']) { value.abilityModify(1.3, \"Tough Claws\"); }\r\n\t\tif (move.flags['sound']) { value.abilityModify(1.3, \"Punk Rock\"); }\r\n\t\tif (move.flags['slicing']) { value.abilityModify(1.5, \"Sharpness\"); }\r\n\t\tfor (let i = 1; i <= 5 && i <= pokemon.side.faintCounter; i++) { if (pokemon.volatiles[`fallen${i}`]) { value.abilityModify(1 + 0.1 * i, \"Supreme Overlord\"); } }\r\n\t\tif (target) {\r\n\t\t\tif ([\"MF\", \"FM\"].includes(pokemon.gender + target.gender)) { value.abilityModify(0.75, \"Rivalry\"); } \r\n\t\t\telse if ([\"MM\", \"FF\"].includes(pokemon.gender + target.gender)) { value.abilityModify(1.25, \"Rivalry\"); }\r\n\t\t}\r\n\t\tconst noTypeOverride = ['judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terrainpulse', 'weatherball',];\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (\r\n\t\t\tmove.category !== 'Status' && allowTypeOverride && !move.isZ && !move.isMax &&\r\n\t\t\t!move.id.startsWith('hiddenpower')\r\n\t\t) {\r\n\t\t\tif (move.type === 'Normal') {\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Aerilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Galvanize\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Pixilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Refrigerate\");\r\n\t\t\t}\r\n\t\t\tif (this.battle.gen > 6) { value.abilityModify(1.2, \"Normalize\"); }\r\n\t\t}\r\n\t\tif (move.recoil || move.hasCrashDamage) { value.abilityModify(1.2, 'Reckless'); }\r\n\t\tif (move.category !== 'Status') {\r\n\t\t\tlet auraBoosted = '';\r\n\t\t\tlet auraBroken = false;\r\n\t\t\tfor (const ally of pokemon.side.active) {\r\n\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\tif (moveType === 'Fairy' && allyAbility === 'Fairy Aura') { auraBoosted = 'Fairy Aura'; } \r\n\t\t\t\telse if (moveType === 'Dark' && allyAbility === 'Dark Aura') { auraBoosted = 'Dark Aura'; } \r\n\t\t\t\telse if (allyAbility === 'Aura Break') { auraBroken = true; } \r\n\t\t\t\telse if (allyAbility === 'Battery' && ally !== pokemon && move.category === 'Special') { value.modify(1.3, 'Battery'); } \r\n\t\t\t\telse if (allyAbility === 'Power Spot' && ally !== pokemon) { value.modify(1.3, 'Power Spot'); } \r\n\t\t\t\telse if (allyAbility === 'Steely Spirit' && moveType === 'Steel') { value.modify(1.5, 'Steely Spirit'); }\r\n\t\t\t}\r\n\t\t\tfor (const foe of pokemon.side.foe.active) {\r\n\t\t\t\tif (!foe || foe.fainted) continue;\r\n\t\t\t\tif (foe.ability === 'Fairy Aura' && moveType === 'Fairy') { auraBoosted = 'Fairy Aura'; } \r\n\t\t\t\telse if (foe.ability === 'Dark Aura' && moveType === 'Dark') { auraBoosted = 'Dark Aura'; } \r\n\t\t\t\telse if (foe.ability === 'Aura Break') { auraBroken = true; }\r\n\t\t\t}\r\n\t\t\tif (auraBoosted) {\r\n\t\t\t\tif (auraBroken) { value.modify(0.75, auraBoosted + ' + Aura Break'); } \r\n\t\t\t\telse { value.modify(1.33, auraBoosted); }\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Terrain\r\n\t\tif ((this.battle.hasPseudoWeather('Electric Terrain') && moveType === 'Electric') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Grassy Terrain') && moveType === 'Grass') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Psychic Terrain') && moveType === 'Psychic')) {\r\n\t\t\tif (pokemon.isGrounded(serverPokemon)) { value.modify(this.battle.gen > 7 ? 1.3 : 1.5, 'Terrain boost'); }\r\n\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain') && moveType === 'Dragon') { if (target ? target.isGrounded() : true) { value.modify(0.5, 'Misty Terrain + grounded target'); } } \r\n\t\telse if (this.battle.hasPseudoWeather('Grassy Terrain') && ['earthquake', 'bulldoze', 'magnitude'].includes(move.id)) { if (target ? target.isGrounded() : true) { value.modify(0.5, 'Grassy Terrain + grounded target'); } }\r\n\t\tif (\r\n\t\t\tmove.id === 'expandingforce' &&\r\n\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain') &&\r\n\t\t\tpokemon.isGrounded(serverPokemon)\r\n\t\t) { value.modify(1.5, 'Expanding Force + Psychic Terrain boost'); }\r\n\t\tif (move.id === 'mistyexplosion' && this.battle.hasPseudoWeather('Misty Terrain')) { value.modify(1.5, 'Misty Explosion + Misty Terrain boost'); }\r\n\t\tif (move.id === 'risingvoltage' && this.battle.hasPseudoWeather('Electric Terrain') && target?.isGrounded()) { value.modify(2, 'Rising Voltage + Electric Terrain boost'); }\r\n\t\t// Item\r\n\t\tvalue = this.getItemBoost(move, value, moveType);\r\n\t\t// Terastal base power floor\r\n\t\tif (\r\n\t\t\tpokemon.terastallized && (pokemon.terastallized === move.type || pokemon.terastallized === 'Stellar') &&\r\n\t\t\tvalue.value < 60 && move.priority <= 0 && !move.multihit && !((move.basePower === 0 || move.basePower === 150) && move.basePowerCallback)\r\n\t\t) { value.set(60, 'Tera type BP minimum'); }\r\n\t\t// Burn isn't really a base power modifier, so it needs to be applied after the Tera BP floor\r\n\t\tif (this.battle.gen > 2 && serverPokemon.status === 'brn' && move.id !== 'facade' && move.category === 'Physical') { if (!value.tryAbility(\"Guts\")) value.modify(0.5, 'Burn'); }\r\n\t\tif (\r\n\t\t\tmove.id === 'steelroller' &&\r\n\t\t\t!this.battle.hasPseudoWeather('Electric Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Grassy Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Misty Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t) { value.set(0, 'no Terrain'); }\r\n\t\treturn value;\r\n\t}\r\n\tstatic incenseTypes: { [itemName: string]: Dex.TypeName } = {\r\n\t\t'Odd Incense': 'Psychic',\r\n\t\t'Rock Incense': 'Rock',\r\n\t\t'Rose Incense': 'Grass',\r\n\t\t'Sea Incense': 'Water',\r\n\t\t'Wave Incense': 'Water',\r\n\t};\r\n\tstatic itemTypes: { [itemName: string]: Dex.TypeName } = {\r\n\t\t'Black Belt': 'Fighting',\r\n\t\t'Black Glasses': 'Dark',\r\n\t\t'Charcoal': 'Fire',\r\n\t\t'Dragon Fang': 'Dragon',\r\n\t\t'Fairy Feather': 'Fairy',\r\n\t\t'Hard Stone': 'Rock',\r\n\t\t'Magnet': 'Electric',\r\n\t\t'Metal Coat': 'Steel',\r\n\t\t'Miracle Seed': 'Grass',\r\n\t\t'Mystic Water': 'Water',\r\n\t\t'Never-Melt Ice': 'Ice',\r\n\t\t'Poison Barb': 'Poison',\r\n\t\t'Sharp Beak': 'Flying',\r\n\t\t'Silk Scarf': 'Normal',\r\n\t\t'Silver Powder': 'Bug',\r\n\t\t'Soft Sand': 'Ground',\r\n\t\t'Spell Tag': 'Ghost',\r\n\t\t'Twisted Spoon': 'Psychic',\r\n\t};\r\n\tstatic orbUsers: { [speciesForme: string]: string[] } = {\r\n\t\t'Latias': ['Soul Dew'],\r\n\t\t'Latios': ['Soul Dew'],\r\n\t\t'Dialga': ['Adamant Crystal', 'Adamant Orb'],\r\n\t\t'Palkia': ['Lustrous Globe', 'Lustrous Orb'],\r\n\t\t'Giratina': ['Griseous Core', 'Griseous Orb'],\r\n\t\t'Venomicon': ['Vile Vial'],\r\n\t};\r\n\tstatic orbTypes: { [itemName: string]: Dex.TypeName[] } = {\r\n\t\t'Soul Dew': ['Psychic', 'Dragon'],\r\n\t\t'Adamant Crystal': ['Steel', 'Dragon'],\r\n\t\t'Adamant Orb': ['Steel', 'Dragon'],\r\n\t\t'Lustrous Globe': ['Water', 'Dragon'],\r\n\t\t'Lustrous Orb': ['Water', 'Dragon'],\r\n\t\t'Griseous Core': ['Ghost', 'Dragon'],\r\n\t\t'Griseous Orb': ['Ghost', 'Dragon'],\r\n\t\t'Vile Vial': ['Poison', 'Flying'],\r\n\t};\r\n\tstatic noGemMoves = [\r\n\t\t'Fire Pledge',\r\n\t\t'Fling',\r\n\t\t'Grass Pledge',\r\n\t\t'Struggle',\r\n\t\t'Water Pledge',\r\n\t];\r\n\tgetItemBoost(move: Dex.Move, value: ModifiableValue, moveType: Dex.TypeName) {\r\n\t\tlet item = this.battle.dex.items.get(value.serverPokemon.item);\r\n\t\tlet itemName = item.name;\r\n\t\tlet moveName = move.name;\r\n\t\tlet species = this.battle.dex.species.get(value.serverPokemon.speciesForme);\r\n\t\tlet isTransform = value.pokemon.volatiles.transform;\r\n\t\tlet speciesName = isTransform && value.pokemon.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\tthis.battle.dex.species.get(value.pokemon.volatiles.formechange[1]).baseSpecies : species.baseSpecies;\r\n\t\t// Plates\r\n\t\tif (item.onPlate === moveType && !item.zMove) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t// Incenses\r\n\t\tif (BattleTooltips.incenseTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t// Type-enhancing items\r\n\t\tif (BattleTooltips.itemTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(this.battle.gen < 4 ? 1.1 : 1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t// Light ball is a base power modifier in gen 4 only\r\n\t\tif (item.name === 'Light Ball' && this.battle.gen === 4 && speciesName === 'Pikachu') {\r\n\t\t\tvalue.itemModify(2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t// Pokemon-specific items\r\n\t\tif (item.name === 'Soul Dew' && this.battle.gen < 7) return value;\r\n\t\tif (BattleTooltips.orbUsers[speciesName]?.includes(item.name) &&\r\n\t\t\tBattleTooltips.orbTypes[item.name]?.includes(moveType)) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif (speciesName === 'Ogerpon') {\r\n\t\t\tconst speciesForme = value.pokemon.getSpeciesForme();\r\n\t\t\tif (\r\n\t\t\t\t(speciesForme.startsWith('Ogerpon-Wellspring') && itemName === 'Wellspring Mask') ||\r\n\t\t\t\t(speciesForme.startsWith('Ogerpon-Hearthflame') && itemName === 'Hearthflame Mask') ||\r\n\t\t\t\t(speciesForme.startsWith('Ogerpon-Cornerstone') && itemName === 'Cornerstone Mask')\r\n\t\t\t) {\r\n\t\t\t\tvalue.itemModify(1.2);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Gems\r\n\t\tif (BattleTooltips.noGemMoves.includes(moveName)) return value;\r\n\t\tif (itemName === moveType + ' Gem') {\r\n\t\t\tvalue.itemModify(this.battle.gen < 6 ? 1.5 : 1.3);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif (itemName === 'Muscle Band' && move.category === 'Physical' ||\r\n\t\t\titemName === 'Wise Glasses' && move.category === 'Special' ||\r\n\t\t\titemName === 'Punching Glove' && move.flags['punch']) {\r\n\t\t\tvalue.itemModify(1.1);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\tgetPokemonTypes(pokemon: Pokemon | ServerPokemon, preterastallized = false): readonly Dex.TypeName[] {\r\n\t\tif (!(pokemon as Pokemon).getTypes) { return this.battle.dex.species.get(pokemon.speciesForme).types; }\r\n\t\treturn (pokemon as Pokemon).getTypeList(undefined, preterastallized);\r\n\t}\r\n\tpokemonHasType(pokemon: Pokemon | ServerPokemon, type: Dex.TypeName, types?: readonly Dex.TypeName[]) {\r\n\t\tif (!types) types = this.getPokemonTypes(pokemon);\r\n\t\tfor (const curType of types) { if (curType === type) return true; }\r\n\t\treturn false;\r\n\t}\r\n\tgetAllyAbility(ally: Pokemon) {\r\n\t\tlet serverPokemon;\r\n\t\tif (this.battle.myAllyPokemon) { serverPokemon = this.battle.myAllyPokemon[ally.slot]; } \r\n\t\telse if (this.battle.myPokemon) { serverPokemon = this.battle.myPokemon[ally.slot]; }\r\n\t\treturn ally.effectiveAbility(serverPokemon);\r\n\t}\r\n\tgetPokemonAbilityData(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon | null | undefined) {\r\n\t\tconst abilityData: {\r\n  \t\t\tability: string; baseAbility: string;\r\n  \t\t\tability2: string; baseAbility2: string;\r\n  \t\t\tpossibilities: string[];\r\n\t\t} = {\r\n  \t\t\tability: '', baseAbility: '',\r\n  \t\t\tability2: '', baseAbility2: '',\r\n  \t\t\tpossibilities: [],\r\n\t\t};\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.ability) {\r\n\t\t\t\tabilityData.ability = clientPokemon.ability || clientPokemon.baseAbility;\r\n\t\t\t\tif (clientPokemon.baseAbility) { abilityData.baseAbility = clientPokemon.baseAbility; }\r\n\t\t\t\t// Slot 2 support (ISL)\r\n\t\t\t\tconst cp: any = clientPokemon;\r\n\t\t\t\tif (cp.ability2) abilityData.ability2 = cp.ability2;\r\n\t\t\t\tif (cp.baseAbility2) abilityData.baseAbility2 = cp.baseAbility2;\r\n\t\t\t} else {\r\n\t\t\t\tconst speciesForme = clientPokemon.getSpeciesForme() || serverPokemon?.speciesForme || '';\r\n\t\t\t\tconst species = this.battle.dex.species.get(speciesForme);\r\n\t\t\t\tif (species.exists && species.abilities) {\r\n\t\t\t\t\tabilityData.possibilities = Object.values(species.abilities);\r\n\t\t\t\t\tif (this.battle.rules['Frantic Fusions Mod']) {\r\n\t\t\t\t\t\tconst fusionSpecies = this.battle.dex.species.get(clientPokemon.name);\r\n\t\t\t\t\t\tif (fusionSpecies.exists && fusionSpecies.name !== species.name) {\r\n\t\t\t\t\t\t\tfor (const newAbility of Object.values(fusionSpecies.abilities)) {\r\n\t\t\t\t\t\t\t\tif (abilityData.possibilities.includes(newAbility)) continue;\r\n\t\t\t\t\t\t\t\tabilityData.possibilities.push(newAbility);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\tif (serverPokemon) {\r\n\t\t\t// ServerPokemon (request payload) is authoritative and updates immediately.\r\n\t\t\t// Always prefer it when present, otherwise stale clientPokemon can mislead tooltips.\r\n\t\t\tconst sp: any = serverPokemon;\r\n\r\n\t\t\tif (serverPokemon.ability || serverPokemon.baseAbility) {\r\n\t\t\t\tabilityData.ability = serverPokemon.ability || serverPokemon.baseAbility;\r\n\t\t\t} else if (!abilityData.ability) {\r\n\t\t\t\tabilityData.ability = serverPokemon.baseAbility;\r\n\t\t\t}\r\n\r\n\t\t\tif (serverPokemon.baseAbility) abilityData.baseAbility = serverPokemon.baseAbility;\r\n\r\n\t\t\t// Slot 2 support (ISL)\r\n\t\t\tif (sp.ability2) abilityData.ability2 = sp.ability2;\r\n\t\t\tif (sp.baseAbility2) abilityData.baseAbility2 = sp.baseAbility2;\r\n\t\t}\r\n\t\treturn abilityData;\r\n\t}\r\n\tgetPokemonAbilityText(\r\n\t\tclientPokemon: Pokemon | null,\r\n\t\tserverPokemon: ServerPokemon | null | undefined,\r\n\t\tisActive: boolean | undefined,\r\n\t\thidePossible?: boolean\r\n\t) {\r\n\t\tlet text = '';\r\n\t\tconst abilityData = this.getPokemonAbilityData(clientPokemon, serverPokemon);\r\n\t\tconst tier = this.battle.tier;\r\n\r\n\r\n\r\n\t\tconst isISLFormat = tier?.toLowerCase().includes('indigostarstorm') || tier?.toLowerCase().includes('isl');\r\n\t\t// ISL formats: two-ability sets, Aura overrides slot 2.\r\n// Also keep ambiguity when shared abilities exist.\r\nif (isISLFormat && (clientPokemon || serverPokemon)) {\r\n  const status = (clientPokemon as any)?.status || (serverPokemon as any)?.status || '';\r\n  const abilityData = this.getPokemonAbilityData(clientPokemon, serverPokemon);\r\n\r\n  // Current + base per-slot\r\n  const cur1 = abilityData.ability || abilityData.baseAbility;\r\n  const base1 = abilityData.baseAbility || cur1;\r\n\r\n  const cur2 = abilityData.ability2 || abilityData.baseAbility2;\r\n  const base2 = abilityData.baseAbility2 || cur2;\r\n\r\n  const nameOf = (id: string) => id ? this.battle.dex.abilities.get(id).name : '';\r\n\r\n  const cur1Name = nameOf(cur1);\r\n  const cur2Name = nameOf(cur2);\r\n  const base2Name = nameOf(base2);\r\n\r\n  // If Aura is active, it *defines* slot 2 right now.\r\n  // Show the actual current pair immediately, and (optionally) note what it replaced.\r\n  if (status === 'aura' && cur1Name && cur2Name) {\r\n    let out = `<small>Ability Set:</small><br />`;\r\n    out += `<span class=\"ability-line\">${BattleLog.escapeHTML(cur1Name)}</span><br />`;\r\n\r\n    // If we know what Aura replaced, annotate it\r\n    if (base2Name && base2Name !== cur2Name) {\r\n      out += `<span class=\"ability-line\">${BattleLog.escapeHTML(cur2Name)} <small>(replaces ${BattleLog.escapeHTML(base2Name)})</small></span><br />`;\r\n    } else {\r\n      out += `<span class=\"ability-line\">${BattleLog.escapeHTML(cur2Name)}</span><br />`;\r\n    }\r\n    return out;\r\n  }\r\n\r\n  // Build possible sets from the flat list (pairs)\r\n  const sets: string[][] = [];\r\n  for (let i = 0; i < abilityData.possibilities.length; i += 2) {\r\n    const a1 = abilityData.possibilities[i];\r\n    const a2 = abilityData.possibilities[i + 1];\r\n    const set: string[] = [];\r\n    if (a1) set.push(a1);\r\n    if (a2) set.push(a2);\r\n    if (set.length) sets.push(set);\r\n  }\r\n\r\n  // Known abilities (IDs, not names) – use base1/base2 when present.\r\n  // IMPORTANT: we only narrow if we have an *exclusive* signal.\r\n  const known: string[] = [];\r\n  if (base1) known.push(base1);\r\n  if (base2) known.push(base2);\r\n\r\n  // Filter sets: a set remains possible if it contains ALL known abilities we’ve actually confirmed.\r\n  // But if the only known ability is shared between sets, both remain -> ambiguity preserved.\r\n  let possible = sets;\r\n  if (known.length && sets.length) {\r\n    possible = sets.filter(set => known.every(k => set.includes(k)));\r\n    if (!possible.length) possible = sets;\r\n  }\r\n\r\n  // If we can narrow to one set, show it as Ability Set\r\n  if (possible.length === 1) {\r\n    const s = possible[0].map(nameOf).filter(Boolean);\r\n    let out = `<small>Ability Set:</small><br />`;\r\n    for (const a of s) out += `<span class=\"ability-line\">${BattleLog.escapeHTML(a)}</span><br />`;\r\n    return out;\r\n  }\r\n\r\n  // Otherwise show possible sets (with Set 1/2 colors you requested)\r\n  if (possible.length && !hidePossible) {\r\n    let out = `<small>Possible ability sets:</small><br />`;\r\n    for (let s = 0; s < possible.length; s++) {\r\n      const setNum = s + 1;\r\n      const setClass = setNum === 1 ? 'set-1' : (setNum === 2 ? 'set-2' : '');\r\n      out += `<span class=\"abilityset-title ${setClass}\">Set ${setNum}</span><br />`;\r\n      for (const id of possible[s]) {\r\n        const n = nameOf(id);\r\n        if (n) out += `<span class=\"ability-line\">${BattleLog.escapeHTML(n)}</span><br />`;\r\n      }\r\n    }\r\n    return out;\r\n  }\r\n}\r\n\t\tif (!isActive) {\r\n\t\t\t// for switch tooltips, only show the original ability\r\n\t\t\tconst ability = abilityData.baseAbility || abilityData.ability;\r\n\t\t\tif (ability) text = '<small>Ability:</small> ' + this.battle.dex.abilities.get(ability).name;\r\n\t\t} else {\r\n\t\t\tif (abilityData.ability) {\r\n\t\t\t\tconst abilityName = this.battle.dex.abilities.get(abilityData.ability).name;\r\n\t\t\t\ttext = '<small>Ability:</small> ' + abilityName;\r\n\t\t\t\tconst baseAbilityName = this.battle.dex.abilities.get(abilityData.baseAbility).name;\r\n\t\t\t\tif (baseAbilityName && baseAbilityName !== abilityName) text += ' (base: ' + baseAbilityName + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!text && abilityData.possibilities.length && !hidePossible && !(tier.includes('Almost Any Ability') || tier.includes('Hackmons') || tier.includes('Inheritance') || tier.includes('Metronome'))) { text = '<small>Possible abilities:</small> ' + abilityData.possibilities.join(', '); }\r\n\t\treturn text;\r\n\t}\r\n}\r\nexport class BattleStatGuesser {\r\n\tformatid: ID;\r\n\tdex: ModdedDex;\r\n\tmoveCount: any = null;\r\n\thasMove: any = null;\r\n\tignoreEVLimits: boolean;\r\n\tsupportsEVs: boolean;\r\n\tsupportsAVs: boolean;\r\n\tconstructor(formatid: ID) {\r\n\t\tthis.formatid = formatid;\r\n\t\tthis.dex = formatid ? Dex.mod(formatid.slice(0, 4) as ID) : Dex;\r\n\t\tthis.ignoreEVLimits = (\r\n\t\t\tthis.dex.gen < 3 ||\r\n\t\t\t((this.formatid.endsWith('hackmons') || this.formatid.endsWith('bh')) && this.dex.gen !== 6) ||\r\n\t\t\tthis.formatid.includes('metronomebattle') ||\r\n\t\t\tthis.formatid.endsWith('norestrictions')\r\n\t\t);\r\n\t\tthis.supportsEVs = !this.formatid.includes('letsgo');\r\n\t\tthis.supportsAVs = !this.supportsEVs && this.formatid.endsWith('norestrictions');\r\n\t}\r\n\tguess(set: Dex.PokemonSet) {\r\n\t\tlet role = this.guessRole(set);\r\n\t\tlet comboEVs = this.guessEVs(set, role);\r\n\t\tlet evs = { hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0 };\r\n\t\tfor (let stat in evs) { evs[stat as Dex.StatName] = comboEVs[stat as Dex.StatName] || 0; }\r\n\t\tlet plusStat = comboEVs.plusStat || '' as const;\r\n\t\tlet minusStat = comboEVs.minusStat || '' as const;\r\n\t\treturn { role, evs, plusStat, minusStat, moveCount: this.moveCount, hasMove: this.hasMove };\r\n\t}\r\n\tguessRole(set: Dex.PokemonSet) {\r\n\t\tif (!set) return '?';\r\n\t\tif (!set.moves) return '?';\r\n\t\tlet moveCount = {\r\n\t\t\t'Physical': 0,\r\n\t\t\t'Special': 0,\r\n\t\t\t'PhysicalAttack': 0,\r\n\t\t\t'SpecialAttack': 0,\r\n\t\t\t'PhysicalSetup': 0,\r\n\t\t\t'SpecialSetup': 0,\r\n\t\t\t'Support': 0,\r\n\t\t\t'Setup': 0,\r\n\t\t\t'Restoration': 0,\r\n\t\t\t'Offense': 0,\r\n\t\t\t'Stall': 0,\r\n\t\t\t'SpecialStall': 0,\r\n\t\t\t'PhysicalStall': 0,\r\n\t\t\t'Fast': 0,\r\n\t\t\t'Ultrafast': 0,\r\n\t\t\t'bulk': 0,\r\n\t\t\t'specialBulk': 0,\r\n\t\t\t'physicalBulk': 0,\r\n\t\t};\r\n\t\tlet hasMove: { [moveid: string]: 1 } = {};\r\n\t\tlet itemid = toID(set.item);\r\n\t\tlet item = this.dex.items.get(itemid);\r\n\t\tlet abilityid = toID(set.ability);\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tif (item.megaEvolves === species.name) species = this.dex.species.get(item.megaStone);\r\n\t\tif (!species.exists) return '?';\r\n\t\tlet stats = species.baseStats;\r\n\t\tif (set.moves.length < 1) return '?';\r\n\t\tlet needsFourMoves = !['unown', 'ditto'].includes(species.id);\r\n\t\tlet hasFourValidMoves = set.moves.length >= 4 && !set.moves.includes('');\r\n\t\tlet moveids = set.moves.map(toID);\r\n\t\tif (moveids.includes('lastresort' as ID)) needsFourMoves = false;\r\n\t\tif (!hasFourValidMoves && needsFourMoves && !this.formatid.includes('metronomebattle')) { return '?'; }\r\n\t\tfor (let i = 0, len = set.moves.length; i < len; i++) {\r\n\t\t\tlet move = this.dex.moves.get(set.moves[i]);\r\n\t\t\thasMove[move.id] = 1;\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tif (['batonpass', 'healingwish', 'lunardance'].includes(move.id)) { moveCount['Support']++; } \r\n\t\t\t\telse if (['metronome', 'assist', 'copycat', 'mefirst', 'photongeyser', 'shellsidearm'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Physical'] += 0.5;\r\n\t\t\t\t\tmoveCount['Special'] += 0.5;\r\n\t\t\t\t} \r\n\t\t\t\telse if (move.id === 'naturepower') { moveCount['Special']++; } \r\n\t\t\t\telse if (['protect', 'detect', 'spikyshield', 'kingsshield'].includes(move.id)) { moveCount['Stall']++; } \r\n\t\t\t\telse if (move.id === 'wish') {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t} \r\n\t\t\t\telse if (move.heal) {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t} \r\n\t\t\t\telse if (move.target === 'self') {\r\n\t\t\t\t\tif (['agility', 'rockpolish', 'shellsmash', 'growth', 'workup'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\t\t\tmoveCount['SpecialSetup']++;\r\n\t\t\t\t\t} else if (['dragondance', 'swordsdance', 'coil', 'bulkup', 'curse', 'bellydrum'].includes(move.id)) { moveCount['PhysicalSetup']++; } \r\n\t\t\t\t\telse if (['nastyplot', 'tailglow', 'quiverdance', 'calmmind', 'geomancy'].includes(move.id)) { moveCount['SpecialSetup']++; }\r\n\t\t\t\t\tif (move.id === 'substitute') moveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (['toxic', 'leechseed', 'willowisp'].includes(move.id)) { moveCount['Stall']++; }\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t}\r\n\t\t\t} else if (['counter', 'endeavor', 'metalburst', 'mirrorcoat', 'rapidspin'].includes(move.id)) { moveCount['Support']++; } \r\n\t\t\telse if (['nightshade', 'seismictoss', 'psywave', 'superfang', 'naturesmadness', 'foulplay', 'endeavor', 'finalgambit', 'bodypress',].includes(move.id)) { moveCount['Offense']++; } \r\n\t\t\telse if (move.id === 'fellstinger') {\r\n\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t} else {\r\n\t\t\t\tmoveCount[move.category]++;\r\n\t\t\t\tmoveCount['Offense']++;\r\n\t\t\t\tif (move.id === 'knockoff') { moveCount['Support']++; }\r\n\t\t\t\tif (['scald', 'voltswitch', 'uturn', 'flipturn'].includes(move.id)) { moveCount[move.category] -= 0.2; }\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasMove['batonpass']) moveCount['Support'] += moveCount['Setup'];\r\n\t\tmoveCount['PhysicalAttack'] = moveCount['Physical'];\r\n\t\tmoveCount['Physical'] += moveCount['PhysicalSetup'];\r\n\t\tmoveCount['SpecialAttack'] = moveCount['Special'];\r\n\t\tmoveCount['Special'] += moveCount['SpecialSetup'];\r\n\t\tif (hasMove['dragondance'] || hasMove['quiverdance']) moveCount['Ultrafast'] = 1;\r\n\t\tlet isFast = (stats.spe >= 80);\r\n\t\tlet physicalBulk = (stats.hp + 75) * (stats.def + 87);\r\n\t\tlet specialBulk = (stats.hp + 75) * (stats.spd + 87);\r\n\t\tif (hasMove['willowisp'] || hasMove['acidarmor'] || hasMove['irondefense'] || hasMove['cottonguard']) {\r\n\t\t\tphysicalBulk *= 1.6;\r\n\t\t\tmoveCount['PhysicalStall']++;\r\n\t\t} else if (hasMove['scald'] || hasMove['bulkup'] || hasMove['coil'] || hasMove['cosmicpower']) {\r\n\t\t\tphysicalBulk *= 1.3;\r\n\t\t\tif (hasMove['scald']) { moveCount['SpecialStall']++; } // partial stall goes in reverse\r\n\t\t\telse { moveCount['PhysicalStall']++; }\r\n\t\t}\r\n\t\tif (abilityid === 'flamebody') physicalBulk *= 1.1;\r\n\t\tif (hasMove['calmmind'] || hasMove['quiverdance'] || hasMove['geomancy']) {\r\n\t\t\tspecialBulk *= 1.3;\r\n\t\t\tmoveCount['SpecialStall']++;\r\n\t\t}\r\n\t\tif (abilityid === 'sandstream' && species.types.includes('Rock')) { specialBulk *= 1.5; }\r\n\t\tif (hasMove['bellydrum']) {\r\n\t\t\tphysicalBulk *= 0.6;\r\n\t\t\tspecialBulk *= 0.6;\r\n\t\t}\r\n\t\tif (moveCount['Restoration']) {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t} else if (hasMove['painsplit'] && hasMove['substitute']) { moveCount['Stall']--; } // SubSplit isn't generally a stall set\r\n\t\telse if (hasMove['painsplit'] || hasMove['rest']) {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif ((hasMove['bodyslam'] || hasMove['thunder']) && abilityid === 'serenegrace' || hasMove['thunderwave']) {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif ((hasMove['ironhead'] || hasMove['airslash']) && abilityid === 'serenegrace') {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif (hasMove['gigadrain'] || hasMove['drainpunch'] || hasMove['hornleech']) {\r\n\t\t\tphysicalBulk *= 1.15;\r\n\t\t\tspecialBulk *= 1.15;\r\n\t\t}\r\n\t\tif (itemid === 'leftovers' || itemid === 'blacksludge') {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif (hasMove['leechseed']) {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif ((itemid === 'flameorb' || itemid === 'toxicorb') && abilityid !== 'magicguard') {\r\n\t\t\tif (itemid === 'toxicorb' && abilityid === 'poisonheal') {\r\n\t\t\t\tphysicalBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t\tspecialBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t} else {\r\n\t\t\t\tphysicalBulk *= 0.8;\r\n\t\t\t\tspecialBulk *= 0.8;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemid === 'lifeorb') {\r\n\t\t\tphysicalBulk *= 0.7;\r\n\t\t\tspecialBulk *= 0.7;\r\n\t\t}\r\n\t\tif (abilityid === 'multiscale' || abilityid === 'magicguard' || abilityid === 'regenerator') {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif (itemid === 'eviolite') {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\t\tif (itemid === 'assaultvest') { specialBulk *= 1.5; }\r\n\t\tlet bulk = physicalBulk + specialBulk;\r\n\t\tif (bulk < 46000 && stats.spe >= 70) isFast = true;\r\n\t\tif (hasMove['trickroom']) isFast = false;\r\n\t\tmoveCount['bulk'] = bulk;\r\n\t\tmoveCount['physicalBulk'] = physicalBulk;\r\n\t\tmoveCount['specialBulk'] = specialBulk;\r\n\t\tif (\r\n\t\t\thasMove['agility'] || hasMove['dragondance'] || hasMove['quiverdance'] ||\r\n\t\t\thasMove['rockpolish'] || hasMove['shellsmash'] || hasMove['flamecharge']\r\n\t\t) { isFast = true; } \r\n\t\telse if (abilityid === 'unburden' || abilityid === 'speedboost' || abilityid === 'motordrive') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 1;\r\n\t\t} else if (abilityid === 'chlorophyll' || abilityid === 'swiftswim' || abilityid === 'sandrush') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 2;\r\n\t\t} else if (itemid === 'salacberry') { isFast = true; }\r\n\t\tconst ultrafast = hasMove['agility'] || hasMove['shellsmash'] || hasMove['autotomize'] || hasMove['shiftgear'] || hasMove['rockpolish'];\r\n\t\tif (ultrafast) { moveCount['Ultrafast'] = 2; }\r\n\t\tmoveCount['Fast'] = isFast ? 1 : 0;\r\n\t\tthis.moveCount = moveCount;\r\n\t\tthis.hasMove = hasMove;\r\n\t\tif (species.id === 'ditto') return abilityid === 'imposter' ? 'Physically Defensive' : 'Fast Bulky Support';\r\n\t\tif (species.id === 'shedinja') return 'Fast Physical Sweeper';\r\n\t\tif (itemid === 'choiceband' && moveCount['PhysicalAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Band';\r\n\t\t\treturn 'Fast Band';\r\n\t\t} else if (itemid === 'choicespecs' && moveCount['SpecialAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Specs';\r\n\t\t\treturn 'Fast Specs';\r\n\t\t} else if (itemid === 'choicescarf') {\r\n\t\t\tif (moveCount['PhysicalAttack'] === 0) return 'Special Scarf';\r\n\t\t\tif (moveCount['SpecialAttack'] === 0) return 'Physical Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] > moveCount['SpecialAttack']) return 'Physical Biased Mixed Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] < moveCount['SpecialAttack']) return 'Special Biased Mixed Scarf';\r\n\t\t\tif (stats.atk < stats.spa) return 'Special Biased Mixed Scarf';\r\n\t\t\treturn 'Physical Biased Mixed Scarf';\r\n\t\t}\r\n\t\tif (species.id === 'unown') return 'Fast Special Sweeper';\r\n\t\tif (moveCount['PhysicalStall'] && moveCount['Restoration']) {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Specially Defensive';\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall'] && moveCount['Restoration'] && itemid !== 'lifeorb') {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Physically Defensive';\r\n\t\t}\r\n\t\tlet offenseBias: 'Physical' | 'Special' = 'Physical';\r\n\t\tif (stats.spa > stats.atk && moveCount['Special'] > 1) offenseBias = 'Special';\r\n\t\telse if (stats.atk > stats.spa && moveCount['Physical'] > 1) offenseBias = 'Physical';\r\n\t\telse if (moveCount['Special'] > moveCount['Physical']) offenseBias = 'Special';\r\n\t\tif (moveCount['Stall'] + moveCount['Support'] / 2 <= 2 && bulk < 135000 && moveCount[offenseBias] >= 1.5) {\r\n\t\t\tif (isFast) {\r\n\t\t\t\tif (bulk > 80000 && !moveCount['Ultrafast']) return 'Bulky ' + offenseBias + ' Sweeper';\r\n\t\t\t\treturn 'Fast ' + offenseBias + ' Sweeper';\r\n\t\t\t} else { if (moveCount[offenseBias] >= 3 || moveCount['Stall'] <= 0) { return 'Bulky ' + offenseBias + ' Sweeper'; } }\r\n\t\t}\r\n\t\tif (isFast && abilityid !== 'prankster') {\r\n\t\t\tif (stats.spe > 100 || bulk < 55000 || moveCount['Ultrafast']) { return 'Fast Bulky Support'; }\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall']) return 'Physically Defensive';\r\n\t\tif (moveCount['PhysicalStall']) return 'Specially Defensive';\r\n\t\tif (species.id === 'blissey' || species.id === 'chansey') return 'Physically Defensive';\r\n\t\tif (specialBulk >= physicalBulk) return 'Specially Defensive';\r\n\t\treturn 'Physically Defensive';\r\n\t}\r\n\tensureMinEVs(evs: Dex.StatsTable, stat: Dex.StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = min - evs[stat];\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tif (evTotal <= 504) {\r\n\t\t\tlet change = Math.min(508 - evTotal, diff);\r\n\t\t\tevTotal += change;\r\n\t\t\tevs[stat] += change;\r\n\t\t\tdiff -= change;\r\n\t\t}\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tlet evPriority = { def: 1, spd: 1, hp: 1, atk: 1, spa: 1, spe: 1 };\r\n\t\tlet prioStat: Dex.StatName;\r\n\t\tfor (prioStat in evPriority) {\r\n\t\t\tif (prioStat === stat) continue;\r\n\t\t\tif (evs[prioStat] && evs[prioStat] > 128) {\r\n\t\t\t\tevs[prioStat] -= diff;\r\n\t\t\t\tevs[stat] += diff;\r\n\t\t\t\treturn evTotal;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tensureMaxEVs(evs: Dex.StatsTable, stat: Dex.StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = evs[stat] - min;\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tevs[stat] -= diff;\r\n\t\tevTotal -= diff;\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tguessEVs(\r\n\t\tset: Dex.PokemonSet, role: string\r\n\t): Partial<Dex.StatsTable> & { plusStat?: Dex.StatNameExceptHP, minusStat?: Dex.StatNameExceptHP } {\r\n\t\tif (!set) return {};\r\n\t\tif (role === '?') return {};\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tlet stats = species.baseStats;\r\n\t\tlet hasMove = this.hasMove;\r\n\t\tlet moveCount = this.moveCount;\r\n\t\tlet evs: Dex.StatsTable & { plusStat?: Dex.StatNameExceptHP, minusStat?: Dex.StatNameExceptHP } = { hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0, };\r\n\t\tlet plusStat: Dex.StatNameExceptHP;\r\n\t\tlet minusStat: Dex.StatNameExceptHP | undefined = undefined;\r\n\t\tlet statChart: { [role: string]: [Dex.StatNameExceptHP, Dex.StatName] } = {\r\n\t\t\t'Bulky Band': ['atk', 'hp'],\r\n\t\t\t'Fast Band': ['spe', 'atk'],\r\n\t\t\t'Bulky Specs': ['spa', 'hp'],\r\n\t\t\t'Fast Specs': ['spe', 'spa'],\r\n\t\t\t'Physical Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Scarf': ['spe', 'spa'],\r\n\t\t\t'Physical Biased Mixed Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Biased Mixed Scarf': ['spe', 'spa'],\r\n\t\t\t'Fast Physical Sweeper': ['spe', 'atk'],\r\n\t\t\t'Fast Special Sweeper': ['spe', 'spa'],\r\n\t\t\t'Bulky Physical Sweeper': ['atk', 'hp'],\r\n\t\t\t'Bulky Special Sweeper': ['spa', 'hp'],\r\n\t\t\t'Fast Bulky Support': ['spe', 'hp'],\r\n\t\t\t'Physically Defensive': ['def', 'hp'],\r\n\t\t\t'Specially Defensive': ['spd', 'hp'],\r\n\t\t};\r\n\t\tplusStat = statChart[role][0];\r\n\t\tif (role === 'Fast Bulky Support') moveCount['Ultrafast'] = 0;\r\n\t\tif (plusStat === 'spe' && moveCount['Ultrafast']) {\r\n\t\t\tif (statChart[role][1] === 'atk' || statChart[role][1] === 'spa') { plusStat = statChart[role][1]; } \r\n\t\t\telse if (moveCount['Physical'] >= 3) { plusStat = 'atk'; } \r\n\t\t\telse if (stats.spd > stats.def) { plusStat = 'spd'; } \r\n\t\t\telse { plusStat = 'def'; }\r\n\t\t}\r\n\t\tif (this.supportsAVs) {\r\n\t\t\t// Let's Go, AVs enabled\r\n\t\t\tevs = { hp: 200, atk: 200, def: 200, spa: 200, spd: 200, spe: 200 };\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack']) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t} else if (!this.supportsEVs) {\r\n\t\t\t// Let's Go, AVs disabled\r\n\t\t} else if (this.ignoreEVLimits) {\r\n\t\t\t// Gen 1-2, hackable EVs (like Hackmons)\r\n\t\t\tevs = { hp: 252, atk: 252, def: 252, spa: 252, spd: 252, spe: 252 };\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack'] && this.dex.gen > 1) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t\tif (this.dex.gen === 1) evs.spd = 0;\r\n\t\t\tif (this.dex.gen < 3) return evs;\r\n\t\t} else {\r\n\t\t\t// Normal Gen 3-7\r\n\t\t\tif (!statChart[role]) return {};\r\n\t\t\tlet evTotal = 0;\r\n\t\t\tlet primaryStat = statChart[role][0];\r\n\t\t\tlet stat = this.getStat(primaryStat, set, 252, plusStat === primaryStat ? 1.1 : 1.0);\r\n\t\t\tlet ev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(primaryStat, set, ev - 4, plusStat === primaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[primaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\t\t\tlet secondaryStat: Dex.StatName | null = statChart[role][1];\r\n\t\t\tif (secondaryStat === 'hp' && set.level && set.level < 20) secondaryStat = 'spd';\r\n\t\t\tstat = this.getStat(secondaryStat, set, 252, plusStat === secondaryStat ? 1.1 : 1.0);\r\n\t\t\tev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(secondaryStat, set, ev - 4, plusStat === secondaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[secondaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\t\t\tlet SRweaknesses = ['Fire', 'Flying', 'Bug', 'Ice'];\r\n\t\t\tlet SRresistances = ['Ground', 'Steel', 'Fighting'];\r\n\t\t\tlet SRweak = 0;\r\n\t\t\tif (set.ability !== 'Magic Guard' && set.ability !== 'Mountaineer') {\r\n\t\t\t\tif (SRweaknesses.includes(species.types[0])) { SRweak++; } \r\n\t\t\t\telse if (SRresistances.includes(species.types[0])) { SRweak--; }\r\n\t\t\t\tif (SRweaknesses.includes(species.types[1])) { SRweak++; } \r\n\t\t\t\telse if (SRresistances.includes(species.types[1])) { SRweak--; }\r\n\t\t\t}\r\n\t\t\tlet hpDivisibility = 0;\r\n\t\t\tlet hpShouldBeDivisible = false;\r\n\t\t\tlet hp = evs['hp'] || 0;\r\n\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\tif ((set.item === 'Leftovers' || set.item === 'Black Sludge') && hasMove['substitute'] && stat !== 404) { hpDivisibility = 4; } \r\n\t\t\telse if (set.item === 'Leftovers' || set.item === 'Black Sludge') { hpDivisibility = 0; } \r\n\t\t\telse if (hasMove['bellydrum'] && (set.item || '').endsWith('Berry')) {\r\n\t\t\t\thpDivisibility = 2;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} \r\n\t\t\telse if (hasMove['substitute'] && (set.item || '').endsWith('Berry')) {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} \r\n\t\t\telse if (SRweak >= 2 || hasMove['bellydrum']) { hpDivisibility = 2; } \r\n\t\t\telse if (SRweak >= 1 || hasMove['substitute'] || hasMove['transform']) { hpDivisibility = 4; } \r\n\t\t\telse if (set.ability !== 'Magic Guard') { hpDivisibility = 8; }\r\n\t\t\tif (hpDivisibility) {\r\n\t\t\t\twhile (hp < 252 && evTotal < 508 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp += 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal += 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && stat === this.getStat('hp', set, hp - 4, 1)) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (hp || evs['hp']) evs['hp'] = hp;\r\n\t\t\t}\r\n\t\t\tif (species.id === 'tentacruel') { evTotal = this.ensureMinEVs(evs, 'spe', 16, evTotal); } \r\n\t\t\telse if (species.id === 'skarmory') { evTotal = this.ensureMinEVs(evs, 'spe', 24, evTotal); } \r\n\t\t\telse if (species.id === 'jirachi') { evTotal = this.ensureMinEVs(evs, 'spe', 32, evTotal); } \r\n\t\t\telse if (species.id === 'celebi') { evTotal = this.ensureMinEVs(evs, 'spe', 36, evTotal); } \r\n\t\t\telse if (species.id === 'volcarona') { evTotal = this.ensureMinEVs(evs, 'spe', 52, evTotal); } \r\n\t\t\telse if (species.id === 'gliscor') { evTotal = this.ensureMinEVs(evs, 'spe', 72, evTotal); } \r\n\t\t\telse if (species.id === 'dragonite' && evs['hp']) { evTotal = this.ensureMaxEVs(evs, 'spe', 220, evTotal); }\r\n\t\t\tif (evTotal < 508) {\r\n\t\t\t\tlet remaining = 508 - evTotal;\r\n\t\t\t\tif (remaining > 252) remaining = 252;\r\n\t\t\t\tsecondaryStat = null;\r\n\t\t\t\tif (!evs['atk'] && moveCount['PhysicalAttack'] >= 1) { secondaryStat = 'atk'; } \r\n\t\t\t\telse if (!evs['spa'] && moveCount['SpecialAttack'] >= 1) { secondaryStat = 'spa'; } \r\n\t\t\t\telse if (stats.hp === 1 && !evs['def']) { secondaryStat = 'def'; } \r\n\t\t\t\telse if (stats.def === stats.spd && !evs['spd']) { secondaryStat = 'spd'; } \r\n\t\t\t\telse if (!evs['spd']) { secondaryStat = 'spd'; } \r\n\t\t\t\telse if (!evs['def']) { secondaryStat = 'def'; }\r\n\t\t\t\tif (secondaryStat) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat(secondaryStat, set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat(secondaryStat, set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs[secondaryStat] = ev;\r\n\t\t\t\t\tremaining -= ev;\r\n\t\t\t\t}\r\n\t\t\t\tif (remaining && !evs['spe']) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat('spe', set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat('spe', set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs['spe'] = ev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasMove['gyroball'] || hasMove['trickroom']) { minusStat = 'spe'; } \r\n\t\telse if (!moveCount['PhysicalAttack']) { minusStat = 'atk'; } \r\n\t\telse if (moveCount['SpecialAttack'] < 1 && !evs['spa']) {\r\n\t\t\tif (moveCount['SpecialAttack'] < moveCount['PhysicalAttack']) { minusStat = 'spa'; } \r\n\t\t\telse if (!evs['atk']) { minusStat = 'atk'; }\r\n\t\t} else if (moveCount['PhysicalAttack'] < 1 && !evs['atk']) { minusStat = 'atk'; } \r\n\t\telse if (stats.def > stats.spe && stats.spd > stats.spe && !evs['spe']) { minusStat = 'spe'; } \r\n\t\telse if (stats.def > stats.spd) { minusStat = 'spd'; } \r\n\t\telse { minusStat = 'def'; }\r\n\t\tif (!minusStat || plusStat === minusStat) { minusStat = (plusStat === 'spe' ? 'spd' : 'spe'); }\r\n\t\tevs.plusStat = plusStat;\r\n\t\tevs.minusStat = minusStat;\r\n\t\treturn evs;\r\n\t}\r\n\tgetStat(stat: Dex.StatName, set: Dex.PokemonSet, evOverride?: number, natureOverride?: number) {\r\n\t\tlet species = this.dex.species.get(set.species);\r\n\t\tif (!species.exists) return 0;\r\n\t\tlet level = set.level || 100;\r\n\t\tlet baseStat = species.baseStats[stat];\r\n\t\tlet iv = set.ivs?.[stat];\r\n\t\tif (typeof iv !== 'number') iv = 31;\r\n\t\tif (this.dex.gen <= 2) iv &= 30;\r\n\t\tlet ev = set.evs?.[stat];\r\n\t\tif (typeof ev !== 'number') ev = (this.dex.gen > 2 ? 0 : 252);\r\n\t\tif (evOverride !== undefined) ev = evOverride;\r\n\t\tif (stat === 'hp') {\r\n\t\t\tif (baseStat === 1) return 1;\r\n\t\t\tif (!this.supportsEVs) return ~~(~~(2 * baseStat + iv + 100) * level / 100 + 10) + (this.supportsAVs ? ev : 0);\r\n\t\t\treturn ~~(~~(2 * baseStat + iv + ~~(ev / 4) + 100) * level / 100 + 10);\r\n\t\t}\r\n\t\tlet val = ~~(~~(2 * baseStat + iv + ~~(ev / 4)) * level / 100 + 5);\r\n\t\tif (!this.supportsEVs) { val = ~~(~~(2 * baseStat + iv) * level / 100 + 5); }\r\n\t\tif (natureOverride) { val *= natureOverride; } \r\n\t\telse if (BattleNatures[set.nature!]?.plus === stat) { val *= 1.1; } \r\n\t\telse if (BattleNatures[set.nature!]?.minus === stat) { val *= 0.9; }\r\n\t\tif (!this.supportsEVs) {\r\n\t\t\tlet friendshipValue = ~~((70 / 255 / 10 + 1) * 100);\r\n\t\t\tval = ~~(val) * friendshipValue / 100 + (this.supportsAVs ? ev : 0);\r\n\t\t}\r\n\t\treturn ~~(val);\r\n\t}\r\n}\r\nexport function BattleStatOptimizer(set: Dex.PokemonSet, formatid: ID) {\r\n\tif (!set.evs) return null;\r\n\tconst dex = Dex.mod(formatid.slice(0, 4) as ID);\r\n\tconst ignoreEVLimits = (\r\n\t\tdex.gen < 3 ||\r\n\t\t((formatid.endsWith('hackmons') || formatid.endsWith('bh')) && dex.gen !== 6) ||\r\n\t\tformatid.includes('metronomebattle') || formatid.endsWith('norestrictions')\r\n\t);\r\n\tconst supportsEVs = !formatid.includes('letsgo');\r\n\tif (!supportsEVs || ignoreEVLimits) return null;\r\n\tconst species = dex.species.get(set.species);\r\n\tconst level = set.level || 100;\r\n\tconst getStat = (stat: Dex.StatNameExceptHP, ev: number, nature: Dex.Nature) => {\r\n\t\tconst baseStat = species.baseStats[stat];\r\n\t\tconst iv = set.ivs?.[stat] || 31;\r\n\t\tlet val = ~~(~~(2 * baseStat + iv + ~~(ev / 4)) * level / 100 + 5);\r\n\t\tif (nature.plus === stat) { val *= 1.1; } \r\n\t\telse if (nature.minus === stat) { val *= 0.9; }\r\n\t\treturn ~~(val);\r\n\t};\r\n\tconst origNature = BattleNatures[set.nature || 'Serious'];\r\n\tconst origStats = {\r\n\t\t// no need to calculate hp\r\n\t\tatk: getStat('atk', set.evs.atk || 0, origNature),\r\n\t\tdef: getStat('def', set.evs.def || 0, origNature),\r\n\t\tspa: getStat('spa', set.evs.spa || 0, origNature),\r\n\t\tspd: getStat('spd', set.evs.spd || 0, origNature),\r\n\t\tspe: getStat('spe', set.evs.spe || 0, origNature),\r\n\t};\r\n\tconst getMinEVs = (stat: Dex.StatNameExceptHP, nature: Dex.Nature) => {\r\n\t\tlet ev = 0;\r\n\t\twhile (getStat(stat, ev, nature) < origStats[stat]) { ev += 4; }\r\n\t\treturn ev;\r\n\t};\r\n\tconst origSpread = { evs: set.evs, ...origNature };\r\n\tlet origLeftoverEVs = 508;\r\n\tfor (const stat of Dex.statNames) { origLeftoverEVs -= origSpread.evs?.[stat] || 0; }\r\n\t// Only check for optimizations if EVs are completed\r\n\tif (origLeftoverEVs > 4) return null;\r\n\t// Can't move the plus if it boosts its stat past normal EV limit\r\n\tconst plusTooHigh = origNature.plus && getStat(origNature.plus, 252, {}) < origStats[origNature.plus];\r\n\t// Can't move the minus if there's no investment in its stat to redistribute\r\n\tconst minusTooLow = origNature.minus && !origSpread.evs?.[origNature.minus];\r\n\t// If we can't move either of them, do nothing\r\n\tif (plusTooHigh && minusTooLow) return null;\r\n\tlet bestPlus = origNature.plus;\r\n\tlet bestPlusMinEVs = bestPlus && origSpread.evs[bestPlus];\r\n\tlet bestMinus = origNature.minus || 'atk';\r\n\tlet bestMinusMinEVs = origSpread.evs[bestMinus];\r\n\tlet savedEVs = 0;\r\n\t// Try and move the minus first, as figuring out where the plus should go is harder if the minus hasn't been placed\r\n\tif (!minusTooLow) {\r\n\t\tfor (const stat of Dex.statNamesExceptHP) {\r\n\t\t\tif (origStats[stat] < origStats[bestMinus]) {\r\n\t\t\t\tconst minEVs = getMinEVs(stat, { minus: stat });\r\n\t\t\t\tif (minEVs > 252) continue;\r\n\t\t\t\t// This number can go negative at this point, but we'll make up for it later (and check to make sure)\r\n\t\t\t\tsavedEVs = (origSpread.evs[stat] || 0) - minEVs;\r\n\t\t\t\tif (origNature.minus) { savedEVs += (origSpread.evs[origNature.minus] || 0) - getMinEVs(origNature.minus, { minus: stat }); }\r\n\t\t\t\tbestMinus = stat;\r\n\t\t\t\tbestMinusMinEVs = minEVs;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (!plusTooHigh) {\r\n\t\tfor (const stat of Dex.statNamesExceptHP) {\r\n\t\t\t// Don't move the plus to an uninvested stat\r\n\t\t\tif (stat !== origNature.plus && origSpread.evs[stat] && stat !== bestMinus) {\r\n\t\t\t\tconst minEVs = getMinEVs(stat, { plus: stat });\r\n\t\t\t\tlet plusEVsSaved = (origNature.minus === stat ? getMinEVs(stat, {}) : origSpread.evs[stat] || 0) - minEVs;\r\n\t\t\t\tif (bestPlus && bestPlus !== bestMinus) { plusEVsSaved += bestPlusMinEVs! - getMinEVs(bestPlus, { plus: stat, minus: bestMinus }); }\r\n\t\t\t\tif (plusEVsSaved > 0 && savedEVs + plusEVsSaved > 0) {\r\n\t\t\t\t\tsavedEVs += plusEVsSaved;\r\n\t\t\t\t\tbestPlus = stat;\r\n\t\t\t\t\tbestPlusMinEVs = minEVs;\r\n\t\t\t\t} else if (plusEVsSaved === 0 && (bestPlus || savedEVs > 0) || plusEVsSaved > 0 && savedEVs + plusEVsSaved === 0) {\r\n\t\t\t\t\tif (!bestPlus || getStat(stat, getMinEVs(stat, { plus: stat }), { plus: stat }) > origStats[stat]) {\r\n\t\t\t\t\t\tsavedEVs += plusEVsSaved;\r\n\t\t\t\t\t\tbestPlus = stat;\r\n\t\t\t\t\t\tbestPlusMinEVs = minEVs;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (bestPlus && savedEVs >= 0) {\r\n\t\tconst newSpread: {\r\n\t\t\tevs: Partial<Dex.StatsTable>,\r\n\t\t\tplus?: Dex.StatNameExceptHP,\r\n\t\t\tminus?: Dex.StatNameExceptHP,\r\n\t\t} = { evs: { ...origSpread.evs }, plus: bestPlus, minus: bestMinus };\r\n\t\tif (bestPlus !== origNature.plus || bestMinus !== origNature.minus) {\r\n\t\t\tnewSpread.evs[bestPlus] = bestPlusMinEVs!;\r\n\t\t\tnewSpread.evs[bestMinus] = bestMinusMinEVs!;\r\n\t\t\tif (origNature.plus && origNature.plus !== bestPlus && origNature.plus !== bestMinus) { newSpread.evs[origNature.plus] = getMinEVs(origNature.plus, newSpread); }\r\n\t\t\tif (origNature.minus && origNature.minus !== bestPlus && origNature.minus !== bestMinus) { newSpread.evs[origNature.minus] = getMinEVs(origNature.minus, newSpread); }\r\n\t\t\tfor (const stat of Dex.statNames) { if (!newSpread.evs[stat]) delete newSpread.evs[stat]; }\r\n\t\t\treturn { ...newSpread, savedEVs };\r\n\t\t} else if (!plusTooHigh && !minusTooLow) {\r\n\t\t\tif (Math.floor(getStat(bestPlus, bestMinusMinEVs!, newSpread) / 11) <= Math.ceil(origStats[bestMinus] / 9)) {\r\n\t\t\t\t// We're not gaining more points from our plus than we're losing to our minus\r\n\t\t\t\t// So a neutral nature would be better\r\n\t\t\t\tdelete newSpread.plus;\r\n\t\t\t\tdelete newSpread.minus;\r\n\t\t\t\tnewSpread.evs[origNature.plus] = getMinEVs(origNature.plus, newSpread);\r\n\t\t\t\tnewSpread.evs[origNature.minus] = getMinEVs(origNature.minus, newSpread);\r\n\t\t\t\tsavedEVs += (origSpread.evs[origNature.plus] || 0) - newSpread.evs[origNature.plus]!;\r\n\t\t\t\tsavedEVs += (origSpread.evs[origNature.minus] || 0) - newSpread.evs[origNature.minus]!;\r\n\t\t\t\tif (savedEVs < 0) return null;\r\n\t\t\t\tfor (const stat of Dex.statNames) { if (!newSpread.evs[stat]) delete newSpread.evs[stat]; }\r\n\t\t\t\treturn { ...newSpread, savedEVs };\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\ndeclare const require: any;\r\ndeclare const global: any;\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\tglobal.BattleStatGuesser = BattleStatGuesser;\r\n\tglobal.BattleStatOptimizer = BattleStatOptimizer;\r\n}"],"mappings":"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","ignoreList":[]}