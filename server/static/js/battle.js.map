{"version":3,"file":"battle.js","names":["Pokemon","data","side","name","speciesForme","ident","details","searchid","slot","fainted","hp","maxhp","level","gender","shiny","hpcolor","moves","ability","baseAbility","ability2","baseAbility2","item","itemEffect","prevItem","prevItemEffect","terastallized","teraType","boosts","status","statusStage","volatiles","turnstatuses","movestatuses","lastMove","moveTrack","statusData","sleepTurns","toxicTurns","timesAttacked","sprite","battle","scene","addPokemonSprite","_proto","prototype","isActive","active","includes","getHPColor","ratio","getHPColorClass","getPixelRange","pixels","color","epsilon","getFormattedRange","range","precision","separator","percentage","Math","abs","floor","toFixed","lower","upper","ceil","getDamageRange","damage","length","undefined","oldrange","newrange","r","healthParse","hpstring","parsedamage","heal","_hpstring","parenIndex","lastIndexOf","parseFloat","isNaN","ret","percent","round","substr","oldhp","oldmaxhp","oldwidth","hpWidth","oldcolor","parseHealth","oldnum","delta","deltawidth","checkDetails","replace","getIdent","slots","removeVolatile","volatile","removeEffect","hasVolatile","addVolatile","_len","arguments","args","Array","_key","concat","addEffect","removeTurnstatus","hasTurnstatus","addTurnstatus","toID","clearTurnstatuses","id","updateStatbar","removeMovestatus","hasMovestatus","addMovestatus","clearMovestatuses","clearVolatiles","clearEffects","rememberMove","moveName","pp","recursionSource","Dex","get","startsWith","transform","_i2","_this$moveTrack2","entry","push","rememberAbility","isNotBase","abilities","swapAbilities","other","_ref","_ref2","_ref3","_ref4","getBoost","boostStat","boostStatTable","atk","def","spa","spd","spe","accuracy","evasion","spc","isRBY","gen","tier","goodBoostTable","badBoostTable","getWeightKg","serverPokemon","_this$volatiles$autot","autotomizeFactor","autotomize","max","getSpecies","weightkg","getBoostType","clearVolatile","i","splice","copyVolatileFrom","pokemon","copySource","volatilesToRemove","_i4","_Dex$statNamesExceptH2","statNamesExceptHP","statName","_i6","removeTransform","copyTypesFrom","preterastallized","_pokemon$getTypes","getTypes","types","addedType","join","typechange","split","filter","typeName","typeadd","isGrounded","hasPseudoWeather","effectiveAbility","getTypeList","dex","flags","ngasActive","effectiveAbility2","_this$getTypes","getSpeciesForme","formechange","species","getBaseSpecies","reset","maxWidth","getHPText","reportExactHP","exactHP","destroy","Side","n","sideid","isFar","foe","ally","avatar","badges","rating","totalPokemon","x","y","z","missedPokemon","wisher","lastPokemon","sideConditions","faintCounter","_proto2","rollTrainerSprites","sprites","random","behindx","offset","behindy","leftof","behind","clearPokemon","_i8","_this$pokemon2","setAvatar","setName","addSideCondition","effect","persist","condition","removeSideCondition","addPokemon","replaceSlot","oldPokemon","parseDetails","poke","speciesClause","existingTable","toRemove","poke1i","poke1","poke2i","poke2","illusionFound","_i10","_this$pokemon4","curPoke","_i12","_this$pokemon6","updateSidebar","switchIn","kwArgs","getEffect","from","animSummon","dragIn","oldpokemon","animDragOut","animDragIn","Object","assign","animUnsummon","switchOut","log","swapTo","target","oslot","swapWith","nslot","faint","animFaint","Battle","_this","options","viewpointSwitched","stepQueue","preemptStepQueue","waitForAnimations","currentStep","seeking","activeMoveIsSpread","subscription","mute","messageFadeTime","messageShownTime","turnsSinceMoved","turn","atQueueEnd","started","ended","isReplay","usesUpkeep","weather","pseudoWeather","weatherTimeLeft","weatherMinTimeLeft","mySide","nearSide","farSide","p1","p2","p3","p4","pokemonControlled","sides","myPokemon","myAllyPokemon","teamPreviewCount","gameType","compatMode","rated","rules","isBlitz","endLastTurnPending","totalTimeLeft","graceTimeLeft","kickingInactive","roomid","hardcoreMode","ignoreNicks","prefs","ignoreOpponent","ignoreSpects","debug","joinButtons","autoresize","paused","onResize","width","$","window","_this$scene$$frame","_this$scene$$frame2","_this$scene$$frame3","scale","$frame","css","_this$scene$$frame4","_this$scene$$frame5","$logFrame","BattleScene","BattleSceneStub","Error","resetStep","addEventListener","_proto3","subscribe","listener","removePseudoWeather","updateWeather","addPseudoWeather","minTimeLeft","timeLeft","_i14","_this$pseudoWeather2","_ref5","pseudoWeatherName","getAllActive","pokemonList","_i16","_side$active2","_i18","_this$getAllActive2","abilityActive","ids","map","_i20","_this$getAllActive4","a1","a2","_this$subscription","pause","call","_i22","_this$sides2","resetTurnsSinceMoved","nextStep","removeEventListener","preempt","add","resetToCurrentTurn","seekTurn","Infinity","switchViewpoint","setViewpoint","start","winner","_this$subscription2","prematureEnd","_this$subscription3","endLastTurn","updateStatbars","setHardcoreMode","mode","updateSidebars","setTurn","turnNum","updateTurnCounters","incrementTurn","stopSeeking","_this$subscription4","updateAcceleration","changeWeather","weatherName","isUpkeep","upkeepWeather","isExtremeWeather","activateAbility","swapSideConditions","temp","_i24","sourceSide","sourceSideConditions","targetSide","side1","side2","_i26","_ref6","_i28","_this$pseudoWeather4","pWeather","_i30","_this$sides4","cond","_i32","_ref8","useMove","move","fromeffect","callerMoveForPressure","isZ","items","zMoveFrom","slice","BattleItems","zMoveType","type","foeTargets","moveTarget","pressureTarget","_i34","_this$getAllActive6","_i36","animateMove","spread","still","miss","notarget","prepare","anim","runPrepareAnim","usedMove","runMoveAnim","targets","_i38","_kwArgs$spread$split2","hitTarget","curTarget","getPokemon","cantUseMove","BattleStatusAnims","runStatusAnim","resultAnim","runOtherAnim","animReset","effectOrName","effectType","abilityActivateAnim","runMinor","nextArgs","nextKwargs","then","silent","closeMessagebar","simult","CONSUMED","ofpoke","of","itemPoke","category","damageinfo","hover","damageAnim","_i40","_poke$moveTrack2","trackedMove","runResidualAnim","_this$parsePokemonId","parsePokemonId","siden","healAnim","k","cpoke","formattedRange","diff","stat","amount","parseInt","stats","_i42","tmp","frompoke","_i44","volatilesToCopy","_i46","timeOffset","_i48","_this$getAllActive8","afdMode","moveid","time","auraTime","Number","thaw","auraStartTurn","auraDuration","_i50","_poke22$side$pokemon2","updateStatbarIfExists","possibleTargets","p","eat","weaken","oldAbility","oldId","b2","effId","s2","fail","wait","newSpeciesForme","commaIndex","indexOf","trim","megaStone","animTransform","tpoke","targetForme","endsWith","_i52","_tpoke$moveTrack2","lockForme","resetStatbar","sanitizeName","typeAnim","already","block","interrupt","_i54","_poke36$side$pokemon2","number","foeActive","_i56","_poke36$side$foe$acti2","maybeTarget","broken","getSide","persistent","upkeep","maxTimeLeft","pwID","_i58","_this$getAllActive10","checkActive","beforeMove","afterMove","pokemonid","output","isTeamPreview","splitDetails","pop","_hpstring$split","_hp$split","curhp","colorchar","test","charAt","slotChart","a","b","c","d","e","f","getSwitchedPokemon","_this$parsePokemonId2","parsedPokemonid","rememberTeamPreviewPokemon","_this$parsePokemonId3","findCorrespondingPokemon","_this$parsePokemonId4","_i60","_this$sides$siden$pok2","faintedOnly","_this$parsePokemonId5","isInactive","_i62","_side$pokemon2","sidename","command","instantAdd","run","runMajor","resetSides","_i64","_this$sides6","mod","_i66","_this$sides8","updateGen","ruleName","_args$1$split","totalTime","graceTime","_window$app","_window$PS","hasIndex","userid","app","user","PS","room","rooms","BattleTextParser","parseNameParts","toUserid","users","userCount","userList","updateUserCount","updateNoUsersOnline","remove","oldid","set","away","hideJoinButtons","badge","_this$parsePokemonId6","teamPreview","team","Teams","unpack","_i68","_i70","_set$moves2","_exec","exec","targetIndex","forGen","_this$subscription5","setFrameHTML","BattleLog","sanitizeHTML","setControlsHTML","str","shift","preemptCatchup","_BattleTextParser$par","parseBattleLine","maybeCloseMessagebar","nextLine","_BattleTextParser$par2","err","_this$subscription6","stack","_i72","line","updateBgm","_this$subscription7","play","_this$subscription8","resume","skipTurn","seekBy","deltaTurn","_this$seeking","forceReset","_this$subscription9","animationOn","animationOff","_this$subscription10","shouldStep","_this2","Date","now","startAnimations","animations","interruptionCount","_this$subscription11","finishAnimations","setTimeout","done","setQueue","queue","setMute","require","global"],"sources":["../src/battle.ts"],"sourcesContent":["/**\r\n * Pokemon Showdown Battle\r\n *\r\n * This is the main file for handling battle animations\r\n *\r\n * Licensing note: PS's client has complicated licensing:\r\n * - The client as a whole is AGPLv3\r\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\r\n *\r\n * Layout:\r\n *\r\n * - Battle\r\n *   - Side\r\n *     - Pokemon\r\n *   - BattleScene\r\n *     - BattleLog\r\n *       - BattleTextParser\r\n *\r\n * When a Battle receives a message, it splits the message into tokens\r\n * and parses what happens, updating its own state, and then telling\r\n * BattleScene to do any relevant animations. The tokens then get\r\n * passed directly into BattleLog. If the message is an in-battle\r\n * message, it'll be extracted by BattleTextParser, which adds it to\r\n * both the battle log itself, as well as the messagebar.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\n// import $ from 'jquery';\r\nimport { BattleSceneStub } from './battle-scene-stub';\r\nimport { BattleLog } from './battle-log';\r\nimport { BattleScene, type PokemonSprite, BattleStatusAnims } from './battle-animations';\r\nimport { Dex, toID, toUserid, type ID, type ModdedDex } from './battle-dex';\r\nimport { BattleTextParser, type Args, type KWArgs, type SideID } from './battle-text-parser';\r\nimport { Teams } from './battle-teams';\r\ndeclare const app: { user: AnyObject, rooms: AnyObject, ignore?: AnyObject } | undefined;\r\n\r\n/** [id, element?, ...misc] */\r\nexport type EffectState = any[] & { 0: ID };\r\nexport type WeatherState = [name: string, minTimeLeft: number, maxTimeLeft: number];\r\nexport type HPColor = 'r' | 'y' | 'g';\r\n\r\nexport class Pokemon implements PokemonDetails, PokemonHealth {\r\n\tname = '';\r\n\tspeciesForme = '';\r\n\r\n\t/**\r\n\t * A string representing information extractable from textual\r\n\t * messages: side, nickname.\r\n\t *\r\n\t * Will be the empty string between Team Preview and the first\r\n\t * switch-in.\r\n\t *\r\n\t * Examples: `p1: Unown` or `p2: Sparky`\r\n\t */\r\n\tident = '';\r\n\t/**\r\n\t * A string representing visible information not included in\r\n\t * ident: species, level, gender, shininess. Level is left off\r\n\t * if it's 100; gender is left off if it's genderless.\r\n\t *\r\n\t * Note: Can be partially filled out in Team Preview, because certain\r\n\t * forme information and shininess isn't visible there. In those\r\n\t * cases, details can change during the first switch-in, but will\r\n\t * otherwise not change over the course of a game.\r\n\t *\r\n\t * Examples: `Mimikyu, L50, F`, `Steelix, M, shiny`\r\n\t */\r\n\tdetails = '';\r\n\t/**\r\n\t * `` `${ident}|${details}` ``. Tracked for ease of searching.\r\n\t *\r\n\t * As with ident, blank before the first switch-in, and will only\r\n\t * change during the first switch-in.\r\n\t */\r\n\tsearchid = '';\r\n\r\n\tside: Side;\r\n\tslot = 0;\r\n\r\n\tfainted = false;\r\n\thp = 0;\r\n\tmaxhp = 1000;\r\n\tlevel = 100;\r\n\tgender: Dex.GenderName = 'N';\r\n\tshiny = false;\r\n\r\n\thpcolor: HPColor = 'g';\r\n\tmoves: string[] = [];\r\n\tability = '';\r\n\tbaseAbility = '';\r\n\tability2 = '';\r\n\tbaseAbility2 = '';\r\n\titem = '';\r\n\titemEffect = '';\r\n\tprevItem = '';\r\n\tprevItemEffect = '';\r\n\tterastallized = '';\r\n\tteraType = '';\r\n\r\n\tboosts: { [stat: string]: number } = {};\r\n\tstatus: Dex.StatusName | 'tox' | '' | '???' = '';\r\n\tstatusStage = 0;\r\n\tvolatiles: { [effectid: string]: EffectState } = {};\r\n\tturnstatuses: { [effectid: string]: EffectState } = {};\r\n\tmovestatuses: { [effectid: string]: EffectState } = {};\r\n\tlastMove = '';\r\n\r\n\t/** [[moveName, ppUsed]] */\r\n\tmoveTrack: [string, number][] = [];\r\n\tstatusData = { sleepTurns: 0, toxicTurns: 0 };\r\n\ttimesAttacked = 0;\r\n\r\n\tsprite: PokemonSprite;\r\n\r\n\tconstructor(data: PokemonDetails, side: Side) {\r\n\t\tthis.side = side;\r\n\t\tthis.speciesForme = data.speciesForme;\r\n\r\n\t\tthis.details = data.details;\r\n\t\tthis.name = data.name;\r\n\t\tthis.level = data.level;\r\n\t\tthis.shiny = data.shiny;\r\n\t\tthis.gender = data.gender || 'N';\r\n\t\tthis.ident = data.ident;\r\n\t\tthis.terastallized = data.terastallized || '';\r\n\t\tthis.searchid = data.searchid;\r\n\r\n\t\tthis.sprite = side.battle.scene.addPokemonSprite(this);\r\n\t}\r\n\r\n\tisActive() {\r\n\t\treturn this.side.active.includes(this);\r\n\t}\r\n\r\n\t/** @deprecated */\r\n\tprivate getHPColor(): HPColor {\r\n\t\tif (this.hpcolor) return this.hpcolor;\r\n\t\tlet ratio = this.hp / this.maxhp;\r\n\t\tif (ratio > 0.5) return 'g';\r\n\t\tif (ratio > 0.2) return 'y';\r\n\t\treturn 'r';\r\n\t}\r\n\t/** @deprecated */\r\n\tprivate getHPColorClass() {\r\n\t\tswitch (this.getHPColor()) {\r\n\t\tcase 'y': return 'hpbar hpbar-yellow';\r\n\t\tcase 'r': return 'hpbar hpbar-red';\r\n\t\t}\r\n\t\treturn 'hpbar';\r\n\t}\r\n\tstatic getPixelRange(pixels: number, color: HPColor | ''): [number, number] {\r\n\t\tlet epsilon = 0.5 / 714;\r\n\r\n\t\tif (pixels === 0) return [0, 0];\r\n\t\tif (pixels === 1) return [0 + epsilon, 2 / 48 - epsilon];\r\n\t\tif (color) {\r\n\t\t\tif (pixels === 9) {\r\n\t\t\t\tif (color === 'y') { // ratio is > 0.2\r\n\t\t\t\t\treturn [0.2 + epsilon, 10 / 48 - epsilon];\r\n\t\t\t\t} else if (color === 'r') { // ratio is <= 0.2\r\n\t\t\t\t\treturn [9 / 48, 0.2];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (pixels === 24) {\r\n\t\t\t\tif (color === 'g') { // ratio is > 0.5\r\n\t\t\t\t\treturn [0.5 + epsilon, 25 / 48 - epsilon];\r\n\t\t\t\t} else if (color === 'y') { // ratio is exactly 0.5\r\n\t\t\t\t\treturn [0.5, 0.5];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (pixels === 48) return [1, 1];\r\n\r\n\t\treturn [pixels / 48, (pixels + 1) / 48 - epsilon];\r\n\t}\r\n\tstatic getFormattedRange(range: [number, number], precision: number, separator: string) {\r\n\t\tif (range[0] === range[1]) {\r\n\t\t\tlet percentage = Math.abs(range[0] * 100);\r\n\t\t\tif (Math.floor(percentage) === percentage) {\r\n\t\t\t\treturn `${percentage}%`;\r\n\t\t\t}\r\n\t\t\treturn percentage.toFixed(precision) + '%';\r\n\t\t}\r\n\t\tlet lower;\r\n\t\tlet upper;\r\n\t\tif (precision === 0) {\r\n\t\t\tlower = Math.floor(range[0] * 100);\r\n\t\t\tupper = Math.ceil(range[1] * 100);\r\n\t\t} else {\r\n\t\t\tlower = (range[0] * 100).toFixed(precision);\r\n\t\t\tupper = (range[1] * 100).toFixed(precision);\r\n\t\t}\r\n\t\treturn `${lower}${separator}${upper}%`;\r\n\t}\r\n\t// Returns [min, max] damage dealt as a proportion of total HP from 0 to 1\r\n\tgetDamageRange(damage: any): [number, number] {\r\n\t\tif (damage[1] !== 48) {\r\n\t\t\tlet ratio = damage[0] / damage[1];\r\n\t\t\treturn [ratio, ratio];\r\n\t\t} else if (damage.length === undefined) {\r\n\t\t\t// wrong pixel damage.\r\n\t\t\t// this case exists for backward compatibility only.\r\n\t\t\treturn [damage[2] / 100, damage[2] / 100];\r\n\t\t}\r\n\t\t// pixel damage\r\n\t\tlet oldrange = Pokemon.getPixelRange(damage[3], damage[4]);\r\n\t\tlet newrange = Pokemon.getPixelRange(damage[3] + damage[0], this.hpcolor);\r\n\t\tif (damage[0] === 0) {\r\n\t\t\t// no change in displayed pixel width\r\n\t\t\treturn [0, newrange[1] - newrange[0]];\r\n\t\t}\r\n\t\tif (oldrange[0] < newrange[0]) { // swap order\r\n\t\t\tlet r = oldrange;\r\n\t\t\toldrange = newrange;\r\n\t\t\tnewrange = r;\r\n\t\t}\r\n\t\treturn [oldrange[0] - newrange[1], oldrange[1] - newrange[0]];\r\n\t}\r\n\thealthParse(hpstring: string, parsedamage?: boolean, heal?: boolean):\r\n\t\t[number, number, number] | [number, number, number, number, HPColor] | null {\r\n\t\t// returns [delta, denominator, percent(, oldnum, oldcolor)] or null\r\n\t\tif (!hpstring?.length) return null;\r\n\t\tlet parenIndex = hpstring.lastIndexOf('(');\r\n\t\tif (parenIndex >= 0) {\r\n\t\t\t// old style damage and health reporting\r\n\t\t\tif (parsedamage) {\r\n\t\t\t\tlet damage = parseFloat(hpstring);\r\n\t\t\t\t// unusual check preseved for backward compatbility\r\n\t\t\t\tif (isNaN(damage)) damage = 50;\r\n\t\t\t\tif (heal) {\r\n\t\t\t\t\tthis.hp += this.maxhp * damage / 100;\r\n\t\t\t\t\tif (this.hp > this.maxhp) this.hp = this.maxhp;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.hp -= this.maxhp * damage / 100;\r\n\t\t\t\t}\r\n\t\t\t\t// parse the absolute health information\r\n\t\t\t\tlet ret = this.healthParse(hpstring);\r\n\t\t\t\tif (ret && (ret[1] === 100)) {\r\n\t\t\t\t\t// support for old replays with nearest-100th damage and health\r\n\t\t\t\t\treturn [damage, 100, damage];\r\n\t\t\t\t}\r\n\t\t\t\t// complicated expressions preserved for backward compatibility\r\n\t\t\t\tlet percent = Math.round(Math.ceil(damage * 48 / 100) / 48 * 100);\r\n\t\t\t\tlet pixels = Math.ceil(damage * 48 / 100);\r\n\t\t\t\treturn [pixels, 48, percent];\r\n\t\t\t}\r\n\t\t\tif (hpstring.substr(hpstring.length - 1) !== ')') {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\thpstring = hpstring.substr(parenIndex + 1, hpstring.length - parenIndex - 2);\r\n\t\t}\r\n\r\n\t\tlet oldhp = this.fainted ? 0 : (this.hp || 1);\r\n\t\tlet oldmaxhp = this.maxhp;\r\n\t\tlet oldwidth = this.hpWidth(100);\r\n\t\tlet oldcolor = this.hpcolor;\r\n\r\n\t\tthis.side.battle.parseHealth(hpstring, this);\r\n\t\tif (oldmaxhp === 0) { // max hp not known before parsing this message\r\n\t\t\toldmaxhp = oldhp = this.maxhp;\r\n\t\t}\r\n\r\n\t\tlet oldnum = oldhp ? (Math.floor(this.maxhp * oldhp / oldmaxhp) || 1) : 0;\r\n\t\tlet delta = this.hp - oldnum;\r\n\t\tlet deltawidth = this.hpWidth(100) - oldwidth;\r\n\t\treturn [delta, this.maxhp, deltawidth, oldnum, oldcolor];\r\n\t}\r\n\tcheckDetails(details?: string) {\r\n\t\tif (!details) return false;\r\n\t\tif (details === this.details) return true;\r\n\t\tif (this.searchid) return false;\r\n\t\tif (details.includes(', shiny')) {\r\n\t\t\tif (this.checkDetails(details.replace(', shiny', ''))) return true;\r\n\t\t}\r\n\t\t// the actual forme was hidden on Team Preview\r\n\t\tdetails = details.replace(/(-[A-Za-z0-9-]+)?(, |$)/, '-*$2');\r\n\t\treturn (details === this.details);\r\n\t}\r\n\tgetIdent() {\r\n\t\tlet slots = ['a', 'b', 'c', 'd', 'e', 'f'];\r\n\t\treturn this.ident.substr(0, 2) + slots[this.slot] + this.ident.substr(2);\r\n\t}\r\n\tremoveVolatile(volatile: ID) {\r\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\r\n\t\tif (!this.hasVolatile(volatile)) return;\r\n\t\tdelete this.volatiles[volatile];\r\n\t}\r\n\taddVolatile(volatile: ID, ...args: any[]) {\r\n\t\tif (this.hasVolatile(volatile) && !args.length) return;\r\n\t\tthis.volatiles[volatile] = [volatile, ...args] as EffectState;\r\n\t\tthis.side.battle.scene.addEffect(this, volatile);\r\n\t}\r\n\thasVolatile(volatile: ID) {\r\n\t\treturn !!this.volatiles[volatile];\r\n\t}\r\n\tremoveTurnstatus(volatile: ID) {\r\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\r\n\t\tif (!this.hasTurnstatus(volatile)) return;\r\n\t\tdelete this.turnstatuses[volatile];\r\n\t}\r\n\taddTurnstatus(volatile: ID) {\r\n\t\tvolatile = toID(volatile);\r\n\t\tthis.side.battle.scene.addEffect(this, volatile);\r\n\t\tif (this.hasTurnstatus(volatile)) return;\r\n\t\tthis.turnstatuses[volatile] = [volatile];\r\n\t}\r\n\thasTurnstatus(volatile: ID) {\r\n\t\treturn !!this.turnstatuses[volatile];\r\n\t}\r\n\tclearTurnstatuses() {\r\n\t\tfor (let id in this.turnstatuses) {\r\n\t\t\tthis.removeTurnstatus(id as ID);\r\n\t\t}\r\n\t\tthis.turnstatuses = {};\r\n\t\tthis.side.battle.scene.updateStatbar(this);\r\n\t}\r\n\tremoveMovestatus(volatile: ID) {\r\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\r\n\t\tif (!this.hasMovestatus(volatile)) return;\r\n\t\tdelete this.movestatuses[volatile];\r\n\t}\r\n\taddMovestatus(volatile: ID) {\r\n\t\tvolatile = toID(volatile);\r\n\t\tif (this.hasMovestatus(volatile)) return;\r\n\t\tthis.movestatuses[volatile] = [volatile];\r\n\t\tthis.side.battle.scene.addEffect(this, volatile);\r\n\t}\r\n\thasMovestatus(volatile: ID) {\r\n\t\treturn !!this.movestatuses[volatile];\r\n\t}\r\n\tclearMovestatuses() {\r\n\t\tfor (let id in this.movestatuses) {\r\n\t\t\tthis.removeMovestatus(id as ID);\r\n\t\t}\r\n\t\tthis.movestatuses = {};\r\n\t}\r\n\tclearVolatiles() {\r\n\t\tthis.volatiles = {};\r\n\t\tthis.clearTurnstatuses();\r\n\t\tthis.clearMovestatuses();\r\n\t\tthis.side.battle.scene.clearEffects(this);\r\n\t}\r\n\trememberMove(moveName: string, pp = 1, recursionSource?: string) {\r\n\t\tif (recursionSource === this.ident) return;\r\n\t\tmoveName = Dex.moves.get(moveName).name;\r\n\t\tif (moveName.startsWith('*')) return;\r\n\t\tif (moveName === 'Struggle') return;\r\n\t\tif (this.volatiles.transform) {\r\n\t\t\t// make sure there is no infinite recursion if both Pokemon are transformed into each other\r\n\t\t\tif (!recursionSource) recursionSource = this.ident;\r\n\t\t\tthis.volatiles.transform[1].rememberMove(moveName, 0, recursionSource);\r\n\t\t\tmoveName = '*' + moveName;\r\n\t\t}\r\n\t\tfor (const entry of this.moveTrack) {\r\n\t\t\tif (moveName === entry[0]) {\r\n\t\t\t\tentry[1] += pp;\r\n\t\t\t\tif (entry[1] < 0) entry[1] = 0;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.moveTrack.push([moveName, pp]);\r\n\t}\r\n\trememberAbility(ability: string, isNotBase?: boolean, slot: 1 | 2 = 1) {\r\n\tability = Dex.abilities.get(ability).name;\r\n\r\n\tif (slot === 2) {\r\n\t\tthis.ability2 = ability;\r\n\t\tif (!this.baseAbility2 && !isNotBase) this.baseAbility2 = ability;\r\n\t\treturn;\r\n\t}\r\n\tthis.ability = ability;\r\n\tif (!this.baseAbility && !isNotBase) { this.baseAbility = ability; }\r\n}\r\n\tswapAbilities(other: Pokemon) {\r\n\t\t[this.ability, other.ability] = [other.ability, this.ability];\r\n\t\t[this.baseAbility, other.baseAbility] = [other.baseAbility, this.baseAbility];\r\n\t\t[this.ability2, other.ability2] = [other.ability2, this.ability2];\r\n\t\t[this.baseAbility2, other.baseAbility2] = [other.baseAbility2, this.baseAbility2];\r\n\t}\r\n\tgetBoost(boostStat: Dex.BoostStatName) {\r\n\t\tlet boostStatTable = {\r\n\t\t\tatk: 'Atk',\r\n\t\t\tdef: 'Def',\r\n\t\t\tspa: 'SpA',\r\n\t\t\tspd: 'SpD',\r\n\t\t\tspe: 'Spe',\r\n\t\t\taccuracy: 'Accuracy',\r\n\t\t\tevasion: 'Evasion',\r\n\t\t\tspc: 'Spc',\r\n\t\t};\r\n\t\tif (!this.boosts[boostStat]) {\r\n\t\t\treturn '1&times;&nbsp;' + boostStatTable[boostStat];\r\n\t\t}\r\n\t\tif (this.boosts[boostStat] > 6) this.boosts[boostStat] = 6;\r\n\t\tif (this.boosts[boostStat] < -6) this.boosts[boostStat] = -6;\r\n\t\tconst isRBY = this.side.battle.gen <= 1 && !this.side.battle.tier.includes('Stadium');\r\n\t\tif (!isRBY && (boostStat === 'accuracy' || boostStat === 'evasion')) {\r\n\t\t\tif (this.boosts[boostStat] > 0) {\r\n\t\t\t\tlet goodBoostTable = [\r\n\t\t\t\t\t'1&times;', '1.33&times;', '1.67&times;', '2&times;', '2.33&times;', '2.67&times;', '3&times;',\r\n\t\t\t\t];\r\n\t\t\t\t// let goodBoostTable = ['Normal', '+1', '+2', '+3', '+4', '+5', '+6'];\r\n\t\t\t\treturn '' + goodBoostTable[this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\r\n\t\t\t}\r\n\t\t\tlet badBoostTable = [\r\n\t\t\t\t'1&times;', '0.75&times;', '0.6&times;', '0.5&times;', '0.43&times;', '0.38&times;', '0.33&times;',\r\n\t\t\t];\r\n\t\t\t// let badBoostTable = ['Normal', '&minus;1', '&minus;2', '&minus;3', '&minus;4', '&minus;5', '&minus;6'];\r\n\t\t\treturn '' + badBoostTable[-this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\r\n\t\t}\r\n\t\tif (this.boosts[boostStat] > 0) {\r\n\t\t\tlet goodBoostTable = [\r\n\t\t\t\t'1&times;', '1.5&times;', '2&times;', '2.5&times;', '3&times;', '3.5&times;', '4&times;',\r\n\t\t\t];\r\n\t\t\t// let goodBoostTable = ['Normal', '+1', '+2', '+3', '+4', '+5', '+6'];\r\n\t\t\treturn '' + goodBoostTable[this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\r\n\t\t}\r\n\t\tlet badBoostTable = [\r\n\t\t\t'1&times;', '0.67&times;', '0.5&times;', '0.4&times;', '0.33&times;', '0.29&times;', '0.25&times;',\r\n\t\t];\r\n\t\t// let badBoostTable = ['Normal', '&minus;1', '&minus;2', '&minus;3', '&minus;4', '&minus;5', '&minus;6'];\r\n\t\treturn '' + badBoostTable[-this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\r\n\t}\r\n\tgetWeightKg(serverPokemon?: ServerPokemon) {\r\n\t\tlet autotomizeFactor = this.volatiles.autotomize?.[1] * 100 || 0;\r\n\t\treturn Math.max(this.getSpecies(serverPokemon).weightkg - autotomizeFactor, 0.1);\r\n\t}\r\n\tgetBoostType(boostStat: Dex.BoostStatName) {\r\n\t\tif (!this.boosts[boostStat]) return 'neutral';\r\n\t\tif (this.boosts[boostStat] > 0) return 'good';\r\n\t\treturn 'bad';\r\n\t}\r\n\tclearVolatile() {\r\n\t\tthis.ability = this.baseAbility;\r\n\t\tthis.boosts = {};\r\n\t\tthis.clearVolatiles();\r\n\t\tfor (let i = 0; i < this.moveTrack.length; i++) {\r\n\t\t\tif (this.moveTrack[i][0].startsWith('*')) {\r\n\t\t\t\tthis.moveTrack.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// this.lastMove = '';\r\n\t\tthis.statusStage = 0;\r\n\t\tthis.statusData.toxicTurns = 0;\r\n\t\tif (this.side.battle.gen === 5) this.statusData.sleepTurns = 0;\r\n\t}\r\n\t/**\r\n\t * copyAll = false means Baton Pass,\r\n\t * copyAll = true means Illusion breaking\r\n\t * copyAll = 'shedtail' means Shed Tail\r\n\t */\r\n\tcopyVolatileFrom(pokemon: Pokemon, copySource?: | 'shedtail' | boolean) {\r\n\t\tthis.boosts = pokemon.boosts;\r\n\t\tthis.volatiles = pokemon.volatiles;\r\n\t\t// this.lastMove = pokemon.lastMove; // I think\r\n\t\tif (!copySource) {\r\n\t\t\tconst volatilesToRemove = [\r\n\t\t\t\t'airballoon', 'attract', 'autotomize', 'disable', 'encore', 'foresight', 'gmaxchistrike', 'imprison', 'laserfocus', 'mimic', 'miracleeye', 'nightmare', 'saltcure', 'smackdown', 'stockpile1', 'stockpile2', 'stockpile3', 'syrupbomb', 'torment', 'typeadd', 'typechange', 'yawn',\r\n\t\t\t];\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tvolatilesToRemove.push('protosynthesis' + statName);\r\n\t\t\t\tvolatilesToRemove.push('quarkdrive' + statName);\r\n\t\t\t}\r\n\t\t\tfor (const volatile of volatilesToRemove) {\r\n\t\t\t\tdelete this.volatiles[volatile];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (copySource === 'shedtail') {\r\n\t\t\tfor (let i in this.volatiles) {\r\n\t\t\t\tif (i === 'substitute') continue;\r\n\t\t\t\tdelete this.volatiles[i];\r\n\t\t\t}\r\n\t\t\tthis.boosts = {};\r\n\t\t}\r\n\t\tdelete this.volatiles['transform'];\r\n\t\tdelete this.volatiles['formechange'];\r\n\r\n\t\tpokemon.boosts = {};\r\n\t\tpokemon.volatiles = {};\r\n\t\tpokemon.side.battle.scene.removeTransform(pokemon);\r\n\t\tpokemon.statusStage = 0;\r\n\t}\r\n\tcopyTypesFrom(pokemon: Pokemon, preterastallized = false) {\r\n\t\tconst [types, addedType] = pokemon.getTypes(undefined, preterastallized);\r\n\t\tthis.addVolatile('typechange' as ID, types.join('/'));\r\n\t\tif (addedType) {\r\n\t\t\tthis.addVolatile('typeadd' as ID, addedType);\r\n\t\t} else {\r\n\t\t\tthis.removeVolatile('typeadd' as ID);\r\n\t\t}\r\n\t}\r\n\tgetTypes(serverPokemon?: ServerPokemon, preterastallized = false): [readonly Dex.TypeName[], Dex.TypeName | ''] {\r\n\t\tlet types: readonly Dex.TypeName[];\r\n\t\tif (!preterastallized && this.terastallized && this.terastallized !== 'Stellar') {\r\n\t\t\ttypes = [this.terastallized as Dex.TypeName];\r\n\t\t} else if (this.volatiles.typechange) {\r\n\t\t\ttypes = this.volatiles.typechange[1].split('/');\r\n\t\t} else {\r\n\t\t\ttypes = this.getSpecies(serverPokemon).types;\r\n\t\t}\r\n\t\tif (this.hasTurnstatus('roost' as ID) && types.includes('Flying')) {\r\n\t\t\ttypes = types.filter(typeName => typeName !== 'Flying');\r\n\t\t\tif (!types.length) types = ['Normal'];\r\n\t\t}\r\n\t\tconst addedType = (this.volatiles.typeadd ? this.volatiles.typeadd[1] : '');\r\n\t\treturn [types, addedType];\r\n\t}\r\n\tisGrounded(serverPokemon?: ServerPokemon) {\r\n\t\tconst battle = this.side.battle;\r\n\t\tif (battle.hasPseudoWeather('Gravity')) {\r\n\t\t\treturn true;\r\n\t\t} else if (this.volatiles['ingrain'] && battle.gen >= 4) {\r\n\t\t\treturn true;\r\n\t\t} else if (this.volatiles['smackdown']) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tlet item = toID(serverPokemon ? serverPokemon.item : this.item);\r\n\t\tlet ability = toID(this.effectiveAbility(serverPokemon));\r\n\t\tif (battle.hasPseudoWeather('Magic Room') || this.volatiles['embargo'] || ability === 'klutz') {\r\n\t\t\titem = '' as ID;\r\n\t\t}\r\n\r\n\t\tif (item === 'ironball') {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (ability === 'levitate') {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.volatiles['magnetrise'] || this.volatiles['telekinesis']) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (item === 'airballoon') {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn !this.getTypeList(serverPokemon).includes('Flying');\r\n\t}\r\n\teffectiveAbility(serverPokemon?: ServerPokemon) {\r\n\t\tconst ability = this.side.battle.dex.abilities.get(serverPokemon?.ability || this.ability || serverPokemon?.baseAbility || '');\r\n\t\tif (\r\n\t\t\tthis.fainted ||\r\n\t\t\t(this.volatiles['transform'] && ability.flags['notransform']) ||\r\n\t\t\t(!ability.flags['cantsuppress'] && (this.side.battle.ngasActive() || this.volatiles['gastroacid']))\r\n\t\t) { return ''; }\r\n\t\treturn ability.name;\r\n\t}\r\n\teffectiveAbility2(serverPokemon?: any) {\r\n\t\tconst ability = this.side.battle.dex.abilities.get(serverPokemon?.ability2 || this.ability2 || serverPokemon?.baseAbility2 || '');\r\n\tif (\r\n\t\tthis.fainted ||\r\n\t\t(this.volatiles['transform'] && ability.flags['notransform']) ||\r\n\t\t(!ability.flags['cantsuppress'] && (this.side.battle.ngasActive() || this.volatiles['gastroacid']))\r\n\t) { return ''; }\r\n\treturn ability.name;\r\n}\r\n\tgetTypeList(serverPokemon?: ServerPokemon, preterastallized = false) {\r\n\t\tconst [types, addedType] = this.getTypes(serverPokemon, preterastallized);\r\n\t\treturn addedType ? types.concat(addedType) : types;\r\n\t}\r\n\tgetSpeciesForme(serverPokemon?: ServerPokemon): string {\r\n\t\treturn this.volatiles.formechange ? this.volatiles.formechange[1] :\r\n\t\t\t(serverPokemon ? serverPokemon.speciesForme : this.speciesForme);\r\n\t}\r\n\tgetSpecies(serverPokemon?: ServerPokemon) {\r\n\t\treturn this.side.battle.dex.species.get(this.getSpeciesForme(serverPokemon));\r\n\t}\r\n\tgetBaseSpecies() {\r\n\t\treturn this.side.battle.dex.species.get(this.speciesForme);\r\n\t}\r\n\treset() {\r\n\t\tthis.clearVolatile();\r\n\t\tthis.hp = this.maxhp;\r\n\t\tthis.fainted = false;\r\n\t\tthis.status = '';\r\n\t\tthis.moveTrack = [];\r\n\t\tthis.name = this.name || this.speciesForme;\r\n\t}\r\n\t// This function is used for two things:\r\n\t//   1) The percentage to display beside the HP bar.\r\n\t//   2) The width to draw an HP bar.\r\n\t//\r\n\t// This function is NOT used in the calculation of any other displayed\r\n\t// percentages or ranges, which have their own, more complex, formulae.\r\n\thpWidth(maxWidth: number) {\r\n\t\tif (this.fainted || !this.hp) return 0;\r\n\r\n\t\t// special case for low health...\r\n\t\tif (this.hp === 1 && this.maxhp > 45) return 1;\r\n\r\n\t\tif (this.maxhp === 48) {\r\n\t\t\t// Draw the health bar to the middle of the range.\r\n\t\t\t// This affects the width of the visual health bar *only*; it\r\n\t\t\t// does not affect the ranges displayed in any way.\r\n\t\t\tlet range = Pokemon.getPixelRange(this.hp, this.hpcolor);\r\n\t\t\tlet ratio = (range[0] + range[1]) / 2;\r\n\t\t\treturn Math.round(maxWidth * ratio) || 1;\r\n\t\t}\r\n\t\tlet percentage = Math.ceil(100 * this.hp / this.maxhp);\r\n\t\tif ((percentage === 100) && (this.hp < this.maxhp)) {\r\n\t\t\tpercentage = 99;\r\n\t\t}\r\n\t\treturn percentage * maxWidth / 100;\r\n\t}\r\n\tgetHPText(precision = 1) {\r\n\t\treturn Pokemon.getHPText(this, this.side.battle.reportExactHP, precision);\r\n\t}\r\n\tstatic getHPText(pokemon: PokemonHealth, exactHP: boolean, precision = 1) {\r\n\t\tif (exactHP) return `${pokemon.hp}/${pokemon.maxhp}`;\r\n\t\tif (pokemon.maxhp === 100) return `${pokemon.hp}%`;\r\n\t\tif (pokemon.maxhp !== 48) return (100 * pokemon.hp / pokemon.maxhp).toFixed(precision) + '%';\r\n\t\tlet range = Pokemon.getPixelRange(pokemon.hp, pokemon.hpcolor);\r\n\t\treturn Pokemon.getFormattedRange(range, precision, '\\u2013');\r\n\t}\r\n\tdestroy() {\r\n\t\tif (this.sprite) this.sprite.destroy();\r\n\t\tthis.sprite = null!;\r\n\t\tthis.side = null!;\r\n\t}\r\n}\r\n\r\nexport class Side {\r\n\tbattle: Battle;\r\n\tname = '';\r\n\tid = '';\r\n\tsideid: SideID;\r\n\tn: number;\r\n\tisFar: boolean;\r\n\tfoe: Side = null!;\r\n\tally: Side | null = null;\r\n\tavatar = 'unknown';\r\n\tbadges: string[] = [];\r\n\trating = '';\r\n\ttotalPokemon = 6;\r\n\tx = 0;\r\n\ty = 0;\r\n\tz = 0;\r\n\tmissedPokemon: Pokemon = null!;\r\n\r\n\twisher: Pokemon | null = null;\r\n\r\n\tactive = [null] as (Pokemon | null)[];\r\n\tlastPokemon = null as Pokemon | null;\r\n\tpokemon = [] as Pokemon[];\r\n\r\n\tsideConditions: {\r\n\t\t[id: string]: [effectName: string, levels: number, minDuration: number, maxDuration: number],\r\n\t} = {};\r\n\tfaintCounter = 0;\r\n\r\n\tconstructor(battle: Battle, n: number) {\r\n\t\tthis.battle = battle;\r\n\t\tthis.n = n;\r\n\t\tthis.sideid = ['p1', 'p2', 'p3', 'p4'][n] as SideID;\r\n\t\tthis.isFar = !!(n % 2);\r\n\t}\r\n\r\n\trollTrainerSprites() {\r\n\t\tlet sprites = ['lucas', 'dawn', 'ethan', 'lyra', 'hilbert', 'hilda'];\r\n\t\tthis.avatar = sprites[Math.floor(Math.random() * sprites.length)];\r\n\t}\r\n\r\n\tbehindx(offset: number) {\r\n\t\treturn this.x + (!this.isFar ? -1 : 1) * offset;\r\n\t}\r\n\tbehindy(offset: number) {\r\n\t\treturn this.y + (!this.isFar ? 1 : -1) * offset;\r\n\t}\r\n\tleftof(offset: number) {\r\n\t\treturn (!this.isFar ? -1 : 1) * offset;\r\n\t}\r\n\tbehind(offset: number) {\r\n\t\treturn this.z + (!this.isFar ? -1 : 1) * offset;\r\n\t}\r\n\r\n\tclearPokemon() {\r\n\t\tfor (const pokemon of this.pokemon) pokemon.destroy();\r\n\t\tthis.pokemon = [];\r\n\t\tfor (let i = 0; i < this.active.length; i++) this.active[i] = null;\r\n\t\tthis.lastPokemon = null;\r\n\t}\r\n\treset() {\r\n\t\tthis.clearPokemon();\r\n\t\tthis.sideConditions = {};\r\n\t\tthis.faintCounter = 0;\r\n\t}\r\n\tsetAvatar(avatar: string) {\r\n\t\tthis.avatar = avatar;\r\n\t}\r\n\tsetName(name: string, avatar?: string) {\r\n\t\tif (name) this.name = name;\r\n\t\tthis.id = toID(this.name);\r\n\t\tif (avatar) {\r\n\t\t\tthis.setAvatar(avatar);\r\n\t\t} else {\r\n\t\t\tthis.rollTrainerSprites();\r\n\t\t\tif (this.foe && this.avatar === this.foe.avatar) this.rollTrainerSprites();\r\n\t\t}\r\n\t}\r\n\taddSideCondition(effect: Dex.Effect, persist: boolean) {\r\n\t\tlet condition = effect.id;\r\n\t\tif (this.sideConditions[condition]) {\r\n\t\t\tif (condition === 'spikes' || condition === 'toxicspikes') {\r\n\t\t\t\tthis.sideConditions[condition][1]++;\r\n\t\t\t}\r\n\t\t\tthis.battle.scene.addSideCondition(this.n, condition);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Side conditions work as: [effectName, levels, minDuration, maxDuration]\r\n\t\tswitch (condition) {\r\n\t\tcase 'auroraveil':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 8];\r\n\t\t\tbreak;\r\n\t\tcase 'reflect':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, this.battle.gen >= 4 ? 8 : 0];\r\n\t\t\tbreak;\r\n\t\tcase 'safeguard':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, persist ? 7 : 5, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'lightscreen':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, this.battle.gen >= 4 ? 8 : 0];\r\n\t\t\tbreak;\r\n\t\tcase 'mist':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'tailwind':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, this.battle.gen >= 5 ? persist ? 6 : 4 : persist ? 5 : 3, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'luckychant':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'stealthrock':\r\n\t\tcase 'spikes':\r\n\t\tcase 'toxicspikes':\r\n\t\tcase 'stickyweb':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 0, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'gmaxwildfire':\r\n\t\tcase 'gmaxvolcalith':\r\n\t\tcase 'gmaxvinelash':\r\n\t\tcase 'gmaxcannonade':\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 4, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'grasspledge':\r\n\t\t\tthis.sideConditions[condition] = ['Swamp', 1, 4, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'waterpledge':\r\n\t\t\tthis.sideConditions[condition] = ['Rainbow', 1, 4, 0];\r\n\t\t\tbreak;\r\n\t\tcase 'firepledge':\r\n\t\t\tthis.sideConditions[condition] = ['Sea of Fire', 1, 4, 0];\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 0, 0];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.battle.scene.addSideCondition(this.n, condition);\r\n\t}\r\n\tremoveSideCondition(condition: string) {\r\n\t\tconst id = toID(condition);\r\n\t\tif (!this.sideConditions[id]) return;\r\n\t\tdelete this.sideConditions[id];\r\n\t\tthis.battle.scene.removeSideCondition(this.n, id);\r\n\t}\r\n\taddPokemon(name: string, ident: string, details: string, replaceSlot = -1) {\r\n\t\tconst oldPokemon = replaceSlot >= 0 ? this.pokemon[replaceSlot] : undefined;\r\n\r\n\t\tconst data = this.battle.parseDetails(name, ident, details);\r\n\t\tconst poke = new Pokemon(data, this);\r\n\t\tif (oldPokemon) {\r\n\t\t\tpoke.item = oldPokemon.item;\r\n\t\t\tpoke.baseAbility = oldPokemon.baseAbility;\r\n\t\t\tpoke.baseAbility2 = oldPokemon.baseAbility2;\r\n\t\t\tpoke.ability2 = oldPokemon.ability2;\r\n\t\t\tpoke.teraType = oldPokemon.teraType;\r\n\t\t}\r\n\r\n\t\tif (!poke.ability && poke.baseAbility) poke.ability = poke.baseAbility;\r\n\t\tif (!poke.ability2 && poke.baseAbility2) poke.ability2 = poke.baseAbility2;\r\n\t\tpoke.reset();\r\n\t\tif (oldPokemon?.moveTrack.length) poke.moveTrack = oldPokemon.moveTrack;\r\n\r\n\t\tif (replaceSlot >= 0) {\r\n\t\t\tthis.pokemon[replaceSlot] = poke;\r\n\t\t} else {\r\n\t\t\tthis.pokemon.push(poke);\r\n\t\t}\r\n\t\tif (this.pokemon.length > this.totalPokemon || this.battle.speciesClause) {\r\n\t\t\t// check for Illusion\r\n\t\t\tlet existingTable: { [searchid: string]: number } = {};\r\n\t\t\tlet toRemove = -1;\r\n\t\t\tfor (let poke1i = 0; poke1i < this.pokemon.length; poke1i++) {\r\n\t\t\t\tlet poke1 = this.pokemon[poke1i];\r\n\t\t\t\tif (!poke1.searchid) continue;\r\n\t\t\t\tif (poke1.searchid in existingTable) {\r\n\t\t\t\t\tlet poke2i = existingTable[poke1.searchid];\r\n\t\t\t\t\tlet poke2 = this.pokemon[poke2i];\r\n\t\t\t\t\tif (poke === poke1) {\r\n\t\t\t\t\t\ttoRemove = poke2i;\r\n\t\t\t\t\t} else if (poke === poke2) {\r\n\t\t\t\t\t\ttoRemove = poke1i;\r\n\t\t\t\t\t} else if (this.active.includes(poke1)) {\r\n\t\t\t\t\t\ttoRemove = poke2i;\r\n\t\t\t\t\t} else if (this.active.includes(poke2)) {\r\n\t\t\t\t\t\ttoRemove = poke1i;\r\n\t\t\t\t\t} else if (poke1.fainted && !poke2.fainted) {\r\n\t\t\t\t\t\ttoRemove = poke2i;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttoRemove = poke1i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\texistingTable[poke1.searchid] = poke1i;\r\n\t\t\t}\r\n\t\t\tif (toRemove >= 0) {\r\n\t\t\t\tif (this.pokemon[toRemove].fainted) {\r\n\t\t\t\t\t// A fainted Pokemon was actually a Zoroark\r\n\t\t\t\t\tlet illusionFound = null;\r\n\t\t\t\t\tfor (const curPoke of this.pokemon) {\r\n\t\t\t\t\t\tif (curPoke === poke) continue;\r\n\t\t\t\t\t\tif (curPoke.fainted) continue;\r\n\t\t\t\t\t\tif (this.active.includes(curPoke)) continue;\r\n\t\t\t\t\t\tif (curPoke.speciesForme === 'Zoroark' || curPoke.speciesForme === 'Zorua' || curPoke.ability === 'Illusion') {\r\n\t\t\t\t\t\t\tillusionFound = curPoke;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!illusionFound) {\r\n\t\t\t\t\t\t// This is Hackmons; we'll just guess a random unfainted Pokemon.\r\n\t\t\t\t\t\t// This will keep the fainted Pokemon count correct, and will\r\n\t\t\t\t\t\t// eventually become correct as incorrect guesses are switched in\r\n\t\t\t\t\t\t// and reguessed.\r\n\t\t\t\t\t\tfor (const curPoke of this.pokemon) {\r\n\t\t\t\t\t\t\tif (curPoke === poke) continue;\r\n\t\t\t\t\t\t\tif (curPoke.fainted) continue;\r\n\t\t\t\t\t\t\tif (this.active.includes(curPoke)) continue;\r\n\t\t\t\t\t\t\tillusionFound = curPoke;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (illusionFound) {\r\n\t\t\t\t\t\tillusionFound.fainted = true;\r\n\t\t\t\t\t\tillusionFound.hp = 0;\r\n\t\t\t\t\t\tillusionFound.status = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.pokemon.splice(toRemove, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.battle.scene.updateSidebar(this);\r\n\r\n\t\treturn poke;\r\n\t}\r\n\r\n\tswitchIn(pokemon: Pokemon, kwArgs: KWArgs, slot = pokemon.slot) {\r\n\t\tthis.active[slot] = pokemon;\r\n\t\tpokemon.slot = slot;\r\n\t\tpokemon.clearVolatile();\r\n\t\tpokemon.lastMove = '';\r\n\t\tthis.battle.lastMove = 'switch-in';\r\n\t\tconst effect = Dex.getEffect(kwArgs.from);\r\n\t\tif (['batonpass', 'zbatonpass', 'shedtail'].includes(effect.id)) {\r\n\t\t\tpokemon.copyVolatileFrom(this.lastPokemon!, effect.id === 'shedtail' ? 'shedtail' : false);\r\n\t\t} else if (this.battle.tier.includes(`Relay Race`) && !effect.id) {\r\n\t\t\tif (this.lastPokemon && !this.lastPokemon.fainted) pokemon.copyVolatileFrom(this.lastPokemon, false);\r\n\t\t}\r\n\r\n\t\tthis.battle.scene.animSummon(pokemon, slot);\r\n\t}\r\n\tdragIn(pokemon: Pokemon, slot = pokemon.slot) {\r\n\t\tlet oldpokemon = this.active[slot];\r\n\t\tif (oldpokemon === pokemon) return;\r\n\t\tthis.lastPokemon = oldpokemon;\r\n\t\tif (oldpokemon) {\r\n\t\t\tthis.battle.scene.animDragOut(oldpokemon);\r\n\t\t\toldpokemon.clearVolatile();\r\n\t\t}\r\n\t\tpokemon.clearVolatile();\r\n\t\tpokemon.lastMove = '';\r\n\t\tthis.battle.lastMove = 'switch-in';\r\n\t\tthis.active[slot] = pokemon;\r\n\t\tpokemon.slot = slot;\r\n\r\n\t\tthis.battle.scene.animDragIn(pokemon, slot);\r\n\t}\r\n\treplace(pokemon: Pokemon, slot = pokemon.slot) {\r\n\t\tlet oldpokemon = this.active[slot];\r\n\t\tif (pokemon === oldpokemon) return;\r\n\t\tthis.lastPokemon = oldpokemon;\r\n\t\tpokemon.clearVolatile();\r\n\t\tif (oldpokemon) {\r\n\t\t\tpokemon.lastMove = oldpokemon.lastMove;\r\n\t\t\tpokemon.hp = oldpokemon.hp;\r\n\t\t\tpokemon.maxhp = oldpokemon.maxhp;\r\n\t\t\tpokemon.hpcolor = oldpokemon.hpcolor;\r\n\t\t\tpokemon.status = oldpokemon.status;\r\n\t\t\tpokemon.copyVolatileFrom(oldpokemon, true);\r\n\t\t\tpokemon.statusData = { ...oldpokemon.statusData };\r\n\t\t\tif (oldpokemon.terastallized) {\r\n\t\t\t\tpokemon.terastallized = oldpokemon.terastallized;\r\n\t\t\t\tpokemon.teraType = oldpokemon.terastallized;\r\n\t\t\t\toldpokemon.terastallized = '';\r\n\t\t\t\toldpokemon.teraType = '';\r\n\t\t\t}\r\n\t\t\t// we don't know anything about the illusioned pokemon except that it's not fainted\r\n\t\t\t// technically we also know its status but only at the end of the turn, not here\r\n\t\t\toldpokemon.fainted = false;\r\n\t\t\toldpokemon.hp = oldpokemon.maxhp;\r\n\t\t\toldpokemon.status = '???';\r\n\t\t}\r\n\t\tthis.active[slot] = pokemon;\r\n\t\tpokemon.slot = slot;\r\n\r\n\t\tif (oldpokemon) {\r\n\t\t\tthis.battle.scene.animUnsummon(oldpokemon, true);\r\n\t\t}\r\n\t\tthis.battle.scene.animSummon(pokemon, slot, true);\r\n\t}\r\n\tswitchOut(pokemon: Pokemon, kwArgs: KWArgs, slot = pokemon.slot) {\r\n\t\tconst effect = Dex.getEffect(kwArgs.from);\r\n\t\tif (!['batonpass', 'zbatonpass', 'shedtail'].includes(effect.id) &&\r\n\t\t\t!(this.battle.tier.includes(`Relay Race`) && !effect.id)) {\r\n\t\t\tpokemon.clearVolatile();\r\n\t\t} else {\r\n\t\t\tpokemon.removeVolatile('transform' as ID);\r\n\t\t\tpokemon.removeVolatile('formechange' as ID);\r\n\t\t}\r\n\t\tif (!['batonpass', 'zbatonpass', 'shedtail', 'teleport'].includes(effect.id) &&\r\n\t\t\t!(this.battle.tier.includes(`Relay Race`) && !effect.id)) {\r\n\t\t\tthis.battle.log(['switchout', pokemon.ident], { from: effect.id });\r\n\t\t}\r\n\t\tpokemon.statusData.toxicTurns = 0;\r\n\t\tif (this.battle.gen === 5) pokemon.statusData.sleepTurns = 0;\r\n\t\tthis.lastPokemon = pokemon;\r\n\t\tthis.active[slot] = null;\r\n\r\n\t\tthis.battle.scene.animUnsummon(pokemon);\r\n\t}\r\n\tswapTo(pokemon: Pokemon, slot: number) {\r\n\t\tif (pokemon.slot === slot) return;\r\n\t\tlet target = this.active[slot];\r\n\r\n\t\tlet oslot = pokemon.slot;\r\n\r\n\t\tpokemon.slot = slot;\r\n\t\tif (target) target.slot = oslot;\r\n\r\n\t\tthis.active[slot] = pokemon;\r\n\t\tthis.active[oslot] = target;\r\n\r\n\t\tthis.battle.scene.animUnsummon(pokemon, true);\r\n\t\tif (target) this.battle.scene.animUnsummon(target, true);\r\n\r\n\t\tthis.battle.scene.animSummon(pokemon, slot, true);\r\n\t\tif (target) this.battle.scene.animSummon(target, oslot, true);\r\n\t}\r\n\tswapWith(pokemon: Pokemon, target: Pokemon, kwArgs: KWArgs) {\r\n\t\t// method provided for backwards compatibility only\r\n\t\tif (pokemon === target) return;\r\n\r\n\t\tlet oslot = pokemon.slot;\r\n\t\tlet nslot = target.slot;\r\n\r\n\t\tpokemon.slot = nslot;\r\n\t\ttarget.slot = oslot;\r\n\t\tthis.active[nslot] = pokemon;\r\n\t\tthis.active[oslot] = target;\r\n\r\n\t\tthis.battle.scene.animUnsummon(pokemon, true);\r\n\t\tthis.battle.scene.animUnsummon(target, true);\r\n\r\n\t\tthis.battle.scene.animSummon(pokemon, nslot, true);\r\n\t\tthis.battle.scene.animSummon(target, oslot, true);\r\n\t}\r\n\tfaint(pokemon: Pokemon, slot = pokemon.slot) {\r\n\t\tpokemon.clearVolatile();\r\n\t\tthis.lastPokemon = pokemon;\r\n\t\tthis.active[slot] = null;\r\n\r\n\t\tpokemon.fainted = true;\r\n\t\tpokemon.hp = 0;\r\n\t\tpokemon.terastallized = '';\r\n\t\tpokemon.details = pokemon.details.replace(/, tera:[a-z]+/i, '');\r\n\t\tpokemon.searchid = pokemon.searchid.replace(/, tera:[a-z]+/i, '');\r\n\t\tif (pokemon.side.faintCounter < 100) pokemon.side.faintCounter++;\r\n\r\n\t\tthis.battle.scene.animFaint(pokemon);\r\n\t}\r\n\tdestroy() {\r\n\t\tthis.clearPokemon();\r\n\t\tthis.battle = null!;\r\n\t\tthis.foe = null!;\r\n\t}\r\n}\r\n\r\nexport interface PokemonDetails {\r\n\tdetails: string;\r\n\tname: string;\r\n\tspeciesForme: string;\r\n\tlevel: number;\r\n\tshiny: boolean;\r\n\tgender: Dex.GenderName | '';\r\n\tident: string;\r\n\tterastallized: string;\r\n\tsearchid: string;\r\n}\r\nexport interface PokemonHealth {\r\n\thp: number;\r\n\tmaxhp: number;\r\n\thpcolor: HPColor | '';\r\n\tstatus: Dex.StatusName | 'tox' | '' | '???';\r\n\tfainted?: boolean;\r\n}\r\nexport interface ServerPokemon extends PokemonDetails, PokemonHealth {\r\n\tident: string;\r\n\tdetails: string;\r\n\tcondition: string;\r\n\tactive: boolean;\r\n\treviving: boolean;\r\n\t/** unboosted stats */\r\n\tstats: {\r\n\t\tatk: number,\r\n\t\tdef: number,\r\n\t\tspa: number,\r\n\t\tspd: number,\r\n\t\tspe: number,\r\n\t};\r\n\t/** currently an ID, will revise to name */\r\n\tmoves: string[];\r\n\t/** currently an ID, will revise to name */\r\n\tbaseAbility: string;\r\n\t/** currently an ID, will revise to name */\r\n\tability?: string;\r\n\t/** currently an ID, will revise to name */\r\n\t/** currently an ID, will revise to name */\r\n\tbaseAbility2?: string;\r\n\t/** currently an ID, will revise to name */\r\n\tability2?: string;\r\n\titem: string;\r\n\t/** currently an ID, will revise to name */\r\n\tpokeball: string;\r\n\t/** always the Tera Type of the Pokemon, regardless of whether it is terastallized or not */\r\n\tteraType: string;\r\n\t/** falsy if the pokemon is not terastallized, otherwise it is the Tera Type of the Pokemon */\r\n\tterastallized: string;\r\n}\r\n\r\nexport class Battle {\r\n\tscene: BattleSceneStub;\r\n\r\n\tviewpointSwitched = false;\r\n\r\n\tstepQueue: string[];\r\n\t/** See battle.instantAdd */\r\n\tpreemptStepQueue: string[] = [];\r\n\twaitForAnimations: true | false | 'simult' = true;\r\n\t/** the index of `stepQueue` currently being animated */\r\n\tcurrentStep = 0;\r\n\t/** null = not seeking, 0 = seek start, Infinity = seek end, otherwise: seek turn number */\r\n\tseeking: number | null = null;\r\n\r\n\tactiveMoveIsSpread: string | null = null;\r\n\r\n\tsubscription: ((state:\r\n\t\t'playing' | 'paused' | 'turn' | 'atqueueend' | 'callback' | 'ended' | 'error'\r\n\t) => void) | null;\r\n\r\n\tmute = false;\r\n\tmessageFadeTime = 300;\r\n\tmessageShownTime = 1;\r\n\t/** for tracking when to accelerate animations in long battles full of double switches */\r\n\tturnsSinceMoved = 0;\r\n\r\n\t/**\r\n\t * * `-1` = non-battle RoomGames, or hasn't hit Team Preview or `|start`\r\n\t * * `0` = after Team Preview or `|start` but before `|turn|1`\r\n\t */\r\n\tturn = -1;\r\n\t/**\r\n\t * Are we at the end of the queue and waiting for more input?\r\n\t *\r\n\t * In addition to at the end of a battle, this is also true if you're\r\n\t * playing/watching a battle live, and waiting for a player to make a move.\r\n\t */\r\n\tatQueueEnd = false;\r\n\t/**\r\n\t * Has the battle ever been played or fast-forwarded?\r\n\t *\r\n\t * This is not exactly `turn > 0` because if you start playing a replay,\r\n\t * then pause before turn 1, `turn` will still be 0, but playback should\r\n\t * be considered started (for the purposes of displaying \"Play\" vs \"Resume\")\r\n\t */\r\n\tstarted = false;\r\n\t/**\r\n\t * Has playback gotten to the point where a player has won or tied?\r\n\t * (Affects whether BGM is playing)\r\n\t */\r\n\tended = false;\r\n\tisReplay = false;\r\n\tusesUpkeep = false;\r\n\tweather = '' as ID;\r\n\tpseudoWeather = [] as WeatherState[];\r\n\tweatherTimeLeft = 0;\r\n\tweatherMinTimeLeft = 0;\r\n\t/**\r\n\t * The side from which perspective we're viewing. Should be identical to\r\n\t * `nearSide` except in multi battles, where `nearSide` is always the first\r\n\t * near side, and `mySide` is the active player.\r\n\t */\r\n\tmySide: Side = null!;\r\n\tnearSide: Side = null!;\r\n\tfarSide: Side = null!;\r\n\tp1: Side = null!;\r\n\tp2: Side = null!;\r\n\tp3?: Side = null!;\r\n\tp4?: Side = null!;\r\n\tpokemonControlled = 0;\r\n\tsides: Side[] = null!;\r\n\tmyPokemon: ServerPokemon[] | null = null;\r\n\tmyAllyPokemon: ServerPokemon[] | null = null;\r\n\tlastMove = '';\r\n\r\n\tgen = 8;\r\n\tdex: ModdedDex = Dex;\r\n\tteamPreviewCount = 0;\r\n\tspeciesClause = false;\r\n\ttier = '';\r\n\tgameType: 'singles' | 'doubles' | 'triples' | 'multi' | 'freeforall' | 'rotation' = 'singles';\r\n\tcompatMode = true;\r\n\trated: string | boolean = false;\r\n\trules: { [ruleName: string]: 1 | undefined } = {};\r\n\tisBlitz = false;\r\n\treportExactHP = false;\r\n\tendLastTurnPending = false;\r\n\ttotalTimeLeft = 0;\r\n\tgraceTimeLeft = 0;\r\n\t/**\r\n\t * true: timer on, state unknown\r\n\t * false: timer off\r\n\t * number: seconds left this turn\r\n\t */\r\n\tkickingInactive: number | boolean = false;\r\n\r\n\t// options\r\n\tid = '';\r\n\t/** used to forward some information to the room in the old client */\r\n\troomid = '';\r\n\thardcoreMode = false;\r\n\tignoreNicks = !!Dex.prefs('ignorenicks');\r\n\tignoreOpponent = !!Dex.prefs('ignoreopp');\r\n\tignoreSpects = !!Dex.prefs('ignorespects');\r\n\tdebug: boolean;\r\n\tjoinButtons = false;\r\n\tautoresize: boolean;\r\n\r\n\t/**\r\n\t * The actual pause state. Will only be true if playback is actually\r\n\t * paused, not just waiting for the opponent to make a move.\r\n\t */\r\n\tpaused: boolean;\r\n\r\n\tconstructor(options: {\r\n\t\t$frame?: JQuery,\r\n\t\t$logFrame?: JQuery,\r\n\t\tid?: ID,\r\n\t\tlog?: string[] | string | null,\r\n\t\tpaused?: boolean,\r\n\t\tisReplay?: boolean,\r\n\t\tdebug?: boolean,\r\n\t\tsubscription?: Battle['subscription'],\r\n\t\t/** autoresize `$frame` for browsers below 640px width (mobile) */\r\n\t\tautoresize?: boolean,\r\n\t} = {}) {\r\n\t\tthis.id = options.id || '';\r\n\r\n\t\tif (options.$frame && options.$logFrame) {\r\n\t\t\tthis.scene = new BattleScene(this, options.$frame, options.$logFrame);\r\n\t\t} else if (!options.$frame && !options.$logFrame) {\r\n\t\t\tthis.scene = new BattleSceneStub();\r\n\t\t} else {\r\n\t\t\tthrow new Error(`You must specify $frame and $logFrame simultaneously`);\r\n\t\t}\r\n\r\n\t\tthis.paused = !!options.paused;\r\n\t\tthis.started = !this.paused;\r\n\t\tthis.debug = !!options.debug;\r\n\t\tif (typeof options.log === 'string') options.log = options.log.split('\\n');\r\n\t\tthis.stepQueue = options.log || [];\r\n\t\tthis.subscription = options.subscription || null;\r\n\t\tthis.autoresize = !!options.autoresize;\r\n\r\n\t\tthis.p1 = new Side(this, 0);\r\n\t\tthis.p2 = new Side(this, 1);\r\n\t\tthis.sides = [this.p1, this.p2];\r\n\t\tthis.p2.foe = this.p1;\r\n\t\tthis.p1.foe = this.p2;\r\n\t\tthis.nearSide = this.mySide = this.p1;\r\n\t\tthis.farSide = this.p2;\r\n\r\n\t\tthis.resetStep();\r\n\t\tif (this.autoresize) {\r\n\t\t\twindow.addEventListener('resize', this.onResize);\r\n\t\t\tthis.onResize();\r\n\t\t}\r\n\t}\r\n\r\n\tonResize = () => {\r\n\t\tconst width = $(window).width()!;\r\n\t\tif (width < 950 || this.hardcoreMode) {\r\n\t\t\tthis.messageShownTime = 500;\r\n\t\t} else {\r\n\t\t\tthis.messageShownTime = 1;\r\n\t\t}\r\n\t\tif (width && width < 640) {\r\n\t\t\tconst scale = (width / 640);\r\n\t\t\tthis.scene.$frame?.css('transform', `scale(${scale})`);\r\n\t\t\tthis.scene.$frame?.css('transform-origin', 'top left');\r\n\t\t\tthis.scene.$frame?.css('margin-bottom', `${360 * scale - 360}px`);\r\n\t\t\t// this.$foeHint.css('transform', 'scale(' + scale + ')');\r\n\t\t} else {\r\n\t\t\tthis.scene.$frame?.css('transform', 'none');\r\n\t\t\t// this.$foeHint.css('transform', 'none');\r\n\t\t\tthis.scene.$frame?.css('margin-bottom', '0');\r\n\t\t}\r\n\t};\r\n\r\n\tsubscribe(listener: Battle['subscription']) {\r\n\t\tthis.subscription = listener;\r\n\t}\r\n\r\n\tremovePseudoWeather(weather: string) {\r\n\t\tfor (let i = 0; i < this.pseudoWeather.length; i++) {\r\n\t\t\tif (this.pseudoWeather[i][0] === weather) {\r\n\t\t\t\tthis.pseudoWeather.splice(i, 1);\r\n\t\t\t\tthis.scene.updateWeather();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\taddPseudoWeather(weather: string, minTimeLeft: number, timeLeft: number) {\r\n\t\tthis.pseudoWeather.push([weather, minTimeLeft, timeLeft]);\r\n\t\tthis.scene.updateWeather();\r\n\t}\r\n\thasPseudoWeather(weather: string) {\r\n\t\tfor (const [pseudoWeatherName] of this.pseudoWeather) {\r\n\t\t\tif (weather === pseudoWeatherName) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgetAllActive() {\r\n\t\tconst pokemonList = [];\r\n\t\t// Sides 3 and 4 are synced with sides 1 and 2, so they don't need to be checked\r\n\t\tfor (let i = 0; i < 2; i++) {\r\n\t\t\tconst side = this.sides[i];\r\n\t\t\tfor (const active of side.active) {\r\n\t\t\t\tif (active && !active.fainted) {\r\n\t\t\t\t\tpokemonList.push(active);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pokemonList;\r\n\t}\r\n\t// Used in Pokemon#effectiveAbility over abilityActive to prevent infinite recursion\r\n\tngasActive() {\r\n\t\tfor (const active of this.getAllActive()) {\r\n\t\t\tif ((active.ability === 'Neutralizing Gas' || active.ability2 === 'Neutralizing Gas') && !active.volatiles['gastroacid']) { return true; }\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tabilityActive(abilities: string | string[]) {\r\n\t\tif (typeof abilities === 'string') abilities = [abilities];\r\n\t\tconst ids = abilities.map(toID);\r\n\t\tfor (const active of this.getAllActive()) {\r\n\t\t\tconst a1 = toID(active.effectiveAbility());\r\n\t\t\tconst a2 = toID((active as any).effectiveAbility2?.() || '');\r\n\t\t\tif (ids.includes(a1) || (a2 && ids.includes(a2))) { return true; }\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\treset() {\r\n\t\tthis.paused = true;\r\n\t\tthis.scene.pause();\r\n\t\tthis.resetStep();\r\n\t\tthis.subscription?.('paused');\r\n\t}\r\n\tresetStep() {\r\n\t\t// battle state\r\n\t\tthis.turn = -1;\r\n\t\tthis.started = !this.paused;\r\n\t\tthis.ended = false;\r\n\t\tthis.atQueueEnd = false;\r\n\t\tthis.weather = '' as ID;\r\n\t\tthis.weatherTimeLeft = 0;\r\n\t\tthis.weatherMinTimeLeft = 0;\r\n\t\tthis.pseudoWeather = [];\r\n\t\tthis.lastMove = '';\r\n\r\n\t\tfor (const side of this.sides) {\r\n\t\t\tif (side) side.reset();\r\n\t\t}\r\n\t\tthis.myPokemon = null;\r\n\t\tthis.myAllyPokemon = null;\r\n\r\n\t\t// DOM state\r\n\t\tthis.scene.reset();\r\n\r\n\t\t// activity queue state\r\n\t\tthis.activeMoveIsSpread = null;\r\n\t\tthis.currentStep = 0;\r\n\t\tthis.resetTurnsSinceMoved();\r\n\t\tthis.nextStep();\r\n\t}\r\n\tdestroy() {\r\n\t\tif (this.autoresize) {\r\n\t\t\twindow.removeEventListener('resize', this.onResize);\r\n\t\t}\r\n\t\tthis.scene.destroy();\r\n\r\n\t\tfor (let i = 0; i < this.sides.length; i++) {\r\n\t\t\tif (this.sides[i]) this.sides[i].destroy();\r\n\t\t\tthis.sides[i] = null!;\r\n\t\t}\r\n\t\tthis.mySide = null!;\r\n\t\tthis.nearSide = null!;\r\n\t\tthis.farSide = null!;\r\n\t\tthis.p1 = null!;\r\n\t\tthis.p2 = null!;\r\n\t\tthis.p3 = null!;\r\n\t\tthis.p4 = null!;\r\n\t}\r\n\r\n\tlog(args: Args, kwArgs?: KWArgs, preempt?: boolean) {\r\n\t\tthis.scene.log.add(args, kwArgs, preempt);\r\n\t}\r\n\r\n\tresetToCurrentTurn() {\r\n\t\tthis.seekTurn(this.ended ? Infinity : this.turn, true);\r\n\t}\r\n\tswitchViewpoint() {\r\n\t\tthis.setViewpoint(this.viewpointSwitched ? 'p1' : 'p2');\r\n\t}\r\n\tsetViewpoint(sideid: SideID) {\r\n\t\tif (this.mySide.sideid === sideid) return;\r\n\t\tif (sideid.length !== 2 || !sideid.startsWith('p')) return;\r\n\t\tconst side = this[sideid];\r\n\t\tif (!side) return;\r\n\t\tthis.mySide = side;\r\n\r\n\t\tif ((side.n % 2) === this.p1.n) {\r\n\t\t\tthis.viewpointSwitched = false;\r\n\t\t\tthis.nearSide = this.p1;\r\n\t\t\tthis.farSide = this.p2;\r\n\t\t} else {\r\n\t\t\tthis.viewpointSwitched = true;\r\n\t\t\tthis.nearSide = this.p2;\r\n\t\t\tthis.farSide = this.p1;\r\n\t\t}\r\n\t\tthis.nearSide.isFar = false;\r\n\t\tthis.farSide.isFar = true;\r\n\t\tif (this.sides.length > 2) {\r\n\t\t\tthis.sides[this.nearSide.n + 2].isFar = false;\r\n\t\t\tthis.sides[this.farSide.n + 2].isFar = true;\r\n\t\t}\r\n\r\n\t\tthis.resetToCurrentTurn();\r\n\t}\r\n\r\n\t//\r\n\t// activities\r\n\t//\r\n\tstart() {\r\n\t\tthis.log(['start']);\r\n\t\tthis.resetTurnsSinceMoved();\r\n\t}\r\n\twinner(winner?: string) {\r\n\t\tthis.log(['win', winner || '']);\r\n\t\tthis.ended = true;\r\n\t\tthis.subscription?.('ended');\r\n\t}\r\n\tprematureEnd() {\r\n\t\tthis.log(['message', 'This replay ends here.']);\r\n\t\tthis.ended = true;\r\n\t\tthis.subscription?.('ended');\r\n\t}\r\n\tendLastTurn() {\r\n\t\tif (this.endLastTurnPending) {\r\n\t\t\tthis.endLastTurnPending = false;\r\n\t\t\tthis.scene.updateStatbars();\r\n\t\t}\r\n\t}\r\n\tsetHardcoreMode(mode: boolean) {\r\n\t\tthis.hardcoreMode = mode;\r\n\t\tthis.scene.updateSidebars();\r\n\t\tthis.scene.updateWeather(true);\r\n\t}\r\n\tsetTurn(turnNum: number) {\r\n\t\tif (turnNum === this.turn + 1) {\r\n\t\t\tthis.endLastTurnPending = true;\r\n\t\t}\r\n\t\tif (this.turn && !this.usesUpkeep) this.updateTurnCounters(); // for compatibility with old replays\r\n\t\tthis.turn = turnNum;\r\n\t\tthis.started = true;\r\n\r\n\t\tif (this.seeking === null) this.turnsSinceMoved++;\r\n\r\n\t\tthis.scene.incrementTurn();\r\n\r\n\t\tif (this.seeking !== null) {\r\n\t\t\tif (turnNum >= this.seeking) {\r\n\t\t\t\tthis.stopSeeking();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.subscription?.('turn');\r\n\t\t}\r\n\t}\r\n\tresetTurnsSinceMoved() {\r\n\t\tthis.turnsSinceMoved = 0;\r\n\t\tthis.scene.updateAcceleration();\r\n\t}\r\n\tchangeWeather(weatherName: string, poke?: Pokemon, isUpkeep?: boolean, ability?: Dex.Effect) {\r\n\t\tlet weather = toID(weatherName);\r\n\t\tif (!weather || weather === 'none') {\r\n\t\t\tweather = '' as ID;\r\n\t\t}\r\n\t\tif (isUpkeep) {\r\n\t\t\tif (this.weather && this.weatherTimeLeft) {\r\n\t\t\t\tthis.weatherTimeLeft--;\r\n\t\t\t\tif (this.weatherMinTimeLeft !== 0) this.weatherMinTimeLeft--;\r\n\t\t\t}\r\n\t\t\tif (this.seeking === null) { this.scene.upkeepWeather(); }\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (weather) {\r\n\t\t\tlet isExtremeWeather = (weather === 'deltastream' || weather === 'desolateland' || weather === 'primordialsea');\r\n\t\t\tif (poke) {\r\n\t\t\t\tif (ability) { this.activateAbility(poke, ability.name); }\r\n\t\t\t\tthis.weatherTimeLeft = (this.gen <= 5 || isExtremeWeather) ? 0 : 8;\r\n\t\t\t\tthis.weatherMinTimeLeft = (this.gen <= 5 || isExtremeWeather) ? 0 : 5;\r\n\t\t\t} else if (isExtremeWeather) {\r\n\t\t\t\tthis.weatherTimeLeft = 0;\r\n\t\t\t\tthis.weatherMinTimeLeft = 0;\r\n\t\t\t} else {\r\n\t\t\t\tthis.weatherTimeLeft = (this.gen <= 3 ? 5 : 8);\r\n\t\t\t\tthis.weatherMinTimeLeft = (this.gen <= 3 ? 0 : 5);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.weather = weather;\r\n\t\tthis.scene.updateWeather();\r\n\t}\r\n\tswapSideConditions() {\r\n\t\tconst sideConditions = ['mist', 'lightscreen', 'reflect', 'spikes', 'safeguard', 'tailwind', 'toxicspikes', 'stealthrock', 'waterpledge', 'firepledge', 'grasspledge', 'stickyweb', 'auroraveil', 'gmaxsteelsurge', 'gmaxcannonade', 'gmaxvinelash', 'gmaxwildfire',];\r\n\t\tif (this.gameType === 'freeforall') {\r\n\t\t\t// Court Change rotates side conditions clockwise in a free-for-all\r\n\r\n\t\t\t// the list of all sides in clockwise order\r\n\t\t\tconst sides = [this.sides[0], this.sides[3], this.sides[1], this.sides[2]];\r\n\t\t\tconst temp: { [k: number]: Side[\"sideConditions\"] } = { 0: {}, 1: {}, 2: {}, 3: {} };\r\n\t\t\tfor (const side of sides) {\r\n\t\t\t\tfor (const id in side.sideConditions) {\r\n\t\t\t\t\tif (!sideConditions.includes(id)) continue;\r\n\t\t\t\t\ttemp[side.n][id] = side.sideConditions[id];\r\n\t\t\t\t\tside.removeSideCondition(id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i = 0; i < 4; i++) {\r\n\t\t\t\tconst sourceSide = sides[i]; // the current side in rotation\r\n\t\t\t\tconst sourceSideConditions = temp[sourceSide.n];\r\n\t\t\t\tconst targetSide = sides[(i + 1) % 4]; // the next side in rotation\r\n\t\t\t\tfor (const id in sourceSideConditions) {\r\n\t\t\t\t\ttargetSide.sideConditions[id] = sourceSideConditions[id];\r\n\t\t\t\t\tthis.scene.addSideCondition(targetSide.n, id as ID);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet side1 = this.sides[0];\r\n\t\tlet side2 = this.sides[1];\r\n\t\tfor (const id of sideConditions) {\r\n\t\t\tif (side1.sideConditions[id] && side2.sideConditions[id]) {\r\n\t\t\t\t[side1.sideConditions[id], side2.sideConditions[id]] = [\r\n\t\t\t\t\tside2.sideConditions[id], side1.sideConditions[id],\r\n\t\t\t\t];\r\n\t\t\t\tthis.scene.addSideCondition(side1.n, id as ID);\r\n\t\t\t\tthis.scene.addSideCondition(side2.n, id as ID);\r\n\t\t\t} else if (side1.sideConditions[id] && !side2.sideConditions[id]) {\r\n\t\t\t\tside2.sideConditions[id] = side1.sideConditions[id];\r\n\t\t\t\tthis.scene.addSideCondition(side2.n, id as ID);\r\n\t\t\t\tside1.removeSideCondition(id);\r\n\t\t\t} else if (side2.sideConditions[id] && !side1.sideConditions[id]) {\r\n\t\t\t\tside1.sideConditions[id] = side2.sideConditions[id];\r\n\t\t\t\tthis.scene.addSideCondition(side1.n, id as ID);\r\n\t\t\t\tside2.removeSideCondition(id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tupdateTurnCounters() {\r\n\t\tfor (const pWeather of this.pseudoWeather) {\r\n\t\t\tif (pWeather[1]) pWeather[1]--;\r\n\t\t\tif (pWeather[2]) pWeather[2]--;\r\n\t\t}\r\n\t\tfor (const side of this.sides) {\r\n\t\t\tfor (const id in side.sideConditions) {\r\n\t\t\t\tlet cond = side.sideConditions[id];\r\n\t\t\t\tif (cond[2]) cond[2]--;\r\n\t\t\t\tif (cond[3]) cond[3]--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const poke of [...this.nearSide.active, ...this.farSide.active]) {\r\n\t\t\tif (poke) {\r\n\t\t\t\tif (poke.status === 'tox') poke.statusData.toxicTurns++;\r\n\t\t\t\tpoke.clearTurnstatuses();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.scene.updateWeather();\r\n\t}\r\n\tuseMove(pokemon: Pokemon, move: Dex.Move, target: Pokemon | null, kwArgs: KWArgs) {\r\n\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\tthis.activateAbility(pokemon, fromeffect);\r\n\t\tpokemon.clearMovestatuses();\r\n\t\tif (move.id === 'focuspunch') {\r\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\r\n\t\t}\r\n\t\tthis.scene.updateStatbar(pokemon);\r\n\t\tif (fromeffect.id === 'sleeptalk') {\r\n\t\t\tpokemon.rememberMove(move.name, 0);\r\n\t\t}\r\n\t\tlet callerMoveForPressure = null;\r\n\t\t// will not include effects that are conditions named after moves like Magic Coat and Snatch, which is good\r\n\t\tif (fromeffect.id && kwArgs.from.startsWith(\"move:\")) {\r\n\t\t\tcallerMoveForPressure = fromeffect as Dex.Move;\r\n\t\t}\r\n\t\tif (!fromeffect.id || callerMoveForPressure || fromeffect.id === 'pursuit') {\r\n\t\t\tlet moveName = move.name;\r\n\t\t\tif (!callerMoveForPressure) {\r\n\t\t\t\tif (move.isZ) {\r\n\t\t\t\t\tpokemon.item = move.isZ;\r\n\t\t\t\t\tlet item = Dex.items.get(move.isZ);\r\n\t\t\t\t\tif (item.zMoveFrom) moveName = item.zMoveFrom;\r\n\t\t\t\t} else if (move.name.startsWith('Z-')) {\r\n\t\t\t\t\tmoveName = moveName.slice(2);\r\n\t\t\t\t\tmove = Dex.moves.get(moveName);\r\n\t\t\t\t\tif (window.BattleItems) {\r\n\t\t\t\t\t\tfor (let item in BattleItems) {\r\n\t\t\t\t\t\t\tif (BattleItems[item].zMoveType === move.type) pokemon.item = item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet pp = 1;\r\n\t\t\tif (this.abilityActive('Pressure') && move.id !== 'stickyweb') {\r\n\t\t\t\tconst foeTargets = [];\r\n\t\t\t\tconst moveTarget = move.pressureTarget;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!target && this.gameType === 'singles' &&\r\n\t\t\t\t\t!['self', 'allies', 'allySide', 'adjacentAlly', 'adjacentAllyOrSelf', 'allyTeam'].includes(moveTarget)\r\n\t\t\t\t) {\r\n\t\t\t\t\t// Hardcode for moves without a target in singles\r\n\t\t\t\t\tfoeTargets.push(pokemon.side.foe.active[0]);\r\n\t\t\t\t} else if (['all', 'allAdjacent', 'allAdjacentFoes', 'foeSide'].includes(moveTarget)) {\r\n\t\t\t\t\tfor (const active of this.getAllActive()) {\r\n\t\t\t\t\t\tif (active === pokemon) continue;\r\n\t\t\t\t\t\t// Pressure affects allies in gen 3 and 4\r\n\t\t\t\t\t\tif (this.gen <= 4 || (active.side !== pokemon.side && active.side.ally !== pokemon.side)) {\r\n\t\t\t\t\t\t\tfoeTargets.push(active);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (target && target.side !== pokemon.side) {\r\n\t\t\t\t\tfoeTargets.push(target);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (const foe of foeTargets) {\r\n\t\t\t\t\tif (foe && !foe.fainted && foe.effectiveAbility() === 'Pressure') {\r\n\t\t\t\t\t\tpp += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!callerMoveForPressure) {\r\n\t\t\t\tpokemon.rememberMove(moveName, pp);\r\n\t\t\t} else {\r\n\t\t\t\tpokemon.rememberMove(callerMoveForPressure.name, pp - 1); // 1 pp was already deducted from using the move itself\r\n\t\t\t}\r\n\t\t}\r\n\t\tpokemon.lastMove = move.id;\r\n\t\tthis.lastMove = move.id;\r\n\t\tif (move.id === 'wish' || move.id === 'healingwish') {\r\n\t\t\tpokemon.side.wisher = pokemon;\r\n\t\t}\r\n\t}\r\n\tanimateMove(pokemon: Pokemon, move: Dex.Move, target: Pokemon | null, kwArgs: KWArgs) {\r\n\t\tthis.activeMoveIsSpread = kwArgs.spread;\r\n\t\tif (this.seeking !== null || kwArgs.still) return;\r\n\r\n\t\tif (!target) target = pokemon.side.foe.active[0];\r\n\t\tif (!target) target = pokemon.side.foe.missedPokemon;\r\n\t\tif (kwArgs.miss && target.side) {\r\n\t\t\ttarget = target.side.missedPokemon;\r\n\t\t}\r\n\t\tif (kwArgs.notarget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (kwArgs.prepare || kwArgs.anim === 'prepare') {\r\n\t\t\tthis.scene.runPrepareAnim(move.id, pokemon, target);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet usedMove = kwArgs.anim ? Dex.moves.get(kwArgs.anim) : move;\r\n\t\tif (!kwArgs.spread) {\r\n\t\t\tthis.scene.runMoveAnim(usedMove.id, [pokemon, target]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet targets = [pokemon];\r\n\t\tif (kwArgs.spread === '.') {\r\n\t\t\t//  no target was hit by the attack\r\n\t\t\ttargets.push(target.side.missedPokemon);\r\n\t\t} else {\r\n\t\t\tfor (const hitTarget of kwArgs.spread.split(',')) {\r\n\t\t\t\tconst curTarget = this.getPokemon(hitTarget + ': ?');\r\n\t\t\t\tif (!curTarget) {\r\n\t\t\t\t\tthis.log(['error', `Invalid spread move target: \"${hitTarget}\"`]);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttargets.push(curTarget);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.scene.runMoveAnim(usedMove.id, targets);\r\n\t}\r\n\tcantUseMove(pokemon: Pokemon, effect: Dex.Effect, move: Dex.Move, kwArgs: KWArgs) {\r\n\t\tpokemon.clearMovestatuses();\r\n\t\tthis.scene.updateStatbar(pokemon);\r\n\t\tif (effect.id in BattleStatusAnims) {\r\n\t\t\tthis.scene.runStatusAnim(effect.id, [pokemon]);\r\n\t\t}\r\n\t\tthis.activateAbility(pokemon, effect);\r\n\t\tif (move.id) pokemon.rememberMove(move.name, 0);\r\n\t\tswitch (effect.id) {\r\n\t\tcase 'par':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Paralyzed', 'par');\r\n\t\t\tbreak;\r\n\t\tcase 'frz':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Frozen', 'frz');\r\n\t\t\tbreak;\r\n\t\tcase 'slp':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Asleep', 'slp');\r\n\t\t\tpokemon.statusData.sleepTurns++;\r\n\t\t\tbreak;\r\n\t\tcase 'truant':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Loafing around', 'neutral');\r\n\t\t\tbreak;\r\n\t\tcase 'recharge':\r\n\t\t\tthis.scene.runOtherAnim('selfstatus' as ID, [pokemon]);\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Must recharge', 'neutral');\r\n\t\t\tbreak;\r\n\t\tcase 'focuspunch':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Lost focus', 'neutral');\r\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\r\n\t\t\tbreak;\r\n\t\tcase 'shelltrap':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Trap failed', 'neutral');\r\n\t\t\tpokemon.removeTurnstatus('shelltrap' as ID);\r\n\t\t\tbreak;\r\n\t\tcase 'flinch':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Flinched', 'neutral');\r\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\r\n\t\t\tbreak;\r\n\t\tcase 'attract':\r\n\t\t\tthis.scene.resultAnim(pokemon, 'Immobilized', 'neutral');\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.scene.animReset(pokemon);\r\n\t}\r\n\r\n\tactivateAbility(\r\n\tpokemon: Pokemon | null,\r\n\teffectOrName: Dex.Effect | string,\r\n\tisNotBase?: boolean,\r\n\tslot: 1 | 2 = 1\r\n) {\r\n\tif (!pokemon || !effectOrName) return;\r\n\tif (typeof effectOrName !== 'string') {\r\n\t\tif (effectOrName.effectType !== 'Ability') return;\r\n\t\teffectOrName = effectOrName.name;\r\n\t}\r\n\tthis.scene.abilityActivateAnim(pokemon, effectOrName);\r\n\tpokemon.rememberAbility(effectOrName, isNotBase, slot);\r\n}\r\n\r\n\trunMinor(args: Args, kwArgs: KWArgs, nextArgs?: Args, nextKwargs?: KWArgs) {\r\n\t\tif (nextArgs && nextKwargs) {\r\n\t\t\tif (args[2] === 'Sturdy' && args[0] === '-activate') {\r\n\t\t\t\targs[2] = 'ability: Sturdy';\r\n\t\t\t}\r\n\t\t\tif (['-crit', '-supereffective', '-resisted'].includes(args[0]) || args[2] === 'ability: Sturdy') {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-damage' && !kwArgs.from && args[1] !== nextArgs[1] && (\r\n\t\t\t\t['-crit', '-supereffective', '-resisted'].includes(nextArgs[0]) ||\r\n\t\t\t\t(nextArgs[0] === '-damage' && !nextKwargs.from)\r\n\t\t\t)) {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-damage' && nextArgs[0] === '-damage' && kwArgs.from && kwArgs.from === nextKwargs.from) {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-heal' && nextArgs[0] === '-heal' && kwArgs.from && kwArgs.from === nextKwargs.from) {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-ability' && (args[2] === 'Intimidate' || args[4] === 'boost')) {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-unboost' && nextArgs[0] === '-unboost') {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-boost' && nextArgs[0] === '-boost') {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === '-damage' && kwArgs.from === 'Leech Seed' && nextArgs[0] === '-heal' && nextKwargs.silent) {\r\n\t\t\t\tkwArgs.then = '.';\r\n\t\t\t}\r\n\t\t\tif (args[0] === 'detailschange' && nextArgs[0] === '-mega') {\r\n\t\t\t\tif (this.scene.closeMessagebar()) {\r\n\t\t\t\t\tthis.currentStep--;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tkwArgs.simult = '.';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (kwArgs.then) this.waitForAnimations = false;\r\n\t\tif (kwArgs.simult) this.waitForAnimations = 'simult';\r\n\r\n\t\tconst CONSUMED = ['eaten', 'popped', 'consumed', 'held up'];\r\n\t\tswitch (args[0]) {\r\n\t\tcase '-damage': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet damage = poke.healthParse(args[2], true);\r\n\t\t\tif (damage === null) break;\r\n\t\t\tlet range = poke.getDamageRange(damage);\r\n\r\n\t\t\tif (kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\t\tthis.activateAbility(ofpoke, effect);\r\n\t\t\t\tif (effect.effectType === 'Item') {\r\n\t\t\t\t\tconst itemPoke = ofpoke || poke;\r\n\t\t\t\t\tif (itemPoke.prevItem !== effect.name && !CONSUMED.includes(itemPoke.prevItemEffect)) {\r\n\t\t\t\t\t\titemPoke.item = effect.name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'brn':\r\n\t\t\t\t\tthis.scene.runStatusAnim('brn' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'psn':\r\n\t\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'baddreams':\r\n\t\t\t\t\tthis.scene.runStatusAnim('cursed' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'curse':\r\n\t\t\t\t\tthis.scene.runStatusAnim('cursed' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'confusion':\r\n\t\t\t\t\tthis.scene.runStatusAnim('confusedselfhit' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'leechseed':\r\n\t\t\t\t\tthis.scene.runOtherAnim('leech' as ID, [ofpoke!, poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'bind':\r\n\t\t\t\tcase 'wrap':\r\n\t\t\t\t\tthis.scene.runOtherAnim('bound' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.dex.moves.get(this.lastMove).category !== 'Status') {\r\n\t\t\t\t\tpoke.timesAttacked++;\r\n\t\t\t\t}\r\n\t\t\t\tlet damageinfo = '' + Pokemon.getFormattedRange(range, damage[1] === 100 ? 0 : 1, '\\u2013');\r\n\t\t\t\tif (damage[1] !== 100) {\r\n\t\t\t\t\tlet hover = `${(damage[0] < 0) ? '\\u2212' : ''}${Math.abs(damage[0])}/${damage[1]}`;\r\n\t\t\t\t\tif (damage[1] === 48) { // this is a hack\r\n\t\t\t\t\t\thover += ' pixels';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// battle-log will convert this into <abbr>\r\n\t\t\t\t\tdamageinfo = '||' + hover + '||' + damageinfo + '||';\r\n\t\t\t\t}\r\n\t\t\t\targs[3] = damageinfo;\r\n\t\t\t}\r\n\t\t\tthis.scene.damageAnim(poke, Pokemon.getFormattedRange(range, 0, ' to '));\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-heal': {\r\n\t\t\tlet poke = this.getPokemon(args[1], Dex.getEffect(kwArgs.from).id === 'revivalblessing')!;\r\n\t\t\tlet damage = poke.healthParse(args[2], true, true);\r\n\t\t\tif (damage === null) break;\r\n\t\t\tlet range = poke.getDamageRange(damage);\r\n\r\n\t\t\tif (kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\t\tif (effect.effectType === 'Item' && !CONSUMED.includes(poke.prevItemEffect)) {\r\n\t\t\t\t\tif (poke.prevItem !== effect.name) {\r\n\t\t\t\t\t\tpoke.item = effect.name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'lunardance':\r\n\t\t\t\t\tfor (let trackedMove of poke.moveTrack) {\r\n\t\t\t\t\t\ttrackedMove[1] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// falls through\r\n\t\t\t\tcase 'healingwish':\r\n\t\t\t\t\tthis.lastMove = 'healing-wish';\r\n\t\t\t\t\tthis.scene.runResidualAnim('healingwish' as ID, poke);\r\n\t\t\t\t\tpoke.side.wisher = null;\r\n\t\t\t\t\tpoke.statusData.sleepTurns = 0;\r\n\t\t\t\t\tpoke.statusData.toxicTurns = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'wish':\r\n\t\t\t\t\tthis.scene.runResidualAnim('wish' as ID, poke);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'revivalblessing':\r\n\t\t\t\t\tthis.scene.runResidualAnim('wish' as ID, poke);\r\n\t\t\t\t\tconst { siden } = this.parsePokemonId(args[1]);\r\n\t\t\t\t\tconst side = this.sides[siden];\r\n\t\t\t\t\tpoke.fainted = false;\r\n\t\t\t\t\tpoke.status = '';\r\n\t\t\t\t\tthis.scene.updateSidebar(side);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.scene.runOtherAnim('heal' as ID, [poke]);\r\n\t\t\tthis.scene.healAnim(poke, Pokemon.getFormattedRange(range, 0, ' to '));\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-sethp': {\r\n\t\t\tfor (let k = 0; k < 2; k++) {\r\n\t\t\t\tlet cpoke = this.getPokemon(args[1 + 2 * k]);\r\n\t\t\t\tif (cpoke) {\r\n\t\t\t\t\tlet damage = cpoke.healthParse(args[2 + 2 * k])!;\r\n\t\t\t\t\tlet range = cpoke.getDamageRange(damage);\r\n\t\t\t\t\tlet formattedRange = Pokemon.getFormattedRange(range, 0, ' to ');\r\n\t\t\t\t\tlet diff = damage[0];\r\n\t\t\t\t\tif (diff > 0) {\r\n\t\t\t\t\t\tthis.scene.healAnim(cpoke, formattedRange);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scene.damageAnim(cpoke, formattedRange);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-boost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet stat = args[2] as Dex.BoostStatName;\r\n\t\t\tif (this.gen === 1 && stat === 'spd') break;\r\n\t\t\tif (this.gen === 1 && stat === 'spa') stat = 'spc';\r\n\t\t\tlet amount = parseInt(args[3], 10);\r\n\t\t\tif (amount === 0) {\r\n\t\t\t\tthis.scene.resultAnim(poke, 'already ' + poke.getBoost(stat), 'neutral');\r\n\t\t\t\tthis.log(args, kwArgs);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!poke.boosts[stat]) {\r\n\t\t\t\tpoke.boosts[stat] = 0;\r\n\t\t\t}\r\n\t\t\tpoke.boosts[stat] += amount;\r\n\r\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\t\tif (!(effect.id === 'weakarmor' && stat === 'spe')) {\r\n\t\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), 'good');\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-unboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet stat = args[2] as Dex.BoostStatName;\r\n\t\t\tif (this.gen === 1 && stat === 'spd') break;\r\n\t\t\tif (this.gen === 1 && stat === 'spa') stat = 'spc';\r\n\t\t\tlet amount = parseInt(args[3], 10);\r\n\t\t\tif (amount === 0) {\r\n\t\t\t\tthis.scene.resultAnim(poke, 'already ' + poke.getBoost(stat), 'neutral');\r\n\t\t\t\tthis.log(args, kwArgs);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!poke.boosts[stat]) {\r\n\t\t\t\tpoke.boosts[stat] = 0;\r\n\t\t\t}\r\n\t\t\tpoke.boosts[stat] -= amount;\r\n\r\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), 'bad');\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-setboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet stat = args[2] as Dex.BoostStatName;\r\n\t\t\tlet amount = parseInt(args[3], 10);\r\n\t\t\tpoke.boosts[stat] = amount;\r\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), (amount > 0 ? 'good' : 'bad'));\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-swapboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet poke2 = this.getPokemon(args[2])!;\r\n\t\t\tlet stats = args[3] ? args[3].split(', ') : ['atk', 'def', 'spa', 'spd', 'spe', 'accuracy', 'evasion'];\r\n\t\t\tfor (const stat of stats) {\r\n\t\t\t\tlet tmp = poke.boosts[stat];\r\n\t\t\t\tpoke.boosts[stat] = poke2.boosts[stat];\r\n\t\t\t\tif (!poke.boosts[stat]) delete poke.boosts[stat];\r\n\t\t\t\tpoke2.boosts[stat] = tmp;\r\n\t\t\t\tif (!poke2.boosts[stat]) delete poke2.boosts[stat];\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Stats swapped', 'neutral');\r\n\t\t\tthis.scene.resultAnim(poke2, 'Stats swapped', 'neutral');\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-clearpositiveboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet ofpoke = this.getPokemon(args[2]);\r\n\t\t\tlet effect = Dex.getEffect(args[3]);\r\n\t\t\tfor (const stat in poke.boosts) {\r\n\t\t\t\tif (poke.boosts[stat] > 0) delete poke.boosts[stat];\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Boosts lost', 'bad');\r\n\r\n\t\t\tif (effect.id) {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'spectralthief':\r\n\t\t\t\t\t// todo: update StealBoosts so it animates 1st on Spectral Thief\r\n\t\t\t\t\tthis.scene.runOtherAnim('spectralthiefboost' as ID, [ofpoke!, poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-clearnegativeboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tfor (const stat in poke.boosts) {\r\n\t\t\t\tif (poke.boosts[stat] < 0) delete poke.boosts[stat];\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Restored', 'good');\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-copyboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet frompoke = this.getPokemon(args[2])!;\r\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tthis.activateAbility(poke, effect);\r\n\t\t\t}\r\n\t\t\tlet stats = args[3] ? args[3].split(', ') : ['atk', 'def', 'spa', 'spd', 'spe', 'accuracy', 'evasion'];\r\n\t\t\tfor (const stat of stats) {\r\n\t\t\t\tpoke.boosts[stat] = frompoke.boosts[stat];\r\n\t\t\t\tif (!poke.boosts[stat]) delete poke.boosts[stat];\r\n\t\t\t}\r\n\t\t\tif (this.gen >= 6) {\r\n\t\t\t\tconst volatilesToCopy = ['focusenergy', 'gmaxchistrike', 'laserfocus'];\r\n\t\t\t\tfor (const volatile of volatilesToCopy) {\r\n\t\t\t\t\tif (frompoke.volatiles[volatile]) {\r\n\t\t\t\t\t\tpoke.addVolatile(volatile as ID);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpoke.removeVolatile(volatile as ID);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Stats copied', 'neutral');\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-clearboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tpoke.boosts = {};\r\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\r\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Stats reset', 'neutral');\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-invertboost': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tfor (const stat in poke.boosts) {\r\n\t\t\t\tpoke.boosts[stat] = -poke.boosts[stat];\r\n\t\t\t}\r\n\t\t\tthis.scene.resultAnim(poke, 'Stats inverted', 'neutral');\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-clearallboost': {\r\n\t\t\tlet timeOffset = this.scene.timeOffset;\r\n\t\t\tfor (const active of this.getAllActive()) {\r\n\t\t\t\tactive.boosts = {};\r\n\t\t\t\tthis.scene.timeOffset = timeOffset;\r\n\t\t\t\tthis.scene.resultAnim(active, 'Stats reset', 'neutral');\r\n\t\t\t}\r\n\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-crit': {\r\n\t\t\tlet poke = this.getPokemon(args[1]);\r\n\t\t\tif (poke) this.scene.resultAnim(poke, 'Critical hit', 'bad');\r\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-supereffective': {\r\n\t\t\tlet poke = this.getPokemon(args[1]);\r\n\t\t\tif (poke) {\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Super-effective', 'bad');\r\n\t\t\t\tif (Dex.afdMode === true) {\r\n\t\t\t\t\t// April Fool's 2018\r\n\t\t\t\t\tthis.scene.runOtherAnim('hitmark' as ID, [poke]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-resisted': {\r\n\t\t\tlet poke = this.getPokemon(args[1]);\r\n\t\t\tif (poke) this.scene.resultAnim(poke, 'Resisted', 'neutral');\r\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-immune': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\t\tthis.activateAbility(this.getPokemon(kwArgs.of) || poke, fromeffect);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tthis.scene.resultAnim(poke, 'Immune', 'neutral');\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-miss': {\r\n\t\t\tlet target = this.getPokemon(args[2]);\r\n\t\t\tif (target) {\r\n\t\t\t\tthis.scene.resultAnim(target, 'Missed', 'neutral');\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-fail': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tif (fromeffect.id === 'clearamulet') {\r\n\t\t\t\tofpoke!.item = 'Clear Amulet';\r\n\t\t\t} else {\r\n\t\t\t\tthis.activateAbility(ofpoke || poke, fromeffect);\r\n\t\t\t}\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'brn':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Already burned', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tox':\r\n\t\t\tcase 'psn':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Already poisoned', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'slp':\r\n\t\t\t\tif (fromeffect.id === 'uproar') {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Failed', 'neutral');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Already asleep', 'neutral');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'par':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Already paralyzed', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'frz':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Already frozen', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'unboost':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Stat drop blocked', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (poke) {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Failed', 'neutral');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.scene.animReset(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-block': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'quickguard':\r\n\t\t\t\tpoke.addTurnstatus('quickguard' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Quick Guard', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'wideguard':\r\n\t\t\t\tpoke.addTurnstatus('wideguard' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Wide Guard', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'craftyshield':\r\n\t\t\t\tpoke.addTurnstatus('craftyshield' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Crafty Shield', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'protect':\r\n\t\t\t\tpoke.addTurnstatus('protect' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Protected', 'good');\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'safetygoggles':\r\n\t\t\t\tpoke.item = 'Safety Goggles';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'protectivepads':\r\n\t\t\t\tpoke.item = 'Protective Pads';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'abilityshield':\r\n\t\t\t\tpoke.item = 'Ability Shield';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-center': case '-notarget': case '-ohko':\r\n\t\tcase '-combine': case '-hitcount': case '-waiting': case '-zbroken': {\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-zpower': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tthis.scene.runOtherAnim('zpower' as ID, [poke]);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-prepare': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet moveid = toID(args[2]);\r\n\t\t\tlet target = this.getPokemon(args[3]) || poke.side.foe.active[0] || poke;\r\n\t\t\tthis.scene.runPrepareAnim(moveid, poke, target);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-mustrecharge': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tpoke.addMovestatus('mustrecharge' as ID);\r\n\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-status': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of) || poke;\r\n\t\t\tpoke.status = args[2] as Dex.StatusName;\r\n\t\t\tif (poke.status === 'aura' && kwArgs.time) { (poke as any).auraTime = Number(kwArgs.time) || 0; }\r\n\t\t\tthis.activateAbility(ofpoke || poke, effect);\r\n\t\t\tif (effect.effectType === 'Item') {\r\n\t\t\t\tofpoke.item = effect.name;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (args[2]) {\r\n\t\t\tcase 'brn':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Burned', 'brn');\r\n\t\t\t\tthis.scene.runStatusAnim('brn' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tox':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Toxic poison', 'psn');\r\n\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\r\n\t\t\t\tpoke.statusData.toxicTurns = (effect.name === \"Toxic Orb\" ? -1 : 0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'psn':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Poisoned', 'psn');\r\n\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'slp':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Asleep', 'slp');\r\n\t\t\t\tif (effect.id === 'rest') {\r\n\t\t\t\t\tpoke.statusData.sleepTurns = 0; // for Gen 2 use through Sleep Talk\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'par':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Paralyzed', 'par');\r\n\t\t\t\tthis.scene.runStatusAnim('par' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'frz':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Frozen', 'frz');\r\n\t\t\t\tthis.scene.runStatusAnim('frz' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-curestatus': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tif (effect.id) {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'flamewheel':\r\n\t\t\t\tcase 'flareblitz':\r\n\t\t\t\tcase 'fusionflare':\r\n\t\t\t\tcase 'sacredfire':\r\n\t\t\t\tcase 'scald':\r\n\t\t\t\tcase 'steameruption':\r\n\t\t\t\t\tkwArgs.thaw = '.';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (poke) {\r\n\t\t\t\tpoke.status = '';\r\n\t\t\t\t// Clear Aura UI timer state when Aura ends\r\n\t\t\t\tif (args[2] === 'aura') {\r\n\t\t\t\t\t(poke as any).auraTime = 0;\r\n\t\t\t\t\t(poke as any).auraStartTurn = 0; // only if you ever used this earlier\r\n\t\t\t\t\t(poke as any).auraDuration = 0;  // only if you ever used this earlier\r\n\t\t\t\t}\r\n\t\t\t\tswitch (args[2]) {\r\n\t\t\t\tcase 'brn':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Burn cured', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'tox':\r\n\t\t\t\tcase 'psn':\r\n\t\t\t\t\tpoke.statusData.toxicTurns = 0;\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Poison cured', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'slp':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Woke up', 'good');\r\n\t\t\t\t\tpoke.statusData.sleepTurns = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'par':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Paralysis cured', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'frz':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Thawed', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tpoke.removeVolatile('confusion' as ID);\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Cured', 'good');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-cureteam': { // For old gens when the whole team was always cured\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tfor (const target of poke.side.pokemon) {\r\n\t\t\t\ttarget.status = '';\r\n\t\t\t\tthis.scene.updateStatbarIfExists(target);\r\n\t\t\t}\r\n\r\n\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-item': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet item = Dex.items.get(args[2]);\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tif (!poke) {\r\n\t\t\t\tif (effect.id === 'frisk') {\r\n\t\t\t\t\tconst possibleTargets = ofpoke!.side.foe.active.filter(p => p !== null);\r\n\t\t\t\t\tif (possibleTargets.length === 1) {\r\n\t\t\t\t\t\tpoke = possibleTargets[0]!;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.activateAbility(ofpoke, \"Frisk\");\r\n\t\t\t\t\t\tthis.log(args, kwArgs);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('No Pokemon in -item message');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpoke.item = item.name;\r\n\t\t\tpoke.itemEffect = '';\r\n\t\t\tpoke.removeVolatile('airballoon' as ID);\r\n\t\t\tif (item.id === 'airballoon') poke.addVolatile('airballoon' as ID);\r\n\r\n\t\t\tif (effect.id) {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'pickup':\r\n\t\t\t\t\tthis.activateAbility(poke, \"Pickup\");\r\n\t\t\t\t\t// falls through\r\n\t\t\t\tcase 'recycle':\r\n\t\t\t\t\tpoke.itemEffect = 'found';\r\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'frisk':\r\n\t\t\t\t\tthis.activateAbility(ofpoke, \"Frisk\");\r\n\t\t\t\t\tif (poke && poke !== ofpoke) { // used for gen 6\r\n\t\t\t\t\t\tpoke.itemEffect = 'frisked';\r\n\t\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'magician':\r\n\t\t\t\tcase 'pickpocket':\r\n\t\t\t\t\tthis.activateAbility(poke, effect.name);\r\n\t\t\t\t\t// falls through\r\n\t\t\t\tcase 'thief':\r\n\t\t\t\tcase 'covet':\r\n\t\t\t\t\t// simulate the removal of the item from the ofpoke\r\n\t\t\t\t\tofpoke!.item = '';\r\n\t\t\t\t\tofpoke!.itemEffect = '';\r\n\t\t\t\t\tofpoke!.prevItem = item.name;\r\n\t\t\t\t\tofpoke!.prevItemEffect = 'stolen';\r\n\t\t\t\t\tofpoke!.addVolatile('itemremoved' as ID);\r\n\t\t\t\t\tpoke.itemEffect = 'stolen';\r\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\r\n\t\t\t\t\tthis.scene.resultAnim(ofpoke!, 'Item Stolen', 'bad');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'harvest':\r\n\t\t\t\t\tpoke.itemEffect = 'harvested';\r\n\t\t\t\t\tthis.activateAbility(poke, \"Harvest\");\r\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'bestow':\r\n\t\t\t\t\tpoke.itemEffect = 'bestowed';\r\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'switcheroo':\r\n\t\t\t\tcase 'trick':\r\n\t\t\t\t\tpoke.itemEffect = 'tricked';\r\n\t\t\t\t\t// falls through\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tswitch (item.id) {\r\n\t\t\t\tcase 'airballoon':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Balloon', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-enditem': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet item = Dex.items.get(args[2]);\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tif (this.gen > 4 || effect.id !== 'knockoff') {\r\n\t\t\t\tpoke.item = '';\r\n\t\t\t\tpoke.itemEffect = '';\r\n\t\t\t\tpoke.prevItem = item.name;\r\n\t\t\t\tpoke.prevItemEffect = '';\r\n\t\t\t}\r\n\t\t\tpoke.removeVolatile('airballoon' as ID);\r\n\t\t\tpoke.addVolatile('itemremoved' as ID);\r\n\t\t\tif (kwArgs.eat) {\r\n\t\t\t\tpoke.prevItemEffect = 'eaten';\r\n\t\t\t\tthis.scene.runOtherAnim('consume' as ID, [poke]);\r\n\t\t\t\tthis.lastMove = item.id;\r\n\t\t\t} else if (kwArgs.weaken) {\r\n\t\t\t\tpoke.prevItemEffect = 'eaten';\r\n\t\t\t\tthis.lastMove = item.id;\r\n\t\t\t} else if (effect.id) {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'fling':\r\n\t\t\t\t\tpoke.prevItemEffect = 'flung';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'knockoff':\r\n\t\t\t\t\tif (this.gen <= 4) {\r\n\t\t\t\t\t\tpoke.itemEffect = 'knocked off';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpoke.prevItemEffect = 'knocked off';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.scene.runOtherAnim('itemoff' as ID, [poke]);\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Item knocked off', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'stealeat':\r\n\t\t\t\t\tpoke.prevItemEffect = 'stolen';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'gem':\r\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'incinerate':\r\n\t\t\t\t\tpoke.prevItemEffect = 'incinerated';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tswitch (item.id) {\r\n\t\t\t\tcase 'airballoon':\r\n\t\t\t\t\tpoke.prevItemEffect = 'popped';\r\n\t\t\t\t\tpoke.removeVolatile('airballoon' as ID);\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Balloon popped', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'focussash':\r\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Sash', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'focusband':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Focus Band', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'redcard':\r\n\t\t\t\t\tpoke.prevItemEffect = 'held up';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-ability': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet ability = Dex.abilities.get(args[2]);\r\n\t\t\tlet oldAbility = Dex.abilities.get(args[3]);\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tlet slot: 1 | 2 = (kwArgs.slot === '2' ? 2 : 1);\r\n\t\t\t// Hard rules (so Aura never overwrites slot 1 even if kwArgs.slot is missing)\r\n\t\t\tif (effect.id === 'aura') slot = 2;\r\n\t\t\tif (effect.id === 'mummy' || effect.id === 'lingeringaroma' || effect.id === 'wanderingspirit') slot = 1;\r\n\t\t\t// If kwArgs.slot wasn't provided, infer slot 2 when the \"old ability\" matches slot 2\r\n\t\t\tif (!kwArgs.slot) {\r\n\t\t\t\tconst oldId = toID(oldAbility.name);\r\n\t\t\t\tconst a2 = toID((poke as any).ability2 || '');\r\n\t\t\t\tconst b2 = toID((poke as any).baseAbility2 || '');\r\n\t\t\t\tif (oldId && (oldId === a2 || oldId === b2)) slot = 2;\r\n\t\t\t}\r\n\t\t\t// Trace / PoA / Receiver replace whichever slot THEY are in on the user\r\n\t\t\tif (effect.id === 'trace' || effect.id === 'powerofalchemy' || effect.id === 'receiver') {\r\n\t\t\t\tconst effId = toID(effect.id);\r\n\t\t\t\tconst s2 = toID((poke as any).ability2 || (poke as any).baseAbility2 || '');\r\n\t\t\t\tslot = (s2 === effId ? 2 : 1);\r\n\t\t\t}\r\n\t\t\tpoke.rememberAbility(ability.name, effect.id && !kwArgs.fail, slot);\r\n\t\t\tif (kwArgs.silent) {\r\n\t\t\t\t// do nothing\r\n\t\t\t} else if (oldAbility.id) {\r\n\t\t\t\tthis.activateAbility(poke, oldAbility.name, undefined, slot);\r\n\t\t\t\tthis.scene.wait(500);\r\n\t\t\t\tthis.activateAbility(poke, ability.name, true, slot);\r\n\t\t\t\tofpoke?.rememberAbility(ability.name, undefined, slot);\r\n\t\t\t} else if (effect.id) {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'desolateland':\r\n\t\t\t\tcase 'primordialsea':\r\n\t\t\t\tcase 'deltastream':\r\n\t\t\t\t\tif (kwArgs.fail) {\r\n\t\t\t\t\t\tthis.activateAbility(poke, ability.name, undefined, slot);;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.activateAbility(poke, ability.name, undefined, slot);;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.activateAbility(poke, ability.name, undefined, slot);;\r\n\t\t\t}\r\n\t\t\tthis.scene.updateWeather();\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-endability': {\r\n\t\t\t// deprecated; use |-start| for Gastro Acid\r\n\t\t\t// and the third arg of |-ability| for Entrainment et al\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet ability = Dex.abilities.get(args[2]);\r\n\t\t\tpoke.ability = '(suppressed)';\r\n\t\t\tpoke.ability2 = '(suppressed)';\r\n\r\n\t\t\tif (ability.id) {\r\n\t\t\t\tif (!poke.baseAbility) poke.baseAbility = ability.name;\r\n\t\t\t\tif (!poke.baseAbility2) poke.baseAbility2 = ability.name;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'detailschange': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tpoke.removeVolatile('formechange' as ID);\r\n\t\t\tpoke.removeVolatile('typeadd' as ID);\r\n\t\t\tpoke.removeVolatile('typechange' as ID);\r\n\r\n\t\t\tlet newSpeciesForme = args[2];\r\n\t\t\tlet commaIndex = newSpeciesForme.indexOf(',');\r\n\t\t\tif (commaIndex !== -1) {\r\n\t\t\t\tlet level = newSpeciesForme.substr(commaIndex + 1).trim();\r\n\t\t\t\tif (level.startsWith('L')) {\r\n\t\t\t\t\tpoke.level = parseInt(level.substr(1), 10);\r\n\t\t\t\t}\r\n\t\t\t\tnewSpeciesForme = args[2].substr(0, commaIndex);\r\n\t\t\t}\r\n\t\t\tlet species = this.dex.species.get(newSpeciesForme);\r\n\t\t\tif (nextArgs) {\r\n\t\t\t\tif (nextArgs[0] === '-mega') {\r\n\t\t\t\t\tspecies = this.dex.species.get(this.dex.items.get(nextArgs[3]).megaStone);\r\n\t\t\t\t} else if (nextArgs[0] === '-primal' && nextArgs.length > 2) {\r\n\t\t\t\t\tif (nextArgs[2] === 'Red Orb') species = this.dex.species.get('Groudon-Primal');\r\n\t\t\t\t\tif (nextArgs[2] === 'Blue Orb') species = this.dex.species.get('Kyogre-Primal');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tpoke.speciesForme = newSpeciesForme;\r\n\t\t\tpoke.ability = poke.baseAbility = (species.abilities ? species.abilities['0'] : '');\r\n\r\n\t\t\tpoke.details = args[2];\r\n\t\t\tpoke.searchid = args[1].substr(0, 2) + args[1].substr(args[1].indexOf(':')) + '|' + args[2];\r\n\r\n\t\t\tthis.scene.animTransform(poke, true, true);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-transform': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet tpoke = this.getPokemon(args[2])!;\r\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\r\n\t\t\tif (poke === tpoke) throw new Error(\"Transforming into self\");\r\n\r\n\t\t\tif (!kwArgs.silent) {\r\n\t\t\t\tthis.activateAbility(poke, effect);\r\n\t\t\t}\r\n\r\n\t\t\tpoke.boosts = { ...tpoke.boosts };\r\n\t\t\tpoke.copyTypesFrom(tpoke, true);\r\n\t\t\tpoke.ability = tpoke.ability;\r\n\t\t\tpoke.timesAttacked = tpoke.timesAttacked;\r\n\t\t\tconst targetForme = tpoke.volatiles.formechange;\r\n\t\t\tconst speciesForme = (targetForme && !targetForme[1].endsWith('-Gmax')) ? targetForme[1] : tpoke.speciesForme;\r\n\t\t\tconst pokemon = tpoke;\r\n\t\t\tconst shiny = tpoke.shiny;\r\n\t\t\tconst gender = tpoke.gender;\r\n\t\t\tconst level = tpoke.level;\r\n\t\t\tpoke.addVolatile('transform' as ID, pokemon, shiny, gender, level);\r\n\t\t\tpoke.addVolatile('formechange' as ID, speciesForme);\r\n\t\t\tfor (const trackedMove of tpoke.moveTrack) {\r\n\t\t\t\tpoke.rememberMove(trackedMove[0], 0);\r\n\t\t\t}\r\n\t\t\tthis.scene.animTransform(poke);\r\n\t\t\tthis.scene.resultAnim(poke, 'Transformed', 'good');\r\n\t\t\tthis.log(['-transform', args[1], args[2], tpoke.speciesForme], kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-formechange': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet species = Dex.species.get(args[2]);\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\t\tif (!poke.getSpeciesForme().endsWith('-Gmax') && !species.name.endsWith('-Gmax')) {\r\n\t\t\t\tpoke.removeVolatile('typeadd' as ID);\r\n\t\t\t\tpoke.removeVolatile('typechange' as ID);\r\n\t\t\t\tif (this.gen >= 6) poke.removeVolatile('autotomize' as ID);\r\n\t\t\t}\r\n\r\n\t\t\tif (!kwArgs.silent) {\r\n\t\t\t\tthis.activateAbility(poke, fromeffect);\r\n\t\t\t}\r\n\t\t\tpoke.addVolatile('formechange' as ID, species.name); // the formechange volatile reminds us to revert the sprite change on switch-out\r\n\t\t\tthis.scene.animTransform(poke, true);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-mega': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet item = Dex.items.get(args[3]);\r\n\t\t\tif (args[3]) {\r\n\t\t\t\tpoke.item = item.name;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-primal': case '-burst': {\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-terastallize': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet type = Dex.types.get(args[2]).name;\r\n\t\t\tlet lockForme = false;\r\n\t\t\tpoke.removeVolatile('typeadd' as ID);\r\n\t\t\tpoke.teraType = type;\r\n\t\t\tpoke.terastallized = type;\r\n\t\t\tpoke.details += `, tera:${type}`;\r\n\t\t\tpoke.searchid += `, tera:${type}`;\r\n\t\t\tif (poke.speciesForme.startsWith(\"Morpeko\")) {\r\n\t\t\t\tlockForme = true;\r\n\t\t\t\tpoke.speciesForme = poke.getSpeciesForme();\r\n\t\t\t\tpoke.details = poke.details.replace(\"Morpeko\", poke.speciesForme);\r\n\t\t\t\tpoke.searchid = `${poke.ident}|${poke.details}`;\r\n\t\t\t\tdelete poke.volatiles['formechange'];\r\n\t\t\t}\r\n\t\t\tthis.scene.animTransform(poke, true, lockForme);\r\n\t\t\tthis.scene.resetStatbar(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-start': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\r\n\t\t\tthis.activateAbility(poke, effect);\r\n\t\t\tthis.activateAbility(ofpoke || poke, fromeffect);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'typechange':\r\n\t\t\t\tif (poke.terastallized) break;\r\n\t\t\t\tif (ofpoke && fromeffect.id === 'reflecttype') {\r\n\t\t\t\t\tpoke.copyTypesFrom(ofpoke);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst types = Dex.sanitizeName(args[3] || '???');\r\n\t\t\t\t\tpoke.removeVolatile('typeadd' as ID);\r\n\t\t\t\t\tpoke.addVolatile('typechange' as ID, types);\r\n\t\t\t\t\tif (!kwArgs.silent) {\r\n\t\t\t\t\t\tthis.scene.typeAnim(poke, types);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'typeadd':\r\n\t\t\t\tconst type = Dex.sanitizeName(args[3]);\r\n\t\t\t\tpoke.addVolatile('typeadd' as ID, type);\r\n\t\t\t\tif (kwArgs.silent) break;\r\n\t\t\t\tthis.scene.typeAnim(poke, type);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'dynamax':\r\n\t\t\t\tpoke.addVolatile('dynamax' as ID, !!args[3]);\r\n\t\t\t\tthis.scene.animTransform(poke, true);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'powertrick':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Power Trick', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'foresight':\r\n\t\t\tcase 'miracleeye':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Identified', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'telekinesis':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Telekinesis', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'confusion':\r\n\t\t\t\tif (!kwArgs.already) {\r\n\t\t\t\t\tthis.scene.runStatusAnim('confused' as ID, [poke]);\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Confused', 'bad');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'leechseed':\r\n\t\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'healblock':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Heal Block', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'yawn':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Drowsy', 'slp');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'taunt':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Taunted', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'imprison':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Imprisoning', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'disable':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Disabled', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'embargo':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Embargo', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'torment':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Tormented', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ingrain':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Ingrained', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'aquaring':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Aqua Ring', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'stockpile1':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'stockpile2':\r\n\t\t\t\tpoke.removeVolatile('stockpile1' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile&times;2', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'stockpile3':\r\n\t\t\t\tpoke.removeVolatile('stockpile2' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile&times;3', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'perish0':\r\n\t\t\t\tpoke.removeVolatile('perish1' as ID);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'perish1':\r\n\t\t\t\tpoke.removeVolatile('perish2' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Perish next turn', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'perish2':\r\n\t\t\t\tpoke.removeVolatile('perish3' as ID);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Perish in 2', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'perish3':\r\n\t\t\t\tif (!kwArgs.silent) this.scene.resultAnim(poke, 'Perish in 3', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'encore':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Encored', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bide':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Bide', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'attract':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Attracted', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'autotomize':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Lightened', 'good');\r\n\t\t\t\tif (poke.volatiles.autotomize) {\r\n\t\t\t\t\tpoke.volatiles.autotomize[1]++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpoke.addVolatile('autotomize' as ID, 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'focusenergy':\r\n\t\t\t\tthis.scene.resultAnim(poke, '+Crit rate', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'curse':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Cursed', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'nightmare':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Nightmare', 'bad');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'magnetrise':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Magnet Rise', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'smackdown':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Smacked Down', 'bad');\r\n\t\t\t\tpoke.removeVolatile('magnetrise' as ID);\r\n\t\t\t\tpoke.removeVolatile('telekinesis' as ID);\r\n\t\t\t\tif (poke.lastMove === 'fly' || poke.lastMove === 'bounce') this.scene.animReset(poke);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'substitute':\r\n\t\t\t\tif (kwArgs.damage) {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Damage', 'bad');\r\n\t\t\t\t} else if (kwArgs.block) {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Blocked', 'neutral');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Gen 1-2\r\n\t\t\tcase 'mist':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Mist', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\t// Gen 1\r\n\t\t\tcase 'lightscreen':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Light Screen', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'reflect':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Reflect', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!(effect.id === 'typechange' && poke.terastallized)) {\r\n\t\t\t\tpoke.addVolatile(effect.id);\r\n\t\t\t}\r\n\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-end': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\t\tpoke.removeVolatile(effect.id);\r\n\r\n\t\t\tif (kwArgs.silent && !(effect.id === 'protosynthesis' || effect.id === 'quarkdrive')) {\r\n\t\t\t\t// do nothing\r\n\t\t\t} else {\r\n\t\t\t\tswitch (effect.id) {\r\n\t\t\t\tcase 'dynamax':\r\n\t\t\t\t\tthis.scene.animTransform(poke);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'powertrick':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Power Trick', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'telekinesis':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Telekinesis&nbsp;ended', 'neutral');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'skydrop':\r\n\t\t\t\t\tif (kwArgs.interrupt) {\r\n\t\t\t\t\t\tthis.scene.anim(poke, { time: 100 });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'confusion':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Confusion&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'leechseed':\r\n\t\t\t\t\tif (fromeffect.id === 'rapidspin') {\r\n\t\t\t\t\t\tthis.scene.resultAnim(poke, 'De-seeded', 'good');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'healblock':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Heal Block ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'attract':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Attract&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'taunt':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Taunt&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'disable':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Disable&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'embargo':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Embargo ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'torment':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Torment&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'encore':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Encore&nbsp;ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'bide':\r\n\t\t\t\t\tthis.scene.runOtherAnim('bideunleash' as ID, [poke]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'illusion':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Illusion ended', 'bad');\r\n\t\t\t\t\tpoke.rememberAbility('Illusion');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'slowstart':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Slow Start ended', 'good');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'perishsong': // for backwards compatibility\r\n\t\t\t\t\tpoke.removeVolatile('perish3' as ID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'substitute':\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Faded', 'bad');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'stockpile':\r\n\t\t\t\t\tpoke.removeVolatile('stockpile1' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('stockpile2' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('stockpile3' as ID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'protosynthesis':\r\n\t\t\t\t\tpoke.removeVolatile('protosynthesisatk' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('protosynthesisdef' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('protosynthesisspa' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('protosynthesisspd' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('protosynthesisspe' as ID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'quarkdrive':\r\n\t\t\t\t\tpoke.removeVolatile('quarkdriveatk' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('quarkdrivedef' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('quarkdrivespa' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('quarkdrivespd' as ID);\r\n\t\t\t\t\tpoke.removeVolatile('quarkdrivespe' as ID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (effect.effectType === 'Move') {\r\n\t\t\t\t\t\tif (effect.name === 'Doom Desire') {\r\n\t\t\t\t\t\t\tthis.scene.runOtherAnim('doomdesirehit' as ID, [poke]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (effect.name === 'Future Sight') {\r\n\t\t\t\t\t\t\tthis.scene.runOtherAnim('futuresighthit' as ID, [poke]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-singleturn': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tif (effect.id === 'roost' && !poke.getTypeList().includes('Flying')) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tpoke.addTurnstatus(effect.id);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'roost':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Landed', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'quickguard':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Quick Guard', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'wideguard':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Wide Guard', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'craftyshield':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Crafty Shield', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'matblock':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Mat Block', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'protect':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Protected', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'endure':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Enduring', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'helpinghand':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Helping Hand', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'focuspunch':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Focusing', 'neutral');\r\n\t\t\t\tpoke.rememberMove(effect.name, 0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'shelltrap':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Trap set', 'neutral');\r\n\t\t\t\tpoke.rememberMove(effect.name, 0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'beakblast':\r\n\t\t\t\tthis.scene.runOtherAnim('bidecharge' as ID, [poke]);\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Beak Blast', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-singlemove': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tpoke.addMovestatus(effect.id);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'grudge':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Grudge', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'destinybond':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Destiny Bond', 'neutral');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.scene.updateStatbar(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-activate': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tlet target = this.getPokemon(args[3]);\r\n\t\t\tthis.activateAbility(poke, effect);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'poltergeist':\r\n\t\t\t\tpoke.item = kwArgs.item;\r\n\t\t\t\tpoke.itemEffect = 'disturbed';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'symbiosis':\r\n\t\t\t\tpoke.item = '';\r\n\t\t\t\tpoke.itemEffect = '';\r\n\t\t\t\tpoke.prevItem = kwArgs.item;\r\n\t\t\t\tpoke.prevItemEffect = 'given away';\r\n\t\t\t\ttarget!.item = kwArgs.item;\r\n\t\t\t\ttarget!.itemEffect = 'shared';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grudge':\r\n\t\t\t\tpoke.rememberMove(kwArgs.move, Infinity);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'substitute':\r\n\t\t\t\tif (kwArgs.damage) {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Damage', 'bad');\r\n\t\t\t\t} else if (kwArgs.block) {\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Blocked', 'neutral');\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'attract':\r\n\t\t\t\tthis.scene.runStatusAnim('attracted' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bide':\r\n\t\t\t\tthis.scene.runOtherAnim('bidecharge' as ID, [poke]);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// move activations\r\n\t\t\tcase 'aromatherapy':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'healbell':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'brickbreak':\r\n\t\t\t\ttarget!.side.removeSideCondition('Reflect');\r\n\t\t\t\ttarget!.side.removeSideCondition('LightScreen');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hyperspacefury':\r\n\t\t\tcase 'hyperspacehole':\r\n\t\t\tcase 'phantomforce':\r\n\t\t\tcase 'shadowforce':\r\n\t\t\tcase 'feint':\r\n\t\t\t\tthis.scene.resultAnim(poke, 'Protection broken', 'bad');\r\n\t\t\t\tpoke.removeTurnstatus('protect' as ID);\r\n\t\t\t\tfor (const curTarget of poke.side.pokemon) {\r\n\t\t\t\t\tcurTarget.removeTurnstatus('wideguard' as ID);\r\n\t\t\t\t\tcurTarget.removeTurnstatus('quickguard' as ID);\r\n\t\t\t\t\tcurTarget.removeTurnstatus('craftyshield' as ID);\r\n\t\t\t\t\tcurTarget.removeTurnstatus('matblock' as ID);\r\n\t\t\t\t\tthis.scene.updateStatbar(curTarget);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'eeriespell':\r\n\t\t\tcase 'gmaxdepletion':\r\n\t\t\tcase 'spite':\r\n\t\t\t\tlet move = Dex.moves.get(kwArgs.move).name;\r\n\t\t\t\tlet pp = Number(kwArgs.number);\r\n\t\t\t\tif (isNaN(pp)) pp = 4;\r\n\t\t\t\tpoke.rememberMove(move, pp);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'gravity':\r\n\t\t\t\tpoke.removeVolatile('magnetrise' as ID);\r\n\t\t\t\tpoke.removeVolatile('telekinesis' as ID);\r\n\t\t\t\tthis.scene.anim(poke, { time: 100 });\r\n\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'skillswap':\r\n\t\t\t\tif (this.gen <= 4) break;\r\n\t\t\t\tif (target) {\r\n\t\t\t\t\t// Your rule: swapping effects swap BOTH ability slots\r\n\t\t\t\t\tpoke.swapAbilities(target);\r\n\r\n\t\t\t\t\tif (poke.side !== target.side) {\r\n\t\t\t\t\t\tthis.activateAbility(poke, poke.ability, true);\r\n\t\t\t\t\t\tthis.activateAbility(target, target.ability, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// ability activations\r\n\t\t\tcase 'electromorphosis':\r\n\t\t\tcase 'windpower':\r\n\t\t\t\tpoke.addMovestatus('charge' as ID);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'forewarn':\r\n\t\t\t\tif (target) {\r\n\t\t\t\t\ttarget.rememberMove(kwArgs.move, 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet foeActive = [] as Pokemon[];\r\n\t\t\t\t\tfor (const maybeTarget of poke.side.foe.active) {\r\n\t\t\t\t\t\tif (maybeTarget && !maybeTarget.fainted) foeActive.push(maybeTarget);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (foeActive.length === 1) {\r\n\t\t\t\t\t\tfoeActive[0].rememberMove(kwArgs.move, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'lingeringaroma':\r\n\t\t\tcase 'mummy':\r\n\t\t\tcase 'wanderingspirit':\r\n\t\t\t\tif (!kwArgs.ability) break; // if Mummy activated but failed, no ability will have been sent\r\n\t\t\t\tlet ability = Dex.abilities.get(kwArgs.ability);\r\n\t\t\t\tthis.activateAbility(target, ability.name);\r\n\t\t\t\tthis.activateAbility(poke, effect.name);\r\n\t\t\t\tthis.scene.wait(700);\r\n\t\t\t\tthis.activateAbility(target, effect.name, true);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// item activations\r\n\t\t\tcase 'leppaberry':\r\n\t\t\tcase 'mysteryberry':\r\n\t\t\t\tpoke.rememberMove(kwArgs.move, effect.id === 'leppaberry' ? -10 : -5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'focusband':\r\n\t\t\t\tpoke.item = 'Focus Band';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'quickclaw':\r\n\t\t\t\tpoke.item = 'Quick Claw';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'abilityshield':\r\n\t\t\t\tpoke.item = 'Ability Shield';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (kwArgs.broken) { // for custom moves that break protection\r\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Protection broken', 'bad');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-sidestart': {\r\n\t\t\tlet side = this.getSide(args[1]);\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tside.addSideCondition(effect, !!kwArgs.persistent);\r\n\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'tailwind':\r\n\t\t\tcase 'auroraveil':\r\n\t\t\tcase 'reflect':\r\n\t\t\tcase 'lightscreen':\r\n\t\t\tcase 'safeguard':\r\n\t\t\tcase 'mist':\r\n\t\t\tcase 'gmaxwildfire':\r\n\t\t\tcase 'gmaxvolcalith':\r\n\t\t\tcase 'gmaxvinelash':\r\n\t\t\tcase 'gmaxcannonade':\r\n\t\t\tcase 'grasspledge':\r\n\t\t\tcase 'firepledge':\r\n\t\t\tcase 'waterpledge':\r\n\t\t\t\tthis.scene.updateWeather();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-sideend': {\r\n\t\t\tlet side = this.getSide(args[1]);\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\t// let from = Dex.getEffect(kwArgs.from);\r\n\t\t\t// let ofpoke = this.getPokemon(kwArgs.of);\r\n\t\t\tside.removeSideCondition(effect.name);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-swapsideconditions': {\r\n\t\t\tthis.swapSideConditions();\r\n\t\t\tthis.scene.updateWeather();\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-weather': {\r\n\t\t\tlet effect = Dex.getEffect(args[1]);\r\n\t\t\tlet poke = this.getPokemon(kwArgs.of) || undefined;\r\n\t\t\tlet ability = Dex.getEffect(kwArgs.from);\r\n\t\t\tif (!effect.id || effect.id === 'none') {\r\n\t\t\t\tkwArgs.from = this.weather;\r\n\t\t\t}\r\n\t\t\tthis.changeWeather(effect.name, poke, !!kwArgs.upkeep, ability);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-fieldstart': {\r\n\t\t\tlet effect = Dex.getEffect(args[1]);\r\n\t\t\tlet poke = this.getPokemon(kwArgs.of);\r\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\r\n\t\t\tthis.activateAbility(poke, fromeffect);\r\n\t\t\tlet minTimeLeft = 5;\r\n\t\t\tlet maxTimeLeft = 0;\r\n\t\t\tif (effect.id.endsWith('terrain')) {\r\n\t\t\t\tfor (let i = this.pseudoWeather.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tlet pwID = toID(this.pseudoWeather[i][0]);\r\n\t\t\t\t\tif (pwID.endsWith('terrain')) {\r\n\t\t\t\t\t\tthis.pseudoWeather.splice(i, 1);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.gen > 6) maxTimeLeft = 8;\r\n\t\t\t}\r\n\t\t\tif (kwArgs.persistent) minTimeLeft += 2;\r\n\t\t\tthis.addPseudoWeather(effect.name, minTimeLeft, maxTimeLeft);\r\n\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'gravity':\r\n\t\t\t\tif (this.seeking !== null) break;\r\n\t\t\t\tfor (const active of this.getAllActive()) {\r\n\t\t\t\t\tthis.scene.runOtherAnim('gravity' as ID, [active]);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-fieldend': {\r\n\t\t\tlet effect = Dex.getEffect(args[1]);\r\n\t\t\t// let poke = this.getPokemon(kwArgs.of);\r\n\t\t\tthis.removePseudoWeather(effect.name);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-fieldactivate': {\r\n\t\t\tlet effect = Dex.getEffect(args[1]);\r\n\t\t\tswitch (effect.id) {\r\n\t\t\tcase 'perishsong':\r\n\t\t\t\tthis.scene.updateStatbars();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-anim': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet move = Dex.moves.get(args[2]);\r\n\t\t\tif (this.checkActive(poke)) return;\r\n\t\t\tlet poke2 = this.getPokemon(args[3]);\r\n\t\t\tthis.scene.beforeMove(poke);\r\n\t\t\tthis.animateMove(poke, move, poke2, kwArgs);\r\n\t\t\tthis.scene.afterMove(poke);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase '-hint': case '-message': case '-candynamax': {\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault: {\r\n\t\t\tthrow new Error(`Unrecognized minor action: ${args[0]}`);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t}\r\n\t}\r\n\t/*\r\n\tparseSpriteData(name) {\r\n\t\tlet siden = 0,\r\n\t\t\tfoe = false;\r\n\t\twhile (true) {\r\n\t\t\tif (name.substr(0, 6) === 'foeof-') {\r\n\t\t\t\tfoe = true;\r\n\t\t\t\tname = name.substr(6);\r\n\t\t\t} else if (name.substr(0, 9) === 'switched-') name = name.substr(9);\r\n\t\t\telse if (name.substr(0, 9) === 'existing-') name = name.substr(9);\r\n\t\t\telse if (name.substr(0, 4) === 'foe-') {\r\n\t\t\t\tsiden = this.p2.n;\r\n\t\t\t\tname = name.substr(4);\r\n\t\t\t} else if (name.substr(0, 5) === 'ally-') {\r\n\t\t\t\tsiden = this.p1.n;\r\n\t\t\t\tname = name.substr(5);\r\n\t\t\t} else break;\r\n\t\t}\r\n\t\tif (name.substr(name.length - 1) === ')') {\r\n\t\t\tlet parenIndex = name.lastIndexOf('(');\r\n\t\t\tif (parenIndex > 0) {\r\n\t\t\t\tlet species = name.substr(parenIndex + 1);\r\n\t\t\t\tname = species.substr(0, species.length - 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (foe) siden = (siden ? 0 : 1);\r\n\r\n\t\tlet data = Dex.species.get(name);\r\n\t\treturn data.spriteData[siden];\r\n\t}\r\n\t*/\r\n\t/**\r\n\t * @param name Leave blank for Team Preview\r\n\t * @param pokemonid Leave blank for Team Preview\r\n\t * @param details\r\n\t * @param output\r\n\t */\r\n\tparseDetails(name: string, pokemonid: string, details: string, output: PokemonDetails = {} as any) {\r\n\t\tconst isTeamPreview = !name;\r\n\t\toutput.details = details;\r\n\t\toutput.name = name;\r\n\t\toutput.speciesForme = name;\r\n\t\toutput.level = 100;\r\n\t\toutput.shiny = false;\r\n\t\toutput.gender = '';\r\n\t\toutput.ident = (!isTeamPreview ? pokemonid : '');\r\n\t\toutput.searchid = (!isTeamPreview ? `${pokemonid}|${details}` : '');\r\n\t\tlet splitDetails = details.split(', ');\r\n\t\tif (splitDetails[splitDetails.length - 1].startsWith('tera:')) {\r\n\t\t\toutput.terastallized = splitDetails[splitDetails.length - 1].slice(5);\r\n\t\t\tsplitDetails.pop();\r\n\t\t}\r\n\t\tif (splitDetails[splitDetails.length - 1] === 'shiny') {\r\n\t\t\toutput.shiny = true;\r\n\t\t\tsplitDetails.pop();\r\n\t\t}\r\n\t\tif (splitDetails[splitDetails.length - 1] === 'M' || splitDetails[splitDetails.length - 1] === 'F') {\r\n\t\t\toutput.gender = splitDetails[splitDetails.length - 1] as Dex.GenderName;\r\n\t\t\tsplitDetails.pop();\r\n\t\t}\r\n\t\tif (splitDetails[1]) {\r\n\t\t\toutput.level = parseInt(splitDetails[1].substr(1), 10) || 100;\r\n\t\t}\r\n\t\tif (splitDetails[0]) {\r\n\t\t\toutput.speciesForme = splitDetails[0];\r\n\t\t}\r\n\t\treturn output;\r\n\t}\r\n\tparseHealth(hpstring: string, output: PokemonHealth = {} as any) {\r\n\t\tlet [hp, status] = hpstring.split(' ');\r\n\r\n\t\t// hp parse\r\n\t\toutput.hpcolor = '';\r\n\t\tif (hp === '0' || hp === '0.0') {\r\n\t\t\tif (!output.maxhp) output.maxhp = 100;\r\n\t\t\toutput.hp = 0;\r\n\t\t} else if (hp.indexOf('/') > 0) {\r\n\t\t\tlet [curhp, maxhp] = hp.split('/');\r\n\t\t\tif (isNaN(parseFloat(curhp)) || isNaN(parseFloat(maxhp))) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\toutput.hp = parseFloat(curhp);\r\n\t\t\toutput.maxhp = parseFloat(maxhp);\r\n\t\t\tif (output.hp > output.maxhp) output.hp = output.maxhp;\r\n\t\t\tconst colorchar = maxhp.slice(-1);\r\n\t\t\tif (colorchar === 'r' || colorchar === 'y' || colorchar === 'g') {\r\n\t\t\t\toutput.hpcolor = colorchar;\r\n\t\t\t}\r\n\t\t} else if (!isNaN(parseFloat(hp))) {\r\n\t\t\tif (!output.maxhp) output.maxhp = 100;\r\n\t\t\toutput.hp = output.maxhp * parseFloat(hp) / 100;\r\n\t\t}\r\n\r\n\t\t// status parse\r\n\t\tif (!status) {\r\n\t\t\toutput.status = '';\r\n\t\t} else if (status === 'par' || status === 'brn' || status === 'slp' || status === 'frz' || status === 'tox') {\r\n\t\t\toutput.status = status;\r\n\t\t} else if (status === 'psn' && output.status !== 'tox') {\r\n\t\t\toutput.status = status;\r\n\t\t} else if (status === 'fnt') {\r\n\t\t\toutput.hp = 0;\r\n\t\t\toutput.fainted = true;\r\n\t\t}\r\n\t\treturn output;\r\n\t}\r\n\tparsePokemonId(pokemonid: string) {\r\n\t\tlet name = pokemonid;\r\n\r\n\t\tlet siden = -1;\r\n\t\tlet slot = -1; // if there is an explicit slot for this pokemon\r\n\t\tif (/^p[1-9]($|: )/.test(name)) {\r\n\t\t\tsiden = parseInt(name.charAt(1), 10) - 1;\r\n\t\t\tname = name.slice(4);\r\n\t\t} else if (/^p[1-9][a-f]: /.test(name)) {\r\n\t\t\tconst slotChart: { [k: string]: number } = { a: 0, b: 1, c: 2, d: 3, e: 4, f: 5 };\r\n\t\t\tsiden = parseInt(name.charAt(1), 10) - 1;\r\n\t\t\tslot = slotChart[name.charAt(2)];\r\n\t\t\tname = name.slice(5);\r\n\t\t\tpokemonid = `p${siden + 1}: ${name}`;\r\n\t\t}\r\n\t\treturn { name, siden, slot, pokemonid };\r\n\t}\r\n\tgetSwitchedPokemon(pokemonid: string, details: string) {\r\n\t\tif (pokemonid === '??') throw new Error(`pokemonid not passed`);\r\n\t\tconst { name, siden, slot, pokemonid: parsedPokemonid } = this.parsePokemonId(pokemonid);\r\n\t\tpokemonid = parsedPokemonid;\r\n\r\n\t\tconst searchid = `${pokemonid}|${details}`;\r\n\t\tconst side = this.sides[siden];\r\n\r\n\t\t// search inactive revealed pokemon\r\n\t\tfor (let i = 0; i < side.pokemon.length; i++) {\r\n\t\t\tlet pokemon = side.pokemon[i];\r\n\t\t\tif (pokemon.fainted) continue;\r\n\t\t\t// already active, can't be switching in\r\n\t\t\tif (side.active.includes(pokemon)) continue;\r\n\t\t\t// just switched out, can't be switching in\r\n\t\t\tif (pokemon === side.lastPokemon && !side.active[slot]) continue;\r\n\r\n\t\t\tif (pokemon.searchid === searchid) {\r\n\t\t\t\t// exact match\r\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\r\n\t\t\t\treturn pokemon;\r\n\t\t\t}\r\n\t\t\tif (!pokemon.searchid && pokemon.checkDetails(details)) {\r\n\t\t\t\t// switch-in matches Team Preview entry\r\n\t\t\t\tpokemon = side.addPokemon(name, pokemonid, details, i);\r\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\r\n\t\t\t\treturn pokemon;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// pokemon not found, create a new pokemon object for it\r\n\t\tconst pokemon = side.addPokemon(name, pokemonid, details);\r\n\t\tif (slot >= 0) pokemon.slot = slot;\r\n\t\treturn pokemon;\r\n\t}\r\n\trememberTeamPreviewPokemon(sideid: string, details: string) {\r\n\t\tconst { siden } = this.parsePokemonId(sideid);\r\n\r\n\t\treturn this.sides[siden].addPokemon('', '', details);\r\n\t}\r\n\tfindCorrespondingPokemon(serverPokemon: { ident: string, details: string }) {\r\n\t\tconst { siden } = this.parsePokemonId(serverPokemon.ident);\r\n\t\tconst searchid = `${serverPokemon.ident}|${serverPokemon.details}`;\r\n\t\tfor (const pokemon of this.sides[siden].pokemon) {\r\n\t\t\tif (pokemon.searchid === searchid) {\r\n\t\t\t\treturn pokemon;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tgetPokemon(pokemonid: string | undefined, faintedOnly = false) {\r\n\t\tif (!pokemonid || pokemonid === '??' || pokemonid === 'null' || pokemonid === 'false') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst { siden, slot, pokemonid: parsedPokemonid } = this.parsePokemonId(pokemonid);\r\n\t\tpokemonid = parsedPokemonid;\r\n\r\n\t\t/** if true, don't match an active pokemon */\r\n\t\tconst isInactive = (slot < 0);\r\n\t\tconst side = this.sides[siden];\r\n\r\n\t\t// search player's pokemon\r\n\t\tif (!isInactive && side.active[slot]) return side.active[slot];\r\n\r\n\t\tfor (const pokemon of side.pokemon) {\r\n\t\t\tif (isInactive && !this.compatMode && side.active.includes(pokemon)) continue;\r\n\t\t\tif (faintedOnly && pokemon.hp) continue;\r\n\t\t\tif (pokemon.ident === pokemonid) { // name matched, good enough\r\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\r\n\t\t\t\treturn pokemon;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\tgetSide(sidename: string): Side {\r\n\t\tif (sidename === 'p1' || sidename.startsWith('p1:')) return this.p1;\r\n\t\tif (sidename === 'p2' || sidename.startsWith('p2:')) return this.p2;\r\n\t\tif ((sidename === 'p3' || sidename.startsWith('p3:')) && this.p3) return this.p3;\r\n\t\tif ((sidename === 'p4' || sidename.startsWith('p4:')) && this.p4) return this.p4;\r\n\t\tif (this.nearSide.id === sidename) return this.nearSide;\r\n\t\tif (this.farSide.id === sidename) return this.farSide;\r\n\t\tif (this.nearSide.name === sidename) return this.nearSide;\r\n\t\tif (this.farSide.name === sidename) return this.farSide;\r\n\t\treturn {\r\n\t\t\tname: sidename,\r\n\t\t\tid: sidename.replace(/ /g, ''),\r\n\t\t} as any;\r\n\t}\r\n\r\n\tadd(command?: string) {\r\n\t\tif (command) this.stepQueue.push(command);\r\n\r\n\t\tif (this.atQueueEnd && this.currentStep < this.stepQueue.length) {\r\n\t\t\tthis.atQueueEnd = false;\r\n\t\t\tthis.nextStep();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * PS's preempt system is intended to show chat messages immediately,\r\n\t * instead of waiting for the battle to get to the point where the\r\n\t * message was said.\r\n\t *\r\n\t * In addition to being a nice quality-of-life feature, it's also\r\n\t * important to make sure timer updates happen in real-time.\r\n\t */\r\n\tinstantAdd(command: string) {\r\n\t\tthis.run(command, true);\r\n\t\tthis.preemptStepQueue.push(command);\r\n\t\tthis.add(command);\r\n\t}\r\n\trunMajor(args: Args, kwArgs: KWArgs, preempt?: boolean) {\r\n\t\tswitch (args[0]) {\r\n\t\tcase 'start': {\r\n\t\t\tthis.nearSide.active[0] = null;\r\n\t\t\tthis.farSide.active[0] = null;\r\n\t\t\tthis.scene.resetSides();\r\n\t\t\tthis.start();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'upkeep': {\r\n\t\t\tthis.usesUpkeep = true;\r\n\t\t\tthis.updateTurnCounters();\r\n\t\t\t// Prevents getSwitchedPokemon from skipping over a Pokemon that switched out mid turn (e.g. U-turn)\r\n\t\t\tfor (const side of this.sides) {\r\n\t\t\t\tside.lastPokemon = null;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'turn': {\r\n\t\t\tthis.setTurn(parseInt(args[1], 10));\r\n\t\t\tthis.log(args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'tier': {\r\n\t\t\tthis.tier = args[1];\r\n\t\t\tif (this.tier.endsWith('Random Battle')) {\r\n\t\t\t\tthis.speciesClause = true;\r\n\t\t\t}\r\n\t\t\tif (this.tier.endsWith(' (Blitz)')) {\r\n\t\t\t\tthis.messageFadeTime = 40;\r\n\t\t\t\tthis.isBlitz = true;\r\n\t\t\t}\r\n\t\t\tif (this.tier.includes(`Let's Go`)) {\r\n\t\t\t\tthis.dex = Dex.mod('gen7letsgo' as ID);\r\n\t\t\t}\r\n\t\t\tif (this.tier.includes('Super Staff Bros')) {\r\n\t\t\t\tthis.dex = Dex.mod('gen9ssb' as ID);\r\n\t\t\t}\r\n\t\t\tif (\r\n  \t\t\tthis.tier.includes('Indigo Starstorm') ||\r\n  \t\t\tthis.tier.includes('ISL Regulation Set')\r\n\t\t\t) {\r\n  \t\t\tthis.dex = Dex.mod('gen9indigostarstorm' as ID);\r\n\t\t\t}\r\n\t\t\tthis.log(args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'gametype': {\r\n\t\t\tthis.gameType = args[1] as any;\r\n\t\t\tthis.compatMode = false;\r\n\t\t\tswitch (args[1]) {\r\n\t\t\tcase 'multi':\r\n\t\t\tcase 'freeforall':\r\n\t\t\t\tthis.pokemonControlled = 1;\r\n\t\t\t\tif (!this.p3) this.p3 = new Side(this, 2);\r\n\t\t\t\tif (!this.p4) this.p4 = new Side(this, 3);\r\n\t\t\t\tthis.p3.foe = this.p2;\r\n\t\t\t\tthis.p4.foe = this.p1;\r\n\r\n\t\t\t\tif (args[1] === 'multi') {\r\n\t\t\t\t\tthis.p4.ally = this.p2;\r\n\t\t\t\t\tthis.p3.ally = this.p1;\r\n\t\t\t\t\tthis.p1.ally = this.p3;\r\n\t\t\t\t\tthis.p2.ally = this.p4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.p3.isFar = this.p1.isFar;\r\n\t\t\t\tthis.p4.isFar = this.p2.isFar;\r\n\t\t\t\tthis.sides = [this.p1, this.p2, this.p3, this.p4];\r\n\t\t\t\t// intentionally sync p1/p3 and p2/p4's active arrays\r\n\t\t\t\tthis.p1.active = this.p3.active = [null, null];\r\n\t\t\t\tthis.p2.active = this.p4.active = [null, null];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'doubles':\r\n\t\t\t\tthis.nearSide.active = [null, null];\r\n\t\t\t\tthis.farSide.active = [null, null];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'triples':\r\n\t\t\tcase 'rotation':\r\n\t\t\t\tthis.nearSide.active = [null, null, null];\r\n\t\t\t\tthis.farSide.active = [null, null, null];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tfor (const side of this.sides) side.active = [null];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!this.pokemonControlled) this.pokemonControlled = this.nearSide.active.length;\r\n\t\t\tthis.scene.updateGen();\r\n\t\t\tthis.scene.resetSides();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'rule': {\r\n\t\t\tlet ruleName = args[1].split(': ')[0];\r\n\t\t\tif (ruleName === 'Species Clause') this.speciesClause = true;\r\n\t\t\tif (ruleName === 'Blitz') {\r\n\t\t\t\tthis.messageFadeTime = 40;\r\n\t\t\t\tthis.isBlitz = true;\r\n\t\t\t}\r\n\t\t\tif (ruleName === 'Exact HP Mod') this.reportExactHP = true;\r\n\t\t\tthis.rules[ruleName] = 1;\r\n\t\t\tthis.log(args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'rated': {\r\n\t\t\tthis.rated = args[1] || true;\r\n\t\t\tthis.scene.updateGen();\r\n\t\t\tthis.log(args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'inactive': {\r\n\t\t\tif (!this.kickingInactive) this.kickingInactive = true;\r\n\t\t\tif (args[1].startsWith(\"Time left: \")) {\r\n\t\t\t\tlet [time, totalTime, graceTime] = args[1].split(' | ');\r\n\t\t\t\tthis.kickingInactive = parseInt(time.slice(11), 10) || true;\r\n\t\t\t\tthis.totalTimeLeft = parseInt(totalTime, 10);\r\n\t\t\t\tthis.graceTimeLeft = parseInt(graceTime || '', 10) || 0;\r\n\t\t\t\tif (this.totalTimeLeft === this.kickingInactive) this.totalTimeLeft = 0;\r\n\t\t\t\treturn;\r\n\t\t\t} else if (args[1].startsWith(\"You have \")) {\r\n\t\t\t\t// this is ugly but parseInt is documented to work this way\r\n\t\t\t\t// so I'm going to be lazy and not chop off the rest of the\r\n\t\t\t\t// sentence\r\n\t\t\t\tthis.kickingInactive = parseInt(args[1].slice(9), 10) || true;\r\n\t\t\t\treturn;\r\n\t\t\t} else if (args[1].endsWith(' seconds left.')) {\r\n\t\t\t\tlet hasIndex = args[1].indexOf(' has ');\r\n\t\t\t\tlet userid = window.app?.user?.get('userid') || window.PS?.user.userid;\r\n\t\t\t\tif (toID(args[1].slice(0, hasIndex)) === userid) {\r\n\t\t\t\t\tthis.kickingInactive = parseInt(args[1].slice(hasIndex + 5), 10) || true;\r\n\t\t\t\t}\r\n\t\t\t} else if (args[1].endsWith(' 15 seconds left this turn.')) {\r\n\t\t\t\tif (this.isBlitz) return;\r\n\t\t\t}\r\n\t\t\tthis.log(args, undefined, preempt);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'inactiveoff': {\r\n\t\t\tthis.kickingInactive = false;\r\n\t\t\tthis.log(args, undefined, preempt);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'join': case 'j': case 'J': {\r\n\t\t\tif (this.roomid) {\r\n\t\t\t\tlet room = app!.rooms[this.roomid];\r\n\t\t\t\tlet user = BattleTextParser.parseNameParts(args[1]);\r\n\t\t\t\tlet userid = toUserid(user.name);\r\n\t\t\t\tif (!room.users[userid]) room.userCount.users++;\r\n\t\t\t\troom.users[userid] = user;\r\n\t\t\t\troom.userList.add(userid);\r\n\t\t\t\troom.userList.updateUserCount();\r\n\t\t\t\troom.userList.updateNoUsersOnline();\r\n\t\t\t}\r\n\t\t\tthis.log(args, undefined, preempt);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'leave': case 'l': case 'L': {\r\n\t\t\tif (this.roomid) {\r\n\t\t\t\tlet room = app!.rooms[this.roomid];\r\n\t\t\t\tlet user = args[1];\r\n\t\t\t\tlet userid = toUserid(user);\r\n\t\t\t\tif (room.users[userid]) room.userCount.users--;\r\n\t\t\t\tdelete room.users[userid];\r\n\t\t\t\troom.userList.remove(userid);\r\n\t\t\t\troom.userList.updateUserCount();\r\n\t\t\t\troom.userList.updateNoUsersOnline();\r\n\t\t\t}\r\n\t\t\tthis.log(args, undefined, preempt);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'name': case 'n': case 'N': {\r\n\t\t\tif (this.roomid) {\r\n\t\t\t\tlet room = app!.rooms[this.roomid];\r\n\t\t\t\tlet user = BattleTextParser.parseNameParts(args[1]);\r\n\t\t\t\tlet oldid = args[2];\r\n\t\t\t\tif (toUserid(oldid) === app!.user.get('userid')) {\r\n\t\t\t\t\tapp!.user.set({\r\n\t\t\t\t\t\taway: user.away,\r\n\t\t\t\t\t\tstatus: user.status,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tlet userid = toUserid(user.name);\r\n\t\t\t\troom.users[userid] = user;\r\n\t\t\t\troom.userList.remove(oldid);\r\n\t\t\t\troom.userList.add(userid);\r\n\t\t\t}\r\n\t\t\tif (!this.ignoreSpects) {\r\n\t\t\t\tthis.log(args, undefined, preempt);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'player': {\r\n\t\t\tlet side = this.getSide(args[1]);\r\n\t\t\tside.setName(args[2]);\r\n\t\t\tif (args[3]) side.setAvatar(args[3]);\r\n\t\t\tif (args[4]) side.rating = args[4];\r\n\t\t\tif (this.joinButtons) this.scene.hideJoinButtons();\r\n\t\t\tthis.log(args);\r\n\t\t\tthis.scene.updateSidebar(side);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'badge': {\r\n\t\t\tlet side = this.getSide(args[1]);\r\n\t\t\t// handle all the rendering further down\r\n\t\t\tconst badge = args.slice(2).join('|');\r\n\t\t\t// (don't allow duping)\r\n\t\t\tif (!side.badges.includes(badge)) side.badges.push(badge);\r\n\t\t\tthis.scene.updateSidebar(side);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'teamsize': {\r\n\t\t\tlet side = this.getSide(args[1]);\r\n\t\t\tside.totalPokemon = parseInt(args[2], 10);\r\n\t\t\tthis.scene.updateSidebar(side);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'win': case 'tie': {\r\n\t\t\tthis.winner(args[0] === 'tie' ? undefined : args[1]);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'prematureend': {\r\n\t\t\tthis.prematureEnd();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'clearpoke': {\r\n\t\t\tthis.p1.clearPokemon();\r\n\t\t\tthis.p2.clearPokemon();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'poke': {\r\n\t\t\tlet pokemon = this.rememberTeamPreviewPokemon(args[1], args[2]);\r\n\t\t\tif (args[3] === 'mail') {\r\n\t\t\t\tpokemon.item = '(mail)';\r\n\t\t\t} else if (args[3] === 'item') {\r\n\t\t\t\tpokemon.item = '(exists)';\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'updatepoke': {\r\n\t\t\tconst { siden } = this.parsePokemonId(args[1]);\r\n\t\t\tconst side = this.sides[siden];\r\n\t\t\tfor (let i = 0; i < side.pokemon.length; i++) {\r\n\t\t\t\tconst pokemon = side.pokemon[i];\r\n\t\t\t\tif (pokemon.details !== args[2] && pokemon.checkDetails(args[2])) {\r\n\t\t\t\t\tside.addPokemon('', '', args[2], i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'teampreview': {\r\n\t\t\tthis.teamPreviewCount = parseInt(args[1], 10);\r\n\t\t\tthis.scene.teamPreview();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'showteam': {\r\n\t\t\tconst team = Teams.unpack(args[2]);\r\n\t\t\tif (!team.length) return;\r\n\t\t\tconst side = this.getSide(args[1]);\r\n\t\t\tside.clearPokemon();\r\n\t\t\tfor (const set of team) {\r\n\t\t\t\tconst details = set.species + (!set.level || set.level === 100 ? '' : `, L${set.level}`) +\r\n\t\t\t\t\t(!set.gender || set.gender === 'N' ? '' : `, ${set.gender}`) + (set.shiny ? ', shiny' : '');\r\n\t\t\t\tconst pokemon = side.addPokemon('', '', details);\r\n\t\t\t\tif (set.item) pokemon.item = set.item;\r\n\t\t\t\tif (set.ability) pokemon.rememberAbility(set.ability);\r\n\t\t\t\tfor (const move of set.moves) {\r\n\t\t\t\t\tpokemon.rememberMove(move, 0);\r\n\t\t\t\t}\r\n\t\t\t\tif (set.teraType) pokemon.teraType = set.teraType;\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'switch': case 'drag': case 'replace': {\r\n\t\t\tthis.endLastTurn();\r\n\t\t\tlet poke = this.getSwitchedPokemon(args[1], args[2]);\r\n\t\t\tlet slot = poke.slot;\r\n\t\t\tpoke.healthParse(args[3]);\r\n\t\t\tpoke.removeVolatile('itemremoved' as ID);\r\n\t\t\tpoke.terastallized = (/tera:([a-z]+)$/i.exec(args[2]))?.[1] || '';\r\n\t\t\tif (args[0] === 'switch') {\r\n\t\t\t\tif (poke.side.active[slot]) {\r\n\t\t\t\t\tpoke.side.switchOut(poke.side.active[slot], kwArgs);\r\n\t\t\t\t}\r\n\t\t\t\tpoke.side.switchIn(poke, kwArgs);\r\n\t\t\t} else if (args[0] === 'replace') {\r\n\t\t\t\tpoke.side.replace(poke);\r\n\t\t\t} else {\r\n\t\t\t\tpoke.side.dragIn(poke);\r\n\t\t\t}\r\n\t\t\tthis.scene.updateWeather();\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'faint': {\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tpoke.side.faint(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'swap': {\r\n\t\t\tif (isNaN(Number(args[2]))) {\r\n\t\t\t\tconst poke = this.getPokemon(args[1])!;\r\n\t\t\t\tpoke.side.swapWith(poke, this.getPokemon(args[2])!, kwArgs);\r\n\t\t\t} else {\r\n\t\t\t\tconst poke = this.getPokemon(args[1])!;\r\n\t\t\t\tconst targetIndex = parseInt(args[2], 10);\r\n\t\t\t\tif (kwArgs.from) {\r\n\t\t\t\t\tconst target = poke.side.active[targetIndex];\r\n\t\t\t\t\tif (target) args[2] = target.ident;\r\n\t\t\t\t}\r\n\t\t\t\tpoke.side.swapTo(poke, targetIndex);\r\n\t\t\t}\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'move': {\r\n\t\t\tthis.endLastTurn();\r\n\t\t\tthis.resetTurnsSinceMoved();\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet move = Dex.moves.get(args[2]);\r\n\t\t\tif (this.checkActive(poke)) return;\r\n\t\t\tlet poke2 = this.getPokemon(args[3]);\r\n\t\t\tthis.scene.beforeMove(poke);\r\n\t\t\tthis.useMove(poke, move, poke2, kwArgs);\r\n\t\t\tthis.animateMove(poke, move, poke2, kwArgs);\r\n\t\t\tthis.scene.afterMove(poke);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'cant': {\r\n\t\t\tthis.endLastTurn();\r\n\t\t\tthis.resetTurnsSinceMoved();\r\n\t\t\tlet poke = this.getPokemon(args[1])!;\r\n\t\t\tlet effect = Dex.getEffect(args[2]);\r\n\t\t\tlet move = Dex.moves.get(args[3]);\r\n\t\t\tthis.cantUseMove(poke, effect, move, kwArgs);\r\n\t\t\tthis.log(args, kwArgs);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'gen': {\r\n\t\t\tthis.gen = parseInt(args[1], 10);\r\n\t\t\tthis.dex = Dex.forGen(this.gen);\r\n\t\t\tthis.scene.updateGen();\r\n\t\t\tthis.log(args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'callback': {\r\n\t\t\tthis.subscription?.('callback');\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'fieldhtml': {\r\n\t\t\tthis.scene.setFrameHTML(BattleLog.sanitizeHTML(args[1]));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'controlshtml': {\r\n\t\t\tthis.scene.setControlsHTML(BattleLog.sanitizeHTML(args[1]));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'custom': {\r\n\t\t\t// Style is always |custom|-subprotocol|pokemon|additional info\r\n\t\t\tif (args[1] === '-endterastallize') {\r\n\t\t\t\tlet poke = this.getPokemon(args[2])!;\r\n\t\t\t\tpoke.removeVolatile('terastallize' as ID);\r\n\t\t\t\tpoke.teraType = '';\r\n\t\t\t\tpoke.terastallized = '';\r\n\t\t\t\tpoke.details = poke.details.replace(/, tera:[a-z]+/i, '');\r\n\t\t\t\tpoke.searchid = poke.searchid.replace(/, tera:[a-z]+/i, '');\r\n\t\t\t\tthis.scene.animTransform(poke);\r\n\t\t\t\tthis.scene.resetStatbar(poke);\r\n\t\t\t\tthis.log(args, kwArgs);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault: {\r\n\t\t\tthis.log(args, kwArgs, preempt);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trun(str: string, preempt?: boolean) {\r\n\t\tif (!preempt && this.preemptStepQueue.length && str === this.preemptStepQueue[0]) {\r\n\t\t\tthis.preemptStepQueue.shift();\r\n\t\t\tthis.scene.preemptCatchup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!str) return;\r\n\t\tconst { args, kwArgs } = BattleTextParser.parseBattleLine(str);\r\n\r\n\t\tif (this.scene.maybeCloseMessagebar(args, kwArgs)) {\r\n\t\t\tthis.currentStep--;\r\n\t\t\tthis.activeMoveIsSpread = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// parse the next line if it's a minor: runMinor needs it parsed to determine when to merge minors\r\n\t\tlet nextArgs: Args = [''];\r\n\t\tlet nextKwargs: KWArgs = {};\r\n\t\tconst nextLine = this.stepQueue[this.currentStep + 1] || '';\r\n\t\tif (nextLine.startsWith('|-')) {\r\n\t\t\t({ args: nextArgs, kwArgs: nextKwargs } = BattleTextParser.parseBattleLine(nextLine));\r\n\t\t}\r\n\r\n\t\tif (this.debug) {\r\n\t\t\tif (args[0].startsWith('-') || args[0] === 'detailschange') {\r\n\t\t\t\tthis.runMinor(args, kwArgs, nextArgs, nextKwargs);\r\n\t\t\t} else {\r\n\t\t\t\tthis.runMajor(args, kwArgs, preempt);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tif (args[0].startsWith('-') || args[0] === 'detailschange') {\r\n\t\t\t\t\tthis.runMinor(args, kwArgs, nextArgs, nextKwargs);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.runMajor(args, kwArgs, preempt);\r\n\t\t\t\t}\r\n\t\t\t} catch (err: any) {\r\n\t\t\t\tthis.log(['majorerror', 'Error parsing: ' + str + ' (' + err + ')']);\r\n\t\t\t\tif (err.stack) {\r\n\t\t\t\t\tlet stack = ('' + err.stack).split('\\n');\r\n\t\t\t\t\tfor (const line of stack) {\r\n\t\t\t\t\t\tif (/\\brun\\b/.test(line)) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.log(['error', line]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.subscription?.('error');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (nextLine.startsWith('|start') || args[0] === 'teampreview') {\r\n\t\t\tif (this.turn === -1) {\r\n\t\t\t\tthis.turn = 0;\r\n\t\t\t\tthis.scene.updateBgm();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcheckActive(poke: Pokemon) {\r\n\t\tif (!poke.side.active[poke.slot]) {\r\n\t\t\t// SOMEONE jumped in in the middle of a replay. <_<\r\n\t\t\tpoke.side.replace(poke);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpause() {\r\n\t\tthis.paused = true;\r\n\t\tthis.scene.pause();\r\n\t\tthis.subscription?.('paused');\r\n\t}\r\n\t/**\r\n\t * Properties relevant to battle playback, for replay UI implementers:\r\n\t * - `ended`: has the game ended in a win/loss?\r\n\t * - `atQueueEnd`: is animation caught up to the end of the battle queue, waiting for more input?\r\n\t * - `seeking`: are we trying to skip to a specific turn\r\n\t * - `turn`: what turn are we currently on? `-1` if we haven't started yet, `0` at team preview\r\n\t * - `paused`: are we playing at all?\r\n\t */\r\n\tplay() {\r\n\t\tthis.paused = false;\r\n\t\tthis.started = true;\r\n\t\tthis.scene.resume();\r\n\t\tthis.nextStep();\r\n\t\tthis.subscription?.('playing');\r\n\t}\r\n\tskipTurn() {\r\n\t\tthis.seekBy(1);\r\n\t}\r\n\tseekBy(deltaTurn: number) {\r\n\t\tif (this.seeking === Infinity && deltaTurn < 0) {\r\n\t\t\treturn this.seekTurn(this.turn + 1);\r\n\t\t}\r\n\t\tthis.seekTurn((this.seeking ?? this.turn) + deltaTurn);\r\n\t}\r\n\tseekTurn(turn: number, forceReset?: boolean) {\r\n\t\tif (isNaN(turn)) return;\r\n\t\tturn = Math.max(Math.floor(turn), 0);\r\n\r\n\t\tif (this.seeking !== null && turn > this.turn && !forceReset) {\r\n\t\t\tthis.seeking = turn;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (turn === 0) {\r\n\t\t\tthis.seeking = null;\r\n\t\t\tthis.resetStep();\r\n\t\t\tthis.scene.animationOn();\r\n\t\t\tif (this.paused) this.subscription?.('paused');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.seeking = turn;\r\n\r\n\t\tif (turn <= this.turn || forceReset) {\r\n\t\t\tthis.scene.animationOff();\r\n\t\t\tthis.resetStep();\r\n\t\t} else if (this.atQueueEnd) {\r\n\t\t\tthis.scene.animationOn();\r\n\t\t\tthis.seeking = null;\r\n\t\t} else {\r\n\t\t\tthis.scene.animationOff();\r\n\t\t\tthis.nextStep();\r\n\t\t}\r\n\t}\r\n\tstopSeeking() {\r\n\t\tthis.seeking = null;\r\n\t\tthis.scene.animationOn();\r\n\t\tthis.subscription?.(this.paused ? 'paused' : 'playing');\r\n\t}\r\n\tshouldStep() {\r\n\t\tif (this.atQueueEnd) return false;\r\n\t\tif (this.seeking !== null) return true;\r\n\t\treturn !(this.paused && this.turn >= 0);\r\n\t}\r\n\tnextStep() {\r\n\t\tif (!this.shouldStep()) return;\r\n\r\n\t\tlet time = Date.now();\r\n\t\tthis.scene.startAnimations();\r\n\t\tlet animations = undefined;\r\n\r\n\t\tlet interruptionCount: number;\r\n\t\tdo {\r\n\t\t\t// modified in this.run() but idk how to tell TS that\r\n\t\t\tthis.waitForAnimations = true as this['waitForAnimations'];\r\n\t\t\tif (this.currentStep >= this.stepQueue.length) {\r\n\t\t\t\tthis.atQueueEnd = true;\r\n\t\t\t\tif (!this.ended && this.isReplay) this.prematureEnd();\r\n\t\t\t\tthis.stopSeeking();\r\n\t\t\t\tif (this.ended) {\r\n\t\t\t\t\tthis.scene.updateBgm();\r\n\t\t\t\t}\r\n\t\t\t\tthis.subscription?.('atqueueend');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.run(this.stepQueue[this.currentStep]);\r\n\t\t\tthis.currentStep++;\r\n\t\t\tif (this.waitForAnimations === true) {\r\n\t\t\t\tanimations = this.scene.finishAnimations();\r\n\t\t\t} else if (this.waitForAnimations === 'simult') {\r\n\t\t\t\tthis.scene.timeOffset = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (Date.now() - time > 300) {\r\n\t\t\t\tinterruptionCount = this.scene.interruptionCount;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (interruptionCount === this.scene.interruptionCount) {\r\n\t\t\t\t\t\tthis.nextStep();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} while (!animations && this.shouldStep());\r\n\r\n\t\tif (this.paused && this.turn >= 0 && this.seeking === null) {\r\n\t\t\t// initial Play button, team preview\r\n\t\t\tthis.scene.pause();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!animations) return;\r\n\r\n\t\tinterruptionCount = this.scene.interruptionCount;\r\n\t\tanimations.done(() => {\r\n\t\t\tif (interruptionCount === this.scene.interruptionCount) {\r\n\t\t\t\tthis.nextStep();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsetQueue(queue: string[]) {\r\n\t\tthis.stepQueue = queue;\r\n\t\tthis.resetStep();\r\n\t}\r\n\r\n\tsetMute(mute: boolean) {\r\n\t\tthis.scene.setMute(mute);\r\n\t}\r\n}\r\n\r\ndeclare const require: any;\r\ndeclare const global: any;\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\tglobal.Battle = Battle;\r\n\tglobal.Pokemon = Pokemon;\r\n}\r\n"],"mappings":"aAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA3BA;;;;;;;;;;;;;;;;AA2CaA,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEnB,SAAAA,QAAYC,IAAoB,CAAEC,IAAU,CAAE,MAxE9CC,IAAI,CAAG,EAAE,MACTC,YAAY,CAAG,EAAE,MAWjBC,KAAK,CAAG,EAAE,MAaVC,OAAO,CAAG,EAAE,MAOZC,QAAQ,CAAG,EAAE,MAEbL,IAAI,aACJM,IAAI,CAAG,CAAC,MAERC,OAAO,CAAG,KAAK,MACfC,EAAE,CAAG,CAAC,MACNC,KAAK,CAAG,IAAI,MACZC,KAAK,CAAG,GAAG,MACXC,MAAM,CAAmB,GAAG,MAC5BC,KAAK,CAAG,KAAK,MAEbC,OAAO,CAAY,GAAG,MACtBC,KAAK,CAAa,EAAE,MACpBC,OAAO,CAAG,EAAE,MACZC,WAAW,CAAG,EAAE,MAChBC,QAAQ,CAAG,EAAE,MACbC,YAAY,CAAG,EAAE,MACjBC,IAAI,CAAG,EAAE,MACTC,UAAU,CAAG,EAAE,MACfC,QAAQ,CAAG,EAAE,MACbC,cAAc,CAAG,EAAE,MACnBC,aAAa,CAAG,EAAE,MAClBC,QAAQ,CAAG,EAAE,MAEbC,MAAM,CAA+B,CAAC,CAAC,MACvCC,MAAM,CAAwC,EAAE,MAChDC,WAAW,CAAG,CAAC,MACfC,SAAS,CAAwC,CAAC,CAAC,MACnDC,YAAY,CAAwC,CAAC,CAAC,MACtDC,YAAY,CAAwC,CAAC,CAAC,MACtDC,QAAQ,CAAG,EAAE,MAGbC,SAAS,CAAuB,EAAE,MAClCC,UAAU,CAAG,CAAEC,UAAU,CAAE,CAAC,CAAEC,UAAU,CAAE,CAAE,CAAC,MAC7CC,aAAa,CAAG,CAAC,MAEjBC,MAAM;AAGL,IAAI,CAACrC,IAAI,CAAGA,IAAI;AAChB,IAAI,CAACE,YAAY,CAAGH,IAAI,CAACG,YAAY;;AAErC,IAAI,CAACE,OAAO,CAAGL,IAAI,CAACK,OAAO;AAC3B,IAAI,CAACH,IAAI,CAAGF,IAAI,CAACE,IAAI;AACrB,IAAI,CAACS,KAAK,CAAGX,IAAI,CAACW,KAAK;AACvB,IAAI,CAACE,KAAK,CAAGb,IAAI,CAACa,KAAK;AACvB,IAAI,CAACD,MAAM,CAAGZ,IAAI,CAACY,MAAM,EAAI,GAAG;AAChC,IAAI,CAACR,KAAK,CAAGJ,IAAI,CAACI,KAAK;AACvB,IAAI,CAACoB,aAAa,CAAGxB,IAAI,CAACwB,aAAa,EAAI,EAAE;AAC7C,IAAI,CAAClB,QAAQ,CAAGN,IAAI,CAACM,QAAQ;;AAE7B,IAAI,CAACgC,MAAM,CAAGrC,IAAI,CAACsC,MAAM,CAACC,KAAK,CAACC,gBAAgB,CAAC,IAAI,CAAC;AACvD,CAAC,IAAAC,MAAA,CAAA3C,OAAA,CAAA4C,SAAA,CAAAD,MAAA;;AAEDE,QAAQ,CAAR,SAAAA,QAAQA,CAAA,CAAG;AACV,MAAO,KAAI,CAAC3C,IAAI,CAAC4C,MAAM,CAACC,QAAQ,CAAC,IAAI,CAAC;AACvC,CAAC,CAAAJ,MAAA;;;AAGOK,UAAU,CAAlB,QAAQ,CAAAA,UAAUA,CAAA,CAAY;AAC7B,GAAI,IAAI,CAACjC,OAAO,CAAE,MAAO,KAAI,CAACA,OAAO;AACrC,GAAI,CAAAkC,KAAK,CAAG,IAAI,CAACvC,EAAE,CAAG,IAAI,CAACC,KAAK;AAChC,GAAIsC,KAAK,CAAG,GAAG,CAAE,MAAO,GAAG;AAC3B,GAAIA,KAAK,CAAG,GAAG,CAAE,MAAO,GAAG;AAC3B,MAAO,GAAG;AACX,CAAC,CAAAN,MAAA;;AAEOO,eAAe,CAAvB,QAAQ,CAAAA,eAAeA,CAAA,CAAG;AACzB,OAAQ,IAAI,CAACF,UAAU,CAAC,CAAC;AACzB,IAAK,GAAG,CAAE,MAAO,oBAAoB;AACrC,IAAK,GAAG,CAAE,MAAO,iBAAiB;AAClC;AACA,MAAO,OAAO;AACf,CAAC,CAAAhD,OAAA;AACMmD,aAAa,CAApB,QAAO,CAAAA,aAAaA,CAACC,MAAc,CAAEC,KAAmB,CAAoB;AAC3E,GAAI,CAAAC,OAAO,CAAG,GAAG,CAAG,GAAG;;AAEvB,GAAIF,MAAM,GAAK,CAAC,CAAE,MAAO,CAAC,CAAC,CAAE,CAAC,CAAC;AAC/B,GAAIA,MAAM,GAAK,CAAC,CAAE,MAAO,CAAC,CAAC,CAAGE,OAAO,CAAE,CAAC,CAAG,EAAE,CAAGA,OAAO,CAAC;AACxD,GAAID,KAAK,CAAE;AACV,GAAID,MAAM,GAAK,CAAC,CAAE;AACjB,GAAIC,KAAK,GAAK,GAAG,CAAE;AAClB,MAAO,CAAC,GAAG,CAAGC,OAAO,CAAE,EAAE,CAAG,EAAE,CAAGA,OAAO,CAAC;AAC1C,CAAC,IAAM,IAAID,KAAK,GAAK,GAAG,CAAE;AACzB,MAAO,CAAC,CAAC,CAAG,EAAE,CAAE,GAAG,CAAC;AACrB;AACD;AACA,GAAID,MAAM,GAAK,EAAE,CAAE;AAClB,GAAIC,KAAK,GAAK,GAAG,CAAE;AAClB,MAAO,CAAC,GAAG,CAAGC,OAAO,CAAE,EAAE,CAAG,EAAE,CAAGA,OAAO,CAAC;AAC1C,CAAC,IAAM,IAAID,KAAK,GAAK,GAAG,CAAE;AACzB,MAAO,CAAC,GAAG,CAAE,GAAG,CAAC;AAClB;AACD;AACD;AACA,GAAID,MAAM,GAAK,EAAE,CAAE,MAAO,CAAC,CAAC,CAAE,CAAC,CAAC;;AAEhC,MAAO,CAACA,MAAM,CAAG,EAAE,CAAE,CAACA,MAAM,CAAG,CAAC,EAAI,EAAE,CAAGE,OAAO,CAAC;AAClD,CAAC,CAAAtD,OAAA;AACMuD,iBAAiB,CAAxB,QAAO,CAAAA,iBAAiBA,CAACC,KAAuB,CAAEC,SAAiB,CAAEC,SAAiB,CAAE;AACvF,GAAIF,KAAK,CAAC,CAAC,CAAC,GAAKA,KAAK,CAAC,CAAC,CAAC,CAAE;AAC1B,GAAI,CAAAG,UAAU,CAAGC,IAAI,CAACC,GAAG,CAACL,KAAK,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC;AACzC,GAAII,IAAI,CAACE,KAAK,CAACH,UAAU,CAAC,GAAKA,UAAU,CAAE;AAC1C,MAAU,CAAAA,UAAU;AACrB;AACA,MAAO,CAAAA,UAAU,CAACI,OAAO,CAACN,SAAS,CAAC,CAAG,GAAG;AAC3C;AACA,GAAI,CAAAO,KAAK;AACT,GAAI,CAAAC,KAAK;AACT,GAAIR,SAAS,GAAK,CAAC,CAAE;AACpBO,KAAK,CAAGJ,IAAI,CAACE,KAAK,CAACN,KAAK,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC;AAClCS,KAAK,CAAGL,IAAI,CAACM,IAAI,CAACV,KAAK,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC;AAClC,CAAC,IAAM;AACNQ,KAAK,CAAG,CAACR,KAAK,CAAC,CAAC,CAAC,CAAG,GAAG,EAAEO,OAAO,CAACN,SAAS,CAAC;AAC3CQ,KAAK,CAAG,CAACT,KAAK,CAAC,CAAC,CAAC,CAAG,GAAG,EAAEO,OAAO,CAACN,SAAS,CAAC;AAC5C;AACA,SAAUO,KAAK,CAAGN,SAAS,CAAGO,KAAK;AACpC,CAAC,CAAAtB,MAAA;;AAEDwB,cAAc,CAAd,SAAAA,cAAcA,CAACC,MAAW,CAAoB;AAC7C,GAAIA,MAAM,CAAC,CAAC,CAAC,GAAK,EAAE,CAAE;AACrB,GAAI,CAAAnB,KAAK,CAAGmB,MAAM,CAAC,CAAC,CAAC,CAAGA,MAAM,CAAC,CAAC,CAAC;AACjC,MAAO,CAACnB,KAAK,CAAEA,KAAK,CAAC;AACtB,CAAC,IAAM,IAAImB,MAAM,CAACC,MAAM,GAAKC,SAAS,CAAE;;;AAGvC,MAAO,CAACF,MAAM,CAAC,CAAC,CAAC,CAAG,GAAG,CAAEA,MAAM,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC;AAC1C;;AAEA,GAAI,CAAAG,QAAQ,CAAGvE,OAAO,CAACmD,aAAa,CAACiB,MAAM,CAAC,CAAC,CAAC,CAAEA,MAAM,CAAC,CAAC,CAAC,CAAC;AAC1D,GAAI,CAAAI,QAAQ,CAAGxE,OAAO,CAACmD,aAAa,CAACiB,MAAM,CAAC,CAAC,CAAC,CAAGA,MAAM,CAAC,CAAC,CAAC,CAAE,IAAI,CAACrD,OAAO,CAAC;AACzE,GAAIqD,MAAM,CAAC,CAAC,CAAC,GAAK,CAAC,CAAE;;AAEpB,MAAO,CAAC,CAAC,CAAEI,QAAQ,CAAC,CAAC,CAAC,CAAGA,QAAQ,CAAC,CAAC,CAAC,CAAC;AACtC;AACA,GAAID,QAAQ,CAAC,CAAC,CAAC,CAAGC,QAAQ,CAAC,CAAC,CAAC,CAAE;AAC9B,GAAI,CAAAC,CAAC,CAAGF,QAAQ;AAChBA,QAAQ,CAAGC,QAAQ;AACnBA,QAAQ,CAAGC,CAAC;AACb;AACA,MAAO,CAACF,QAAQ,CAAC,CAAC,CAAC,CAAGC,QAAQ,CAAC,CAAC,CAAC,CAAED,QAAQ,CAAC,CAAC,CAAC,CAAGC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC9D,CAAC,CAAA7B,MAAA;AACD+B,WAAW,CAAX,SAAAA,WAAWA,CAACC,QAAgB,CAAEC,WAAqB,CAAEC,IAAc;AACU,KAAAC,SAAA;;AAE5E,GAAI,GAAAA,SAAA,CAACH,QAAQ,SAARG,SAAA,CAAUT,MAAM,EAAE,MAAO,KAAI;AAClC,GAAI,CAAAU,UAAU,CAAGJ,QAAQ,CAACK,WAAW,CAAC,GAAG,CAAC;AAC1C,GAAID,UAAU,EAAI,CAAC,CAAE;;AAEpB,GAAIH,WAAW,CAAE;AAChB,GAAI,CAAAR,MAAM,CAAGa,UAAU,CAACN,QAAQ,CAAC;;AAEjC,GAAIO,KAAK,CAACd,MAAM,CAAC,CAAEA,MAAM,CAAG,EAAE;AAC9B,GAAIS,IAAI,CAAE;AACT,IAAI,CAACnE,EAAE,EAAI,IAAI,CAACC,KAAK,CAAGyD,MAAM,CAAG,GAAG;AACpC,GAAI,IAAI,CAAC1D,EAAE,CAAG,IAAI,CAACC,KAAK,CAAE,IAAI,CAACD,EAAE,CAAG,IAAI,CAACC,KAAK;AAC/C,CAAC,IAAM;AACN,IAAI,CAACD,EAAE,EAAI,IAAI,CAACC,KAAK,CAAGyD,MAAM,CAAG,GAAG;AACrC;;AAEA,GAAI,CAAAe,GAAG,CAAG,IAAI,CAACT,WAAW,CAACC,QAAQ,CAAC;AACpC,GAAIQ,GAAG,EAAKA,GAAG,CAAC,CAAC,CAAC,GAAK,GAAI,CAAE;;AAE5B,MAAO,CAACf,MAAM,CAAE,GAAG,CAAEA,MAAM,CAAC;AAC7B;;AAEA,GAAI,CAAAgB,OAAO,CAAGxB,IAAI,CAACyB,KAAK,CAACzB,IAAI,CAACM,IAAI,CAACE,MAAM,CAAG,EAAE,CAAG,GAAG,CAAC,CAAG,EAAE,CAAG,GAAG,CAAC;AACjE,GAAI,CAAAhB,MAAM,CAAGQ,IAAI,CAACM,IAAI,CAACE,MAAM,CAAG,EAAE,CAAG,GAAG,CAAC;AACzC,MAAO,CAAChB,MAAM,CAAE,EAAE,CAAEgC,OAAO,CAAC;AAC7B;AACA,GAAIT,QAAQ,CAACW,MAAM,CAACX,QAAQ,CAACN,MAAM,CAAG,CAAC,CAAC,GAAK,GAAG,CAAE;AACjD,MAAO,KAAI;AACZ;AACAM,QAAQ,CAAGA,QAAQ,CAACW,MAAM,CAACP,UAAU,CAAG,CAAC,CAAEJ,QAAQ,CAACN,MAAM,CAAGU,UAAU,CAAG,CAAC,CAAC;AAC7E;;AAEA,GAAI,CAAAQ,KAAK,CAAG,IAAI,CAAC9E,OAAO,CAAG,CAAC,CAAI,IAAI,CAACC,EAAE,EAAI,CAAE;AAC7C,GAAI,CAAA8E,QAAQ,CAAG,IAAI,CAAC7E,KAAK;AACzB,GAAI,CAAA8E,QAAQ,CAAG,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC;AAChC,GAAI,CAAAC,QAAQ,CAAG,IAAI,CAAC5E,OAAO;;AAE3B,IAAI,CAACb,IAAI,CAACsC,MAAM,CAACoD,WAAW,CAACjB,QAAQ,CAAE,IAAI,CAAC;AAC5C,GAAIa,QAAQ,GAAK,CAAC,CAAE;AACnBA,QAAQ,CAAGD,KAAK,CAAG,IAAI,CAAC5E,KAAK;AAC9B;;AAEA,GAAI,CAAAkF,MAAM,CAAGN,KAAK,CAAI3B,IAAI,CAACE,KAAK,CAAC,IAAI,CAACnD,KAAK,CAAG4E,KAAK,CAAGC,QAAQ,CAAC,EAAI,CAAC,CAAI,CAAC;AACzE,GAAI,CAAAM,KAAK,CAAG,IAAI,CAACpF,EAAE,CAAGmF,MAAM;AAC5B,GAAI,CAAAE,UAAU,CAAG,IAAI,CAACL,OAAO,CAAC,GAAG,CAAC,CAAGD,QAAQ;AAC7C,MAAO,CAACK,KAAK,CAAE,IAAI,CAACnF,KAAK,CAAEoF,UAAU,CAAEF,MAAM,CAAEF,QAAQ,CAAC;AACzD,CAAC,CAAAhD,MAAA;AACDqD,YAAY,CAAZ,SAAAA,YAAYA,CAAC1F,OAAgB,CAAE;AAC9B,GAAI,CAACA,OAAO,CAAE,MAAO,MAAK;AAC1B,GAAIA,OAAO,GAAK,IAAI,CAACA,OAAO,CAAE,MAAO,KAAI;AACzC,GAAI,IAAI,CAACC,QAAQ,CAAE,MAAO,MAAK;AAC/B,GAAID,OAAO,CAACyC,QAAQ,CAAC,SAAS,CAAC,CAAE;AAChC,GAAI,IAAI,CAACiD,YAAY,CAAC1F,OAAO,CAAC2F,OAAO,CAAC,SAAS,CAAE,EAAE,CAAC,CAAC,CAAE,MAAO,KAAI;AACnE;;AAEA3F,OAAO,CAAGA,OAAO,CAAC2F,OAAO,CAAC,yBAAyB,CAAE,MAAM,CAAC;AAC5D,MAAQ,CAAA3F,OAAO,GAAK,IAAI,CAACA,OAAO;AACjC,CAAC,CAAAqC,MAAA;AACDuD,QAAQ,CAAR,SAAAA,QAAQA,CAAA,CAAG;AACV,GAAI,CAAAC,KAAK,CAAG,CAAC,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC;AAC1C,MAAO,KAAI,CAAC9F,KAAK,CAACiF,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAGa,KAAK,CAAC,IAAI,CAAC3F,IAAI,CAAC,CAAG,IAAI,CAACH,KAAK,CAACiF,MAAM,CAAC,CAAC,CAAC;AACzE,CAAC,CAAA3C,MAAA;AACDyD,cAAc,CAAd,SAAAA,cAAcA,CAACC,QAAY,CAAE;AAC5B,IAAI,CAACnG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAAC6D,YAAY,CAAC,IAAI,CAAED,QAAQ,CAAC;AACnD,GAAI,CAAC,IAAI,CAACE,WAAW,CAACF,QAAQ,CAAC,CAAE;AACjC,MAAO,KAAI,CAACvE,SAAS,CAACuE,QAAQ,CAAC;AAChC,CAAC,CAAA1D,MAAA;AACD6D,WAAW,CAAX,SAAAA,WAAWA,CAACH,QAAY,CAAkB,SAAAI,IAAA,CAAAC,SAAA,CAAArC,MAAA,CAAbsC,IAAI,KAAAC,KAAA,CAAAH,IAAA,GAAAA,IAAA,MAAAI,IAAA,GAAAA,IAAA,CAAAJ,IAAA,CAAAI,IAAA,IAAJF,IAAI,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;AAChC,GAAI,IAAI,CAACN,WAAW,CAACF,QAAQ,CAAC,EAAI,CAACM,IAAI,CAACtC,MAAM,CAAE;AAChD,IAAI,CAACvC,SAAS,CAACuE,QAAQ,CAAC,EAAIA,QAAQ,EAAAS,MAAA,CAAKH,IAAI,CAAgB;AAC7D,IAAI,CAACzG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAACsE,SAAS,CAAC,IAAI,CAAEV,QAAQ,CAAC;AACjD,CAAC,CAAA1D,MAAA;AACD4D,WAAW,CAAX,SAAAA,WAAWA,CAACF,QAAY,CAAE;AACzB,MAAO,CAAC,CAAC,IAAI,CAACvE,SAAS,CAACuE,QAAQ,CAAC;AAClC,CAAC,CAAA1D,MAAA;AACDqE,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAACX,QAAY,CAAE;AAC9B,IAAI,CAACnG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAAC6D,YAAY,CAAC,IAAI,CAAED,QAAQ,CAAC;AACnD,GAAI,CAAC,IAAI,CAACY,aAAa,CAACZ,QAAQ,CAAC,CAAE;AACnC,MAAO,KAAI,CAACtE,YAAY,CAACsE,QAAQ,CAAC;AACnC,CAAC,CAAA1D,MAAA;AACDuE,aAAa,CAAb,SAAAA,aAAaA,CAACb,QAAY,CAAE;AAC3BA,QAAQ,CAAGc,IAAI,CAACd,QAAQ,CAAC;AACzB,IAAI,CAACnG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAACsE,SAAS,CAAC,IAAI,CAAEV,QAAQ,CAAC;AAChD,GAAI,IAAI,CAACY,aAAa,CAACZ,QAAQ,CAAC,CAAE;AAClC,IAAI,CAACtE,YAAY,CAACsE,QAAQ,CAAC,CAAG,CAACA,QAAQ,CAAC;AACzC,CAAC,CAAA1D,MAAA;AACDsE,aAAa,CAAb,SAAAA,aAAaA,CAACZ,QAAY,CAAE;AAC3B,MAAO,CAAC,CAAC,IAAI,CAACtE,YAAY,CAACsE,QAAQ,CAAC;AACrC,CAAC,CAAA1D,MAAA;AACDyE,iBAAiB,CAAjB,SAAAA,iBAAiBA,CAAA,CAAG;AACnB,IAAK,GAAI,CAAAC,EAAE,GAAI,KAAI,CAACtF,YAAY,CAAE;AACjC,IAAI,CAACiF,gBAAgB,CAACK,EAAQ,CAAC;AAChC;AACA,IAAI,CAACtF,YAAY,CAAG,CAAC,CAAC;AACtB,IAAI,CAAC7B,IAAI,CAACsC,MAAM,CAACC,KAAK,CAAC6E,aAAa,CAAC,IAAI,CAAC;AAC3C,CAAC,CAAA3E,MAAA;AACD4E,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAAClB,QAAY,CAAE;AAC9B,IAAI,CAACnG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAAC6D,YAAY,CAAC,IAAI,CAAED,QAAQ,CAAC;AACnD,GAAI,CAAC,IAAI,CAACmB,aAAa,CAACnB,QAAQ,CAAC,CAAE;AACnC,MAAO,KAAI,CAACrE,YAAY,CAACqE,QAAQ,CAAC;AACnC,CAAC,CAAA1D,MAAA;AACD8E,aAAa,CAAb,SAAAA,aAAaA,CAACpB,QAAY,CAAE;AAC3BA,QAAQ,CAAGc,IAAI,CAACd,QAAQ,CAAC;AACzB,GAAI,IAAI,CAACmB,aAAa,CAACnB,QAAQ,CAAC,CAAE;AAClC,IAAI,CAACrE,YAAY,CAACqE,QAAQ,CAAC,CAAG,CAACA,QAAQ,CAAC;AACxC,IAAI,CAACnG,IAAI,CAACsC,MAAM,CAACC,KAAK,CAACsE,SAAS,CAAC,IAAI,CAAEV,QAAQ,CAAC;AACjD,CAAC,CAAA1D,MAAA;AACD6E,aAAa,CAAb,SAAAA,aAAaA,CAACnB,QAAY,CAAE;AAC3B,MAAO,CAAC,CAAC,IAAI,CAACrE,YAAY,CAACqE,QAAQ,CAAC;AACrC,CAAC,CAAA1D,MAAA;AACD+E,iBAAiB,CAAjB,SAAAA,iBAAiBA,CAAA,CAAG;AACnB,IAAK,GAAI,CAAAL,EAAE,GAAI,KAAI,CAACrF,YAAY,CAAE;AACjC,IAAI,CAACuF,gBAAgB,CAACF,EAAQ,CAAC;AAChC;AACA,IAAI,CAACrF,YAAY,CAAG,CAAC,CAAC;AACvB,CAAC,CAAAW,MAAA;AACDgF,cAAc,CAAd,SAAAA,cAAcA,CAAA,CAAG;AAChB,IAAI,CAAC7F,SAAS,CAAG,CAAC,CAAC;AACnB,IAAI,CAACsF,iBAAiB,CAAC,CAAC;AACxB,IAAI,CAACM,iBAAiB,CAAC,CAAC;AACxB,IAAI,CAACxH,IAAI,CAACsC,MAAM,CAACC,KAAK,CAACmF,YAAY,CAAC,IAAI,CAAC;AAC1C,CAAC,CAAAjF,MAAA;AACDkF,YAAY,CAAZ,SAAAA,YAAYA,CAACC,QAAgB,CAAoC,IAAlC,CAAAC,EAAE,CAAArB,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC,IAAE,CAAAsB,eAAwB,CAAAtB,SAAA,CAAArC,MAAA,GAAAqC,SAAA,IAAApC,SAAA;AAC9D,GAAI0D,eAAe,GAAK,IAAI,CAAC3H,KAAK,CAAE;AACpCyH,QAAQ,CAAGG,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAACJ,QAAQ,CAAC,CAAC3H,IAAI;AACvC,GAAI2H,QAAQ,CAACK,UAAU,CAAC,GAAG,CAAC,CAAE;AAC9B,GAAIL,QAAQ,GAAK,UAAU,CAAE;AAC7B,GAAI,IAAI,CAAChG,SAAS,CAACsG,SAAS,CAAE;;AAE7B,GAAI,CAACJ,eAAe,CAAEA,eAAe,CAAG,IAAI,CAAC3H,KAAK;AAClD,IAAI,CAACyB,SAAS,CAACsG,SAAS,CAAC,CAAC,CAAC,CAACP,YAAY,CAACC,QAAQ,CAAE,CAAC,CAAEE,eAAe,CAAC;AACtEF,QAAQ,CAAG,GAAG,CAAGA,QAAQ;AAC1B,CAAC,QAAAO,GAAA,GAAAC,gBAAA;AACmB,IAAI,CAACpG,SAAS,CAAAmG,GAAA,CAAAC,gBAAA,CAAAjE,MAAA,CAAAgE,GAAA,GAAE,CAA/B,GAAM,CAAAE,KAAK,CAAAD,gBAAA,CAAAD,GAAA;AACf,GAAIP,QAAQ,GAAKS,KAAK,CAAC,CAAC,CAAC,CAAE;AAC1BA,KAAK,CAAC,CAAC,CAAC,EAAIR,EAAE;AACd,GAAIQ,KAAK,CAAC,CAAC,CAAC,CAAG,CAAC,CAAEA,KAAK,CAAC,CAAC,CAAC,CAAG,CAAC;AAC9B;AACD;AACD;AACA,IAAI,CAACrG,SAAS,CAACsG,IAAI,CAAC,CAACV,QAAQ,CAAEC,EAAE,CAAC,CAAC;AACpC,CAAC,CAAApF,MAAA;AACD8F,eAAe,CAAf,SAAAA,eAAeA,CAACxH,OAAe,CAAEyH,SAAmB,CAAmB,IAAjB,CAAAlI,IAAW,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC;AACrEzF,OAAO,CAAGgH,GAAG,CAACU,SAAS,CAACT,GAAG,CAACjH,OAAO,CAAC,CAACd,IAAI;;AAEzC,GAAIK,IAAI,GAAK,CAAC,CAAE;AACf,IAAI,CAACW,QAAQ,CAAGF,OAAO;AACvB,GAAI,CAAC,IAAI,CAACG,YAAY,EAAI,CAACsH,SAAS,CAAE,IAAI,CAACtH,YAAY,CAAGH,OAAO;AACjE;AACD;AACA,IAAI,CAACA,OAAO,CAAGA,OAAO;AACtB,GAAI,CAAC,IAAI,CAACC,WAAW,EAAI,CAACwH,SAAS,CAAE,CAAE,IAAI,CAACxH,WAAW,CAAGD,OAAO,CAAE;AACpE,CAAC,CAAA0B,MAAA;AACAiG,aAAa,CAAb,SAAAA,aAAaA,CAACC,KAAc,CAAE,KAAAC,IAAA;AACG,CAACD,KAAK,CAAC5H,OAAO,CAAE,IAAI,CAACA,OAAO,CAAC,CAA5D,IAAI,CAACA,OAAO,CAAA6H,IAAA,IAAED,KAAK,CAAC5H,OAAO,CAAA6H,IAAA,QAAAC,KAAA;AACY,CAACF,KAAK,CAAC3H,WAAW,CAAE,IAAI,CAACA,WAAW,CAAC,CAA5E,IAAI,CAACA,WAAW,CAAA6H,KAAA,IAAEF,KAAK,CAAC3H,WAAW,CAAA6H,KAAA,QAAAC,KAAA;AACF,CAACH,KAAK,CAAC1H,QAAQ,CAAE,IAAI,CAACA,QAAQ,CAAC,CAAhE,IAAI,CAACA,QAAQ,CAAA6H,KAAA,IAAEH,KAAK,CAAC1H,QAAQ,CAAA6H,KAAA,QAAAC,KAAA;AACY,CAACJ,KAAK,CAACzH,YAAY,CAAE,IAAI,CAACA,YAAY,CAAC,CAAhF,IAAI,CAACA,YAAY,CAAA6H,KAAA,IAAEJ,KAAK,CAACzH,YAAY,CAAA6H,KAAA;AACvC,CAAC,CAAAtG,MAAA;AACDuG,QAAQ,CAAR,SAAAA,QAAQA,CAACC,SAA4B,CAAE;AACtC,GAAI,CAAAC,cAAc,CAAG;AACpBC,GAAG,CAAE,KAAK;AACVC,GAAG,CAAE,KAAK;AACVC,GAAG,CAAE,KAAK;AACVC,GAAG,CAAE,KAAK;AACVC,GAAG,CAAE,KAAK;AACVC,QAAQ,CAAE,UAAU;AACpBC,OAAO,CAAE,SAAS;AAClBC,GAAG,CAAE;AACN,CAAC;AACD,GAAI,CAAC,IAAI,CAACjI,MAAM,CAACwH,SAAS,CAAC,CAAE;AAC5B,MAAO,gBAAgB,CAAGC,cAAc,CAACD,SAAS,CAAC;AACpD;AACA,GAAI,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAE,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC;AAC1D,GAAI,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAC,CAAE,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAC;AAC5D,GAAM,CAAAU,KAAK,CAAG,IAAI,CAAC3J,IAAI,CAACsC,MAAM,CAACsH,GAAG,EAAI,CAAC,EAAI,CAAC,IAAI,CAAC5J,IAAI,CAACsC,MAAM,CAACuH,IAAI,CAAChH,QAAQ,CAAC,SAAS,CAAC;AACrF,GAAI,CAAC8G,KAAK,GAAKV,SAAS,GAAK,UAAU,EAAIA,SAAS,GAAK,SAAS,CAAC,CAAE;AACpE,GAAI,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAE;AAC/B,GAAI,CAAAa,cAAc,CAAG;AACpB,UAAU,CAAE,aAAa,CAAE,aAAa,CAAE,UAAU,CAAE,aAAa,CAAE,aAAa,CAAE,UAAU,CAC9F;;;AAED,MAAO,EAAE,CAAGA,cAAc,CAAC,IAAI,CAACrI,MAAM,CAACwH,SAAS,CAAC,CAAC,CAAG,QAAQ,CAAGC,cAAc,CAACD,SAAS,CAAC;AAC1F;AACA,GAAI,CAAAc,cAAa,CAAG;AACnB,UAAU,CAAE,aAAa,CAAE,YAAY,CAAE,YAAY,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAClG;;;AAED,MAAO,EAAE,CAAGA,cAAa,CAAC,CAAC,IAAI,CAACtI,MAAM,CAACwH,SAAS,CAAC,CAAC,CAAG,QAAQ,CAAGC,cAAc,CAACD,SAAS,CAAC;AAC1F;AACA,GAAI,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAE;AAC/B,GAAI,CAAAa,eAAc,CAAG;AACpB,UAAU,CAAE,YAAY,CAAE,UAAU,CAAE,YAAY,CAAE,UAAU,CAAE,YAAY,CAAE,UAAU,CACxF;;;AAED,MAAO,EAAE,CAAGA,eAAc,CAAC,IAAI,CAACrI,MAAM,CAACwH,SAAS,CAAC,CAAC,CAAG,QAAQ,CAAGC,cAAc,CAACD,SAAS,CAAC;AAC1F;AACA,GAAI,CAAAc,aAAa,CAAG;AACnB,UAAU,CAAE,aAAa,CAAE,YAAY,CAAE,YAAY,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAClG;;;AAED,MAAO,EAAE,CAAGA,aAAa,CAAC,CAAC,IAAI,CAACtI,MAAM,CAACwH,SAAS,CAAC,CAAC,CAAG,QAAQ,CAAGC,cAAc,CAACD,SAAS,CAAC;AAC1F,CAAC,CAAAxG,MAAA;AACDuH,WAAW,CAAX,SAAAA,WAAWA,CAACC,aAA6B,CAAE,KAAAC,qBAAA;AAC1C,GAAI,CAAAC,gBAAgB,CAAG,EAAAD,qBAAA,KAAI,CAACtI,SAAS,CAACwI,UAAU,eAAzBF,qBAAA,CAA4B,CAAC,CAAC,EAAG,GAAG,EAAI,CAAC;AAChE,MAAO,CAAAxG,IAAI,CAAC2G,GAAG,CAAC,IAAI,CAACC,UAAU,CAACL,aAAa,CAAC,CAACM,QAAQ,CAAGJ,gBAAgB,CAAE,GAAG,CAAC;AACjF,CAAC,CAAA1H,MAAA;AACD+H,YAAY,CAAZ,SAAAA,YAAYA,CAACvB,SAA4B,CAAE;AAC1C,GAAI,CAAC,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAE,MAAO,SAAS;AAC7C,GAAI,IAAI,CAACxH,MAAM,CAACwH,SAAS,CAAC,CAAG,CAAC,CAAE,MAAO,MAAM;AAC7C,MAAO,KAAK;AACb,CAAC,CAAAxG,MAAA;AACDgI,aAAa,CAAb,SAAAA,aAAaA,CAAA,CAAG;AACf,IAAI,CAAC1J,OAAO,CAAG,IAAI,CAACC,WAAW;AAC/B,IAAI,CAACS,MAAM,CAAG,CAAC,CAAC;AAChB,IAAI,CAACgG,cAAc,CAAC,CAAC;AACrB,IAAK,GAAI,CAAAiD,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAAC1I,SAAS,CAACmC,MAAM,CAAEuG,CAAC,EAAE,CAAE;AAC/C,GAAI,IAAI,CAAC1I,SAAS,CAAC0I,CAAC,CAAC,CAAC,CAAC,CAAC,CAACzC,UAAU,CAAC,GAAG,CAAC,CAAE;AACzC,IAAI,CAACjG,SAAS,CAAC2I,MAAM,CAACD,CAAC,CAAE,CAAC,CAAC;AAC3BA,CAAC,EAAE;AACJ;AACD;;AAEA,IAAI,CAAC/I,WAAW,CAAG,CAAC;AACpB,IAAI,CAACM,UAAU,CAACE,UAAU,CAAG,CAAC;AAC9B,GAAI,IAAI,CAACnC,IAAI,CAACsC,MAAM,CAACsH,GAAG,GAAK,CAAC,CAAE,IAAI,CAAC3H,UAAU,CAACC,UAAU,CAAG,CAAC;AAC/D,CAAC,CAAAO,MAAA;;;;;;AAMDmI,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAACC,OAAgB,CAAEC,UAAmC,CAAE;AACvE,IAAI,CAACrJ,MAAM,CAAGoJ,OAAO,CAACpJ,MAAM;AAC5B,IAAI,CAACG,SAAS,CAAGiJ,OAAO,CAACjJ,SAAS;;AAElC,GAAI,CAACkJ,UAAU,CAAE;AAChB,GAAM,CAAAC,iBAAiB,CAAG;AACzB,YAAY,CAAE,SAAS,CAAE,YAAY,CAAE,SAAS,CAAE,QAAQ,CAAE,WAAW,CAAE,eAAe,CAAE,UAAU,CAAE,YAAY,CAAE,OAAO,CAAE,YAAY,CAAE,WAAW,CAAE,UAAU,CAAE,WAAW,CAAE,YAAY,CAAE,YAAY,CAAE,YAAY,CAAE,WAAW,CAAE,SAAS,CAAE,SAAS,CAAE,YAAY,CAAE,MAAM,CAClR,CAAC,QAAAC,GAAA,GAAAC,sBAAA;;AACqBlD,GAAG,CAACmD,iBAAiB,CAAAF,GAAA,CAAAC,sBAAA,CAAA9G,MAAA,CAAA6G,GAAA,GAAE,CAAzC,GAAM,CAAAG,QAAQ,CAAAF,sBAAA,CAAAD,GAAA;AAClBD,iBAAiB,CAACzC,IAAI,CAAC,gBAAgB,CAAG6C,QAAQ,CAAC;AACnDJ,iBAAiB,CAACzC,IAAI,CAAC,YAAY,CAAG6C,QAAQ,CAAC;AAChD,CAAC,QAAAC,GAAA,GAAAA,GAAA;AACsBL,iBAAiB,CAAA5G,MAAA,CAAAiH,GAAA,GAAE,CAArC,GAAM,CAAAjF,QAAQ,CAAI4E,iBAAiB,CAAAK,GAAA,CAArB;AAClB,MAAO,KAAI,CAACxJ,SAAS,CAACuE,QAAQ,CAAC;AAChC;AACD;AACA,GAAI2E,UAAU,GAAK,UAAU,CAAE;AAC9B,IAAK,GAAI,CAAAJ,CAAC,GAAI,KAAI,CAAC9I,SAAS,CAAE;AAC7B,GAAI8I,CAAC,GAAK,YAAY,CAAE;AACxB,MAAO,KAAI,CAAC9I,SAAS,CAAC8I,CAAC,CAAC;AACzB;AACA,IAAI,CAACjJ,MAAM,CAAG,CAAC,CAAC;AACjB;AACA,MAAO,KAAI,CAACG,SAAS,CAAC,WAAW,CAAC;AAClC,MAAO,KAAI,CAACA,SAAS,CAAC,aAAa,CAAC;;AAEpCiJ,OAAO,CAACpJ,MAAM,CAAG,CAAC,CAAC;AACnBoJ,OAAO,CAACjJ,SAAS,CAAG,CAAC,CAAC;AACtBiJ,OAAO,CAAC7K,IAAI,CAACsC,MAAM,CAACC,KAAK,CAAC8I,eAAe,CAACR,OAAO,CAAC;AAClDA,OAAO,CAAClJ,WAAW,CAAG,CAAC;AACxB,CAAC,CAAAc,MAAA;AACD6I,aAAa,CAAb,SAAAA,aAAaA,CAACT,OAAgB,CAA4B,IAA1B,CAAAU,gBAAgB,CAAA/E,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,KAAK;AACvD,IAAAgF,iBAAA,CAA2BX,OAAO,CAACY,QAAQ,CAACrH,SAAS,CAAEmH,gBAAgB,CAAC,CAAjEG,KAAK,CAAAF,iBAAA,IAAEG,SAAS,CAAAH,iBAAA;AACvB,IAAI,CAAClF,WAAW,CAAC,YAAY,CAAQoF,KAAK,CAACE,IAAI,CAAC,GAAG,CAAC,CAAC;AACrD,GAAID,SAAS,CAAE;AACd,IAAI,CAACrF,WAAW,CAAC,SAAS,CAAQqF,SAAS,CAAC;AAC7C,CAAC,IAAM;AACN,IAAI,CAACzF,cAAc,CAAC,SAAe,CAAC;AACrC;AACD,CAAC,CAAAzD,MAAA;AACDgJ,QAAQ,CAAR,SAAAA,QAAQA,CAACxB,aAA6B,CAA0E,IAAxE,CAAAsB,gBAAgB,CAAA/E,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,KAAK;AAC/D,GAAI,CAAAkF,KAA8B;AAClC,GAAI,CAACH,gBAAgB,EAAI,IAAI,CAAChK,aAAa,EAAI,IAAI,CAACA,aAAa,GAAK,SAAS,CAAE;AAChFmK,KAAK,CAAG,CAAC,IAAI,CAACnK,aAAa,CAAiB;AAC7C,CAAC,IAAM,IAAI,IAAI,CAACK,SAAS,CAACiK,UAAU,CAAE;AACrCH,KAAK,CAAG,IAAI,CAAC9J,SAAS,CAACiK,UAAU,CAAC,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC;AAChD,CAAC,IAAM;AACNJ,KAAK,CAAG,IAAI,CAACpB,UAAU,CAACL,aAAa,CAAC,CAACyB,KAAK;AAC7C;AACA,GAAI,IAAI,CAAC3E,aAAa,CAAC,OAAa,CAAC,EAAI2E,KAAK,CAAC7I,QAAQ,CAAC,QAAQ,CAAC,CAAE;AAClE6I,KAAK,CAAGA,KAAK,CAACK,MAAM,CAAC,SAAAC,QAAQ,QAAI,CAAAA,QAAQ,GAAK,QAAQ,GAAC;AACvD,GAAI,CAACN,KAAK,CAACvH,MAAM,CAAEuH,KAAK,CAAG,CAAC,QAAQ,CAAC;AACtC;AACA,GAAM,CAAAC,SAAS,CAAI,IAAI,CAAC/J,SAAS,CAACqK,OAAO,CAAG,IAAI,CAACrK,SAAS,CAACqK,OAAO,CAAC,CAAC,CAAC,CAAG,EAAG;AAC3E,MAAO,CAACP,KAAK,CAAEC,SAAS,CAAC;AAC1B,CAAC,CAAAlJ,MAAA;AACDyJ,UAAU,CAAV,SAAAA,UAAUA,CAACjC,aAA6B,CAAE;AACzC,GAAM,CAAA3H,MAAM,CAAG,IAAI,CAACtC,IAAI,CAACsC,MAAM;AAC/B,GAAIA,MAAM,CAAC6J,gBAAgB,CAAC,SAAS,CAAC,CAAE;AACvC,MAAO,KAAI;AACZ,CAAC,IAAM,IAAI,IAAI,CAACvK,SAAS,CAAC,SAAS,CAAC,EAAIU,MAAM,CAACsH,GAAG,EAAI,CAAC,CAAE;AACxD,MAAO,KAAI;AACZ,CAAC,IAAM,IAAI,IAAI,CAAChI,SAAS,CAAC,WAAW,CAAC,CAAE;AACvC,MAAO,KAAI;AACZ;;AAEA,GAAI,CAAAT,IAAI,CAAG8F,IAAI,CAACgD,aAAa,CAAGA,aAAa,CAAC9I,IAAI,CAAG,IAAI,CAACA,IAAI,CAAC;AAC/D,GAAI,CAAAJ,OAAO,CAAGkG,IAAI,CAAC,IAAI,CAACmF,gBAAgB,CAACnC,aAAa,CAAC,CAAC;AACxD,GAAI3H,MAAM,CAAC6J,gBAAgB,CAAC,YAAY,CAAC,EAAI,IAAI,CAACvK,SAAS,CAAC,SAAS,CAAC,EAAIb,OAAO,GAAK,OAAO,CAAE;AAC9FI,IAAI,CAAG,EAAQ;AAChB;;AAEA,GAAIA,IAAI,GAAK,UAAU,CAAE;AACxB,MAAO,KAAI;AACZ;AACA,GAAIJ,OAAO,GAAK,UAAU,CAAE;AAC3B,MAAO,MAAK;AACb;AACA,GAAI,IAAI,CAACa,SAAS,CAAC,YAAY,CAAC,EAAI,IAAI,CAACA,SAAS,CAAC,aAAa,CAAC,CAAE;AAClE,MAAO,MAAK;AACb;AACA,GAAIT,IAAI,GAAK,YAAY,CAAE;AAC1B,MAAO,MAAK;AACb;AACA,MAAO,CAAC,IAAI,CAACkL,WAAW,CAACpC,aAAa,CAAC,CAACpH,QAAQ,CAAC,QAAQ,CAAC;AAC3D,CAAC,CAAAJ,MAAA;AACD2J,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAACnC,aAA6B,CAAE;AAC/C,GAAM,CAAAlJ,OAAO,CAAG,IAAI,CAACf,IAAI,CAACsC,MAAM,CAACgK,GAAG,CAAC7D,SAAS,CAACT,GAAG,CAAC,CAAAiC,aAAa,cAAbA,aAAa,CAAElJ,OAAO,GAAI,IAAI,CAACA,OAAO,GAAIkJ,aAAa,cAAbA,aAAa,CAAEjJ,WAAW,GAAI,EAAE,CAAC;AAC9H;AACC,IAAI,CAACT,OAAO;AACX,IAAI,CAACqB,SAAS,CAAC,WAAW,CAAC,EAAIb,OAAO,CAACwL,KAAK,CAAC,aAAa,CAAE;AAC5D,CAACxL,OAAO,CAACwL,KAAK,CAAC,cAAc,CAAC,GAAK,IAAI,CAACvM,IAAI,CAACsC,MAAM,CAACkK,UAAU,CAAC,CAAC,EAAI,IAAI,CAAC5K,SAAS,CAAC,YAAY,CAAC,CAAE;AAClG,CAAE,MAAO,EAAE,CAAE;AACf,MAAO,CAAAb,OAAO,CAACd,IAAI;AACpB,CAAC,CAAAwC,MAAA;AACDgK,iBAAiB,CAAjB,SAAAA,iBAAiBA,CAACxC,aAAmB,CAAE;AACtC,GAAM,CAAAlJ,OAAO,CAAG,IAAI,CAACf,IAAI,CAACsC,MAAM,CAACgK,GAAG,CAAC7D,SAAS,CAACT,GAAG,CAAC,CAAAiC,aAAa,cAAbA,aAAa,CAAEhJ,QAAQ,GAAI,IAAI,CAACA,QAAQ,GAAIgJ,aAAa,cAAbA,aAAa,CAAE/I,YAAY,GAAI,EAAE,CAAC;AAClI;AACC,IAAI,CAACX,OAAO;AACX,IAAI,CAACqB,SAAS,CAAC,WAAW,CAAC,EAAIb,OAAO,CAACwL,KAAK,CAAC,aAAa,CAAE;AAC5D,CAACxL,OAAO,CAACwL,KAAK,CAAC,cAAc,CAAC,GAAK,IAAI,CAACvM,IAAI,CAACsC,MAAM,CAACkK,UAAU,CAAC,CAAC,EAAI,IAAI,CAAC5K,SAAS,CAAC,YAAY,CAAC,CAAE;AAClG,CAAE,MAAO,EAAE,CAAE;AACf,MAAO,CAAAb,OAAO,CAACd,IAAI;AACpB,CAAC,CAAAwC,MAAA;AACA4J,WAAW,CAAX,SAAAA,WAAWA,CAACpC,aAA6B,CAA4B,IAA1B,CAAAsB,gBAAgB,CAAA/E,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,KAAK;AAClE,IAAAkG,cAAA,CAA2B,IAAI,CAACjB,QAAQ,CAACxB,aAAa,CAAEsB,gBAAgB,CAAC,CAAlEG,KAAK,CAAAgB,cAAA,IAAEf,SAAS,CAAAe,cAAA;AACvB,MAAO,CAAAf,SAAS,CAAGD,KAAK,CAAC9E,MAAM,CAAC+E,SAAS,CAAC,CAAGD,KAAK;AACnD,CAAC,CAAAjJ,MAAA;AACDkK,eAAe,CAAf,SAAAA,eAAeA,CAAC1C,aAA6B,CAAU;AACtD,MAAO,KAAI,CAACrI,SAAS,CAACgL,WAAW,CAAG,IAAI,CAAChL,SAAS,CAACgL,WAAW,CAAC,CAAC,CAAC;AAC/D3C,aAAa,CAAGA,aAAa,CAAC/J,YAAY,CAAG,IAAI,CAACA,YAAa;AAClE,CAAC,CAAAuC,MAAA;AACD6H,UAAU,CAAV,SAAAA,UAAUA,CAACL,aAA6B,CAAE;AACzC,MAAO,KAAI,CAACjK,IAAI,CAACsC,MAAM,CAACgK,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAAC,IAAI,CAAC2E,eAAe,CAAC1C,aAAa,CAAC,CAAC;AAC7E,CAAC,CAAAxH,MAAA;AACDqK,cAAc,CAAd,SAAAA,cAAcA,CAAA,CAAG;AAChB,MAAO,KAAI,CAAC9M,IAAI,CAACsC,MAAM,CAACgK,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAAC,IAAI,CAAC9H,YAAY,CAAC;AAC3D,CAAC,CAAAuC,MAAA;AACDsK,KAAK,CAAL,SAAAA,KAAKA,CAAA,CAAG;AACP,IAAI,CAACtC,aAAa,CAAC,CAAC;AACpB,IAAI,CAACjK,EAAE,CAAG,IAAI,CAACC,KAAK;AACpB,IAAI,CAACF,OAAO,CAAG,KAAK;AACpB,IAAI,CAACmB,MAAM,CAAG,EAAE;AAChB,IAAI,CAACM,SAAS,CAAG,EAAE;AACnB,IAAI,CAAC/B,IAAI,CAAG,IAAI,CAACA,IAAI,EAAI,IAAI,CAACC,YAAY;AAC3C,CAAC,CAAAuC,MAAA;;;;;;;AAOD+C,OAAO,CAAP,SAAAA,OAAOA,CAACwH,QAAgB,CAAE;AACzB,GAAI,IAAI,CAACzM,OAAO,EAAI,CAAC,IAAI,CAACC,EAAE,CAAE,MAAO,EAAC;;;AAGtC,GAAI,IAAI,CAACA,EAAE,GAAK,CAAC,EAAI,IAAI,CAACC,KAAK,CAAG,EAAE,CAAE,MAAO,EAAC;;AAE9C,GAAI,IAAI,CAACA,KAAK,GAAK,EAAE,CAAE;;;;AAItB,GAAI,CAAA6C,KAAK,CAAGxD,OAAO,CAACmD,aAAa,CAAC,IAAI,CAACzC,EAAE,CAAE,IAAI,CAACK,OAAO,CAAC;AACxD,GAAI,CAAAkC,KAAK,CAAG,CAACO,KAAK,CAAC,CAAC,CAAC,CAAGA,KAAK,CAAC,CAAC,CAAC,EAAI,CAAC;AACrC,MAAO,CAAAI,IAAI,CAACyB,KAAK,CAAC6H,QAAQ,CAAGjK,KAAK,CAAC,EAAI,CAAC;AACzC;AACA,GAAI,CAAAU,UAAU,CAAGC,IAAI,CAACM,IAAI,CAAC,GAAG,CAAG,IAAI,CAACxD,EAAE,CAAG,IAAI,CAACC,KAAK,CAAC;AACtD,GAAKgD,UAAU,GAAK,GAAG,EAAM,IAAI,CAACjD,EAAE,CAAG,IAAI,CAACC,KAAM,CAAE;AACnDgD,UAAU,CAAG,EAAE;AAChB;AACA,MAAO,CAAAA,UAAU,CAAGuJ,QAAQ,CAAG,GAAG;AACnC,CAAC,CAAAvK,MAAA;AACDwK,SAAS,CAAT,SAAAA,SAASA,CAAA,CAAgB,IAAf,CAAA1J,SAAS,CAAAiD,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC;AACtB,MAAO,CAAA1G,OAAO,CAACmN,SAAS,CAAC,IAAI,CAAE,IAAI,CAACjN,IAAI,CAACsC,MAAM,CAAC4K,aAAa,CAAE3J,SAAS,CAAC;AAC1E,CAAC,CAAAzD,OAAA;AACMmN,SAAS,CAAhB,QAAO,CAAAA,SAASA,CAACpC,OAAsB,CAAEsC,OAAgB,CAAiB,IAAf,CAAA5J,SAAS,CAAAiD,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC;AACvE,GAAI2G,OAAO,CAAE,MAAU,CAAAtC,OAAO,CAACrK,EAAE,KAAIqK,OAAO,CAACpK,KAAK;AAClD,GAAIoK,OAAO,CAACpK,KAAK,GAAK,GAAG,CAAE,MAAU,CAAAoK,OAAO,CAACrK,EAAE;AAC/C,GAAIqK,OAAO,CAACpK,KAAK,GAAK,EAAE,CAAE,MAAO,CAAC,GAAG,CAAGoK,OAAO,CAACrK,EAAE,CAAGqK,OAAO,CAACpK,KAAK,EAAEoD,OAAO,CAACN,SAAS,CAAC,CAAG,GAAG;AAC5F,GAAI,CAAAD,KAAK,CAAGxD,OAAO,CAACmD,aAAa,CAAC4H,OAAO,CAACrK,EAAE,CAAEqK,OAAO,CAAChK,OAAO,CAAC;AAC9D,MAAO,CAAAf,OAAO,CAACuD,iBAAiB,CAACC,KAAK,CAAEC,SAAS,CAAE,QAAQ,CAAC;AAC7D,CAAC,CAAAd,MAAA;AACD2K,OAAO,CAAP,SAAAA,OAAOA,CAAA,CAAG;AACT,GAAI,IAAI,CAAC/K,MAAM,CAAE,IAAI,CAACA,MAAM,CAAC+K,OAAO,CAAC,CAAC;AACtC,IAAI,CAAC/K,MAAM,CAAG,IAAK;AACnB,IAAI,CAACrC,IAAI,CAAG,IAAK;AAClB,CAAC,QAAAF,OAAA;;;AAGWuN,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BhB,SAAAA,KAAY/K,MAAc,CAAEgL,CAAS,CAAE,MA5BvChL,MAAM,aACNrC,IAAI,CAAG,EAAE,MACTkH,EAAE,CAAG,EAAE,MACPoG,MAAM,aACND,CAAC,aACDE,KAAK,aACLC,GAAG,CAAS,IAAI,MAChBC,IAAI,CAAgB,IAAI,MACxBC,MAAM,CAAG,SAAS,MAClBC,MAAM,CAAa,EAAE,MACrBC,MAAM,CAAG,EAAE,MACXC,YAAY,CAAG,CAAC,MAChBC,CAAC,CAAG,CAAC,MACLC,CAAC,CAAG,CAAC,MACLC,CAAC,CAAG,CAAC,MACLC,aAAa,CAAY,IAAI,MAE7BC,MAAM,CAAmB,IAAI,MAE7BvL,MAAM,CAAG,CAAC,IAAI,CAAC,MACfwL,WAAW,CAAG,IAAI,MAClBvD,OAAO,CAAG,EAAE,MAEZwD,cAAc,CAEV,CAAC,CAAC,MACNC,YAAY,CAAG,CAAC;AAGf,IAAI,CAAChM,MAAM,CAAGA,MAAM;AACpB,IAAI,CAACgL,CAAC,CAAGA,CAAC;AACV,IAAI,CAACC,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAE,IAAI,CAAE,IAAI,CAAC,CAACD,CAAC,CAAW;AACnD,IAAI,CAACE,KAAK,CAAG,CAAC,EAAEF,CAAC,CAAG,CAAC,CAAC;AACvB,CAAC,IAAAiB,OAAA,CAAAlB,IAAA,CAAA3K,SAAA,CAAA6L,OAAA;;AAEDC,kBAAkB,CAAlB,SAAAA,kBAAkBA,CAAA,CAAG;AACpB,GAAI,CAAAC,OAAO,CAAG,CAAC,OAAO,CAAE,MAAM,CAAE,OAAO,CAAE,MAAM,CAAE,SAAS,CAAE,OAAO,CAAC;AACpE,IAAI,CAACd,MAAM,CAAGc,OAAO,CAAC/K,IAAI,CAACE,KAAK,CAACF,IAAI,CAACgL,MAAM,CAAC,CAAC,CAAGD,OAAO,CAACtK,MAAM,CAAC,CAAC;AAClE,CAAC,CAAAoK,OAAA;;AAEDI,OAAO,CAAP,SAAAA,OAAOA,CAACC,MAAc,CAAE;AACvB,MAAO,KAAI,CAACb,CAAC,CAAG,CAAC,CAAC,IAAI,CAACP,KAAK,CAAG,CAAC,CAAC,CAAG,CAAC,EAAIoB,MAAM;AAChD,CAAC,CAAAL,OAAA;AACDM,OAAO,CAAP,SAAAA,OAAOA,CAACD,MAAc,CAAE;AACvB,MAAO,KAAI,CAACZ,CAAC,CAAG,CAAC,CAAC,IAAI,CAACR,KAAK,CAAG,CAAC,CAAG,CAAC,CAAC,EAAIoB,MAAM;AAChD,CAAC,CAAAL,OAAA;AACDO,MAAM,CAAN,SAAAA,MAAMA,CAACF,MAAc,CAAE;AACtB,MAAO,CAAC,CAAC,IAAI,CAACpB,KAAK,CAAG,CAAC,CAAC,CAAG,CAAC,EAAIoB,MAAM;AACvC,CAAC,CAAAL,OAAA;AACDQ,MAAM,CAAN,SAAAA,MAAMA,CAACH,MAAc,CAAE;AACtB,MAAO,KAAI,CAACX,CAAC,CAAG,CAAC,CAAC,IAAI,CAACT,KAAK,CAAG,CAAC,CAAC,CAAG,CAAC,EAAIoB,MAAM;AAChD,CAAC,CAAAL,OAAA;;AAEDS,YAAY,CAAZ,SAAAA,YAAYA,CAAA,CAAG,SAAAC,GAAA,GAAAC,cAAA;AACQ,IAAI,CAACrE,OAAO,CAAAoE,GAAA,CAAAC,cAAA,CAAA/K,MAAA,CAAA8K,GAAA,IAA7B,GAAM,CAAApE,OAAO,CAAAqE,cAAA,CAAAD,GAAA,EAAkBpE,OAAO,CAACuC,OAAO,CAAC,CAAC,CAAC;AACtD,IAAI,CAACvC,OAAO,CAAG,EAAE;AACjB,IAAK,GAAI,CAAAH,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAAC9H,MAAM,CAACuB,MAAM,CAAEuG,CAAC,EAAE,CAAE,IAAI,CAAC9H,MAAM,CAAC8H,CAAC,CAAC,CAAG,IAAI;AAClE,IAAI,CAAC0D,WAAW,CAAG,IAAI;AACxB,CAAC,CAAAG,OAAA;AACDxB,KAAK,CAAL,SAAAA,KAAKA,CAAA,CAAG;AACP,IAAI,CAACiC,YAAY,CAAC,CAAC;AACnB,IAAI,CAACX,cAAc,CAAG,CAAC,CAAC;AACxB,IAAI,CAACC,YAAY,CAAG,CAAC;AACtB,CAAC,CAAAC,OAAA;AACDY,SAAS,CAAT,SAAAA,SAASA,CAACxB,MAAc,CAAE;AACzB,IAAI,CAACA,MAAM,CAAGA,MAAM;AACrB,CAAC,CAAAY,OAAA;AACDa,OAAO,CAAP,SAAAA,OAAOA,CAACnP,IAAY,CAAE0N,MAAe,CAAE;AACtC,GAAI1N,IAAI,CAAE,IAAI,CAACA,IAAI,CAAGA,IAAI;AAC1B,IAAI,CAACkH,EAAE,CAAGF,IAAI,CAAC,IAAI,CAAChH,IAAI,CAAC;AACzB,GAAI0N,MAAM,CAAE;AACX,IAAI,CAACwB,SAAS,CAACxB,MAAM,CAAC;AACvB,CAAC,IAAM;AACN,IAAI,CAACa,kBAAkB,CAAC,CAAC;AACzB,GAAI,IAAI,CAACf,GAAG,EAAI,IAAI,CAACE,MAAM,GAAK,IAAI,CAACF,GAAG,CAACE,MAAM,CAAE,IAAI,CAACa,kBAAkB,CAAC,CAAC;AAC3E;AACD,CAAC,CAAAD,OAAA;AACDc,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAACC,MAAkB,CAAEC,OAAgB,CAAE;AACtD,GAAI,CAAAC,SAAS,CAAGF,MAAM,CAACnI,EAAE;AACzB,GAAI,IAAI,CAACkH,cAAc,CAACmB,SAAS,CAAC,CAAE;AACnC,GAAIA,SAAS,GAAK,QAAQ,EAAIA,SAAS,GAAK,aAAa,CAAE;AAC1D,IAAI,CAACnB,cAAc,CAACmB,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE;AACpC;AACA,IAAI,CAAClN,MAAM,CAACC,KAAK,CAAC8M,gBAAgB,CAAC,IAAI,CAAC/B,CAAC,CAAEkC,SAAS,CAAC;AACrD;AACD;;AAEA,OAAQA,SAAS;AACjB,IAAK,YAAY;AAChB,IAAI,CAACnB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD,IAAK,SAAS;AACb,IAAI,CAACoO,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,IAAI,CAACqC,MAAM,CAACsH,GAAG,EAAI,CAAC,CAAG,CAAC,CAAG,CAAC,CAAC;AAClF;AACD,IAAK,WAAW;AACf,IAAI,CAACyE,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAEsP,OAAO,CAAG,CAAC,CAAG,CAAC,CAAE,CAAC,CAAC;AACrE;AACD,IAAK,aAAa;AACjB,IAAI,CAAClB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,IAAI,CAACqC,MAAM,CAACsH,GAAG,EAAI,CAAC,CAAG,CAAC,CAAG,CAAC,CAAC;AAClF;AACD,IAAK,MAAM;AACV,IAAI,CAACyE,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD,IAAK,UAAU;AACd,IAAI,CAACoO,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,IAAI,CAACqC,MAAM,CAACsH,GAAG,EAAI,CAAC,CAAG2F,OAAO,CAAG,CAAC,CAAG,CAAC,CAAGA,OAAO,CAAG,CAAC,CAAG,CAAC,CAAE,CAAC,CAAC;AAC9G;AACD,IAAK,YAAY;AAChB,IAAI,CAAClB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD,IAAK,aAAa;AAClB,IAAK,QAAQ;AACb,IAAK,aAAa;AAClB,IAAK,WAAW;AACf,IAAI,CAACoO,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD,IAAK,cAAc;AACnB,IAAK,eAAe;AACpB,IAAK,cAAc;AACnB,IAAK,eAAe;AACnB,IAAI,CAACoO,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD,IAAK,aAAa;AACjB,IAAI,CAACoO,cAAc,CAACmB,SAAS,CAAC,CAAG,CAAC,OAAO,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACnD;AACD,IAAK,aAAa;AACjB,IAAI,CAACnB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAAC,SAAS,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACrD;AACD,IAAK,YAAY;AAChB,IAAI,CAACnB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAAC,aAAa,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACzD;AACD;AACC,IAAI,CAACnB,cAAc,CAACmB,SAAS,CAAC,CAAG,CAACF,MAAM,CAACrP,IAAI,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC;AACvD;AACD;AACA,IAAI,CAACqC,MAAM,CAACC,KAAK,CAAC8M,gBAAgB,CAAC,IAAI,CAAC/B,CAAC,CAAEkC,SAAS,CAAC;AACtD,CAAC,CAAAjB,OAAA;AACDkB,mBAAmB,CAAnB,SAAAA,mBAAmBA,CAACD,SAAiB,CAAE;AACtC,GAAM,CAAArI,EAAE,CAAGF,IAAI,CAACuI,SAAS,CAAC;AAC1B,GAAI,CAAC,IAAI,CAACnB,cAAc,CAAClH,EAAE,CAAC,CAAE;AAC9B,MAAO,KAAI,CAACkH,cAAc,CAAClH,EAAE,CAAC;AAC9B,IAAI,CAAC7E,MAAM,CAACC,KAAK,CAACkN,mBAAmB,CAAC,IAAI,CAACnC,CAAC,CAAEnG,EAAE,CAAC;AAClD,CAAC,CAAAoH,OAAA;AACDmB,UAAU,CAAV,SAAAA,UAAUA,CAACzP,IAAY,CAAEE,KAAa,CAAEC,OAAe,CAAoB,IAAlB,CAAAuP,WAAW,CAAAnJ,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC,CAAC;AACxE,GAAM,CAAAoJ,UAAU,CAAGD,WAAW,EAAI,CAAC,CAAG,IAAI,CAAC9E,OAAO,CAAC8E,WAAW,CAAC,CAAGvL,SAAS;;AAE3E,GAAM,CAAArE,IAAI,CAAG,IAAI,CAACuC,MAAM,CAACuN,YAAY,CAAC5P,IAAI,CAAEE,KAAK,CAAEC,OAAO,CAAC;AAC3D,GAAM,CAAA0P,IAAI,CAAG,GAAI,CAAAhQ,OAAO,CAACC,IAAI,CAAE,IAAI,CAAC;AACpC,GAAI6P,UAAU,CAAE;AACfE,IAAI,CAAC3O,IAAI,CAAGyO,UAAU,CAACzO,IAAI;AAC3B2O,IAAI,CAAC9O,WAAW,CAAG4O,UAAU,CAAC5O,WAAW;AACzC8O,IAAI,CAAC5O,YAAY,CAAG0O,UAAU,CAAC1O,YAAY;AAC3C4O,IAAI,CAAC7O,QAAQ,CAAG2O,UAAU,CAAC3O,QAAQ;AACnC6O,IAAI,CAACtO,QAAQ,CAAGoO,UAAU,CAACpO,QAAQ;AACpC;;AAEA,GAAI,CAACsO,IAAI,CAAC/O,OAAO,EAAI+O,IAAI,CAAC9O,WAAW,CAAE8O,IAAI,CAAC/O,OAAO,CAAG+O,IAAI,CAAC9O,WAAW;AACtE,GAAI,CAAC8O,IAAI,CAAC7O,QAAQ,EAAI6O,IAAI,CAAC5O,YAAY,CAAE4O,IAAI,CAAC7O,QAAQ,CAAG6O,IAAI,CAAC5O,YAAY;AAC1E4O,IAAI,CAAC/C,KAAK,CAAC,CAAC;AACZ,GAAI6C,UAAU,QAAVA,UAAU,CAAE5N,SAAS,CAACmC,MAAM,CAAE2L,IAAI,CAAC9N,SAAS,CAAG4N,UAAU,CAAC5N,SAAS;;AAEvE,GAAI2N,WAAW,EAAI,CAAC,CAAE;AACrB,IAAI,CAAC9E,OAAO,CAAC8E,WAAW,CAAC,CAAGG,IAAI;AACjC,CAAC,IAAM;AACN,IAAI,CAACjF,OAAO,CAACvC,IAAI,CAACwH,IAAI,CAAC;AACxB;AACA,GAAI,IAAI,CAACjF,OAAO,CAAC1G,MAAM,CAAG,IAAI,CAAC2J,YAAY,EAAI,IAAI,CAACxL,MAAM,CAACyN,aAAa,CAAE;;AAEzE,GAAI,CAAAC,aAA6C,CAAG,CAAC,CAAC;AACtD,GAAI,CAAAC,QAAQ,CAAG,CAAC,CAAC;AACjB,IAAK,GAAI,CAAAC,MAAM,CAAG,CAAC,CAAEA,MAAM,CAAG,IAAI,CAACrF,OAAO,CAAC1G,MAAM,CAAE+L,MAAM,EAAE,CAAE;AAC5D,GAAI,CAAAC,KAAK,CAAG,IAAI,CAACtF,OAAO,CAACqF,MAAM,CAAC;AAChC,GAAI,CAACC,KAAK,CAAC9P,QAAQ,CAAE;AACrB,GAAI8P,KAAK,CAAC9P,QAAQ,GAAI,CAAA2P,aAAa,CAAE;AACpC,GAAI,CAAAI,MAAM,CAAGJ,aAAa,CAACG,KAAK,CAAC9P,QAAQ,CAAC;AAC1C,GAAI,CAAAgQ,KAAK,CAAG,IAAI,CAACxF,OAAO,CAACuF,MAAM,CAAC;AAChC,GAAIN,IAAI,GAAKK,KAAK,CAAE;AACnBF,QAAQ,CAAGG,MAAM;AAClB,CAAC,IAAM,IAAIN,IAAI,GAAKO,KAAK,CAAE;AAC1BJ,QAAQ,CAAGC,MAAM;AAClB,CAAC,IAAM,IAAI,IAAI,CAACtN,MAAM,CAACC,QAAQ,CAACsN,KAAK,CAAC,CAAE;AACvCF,QAAQ,CAAGG,MAAM;AAClB,CAAC,IAAM,IAAI,IAAI,CAACxN,MAAM,CAACC,QAAQ,CAACwN,KAAK,CAAC,CAAE;AACvCJ,QAAQ,CAAGC,MAAM;AAClB,CAAC,IAAM,IAAIC,KAAK,CAAC5P,OAAO,EAAI,CAAC8P,KAAK,CAAC9P,OAAO,CAAE;AAC3C0P,QAAQ,CAAGG,MAAM;AAClB,CAAC,IAAM;AACNH,QAAQ,CAAGC,MAAM;AAClB;AACA;AACD;AACAF,aAAa,CAACG,KAAK,CAAC9P,QAAQ,CAAC,CAAG6P,MAAM;AACvC;AACA,GAAID,QAAQ,EAAI,CAAC,CAAE;AAClB,GAAI,IAAI,CAACpF,OAAO,CAACoF,QAAQ,CAAC,CAAC1P,OAAO,CAAE;;AAEnC,GAAI,CAAA+P,aAAa,CAAG,IAAI,CAAC,QAAAC,IAAA,GAAAC,cAAA;AACH,IAAI,CAAC3F,OAAO,CAAA0F,IAAA,CAAAC,cAAA,CAAArM,MAAA,CAAAoM,IAAA,GAAE,CAA/B,GAAM,CAAAE,OAAO,CAAAD,cAAA,CAAAD,IAAA;AACjB,GAAIE,OAAO,GAAKX,IAAI,CAAE;AACtB,GAAIW,OAAO,CAAClQ,OAAO,CAAE;AACrB,GAAI,IAAI,CAACqC,MAAM,CAACC,QAAQ,CAAC4N,OAAO,CAAC,CAAE;AACnC,GAAIA,OAAO,CAACvQ,YAAY,GAAK,SAAS,EAAIuQ,OAAO,CAACvQ,YAAY,GAAK,OAAO,EAAIuQ,OAAO,CAAC1P,OAAO,GAAK,UAAU,CAAE;AAC7GuP,aAAa,CAAGG,OAAO;AACvB;AACD;AACD;AACA,GAAI,CAACH,aAAa,CAAE,SAAAI,IAAA,GAAAC,cAAA;;;;;AAKG,IAAI,CAAC9F,OAAO,CAAA6F,IAAA,CAAAC,cAAA,CAAAxM,MAAA,CAAAuM,IAAA,GAAE,CAA/B,GAAM,CAAAD,QAAO,CAAAE,cAAA,CAAAD,IAAA;AACjB,GAAID,QAAO,GAAKX,IAAI,CAAE;AACtB,GAAIW,QAAO,CAAClQ,OAAO,CAAE;AACrB,GAAI,IAAI,CAACqC,MAAM,CAACC,QAAQ,CAAC4N,QAAO,CAAC,CAAE;AACnCH,aAAa,CAAGG,QAAO;AACvB;AACD;AACD;AACA,GAAIH,aAAa,CAAE;AAClBA,aAAa,CAAC/P,OAAO,CAAG,IAAI;AAC5B+P,aAAa,CAAC9P,EAAE,CAAG,CAAC;AACpB8P,aAAa,CAAC5O,MAAM,CAAG,EAAE;AAC1B;AACD;AACA,IAAI,CAACmJ,OAAO,CAACF,MAAM,CAACsF,QAAQ,CAAE,CAAC,CAAC;AACjC;AACD;AACA,IAAI,CAAC3N,MAAM,CAACC,KAAK,CAACqO,aAAa,CAAC,IAAI,CAAC;;AAErC,MAAO,CAAAd,IAAI;AACZ,CAAC,CAAAvB,OAAA;;AAEDsC,QAAQ,CAAR,SAAAA,QAAQA,CAAChG,OAAgB,CAAEiG,MAAc,CAAuB,IAArB,CAAAxQ,IAAI,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAGqE,OAAO,CAACvK,IAAI;AAC7D,IAAI,CAACsC,MAAM,CAACtC,IAAI,CAAC,CAAGuK,OAAO;AAC3BA,OAAO,CAACvK,IAAI,CAAGA,IAAI;AACnBuK,OAAO,CAACJ,aAAa,CAAC,CAAC;AACvBI,OAAO,CAAC9I,QAAQ,CAAG,EAAE;AACrB,IAAI,CAACO,MAAM,CAACP,QAAQ,CAAG,WAAW;AAClC,GAAM,CAAAuN,MAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACzC,GAAI,CAAC,WAAW,CAAE,YAAY,CAAE,UAAU,CAAC,CAACnO,QAAQ,CAACyM,MAAM,CAACnI,EAAE,CAAC,CAAE;AAChE0D,OAAO,CAACD,gBAAgB,CAAC,IAAI,CAACwD,WAAW,CAAGkB,MAAM,CAACnI,EAAE,GAAK,UAAU,CAAG,UAAU,CAAG,KAAK,CAAC;AAC3F,CAAC,IAAM,IAAI,IAAI,CAAC7E,MAAM,CAACuH,IAAI,CAAChH,QAAQ,aAAa,CAAC,EAAI,CAACyM,MAAM,CAACnI,EAAE,CAAE;AACjE,GAAI,IAAI,CAACiH,WAAW,EAAI,CAAC,IAAI,CAACA,WAAW,CAAC7N,OAAO,CAAEsK,OAAO,CAACD,gBAAgB,CAAC,IAAI,CAACwD,WAAW,CAAE,KAAK,CAAC;AACrG;;AAEA,IAAI,CAAC9L,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACpG,OAAO,CAAEvK,IAAI,CAAC;AAC5C,CAAC,CAAAiO,OAAA;AACD2C,MAAM,CAAN,SAAAA,MAAMA,CAACrG,OAAgB,CAAuB,IAArB,CAAAvK,IAAI,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAGqE,OAAO,CAACvK,IAAI;AAC3C,GAAI,CAAA6Q,UAAU,CAAG,IAAI,CAACvO,MAAM,CAACtC,IAAI,CAAC;AAClC,GAAI6Q,UAAU,GAAKtG,OAAO,CAAE;AAC5B,IAAI,CAACuD,WAAW,CAAG+C,UAAU;AAC7B,GAAIA,UAAU,CAAE;AACf,IAAI,CAAC7O,MAAM,CAACC,KAAK,CAAC6O,WAAW,CAACD,UAAU,CAAC;AACzCA,UAAU,CAAC1G,aAAa,CAAC,CAAC;AAC3B;AACAI,OAAO,CAACJ,aAAa,CAAC,CAAC;AACvBI,OAAO,CAAC9I,QAAQ,CAAG,EAAE;AACrB,IAAI,CAACO,MAAM,CAACP,QAAQ,CAAG,WAAW;AAClC,IAAI,CAACa,MAAM,CAACtC,IAAI,CAAC,CAAGuK,OAAO;AAC3BA,OAAO,CAACvK,IAAI,CAAGA,IAAI;;AAEnB,IAAI,CAACgC,MAAM,CAACC,KAAK,CAAC8O,UAAU,CAACxG,OAAO,CAAEvK,IAAI,CAAC;AAC5C,CAAC,CAAAiO,OAAA;AACDxI,OAAO,CAAP,SAAAA,OAAOA,CAAC8E,OAAgB,CAAuB,IAArB,CAAAvK,IAAI,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAGqE,OAAO,CAACvK,IAAI;AAC5C,GAAI,CAAA6Q,UAAU,CAAG,IAAI,CAACvO,MAAM,CAACtC,IAAI,CAAC;AAClC,GAAIuK,OAAO,GAAKsG,UAAU,CAAE;AAC5B,IAAI,CAAC/C,WAAW,CAAG+C,UAAU;AAC7BtG,OAAO,CAACJ,aAAa,CAAC,CAAC;AACvB,GAAI0G,UAAU,CAAE;AACftG,OAAO,CAAC9I,QAAQ,CAAGoP,UAAU,CAACpP,QAAQ;AACtC8I,OAAO,CAACrK,EAAE,CAAG2Q,UAAU,CAAC3Q,EAAE;AAC1BqK,OAAO,CAACpK,KAAK,CAAG0Q,UAAU,CAAC1Q,KAAK;AAChCoK,OAAO,CAAChK,OAAO,CAAGsQ,UAAU,CAACtQ,OAAO;AACpCgK,OAAO,CAACnJ,MAAM,CAAGyP,UAAU,CAACzP,MAAM;AAClCmJ,OAAO,CAACD,gBAAgB,CAACuG,UAAU,CAAE,IAAI,CAAC;AAC1CtG,OAAO,CAAC5I,UAAU,CAAAqP,MAAA,CAAAC,MAAA,IAAQJ,UAAU,CAAClP,UAAU,CAAE;AACjD,GAAIkP,UAAU,CAAC5P,aAAa,CAAE;AAC7BsJ,OAAO,CAACtJ,aAAa,CAAG4P,UAAU,CAAC5P,aAAa;AAChDsJ,OAAO,CAACrJ,QAAQ,CAAG2P,UAAU,CAAC5P,aAAa;AAC3C4P,UAAU,CAAC5P,aAAa,CAAG,EAAE;AAC7B4P,UAAU,CAAC3P,QAAQ,CAAG,EAAE;AACzB;;;AAGA2P,UAAU,CAAC5Q,OAAO,CAAG,KAAK;AAC1B4Q,UAAU,CAAC3Q,EAAE,CAAG2Q,UAAU,CAAC1Q,KAAK;AAChC0Q,UAAU,CAACzP,MAAM,CAAG,KAAK;AAC1B;AACA,IAAI,CAACkB,MAAM,CAACtC,IAAI,CAAC,CAAGuK,OAAO;AAC3BA,OAAO,CAACvK,IAAI,CAAGA,IAAI;;AAEnB,GAAI6Q,UAAU,CAAE;AACf,IAAI,CAAC7O,MAAM,CAACC,KAAK,CAACiP,YAAY,CAACL,UAAU,CAAE,IAAI,CAAC;AACjD;AACA,IAAI,CAAC7O,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACpG,OAAO,CAAEvK,IAAI,CAAE,IAAI,CAAC;AAClD,CAAC,CAAAiO,OAAA;AACDkD,SAAS,CAAT,SAAAA,SAASA,CAAC5G,OAAgB,CAAEiG,MAAc,CAAuB,IAArB,CAAAxQ,IAAI,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAGqE,OAAO,CAACvK,IAAI;AAC9D,GAAM,CAAAgP,MAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACzC,GAAI,CAAC,CAAC,WAAW,CAAE,YAAY,CAAE,UAAU,CAAC,CAACnO,QAAQ,CAACyM,MAAM,CAACnI,EAAE,CAAC;AAC/D,EAAE,IAAI,CAAC7E,MAAM,CAACuH,IAAI,CAAChH,QAAQ,aAAa,CAAC,EAAI,CAACyM,MAAM,CAACnI,EAAE,CAAC,CAAE;AAC1D0D,OAAO,CAACJ,aAAa,CAAC,CAAC;AACxB,CAAC,IAAM;AACNI,OAAO,CAAC3E,cAAc,CAAC,WAAiB,CAAC;AACzC2E,OAAO,CAAC3E,cAAc,CAAC,aAAmB,CAAC;AAC5C;AACA,GAAI,CAAC,CAAC,WAAW,CAAE,YAAY,CAAE,UAAU,CAAE,UAAU,CAAC,CAACrD,QAAQ,CAACyM,MAAM,CAACnI,EAAE,CAAC;AAC3E,EAAE,IAAI,CAAC7E,MAAM,CAACuH,IAAI,CAAChH,QAAQ,aAAa,CAAC,EAAI,CAACyM,MAAM,CAACnI,EAAE,CAAC,CAAE;AAC1D,IAAI,CAAC7E,MAAM,CAACoP,GAAG,CAAC,CAAC,WAAW,CAAE7G,OAAO,CAAC1K,KAAK,CAAC,CAAE,CAAE6Q,IAAI,CAAE1B,MAAM,CAACnI,EAAG,CAAC,CAAC;AACnE;AACA0D,OAAO,CAAC5I,UAAU,CAACE,UAAU,CAAG,CAAC;AACjC,GAAI,IAAI,CAACG,MAAM,CAACsH,GAAG,GAAK,CAAC,CAAEiB,OAAO,CAAC5I,UAAU,CAACC,UAAU,CAAG,CAAC;AAC5D,IAAI,CAACkM,WAAW,CAAGvD,OAAO;AAC1B,IAAI,CAACjI,MAAM,CAACtC,IAAI,CAAC,CAAG,IAAI;;AAExB,IAAI,CAACgC,MAAM,CAACC,KAAK,CAACiP,YAAY,CAAC3G,OAAO,CAAC;AACxC,CAAC,CAAA0D,OAAA;AACDoD,MAAM,CAAN,SAAAA,MAAMA,CAAC9G,OAAgB,CAAEvK,IAAY,CAAE;AACtC,GAAIuK,OAAO,CAACvK,IAAI,GAAKA,IAAI,CAAE;AAC3B,GAAI,CAAAsR,MAAM,CAAG,IAAI,CAAChP,MAAM,CAACtC,IAAI,CAAC;;AAE9B,GAAI,CAAAuR,KAAK,CAAGhH,OAAO,CAACvK,IAAI;;AAExBuK,OAAO,CAACvK,IAAI,CAAGA,IAAI;AACnB,GAAIsR,MAAM,CAAEA,MAAM,CAACtR,IAAI,CAAGuR,KAAK;;AAE/B,IAAI,CAACjP,MAAM,CAACtC,IAAI,CAAC,CAAGuK,OAAO;AAC3B,IAAI,CAACjI,MAAM,CAACiP,KAAK,CAAC,CAAGD,MAAM;;AAE3B,IAAI,CAACtP,MAAM,CAACC,KAAK,CAACiP,YAAY,CAAC3G,OAAO,CAAE,IAAI,CAAC;AAC7C,GAAI+G,MAAM,CAAE,IAAI,CAACtP,MAAM,CAACC,KAAK,CAACiP,YAAY,CAACI,MAAM,CAAE,IAAI,CAAC;;AAExD,IAAI,CAACtP,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACpG,OAAO,CAAEvK,IAAI,CAAE,IAAI,CAAC;AACjD,GAAIsR,MAAM,CAAE,IAAI,CAACtP,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACW,MAAM,CAAEC,KAAK,CAAE,IAAI,CAAC;AAC9D,CAAC,CAAAtD,OAAA;AACDuD,QAAQ,CAAR,SAAAA,QAAQA,CAACjH,OAAgB,CAAE+G,MAAe,CAAEd,MAAc,CAAE;;AAE3D,GAAIjG,OAAO,GAAK+G,MAAM,CAAE;;AAExB,GAAI,CAAAC,KAAK,CAAGhH,OAAO,CAACvK,IAAI;AACxB,GAAI,CAAAyR,KAAK,CAAGH,MAAM,CAACtR,IAAI;;AAEvBuK,OAAO,CAACvK,IAAI,CAAGyR,KAAK;AACpBH,MAAM,CAACtR,IAAI,CAAGuR,KAAK;AACnB,IAAI,CAACjP,MAAM,CAACmP,KAAK,CAAC,CAAGlH,OAAO;AAC5B,IAAI,CAACjI,MAAM,CAACiP,KAAK,CAAC,CAAGD,MAAM;;AAE3B,IAAI,CAACtP,MAAM,CAACC,KAAK,CAACiP,YAAY,CAAC3G,OAAO,CAAE,IAAI,CAAC;AAC7C,IAAI,CAACvI,MAAM,CAACC,KAAK,CAACiP,YAAY,CAACI,MAAM,CAAE,IAAI,CAAC;;AAE5C,IAAI,CAACtP,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACpG,OAAO,CAAEkH,KAAK,CAAE,IAAI,CAAC;AAClD,IAAI,CAACzP,MAAM,CAACC,KAAK,CAAC0O,UAAU,CAACW,MAAM,CAAEC,KAAK,CAAE,IAAI,CAAC;AAClD,CAAC,CAAAtD,OAAA;AACDyD,KAAK,CAAL,SAAAA,KAAKA,CAACnH,OAAgB,CAAuB,IAArB,CAAAvK,IAAI,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAGqE,OAAO,CAACvK,IAAI;AAC1CuK,OAAO,CAACJ,aAAa,CAAC,CAAC;AACvB,IAAI,CAAC2D,WAAW,CAAGvD,OAAO;AAC1B,IAAI,CAACjI,MAAM,CAACtC,IAAI,CAAC,CAAG,IAAI;;AAExBuK,OAAO,CAACtK,OAAO,CAAG,IAAI;AACtBsK,OAAO,CAACrK,EAAE,CAAG,CAAC;AACdqK,OAAO,CAACtJ,aAAa,CAAG,EAAE;AAC1BsJ,OAAO,CAACzK,OAAO,CAAGyK,OAAO,CAACzK,OAAO,CAAC2F,OAAO,CAAC,gBAAgB,CAAE,EAAE,CAAC;AAC/D8E,OAAO,CAACxK,QAAQ,CAAGwK,OAAO,CAACxK,QAAQ,CAAC0F,OAAO,CAAC,gBAAgB,CAAE,EAAE,CAAC;AACjE,GAAI8E,OAAO,CAAC7K,IAAI,CAACsO,YAAY,CAAG,GAAG,CAAEzD,OAAO,CAAC7K,IAAI,CAACsO,YAAY,EAAE;;AAEhE,IAAI,CAAChM,MAAM,CAACC,KAAK,CAAC0P,SAAS,CAACpH,OAAO,CAAC;AACrC,CAAC,CAAA0D,OAAA;AACDnB,OAAO,CAAP,SAAAA,OAAOA,CAAA,CAAG;AACT,IAAI,CAAC4B,YAAY,CAAC,CAAC;AACnB,IAAI,CAAC1M,MAAM,CAAG,IAAK;AACnB,IAAI,CAACmL,GAAG,CAAG,IAAK;AACjB,CAAC,QAAAJ,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDW6E,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkHlB,SAAAA,OAAA;;;;;;;;;;;AAWQ,KAAAC,KAAA,SAXI,CAAAC,OAWX,CAAA5L,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC,CAAC,MA5HNjE,KAAK,aAEL8P,iBAAiB,CAAG,KAAK,MAEzBC,SAAS,aAETC,gBAAgB,CAAa,EAAE,MAC/BC,iBAAiB,CAA4B,IAAI,MAEjDC,WAAW,CAAG,CAAC,MAEfC,OAAO,CAAkB,IAAI,MAE7BC,kBAAkB,CAAkB,IAAI,MAExCC,YAAY,aAIZC,IAAI,CAAG,KAAK,MACZC,eAAe,CAAG,GAAG,MACrBC,gBAAgB,CAAG,CAAC,MAEpBC,eAAe,CAAG,CAAC,MAMnBC,IAAI,CAAG,CAAC,CAAC,MAOTC,UAAU,CAAG,KAAK,MAQlBC,OAAO,CAAG,KAAK,MAKfC,KAAK,CAAG,KAAK,MACbC,QAAQ,CAAG,KAAK,MAChBC,UAAU,CAAG,KAAK,MAClBC,OAAO,CAAG,EAAE,MACZC,aAAa,CAAG,EAAE,MAClBC,eAAe,CAAG,CAAC,MACnBC,kBAAkB,CAAG,CAAC,MAMtBC,MAAM,CAAS,IAAI,MACnBC,QAAQ,CAAS,IAAI,MACrBC,OAAO,CAAS,IAAI,MACpBC,EAAE,CAAS,IAAI,MACfC,EAAE,CAAS,IAAI,MACfC,EAAE,CAAU,IAAI,MAChBC,EAAE,CAAU,IAAI,MAChBC,iBAAiB,CAAG,CAAC,MACrBC,KAAK,CAAW,IAAI,MACpBC,SAAS,CAA2B,IAAI,MACxCC,aAAa,CAA2B,IAAI,MAC5CtS,QAAQ,CAAG,EAAE,MAEb6H,GAAG,CAAG,CAAC,MACP0C,GAAG,CAAcvE,GAAG,MACpBuM,gBAAgB,CAAG,CAAC,MACpBvE,aAAa,CAAG,KAAK,MACrBlG,IAAI,CAAG,EAAE,MACT0K,QAAQ,CAA4E,SAAS,MAC7FC,UAAU,CAAG,IAAI,MACjBC,KAAK,CAAqB,KAAK,MAC/BC,KAAK,CAA0C,CAAC,CAAC,MACjDC,OAAO,CAAG,KAAK,MACfzH,aAAa,CAAG,KAAK,MACrB0H,kBAAkB,CAAG,KAAK,MAC1BC,aAAa,CAAG,CAAC,MACjBC,aAAa,CAAG,CAAC,MAMjBC,eAAe,CAAqB,KAAK,MAGzC5N,EAAE,CAAG,EAAE,MAEP6N,MAAM,CAAG,EAAE,MACXC,YAAY,CAAG,KAAK,MACpBC,WAAW,CAAG,CAAC,CAACnN,GAAG,CAACoN,KAAK,CAAC,aAAa,CAAC,MACxCC,cAAc,CAAG,CAAC,CAACrN,GAAG,CAACoN,KAAK,CAAC,WAAW,CAAC,MACzCE,YAAY,CAAG,CAAC,CAACtN,GAAG,CAACoN,KAAK,CAAC,cAAc,CAAC,MAC1CG,KAAK,aACLC,WAAW,CAAG,KAAK,MACnBC,UAAU,aAMVC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CNC,QAAQ,CAAG,UAAM;AAChB,GAAM,CAAAC,KAAK,CAAGC,CAAC,CAACC,MAAM,CAAC,CAACF,KAAK,CAAC,CAAE;AAChC,GAAIA,KAAK,CAAG,GAAG,EAAIxD,KAAI,CAAC8C,YAAY,CAAE;AACrC9C,KAAI,CAACY,gBAAgB,CAAG,GAAG;AAC5B,CAAC,IAAM;AACNZ,KAAI,CAACY,gBAAgB,CAAG,CAAC;AAC1B;AACA,GAAI4C,KAAK,EAAIA,KAAK,CAAG,GAAG,CAAE,KAAAG,kBAAA,CAAAC,mBAAA,CAAAC,mBAAA;AACzB,GAAM,CAAAC,KAAK,CAAIN,KAAK,CAAG,GAAI;AAC3B,CAAAG,kBAAA,CAAA3D,KAAI,CAAC5P,KAAK,CAAC2T,MAAM,SAAjBJ,kBAAA,CAAmBK,GAAG,CAAC,WAAW,UAAWF,KAAK,IAAG,CAAC;AACtD,CAAAF,mBAAA,CAAA5D,KAAI,CAAC5P,KAAK,CAAC2T,MAAM,SAAjBH,mBAAA,CAAmBI,GAAG,CAAC,kBAAkB,CAAE,UAAU,CAAC;AACtD,CAAAH,mBAAA,CAAA7D,KAAI,CAAC5P,KAAK,CAAC2T,MAAM,SAAjBF,mBAAA,CAAmBG,GAAG,CAAC,eAAe,CAAK,GAAG,CAAGF,KAAK,CAAG,GAAG,KAAI,CAAC;;AAElE,CAAC,IAAM,KAAAG,mBAAA,CAAAC,mBAAA;AACN,CAAAD,mBAAA,CAAAjE,KAAI,CAAC5P,KAAK,CAAC2T,MAAM,SAAjBE,mBAAA,CAAmBD,GAAG,CAAC,WAAW,CAAE,MAAM,CAAC;;AAE3C,CAAAE,mBAAA,CAAAlE,KAAI,CAAC5P,KAAK,CAAC2T,MAAM,SAAjBG,mBAAA,CAAmBF,GAAG,CAAC,eAAe,CAAE,GAAG,CAAC;AAC7C;AACD,CAAC,CAnDA,IAAI,CAAChP,EAAE,CAAGiL,OAAO,CAACjL,EAAE,EAAI,EAAE,CAE1B,GAAIiL,OAAO,CAAC8D,MAAM,EAAI9D,OAAO,CAACkE,SAAS,CAAE,CACxC,IAAI,CAAC/T,KAAK,CAAG,GAAI,CAAAgU,WAAW,CAAC,IAAI,CAAEnE,OAAO,CAAC8D,MAAM,CAAE9D,OAAO,CAACkE,SAAS,CAAC,CACtE,CAAC,IAAM,IAAI,CAAClE,OAAO,CAAC8D,MAAM,EAAI,CAAC9D,OAAO,CAACkE,SAAS,CAAE,CACjD,IAAI,CAAC/T,KAAK,CAAG,GAAI,CAAAiU,eAAe,CAAC,CAAC,CACnC,CAAC,IAAM,CACN,KAAM,IAAI,CAAAC,KAAK,uDAAuD,CAAC,CACxE,CAEA,IAAI,CAAChB,MAAM,CAAG,CAAC,CAACrD,OAAO,CAACqD,MAAM,CAC9B,IAAI,CAACtC,OAAO,CAAG,CAAC,IAAI,CAACsC,MAAM,CAC3B,IAAI,CAACH,KAAK,CAAG,CAAC,CAAClD,OAAO,CAACkD,KAAK,CAC5B,GAAI,MAAO,CAAAlD,OAAO,CAACV,GAAG,GAAK,QAAQ,CAAEU,OAAO,CAACV,GAAG,CAAGU,OAAO,CAACV,GAAG,CAAC5F,KAAK,CAAC,IAAI,CAAC,CAC1E,IAAI,CAACwG,SAAS,CAAGF,OAAO,CAACV,GAAG,EAAI,EAAE,CAClC,IAAI,CAACkB,YAAY,CAAGR,OAAO,CAACQ,YAAY,EAAI,IAAI,CAChD,IAAI,CAAC4C,UAAU,CAAG,CAAC,CAACpD,OAAO,CAACoD,UAAU,CAEtC,IAAI,CAAC1B,EAAE,CAAG,GAAI,CAAAzG,IAAI,CAAC,IAAI,CAAE,CAAC,CAAC,CAC3B,IAAI,CAAC0G,EAAE,CAAG,GAAI,CAAA1G,IAAI,CAAC,IAAI,CAAE,CAAC,CAAC,CAC3B,IAAI,CAAC8G,KAAK,CAAG,CAAC,IAAI,CAACL,EAAE,CAAE,IAAI,CAACC,EAAE,CAAC,CAC/B,IAAI,CAACA,EAAE,CAACtG,GAAG,CAAG,IAAI,CAACqG,EAAE,CACrB,IAAI,CAACA,EAAE,CAACrG,GAAG,CAAG,IAAI,CAACsG,EAAE,CACrB,IAAI,CAACH,QAAQ,CAAG,IAAI,CAACD,MAAM,CAAG,IAAI,CAACG,EAAE,CACrC,IAAI,CAACD,OAAO,CAAG,IAAI,CAACE,EAAE,CAEtB,IAAI,CAAC2C,SAAS,CAAC,CAAC,CAChB,GAAI,IAAI,CAAClB,UAAU,CAAE,CACpBK,MAAM,CAACc,gBAAgB,CAAC,QAAQ,CAAE,IAAI,CAACjB,QAAQ,CAAC,CAChD,IAAI,CAACA,QAAQ,CAAC,CAAC,CAChB,CACD,CAAC,IAAAkB,OAAA,CAAA1E,MAAA,CAAAxP,SAAA,CAAAkU,OAAA;;AAsBDC,SAAS,CAAT,SAAAA,SAASA,CAACC,QAAgC,CAAE;AAC3C,IAAI,CAAClE,YAAY,CAAGkE,QAAQ;AAC7B,CAAC,CAAAF,OAAA;;AAEDG,mBAAmB,CAAnB,SAAAA,mBAAmBA,CAACxD,OAAe,CAAE;AACpC,IAAK,GAAI,CAAA7I,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAAC8I,aAAa,CAACrP,MAAM,CAAEuG,CAAC,EAAE,CAAE;AACnD,GAAI,IAAI,CAAC8I,aAAa,CAAC9I,CAAC,CAAC,CAAC,CAAC,CAAC,GAAK6I,OAAO,CAAE;AACzC,IAAI,CAACC,aAAa,CAAC7I,MAAM,CAACD,CAAC,CAAE,CAAC,CAAC;AAC/B,IAAI,CAACnI,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC1B;AACD;AACD;AACD,CAAC,CAAAJ,OAAA;AACDK,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAAC1D,OAAe,CAAE2D,WAAmB,CAAEC,QAAgB,CAAE;AACxE,IAAI,CAAC3D,aAAa,CAAClL,IAAI,CAAC,CAACiL,OAAO,CAAE2D,WAAW,CAAEC,QAAQ,CAAC,CAAC;AACzD,IAAI,CAAC5U,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC3B,CAAC,CAAAJ,OAAA;AACDzK,gBAAgB,CAAhB,SAAAA,gBAAgBA,CAACoH,OAAe,CAAE,SAAA6D,IAAA,GAAAC,oBAAA;AACC,IAAI,CAAC7D,aAAa,CAAA4D,IAAA,CAAAC,oBAAA,CAAAlT,MAAA,CAAAiT,IAAA,GAAE,KAAAE,KAAA,CAAAD,oBAAA,CAAAD,IAAA,KAA1C,CAAAG,iBAAiB,CAAAD,KAAA;AAC5B,GAAI/D,OAAO,GAAKgE,iBAAiB,CAAE;AAClC,MAAO,KAAI;AACZ;AACD;AACA,MAAO,MAAK;AACb,CAAC,CAAAX,OAAA;AACDY,YAAY,CAAZ,SAAAA,YAAYA,CAAA,CAAG;AACd,GAAM,CAAAC,WAAW,CAAG,EAAE;;AAEtB,IAAK,GAAI,CAAA/M,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAE,CAAE;AAC3B,GAAM,CAAA1K,IAAI,CAAG,IAAI,CAACmU,KAAK,CAACzJ,CAAC,CAAC,CAAC,QAAAgN,IAAA,GAAAC,aAAA;AACN3X,IAAI,CAAC4C,MAAM,CAAA8U,IAAA,CAAAC,aAAA,CAAAxT,MAAA,CAAAuT,IAAA,GAAE,CAA7B,GAAM,CAAA9U,MAAM,CAAA+U,aAAA,CAAAD,IAAA;AAChB,GAAI9U,MAAM,EAAI,CAACA,MAAM,CAACrC,OAAO,CAAE;AAC9BkX,WAAW,CAACnP,IAAI,CAAC1F,MAAM,CAAC;AACzB;AACD;AACD;AACA,MAAO,CAAA6U,WAAW;AACnB,CAAC,CAAAb,OAAA;;AAEDpK,UAAU,CAAV,SAAAA,UAAUA,CAAA,CAAG,SAAAoL,IAAA,GAAAC,mBAAA;AACS,IAAI,CAACL,YAAY,CAAC,CAAC,CAAAI,IAAA,CAAAC,mBAAA,CAAA1T,MAAA,CAAAyT,IAAA,GAAE,CAArC,GAAM,CAAAhV,MAAM,CAAAiV,mBAAA,CAAAD,IAAA;AAChB,GAAI,CAAChV,MAAM,CAAC7B,OAAO,GAAK,kBAAkB,EAAI6B,MAAM,CAAC3B,QAAQ,GAAK,kBAAkB,GAAK,CAAC2B,MAAM,CAAChB,SAAS,CAAC,YAAY,CAAC,CAAE,CAAE,MAAO,KAAI,CAAE;AAC1I;AACA,MAAO,MAAK;AACb,CAAC,CAAAgV,OAAA;AACDkB,aAAa,CAAb,SAAAA,aAAaA,CAACrP,SAA4B,CAAE;AAC3C,GAAI,MAAO,CAAAA,SAAS,GAAK,QAAQ,CAAEA,SAAS,CAAG,CAACA,SAAS,CAAC;AAC1D,GAAM,CAAAsP,GAAG,CAAGtP,SAAS,CAACuP,GAAG,CAAC/Q,IAAI,CAAC,CAAC,QAAAgR,IAAA,GAAAC,mBAAA;AACX,IAAI,CAACV,YAAY,CAAC,CAAC,CAAAS,IAAA,CAAAC,mBAAA,CAAA/T,MAAA,CAAA8T,IAAA,GAAE,CAArC,GAAM,CAAArV,MAAM,CAAAsV,mBAAA,CAAAD,IAAA;AAChB,GAAM,CAAAE,EAAE,CAAGlR,IAAI,CAACrE,MAAM,CAACwJ,gBAAgB,CAAC,CAAC,CAAC;AAC1C,GAAM,CAAAgM,EAAE,CAAGnR,IAAI,CAAC,CAACrE,MAAM,CAAS6J,iBAAiB,cAAhC7J,MAAM,CAAS6J,iBAAiB,CAAG,CAAC,GAAI,EAAE,CAAC;AAC5D,GAAIsL,GAAG,CAAClV,QAAQ,CAACsV,EAAE,CAAC,EAAKC,EAAE,EAAIL,GAAG,CAAClV,QAAQ,CAACuV,EAAE,CAAE,CAAE,CAAE,MAAO,KAAI,CAAE;AAClE;AACA,MAAO,MAAK;AACb,CAAC,CAAAxB,OAAA;AACD7J,KAAK,CAAL,SAAAA,KAAKA,CAAA,CAAG,KAAAsL,kBAAA;AACP,IAAI,CAAC5C,MAAM,CAAG,IAAI;AAClB,IAAI,CAAClT,KAAK,CAAC+V,KAAK,CAAC,CAAC;AAClB,IAAI,CAAC5B,SAAS,CAAC,CAAC;AAChB,CAAA2B,kBAAA,KAAI,CAACzF,YAAY,SAAjByF,kBAAA,CAAAE,IAAA,KAAI,CAAgB,QAAQ,CAAC;AAC9B,CAAC,CAAA3B,OAAA;AACDF,SAAS,CAAT,SAAAA,SAASA,CAAA,CAAG;;AAEX,IAAI,CAACzD,IAAI,CAAG,CAAC,CAAC;AACd,IAAI,CAACE,OAAO,CAAG,CAAC,IAAI,CAACsC,MAAM;AAC3B,IAAI,CAACrC,KAAK,CAAG,KAAK;AAClB,IAAI,CAACF,UAAU,CAAG,KAAK;AACvB,IAAI,CAACK,OAAO,CAAG,EAAQ;AACvB,IAAI,CAACE,eAAe,CAAG,CAAC;AACxB,IAAI,CAACC,kBAAkB,CAAG,CAAC;AAC3B,IAAI,CAACF,aAAa,CAAG,EAAE;AACvB,IAAI,CAACzR,QAAQ,CAAG,EAAE,CAAC,QAAAyW,IAAA,GAAAC,YAAA;;AAEA,IAAI,CAACtE,KAAK,CAAAqE,IAAA,CAAAC,YAAA,CAAAtU,MAAA,CAAAqU,IAAA,GAAE,CAA1B,GAAM,CAAAxY,IAAI,CAAAyY,YAAA,CAAAD,IAAA;AACd,GAAIxY,IAAI,CAAEA,IAAI,CAAC+M,KAAK,CAAC,CAAC;AACvB;AACA,IAAI,CAACqH,SAAS,CAAG,IAAI;AACrB,IAAI,CAACC,aAAa,CAAG,IAAI;;;AAGzB,IAAI,CAAC9R,KAAK,CAACwK,KAAK,CAAC,CAAC;;;AAGlB,IAAI,CAAC4F,kBAAkB,CAAG,IAAI;AAC9B,IAAI,CAACF,WAAW,CAAG,CAAC;AACpB,IAAI,CAACiG,oBAAoB,CAAC,CAAC;AAC3B,IAAI,CAACC,QAAQ,CAAC,CAAC;AAChB,CAAC,CAAA/B,OAAA;AACDxJ,OAAO,CAAP,SAAAA,OAAOA,CAAA,CAAG;AACT,GAAI,IAAI,CAACoI,UAAU,CAAE;AACpBK,MAAM,CAAC+C,mBAAmB,CAAC,QAAQ,CAAE,IAAI,CAAClD,QAAQ,CAAC;AACpD;AACA,IAAI,CAACnT,KAAK,CAAC6K,OAAO,CAAC,CAAC;;AAEpB,IAAK,GAAI,CAAA1C,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAACyJ,KAAK,CAAChQ,MAAM,CAAEuG,CAAC,EAAE,CAAE;AAC3C,GAAI,IAAI,CAACyJ,KAAK,CAACzJ,CAAC,CAAC,CAAE,IAAI,CAACyJ,KAAK,CAACzJ,CAAC,CAAC,CAAC0C,OAAO,CAAC,CAAC;AAC1C,IAAI,CAAC+G,KAAK,CAACzJ,CAAC,CAAC,CAAG,IAAK;AACtB;AACA,IAAI,CAACiJ,MAAM,CAAG,IAAK;AACnB,IAAI,CAACC,QAAQ,CAAG,IAAK;AACrB,IAAI,CAACC,OAAO,CAAG,IAAK;AACpB,IAAI,CAACC,EAAE,CAAG,IAAK;AACf,IAAI,CAACC,EAAE,CAAG,IAAK;AACf,IAAI,CAACC,EAAE,CAAG,IAAK;AACf,IAAI,CAACC,EAAE,CAAG,IAAK;AAChB,CAAC,CAAA2C,OAAA;;AAEDlF,GAAG,CAAH,SAAAA,GAAGA,CAACjL,IAAU,CAAEqK,MAAe,CAAE+H,OAAiB,CAAE;AACnD,IAAI,CAACtW,KAAK,CAACmP,GAAG,CAACoH,GAAG,CAACrS,IAAI,CAAEqK,MAAM,CAAE+H,OAAO,CAAC;AAC1C,CAAC,CAAAjC,OAAA;;AAEDmC,kBAAkB,CAAlB,SAAAA,kBAAkBA,CAAA,CAAG;AACpB,IAAI,CAACC,QAAQ,CAAC,IAAI,CAAC5F,KAAK,CAAG6F,QAAQ,CAAG,IAAI,CAAChG,IAAI,CAAE,IAAI,CAAC;AACvD,CAAC,CAAA2D,OAAA;AACDsC,eAAe,CAAf,SAAAA,eAAeA,CAAA,CAAG;AACjB,IAAI,CAACC,YAAY,CAAC,IAAI,CAAC9G,iBAAiB,CAAG,IAAI,CAAG,IAAI,CAAC;AACxD,CAAC,CAAAuE,OAAA;AACDuC,YAAY,CAAZ,SAAAA,YAAYA,CAAC5L,MAAc,CAAE;AAC5B,GAAI,IAAI,CAACoG,MAAM,CAACpG,MAAM,GAAKA,MAAM,CAAE;AACnC,GAAIA,MAAM,CAACpJ,MAAM,GAAK,CAAC,EAAI,CAACoJ,MAAM,CAACtF,UAAU,CAAC,GAAG,CAAC,CAAE;AACpD,GAAM,CAAAjI,IAAI,CAAG,IAAI,CAACuN,MAAM,CAAC;AACzB,GAAI,CAACvN,IAAI,CAAE;AACX,IAAI,CAAC2T,MAAM,CAAG3T,IAAI;;AAElB,GAAKA,IAAI,CAACsN,CAAC,CAAG,CAAC,GAAM,IAAI,CAACwG,EAAE,CAACxG,CAAC,CAAE;AAC/B,IAAI,CAAC+E,iBAAiB,CAAG,KAAK;AAC9B,IAAI,CAACuB,QAAQ,CAAG,IAAI,CAACE,EAAE;AACvB,IAAI,CAACD,OAAO,CAAG,IAAI,CAACE,EAAE;AACvB,CAAC,IAAM;AACN,IAAI,CAAC1B,iBAAiB,CAAG,IAAI;AAC7B,IAAI,CAACuB,QAAQ,CAAG,IAAI,CAACG,EAAE;AACvB,IAAI,CAACF,OAAO,CAAG,IAAI,CAACC,EAAE;AACvB;AACA,IAAI,CAACF,QAAQ,CAACpG,KAAK,CAAG,KAAK;AAC3B,IAAI,CAACqG,OAAO,CAACrG,KAAK,CAAG,IAAI;AACzB,GAAI,IAAI,CAAC2G,KAAK,CAAChQ,MAAM,CAAG,CAAC,CAAE;AAC1B,IAAI,CAACgQ,KAAK,CAAC,IAAI,CAACP,QAAQ,CAACtG,CAAC,CAAG,CAAC,CAAC,CAACE,KAAK,CAAG,KAAK;AAC7C,IAAI,CAAC2G,KAAK,CAAC,IAAI,CAACN,OAAO,CAACvG,CAAC,CAAG,CAAC,CAAC,CAACE,KAAK,CAAG,IAAI;AAC5C;;AAEA,IAAI,CAACuL,kBAAkB,CAAC,CAAC;AAC1B,CAAC,CAAAnC,OAAA;;;;;AAKDwC,KAAK,CAAL,SAAAA,KAAKA,CAAA,CAAG;AACP,IAAI,CAAC1H,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC;AACnB,IAAI,CAACgH,oBAAoB,CAAC,CAAC;AAC5B,CAAC,CAAA9B,OAAA;AACDyC,MAAM,CAAN,SAAAA,MAAMA,CAACA,OAAe,CAAE,KAAAC,mBAAA;AACvB,IAAI,CAAC5H,GAAG,CAAC,CAAC,KAAK,CAAE2H,OAAM,EAAI,EAAE,CAAC,CAAC;AAC/B,IAAI,CAACjG,KAAK,CAAG,IAAI;AACjB,CAAAkG,mBAAA,KAAI,CAAC1G,YAAY,SAAjB0G,mBAAA,CAAAf,IAAA,KAAI,CAAgB,OAAO,CAAC;AAC7B,CAAC,CAAA3B,OAAA;AACD2C,YAAY,CAAZ,SAAAA,YAAYA,CAAA,CAAG,KAAAC,mBAAA;AACd,IAAI,CAAC9H,GAAG,CAAC,CAAC,SAAS,CAAE,wBAAwB,CAAC,CAAC;AAC/C,IAAI,CAAC0B,KAAK,CAAG,IAAI;AACjB,CAAAoG,mBAAA,KAAI,CAAC5G,YAAY,SAAjB4G,mBAAA,CAAAjB,IAAA,KAAI,CAAgB,OAAO,CAAC;AAC7B,CAAC,CAAA3B,OAAA;AACD6C,WAAW,CAAX,SAAAA,WAAWA,CAAA,CAAG;AACb,GAAI,IAAI,CAAC7E,kBAAkB,CAAE;AAC5B,IAAI,CAACA,kBAAkB,CAAG,KAAK;AAC/B,IAAI,CAACrS,KAAK,CAACmX,cAAc,CAAC,CAAC;AAC5B;AACD,CAAC,CAAA9C,OAAA;AACD+C,eAAe,CAAf,SAAAA,eAAeA,CAACC,IAAa,CAAE;AAC9B,IAAI,CAAC3E,YAAY,CAAG2E,IAAI;AACxB,IAAI,CAACrX,KAAK,CAACsX,cAAc,CAAC,CAAC;AAC3B,IAAI,CAACtX,KAAK,CAACyU,aAAa,CAAC,IAAI,CAAC;AAC/B,CAAC,CAAAJ,OAAA;AACDkD,OAAO,CAAP,SAAAA,OAAOA,CAACC,OAAe,CAAE;AACxB,GAAIA,OAAO,GAAK,IAAI,CAAC9G,IAAI,CAAG,CAAC,CAAE;AAC9B,IAAI,CAAC2B,kBAAkB,CAAG,IAAI;AAC/B;AACA,GAAI,IAAI,CAAC3B,IAAI,EAAI,CAAC,IAAI,CAACK,UAAU,CAAE,IAAI,CAAC0G,kBAAkB,CAAC,CAAC;AAC5D,IAAI,CAAC/G,IAAI,CAAG8G,OAAO;AACnB,IAAI,CAAC5G,OAAO,CAAG,IAAI;;AAEnB,GAAI,IAAI,CAACT,OAAO,GAAK,IAAI,CAAE,IAAI,CAACM,eAAe,EAAE;;AAEjD,IAAI,CAACzQ,KAAK,CAAC0X,aAAa,CAAC,CAAC;;AAE1B,GAAI,IAAI,CAACvH,OAAO,GAAK,IAAI,CAAE;AAC1B,GAAIqH,OAAO,EAAI,IAAI,CAACrH,OAAO,CAAE;AAC5B,IAAI,CAACwH,WAAW,CAAC,CAAC;AACnB;AACD,CAAC,IAAM,KAAAC,mBAAA;AACN,CAAAA,mBAAA,KAAI,CAACvH,YAAY,SAAjBuH,mBAAA,CAAA5B,IAAA,KAAI,CAAgB,MAAM,CAAC;AAC5B;AACD,CAAC,CAAA3B,OAAA;AACD8B,oBAAoB,CAApB,SAAAA,oBAAoBA,CAAA,CAAG;AACtB,IAAI,CAAC1F,eAAe,CAAG,CAAC;AACxB,IAAI,CAACzQ,KAAK,CAAC6X,kBAAkB,CAAC,CAAC;AAChC,CAAC,CAAAxD,OAAA;AACDyD,aAAa,CAAb,SAAAA,aAAaA,CAACC,WAAmB,CAAExK,IAAc,CAAEyK,QAAkB,CAAExZ,OAAoB,CAAE;AAC5F,GAAI,CAAAwS,OAAO,CAAGtM,IAAI,CAACqT,WAAW,CAAC;AAC/B,GAAI,CAAC/G,OAAO,EAAIA,OAAO,GAAK,MAAM,CAAE;AACnCA,OAAO,CAAG,EAAQ;AACnB;AACA,GAAIgH,QAAQ,CAAE;AACb,GAAI,IAAI,CAAChH,OAAO,EAAI,IAAI,CAACE,eAAe,CAAE;AACzC,IAAI,CAACA,eAAe,EAAE;AACtB,GAAI,IAAI,CAACC,kBAAkB,GAAK,CAAC,CAAE,IAAI,CAACA,kBAAkB,EAAE;AAC7D;AACA,GAAI,IAAI,CAAChB,OAAO,GAAK,IAAI,CAAE,CAAE,IAAI,CAACnQ,KAAK,CAACiY,aAAa,CAAC,CAAC,CAAE;AACzD;AACD;AACA,GAAIjH,OAAO,CAAE;AACZ,GAAI,CAAAkH,gBAAgB,CAAIlH,OAAO,GAAK,aAAa,EAAIA,OAAO,GAAK,cAAc,EAAIA,OAAO,GAAK,eAAgB;AAC/G,GAAIzD,IAAI,CAAE;AACT,GAAI/O,OAAO,CAAE,CAAE,IAAI,CAAC2Z,eAAe,CAAC5K,IAAI,CAAE/O,OAAO,CAACd,IAAI,CAAC,CAAE;AACzD,IAAI,CAACwT,eAAe,CAAI,IAAI,CAAC7J,GAAG,EAAI,CAAC,EAAI6Q,gBAAgB,CAAI,CAAC,CAAG,CAAC;AAClE,IAAI,CAAC/G,kBAAkB,CAAI,IAAI,CAAC9J,GAAG,EAAI,CAAC,EAAI6Q,gBAAgB,CAAI,CAAC,CAAG,CAAC;AACtE,CAAC,IAAM,IAAIA,gBAAgB,CAAE;AAC5B,IAAI,CAAChH,eAAe,CAAG,CAAC;AACxB,IAAI,CAACC,kBAAkB,CAAG,CAAC;AAC5B,CAAC,IAAM;AACN,IAAI,CAACD,eAAe,CAAI,IAAI,CAAC7J,GAAG,EAAI,CAAC,CAAG,CAAC,CAAG,CAAE;AAC9C,IAAI,CAAC8J,kBAAkB,CAAI,IAAI,CAAC9J,GAAG,EAAI,CAAC,CAAG,CAAC,CAAG,CAAE;AAClD;AACD;AACA,IAAI,CAAC2J,OAAO,CAAGA,OAAO;AACtB,IAAI,CAAChR,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC3B,CAAC,CAAAJ,OAAA;AACD+D,kBAAkB,CAAlB,SAAAA,kBAAkBA,CAAA,CAAG;AACpB,GAAM,CAAAtM,cAAc,CAAG,CAAC,MAAM,CAAE,aAAa,CAAE,SAAS,CAAE,QAAQ,CAAE,WAAW,CAAE,UAAU,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAAE,YAAY,CAAE,aAAa,CAAE,WAAW,CAAE,YAAY,CAAE,gBAAgB,CAAE,eAAe,CAAE,cAAc,CAAE,cAAc,CAAE;AACrQ,GAAI,IAAI,CAACkG,QAAQ,GAAK,YAAY,CAAE;;;;AAInC,GAAM,CAAAJ,KAAK,CAAG,CAAC,IAAI,CAACA,KAAK,CAAC,CAAC,CAAC,CAAE,IAAI,CAACA,KAAK,CAAC,CAAC,CAAC,CAAE,IAAI,CAACA,KAAK,CAAC,CAAC,CAAC,CAAE,IAAI,CAACA,KAAK,CAAC,CAAC,CAAC,CAAC;AAC1E,GAAM,CAAAyG,IAA6C,CAAG,CAAE,CAAC,CAAE,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,QAAAC,IAAA,GAAAA,IAAA;AAClE1G,KAAK,CAAAhQ,MAAA,CAAA0W,IAAA,GAAE,CAArB,GAAM,CAAA7a,IAAI,CAAImU,KAAK,CAAA0G,IAAA,CAAT;AACd,IAAK,GAAM,CAAA1T,EAAE,GAAI,CAAAnH,IAAI,CAACqO,cAAc,CAAE;AACrC,GAAI,CAACA,cAAc,CAACxL,QAAQ,CAACsE,EAAE,CAAC,CAAE;AAClCyT,IAAI,CAAC5a,IAAI,CAACsN,CAAC,CAAC,CAACnG,EAAE,CAAC,CAAGnH,IAAI,CAACqO,cAAc,CAAClH,EAAE,CAAC;AAC1CnH,IAAI,CAACyP,mBAAmB,CAACtI,EAAE,CAAC;AAC7B;AACD;AACA,IAAK,GAAI,CAAAuD,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAE,CAAE;AAC3B,GAAM,CAAAoQ,UAAU,CAAG3G,KAAK,CAACzJ,CAAC,CAAC;AAC3B,GAAM,CAAAqQ,oBAAoB,CAAGH,IAAI,CAACE,UAAU,CAACxN,CAAC,CAAC;AAC/C,GAAM,CAAA0N,UAAU,CAAG7G,KAAK,CAAC,CAACzJ,CAAC,CAAG,CAAC,EAAI,CAAC,CAAC;AACrC,IAAK,GAAM,CAAAvD,GAAE,GAAI,CAAA4T,oBAAoB,CAAE;AACtCC,UAAU,CAAC3M,cAAc,CAAClH,GAAE,CAAC,CAAG4T,oBAAoB,CAAC5T,GAAE,CAAC;AACxD,IAAI,CAAC5E,KAAK,CAAC8M,gBAAgB,CAAC2L,UAAU,CAAC1N,CAAC,CAAEnG,GAAQ,CAAC;AACpD;AACD;AACA;AACD;AACA,GAAI,CAAA8T,KAAK,CAAG,IAAI,CAAC9G,KAAK,CAAC,CAAC,CAAC;AACzB,GAAI,CAAA+G,KAAK,CAAG,IAAI,CAAC/G,KAAK,CAAC,CAAC,CAAC,CAAC,QAAAgH,IAAA,GAAAA,IAAA;AACT9M,cAAc,CAAAlK,MAAA,CAAAgX,IAAA,GAAE,CAA5B,GAAM,CAAAhU,IAAE,CAAIkH,cAAc,CAAA8M,IAAA,CAAlB;AACZ,GAAIF,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,EAAI+T,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,CAAE,KAAAiU,KAAA;AACF;AACtDF,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,CAAE8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,CAClD,CAFA8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,CAAAiU,KAAA,IAAEF,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,CAAAiU,KAAA;;AAGnD,IAAI,CAAC7Y,KAAK,CAAC8M,gBAAgB,CAAC4L,KAAK,CAAC3N,CAAC,CAAEnG,IAAQ,CAAC;AAC9C,IAAI,CAAC5E,KAAK,CAAC8M,gBAAgB,CAAC6L,KAAK,CAAC5N,CAAC,CAAEnG,IAAQ,CAAC;AAC/C,CAAC,IAAM,IAAI8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,EAAI,CAAC+T,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,CAAE;AACjE+T,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,CAAG8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC;AACnD,IAAI,CAAC5E,KAAK,CAAC8M,gBAAgB,CAAC6L,KAAK,CAAC5N,CAAC,CAAEnG,IAAQ,CAAC;AAC9C8T,KAAK,CAACxL,mBAAmB,CAACtI,IAAE,CAAC;AAC9B,CAAC,IAAM,IAAI+T,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC,EAAI,CAAC8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,CAAE;AACjE8T,KAAK,CAAC5M,cAAc,CAAClH,IAAE,CAAC,CAAG+T,KAAK,CAAC7M,cAAc,CAAClH,IAAE,CAAC;AACnD,IAAI,CAAC5E,KAAK,CAAC8M,gBAAgB,CAAC4L,KAAK,CAAC3N,CAAC,CAAEnG,IAAQ,CAAC;AAC9C+T,KAAK,CAACzL,mBAAmB,CAACtI,IAAE,CAAC;AAC9B;AACD;AACD,CAAC,CAAAyP,OAAA;AACDoD,kBAAkB,CAAlB,SAAAA,kBAAkBA,CAAA,CAAG,SAAAqB,IAAA,GAAAC,oBAAA;AACG,IAAI,CAAC9H,aAAa,CAAA6H,IAAA,CAAAC,oBAAA,CAAAnX,MAAA,CAAAkX,IAAA,GAAE,CAAtC,GAAM,CAAAE,QAAQ,CAAAD,oBAAA,CAAAD,IAAA;AAClB,GAAIE,QAAQ,CAAC,CAAC,CAAC,CAAEA,QAAQ,CAAC,CAAC,CAAC,EAAE;AAC9B,GAAIA,QAAQ,CAAC,CAAC,CAAC,CAAEA,QAAQ,CAAC,CAAC,CAAC,EAAE;AAC/B,CAAC,QAAAC,IAAA,GAAAC,YAAA;AACkB,IAAI,CAACtH,KAAK,CAAAqH,IAAA,CAAAC,YAAA,CAAAtX,MAAA,CAAAqX,IAAA,GAAE,CAA1B,GAAM,CAAAxb,IAAI,CAAAyb,YAAA,CAAAD,IAAA;AACd,IAAK,GAAM,CAAArU,EAAE,GAAI,CAAAnH,IAAI,CAACqO,cAAc,CAAE;AACrC,GAAI,CAAAqN,IAAI,CAAG1b,IAAI,CAACqO,cAAc,CAAClH,EAAE,CAAC;AAClC,GAAIuU,IAAI,CAAC,CAAC,CAAC,CAAEA,IAAI,CAAC,CAAC,CAAC,EAAE;AACtB,GAAIA,IAAI,CAAC,CAAC,CAAC,CAAEA,IAAI,CAAC,CAAC,CAAC,EAAE;AACvB;AACD,CAAC,QAAAC,IAAA,GAAAC,KAAA,IAAAhV,MAAA;AACsB,IAAI,CAACgN,QAAQ,CAAChR,MAAM,CAAK,IAAI,CAACiR,OAAO,CAACjR,MAAM,EAAA+Y,IAAA,CAAAC,KAAA,CAAAzX,MAAA,CAAAwX,IAAA,GAAG,CAAjE,GAAM,CAAA7L,IAAI,CAAA8L,KAAA,CAAAD,IAAA;AACd,GAAI7L,IAAI,CAAE;AACT,GAAIA,IAAI,CAACpO,MAAM,GAAK,KAAK,CAAEoO,IAAI,CAAC7N,UAAU,CAACE,UAAU,EAAE;AACvD2N,IAAI,CAAC5I,iBAAiB,CAAC,CAAC;AACzB;AACD;AACA,IAAI,CAAC3E,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC3B,CAAC,CAAAJ,OAAA;AACDiF,OAAO,CAAP,SAAAA,OAAOA,CAAChR,OAAgB,CAAEiR,IAAc,CAAElK,MAAsB,CAAEd,MAAc,CAAE;AACjF,GAAI,CAAAiL,UAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3C,IAAI,CAAC0J,eAAe,CAAC7P,OAAO,CAAEkR,UAAU,CAAC;AACzClR,OAAO,CAACrD,iBAAiB,CAAC,CAAC;AAC3B,GAAIsU,IAAI,CAAC3U,EAAE,GAAK,YAAY,CAAE;AAC7B0D,OAAO,CAAC/D,gBAAgB,CAAC,YAAkB,CAAC;AAC7C;AACA,IAAI,CAACvE,KAAK,CAAC6E,aAAa,CAACyD,OAAO,CAAC;AACjC,GAAIkR,UAAU,CAAC5U,EAAE,GAAK,WAAW,CAAE;AAClC0D,OAAO,CAAClD,YAAY,CAACmU,IAAI,CAAC7b,IAAI,CAAE,CAAC,CAAC;AACnC;AACA,GAAI,CAAA+b,qBAAqB,CAAG,IAAI;;AAEhC,GAAID,UAAU,CAAC5U,EAAE,EAAI2J,MAAM,CAACE,IAAI,CAAC/I,UAAU,CAAC,OAAO,CAAC,CAAE;AACrD+T,qBAAqB,CAAGD,UAAsB;AAC/C;AACA,GAAI,CAACA,UAAU,CAAC5U,EAAE,EAAI6U,qBAAqB,EAAID,UAAU,CAAC5U,EAAE,GAAK,SAAS,CAAE;AAC3E,GAAI,CAAAS,QAAQ,CAAGkU,IAAI,CAAC7b,IAAI;AACxB,GAAI,CAAC+b,qBAAqB,CAAE;AAC3B,GAAIF,IAAI,CAACG,GAAG,CAAE;AACbpR,OAAO,CAAC1J,IAAI,CAAG2a,IAAI,CAACG,GAAG;AACvB,GAAI,CAAA9a,IAAI,CAAG4G,GAAG,CAACmU,KAAK,CAAClU,GAAG,CAAC8T,IAAI,CAACG,GAAG,CAAC;AAClC,GAAI9a,IAAI,CAACgb,SAAS,CAAEvU,QAAQ,CAAGzG,IAAI,CAACgb,SAAS;AAC9C,CAAC,IAAM,IAAIL,IAAI,CAAC7b,IAAI,CAACgI,UAAU,CAAC,IAAI,CAAC,CAAE;AACtCL,QAAQ,CAAGA,QAAQ,CAACwU,KAAK,CAAC,CAAC,CAAC;AAC5BN,IAAI,CAAG/T,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAACJ,QAAQ,CAAC;AAC9B,GAAIiO,MAAM,CAACwG,WAAW,CAAE;AACvB,IAAK,GAAI,CAAAlb,KAAI,GAAI,CAAAkb,WAAW,CAAE;AAC7B,GAAIA,WAAW,CAAClb,KAAI,CAAC,CAACmb,SAAS,GAAKR,IAAI,CAACS,IAAI,CAAE1R,OAAO,CAAC1J,IAAI,CAAGA,KAAI;AACnE;AACD;AACD;AACD;AACA,GAAI,CAAA0G,EAAE,CAAG,CAAC;AACV,GAAI,IAAI,CAACiQ,aAAa,CAAC,UAAU,CAAC,EAAIgE,IAAI,CAAC3U,EAAE,GAAK,WAAW,CAAE;AAC9D,GAAM,CAAAqV,UAAU,CAAG,EAAE;AACrB,GAAM,CAAAC,UAAU,CAAGX,IAAI,CAACY,cAAc;;AAEtC;AACC,CAAC9K,MAAM,EAAI,IAAI,CAAC2C,QAAQ,GAAK,SAAS;AACtC,CAAC,CAAC,MAAM,CAAE,QAAQ,CAAE,UAAU,CAAE,cAAc,CAAE,oBAAoB,CAAE,UAAU,CAAC,CAAC1R,QAAQ,CAAC4Z,UAAU,CAAC;AACrG;;AAEDD,UAAU,CAAClU,IAAI,CAACuC,OAAO,CAAC7K,IAAI,CAACyN,GAAG,CAAC7K,MAAM,CAAC,CAAC,CAAC,CAAC;AAC5C,CAAC,IAAM,IAAI,CAAC,KAAK,CAAE,aAAa,CAAE,iBAAiB,CAAE,SAAS,CAAC,CAACC,QAAQ,CAAC4Z,UAAU,CAAC,CAAE,SAAAE,IAAA,GAAAC,mBAAA;AAChE,IAAI,CAACpF,YAAY,CAAC,CAAC,CAAAmF,IAAA,CAAAC,mBAAA,CAAAzY,MAAA,CAAAwY,IAAA,GAAE,CAArC,GAAM,CAAA/Z,MAAM,CAAAga,mBAAA,CAAAD,IAAA;AAChB,GAAI/Z,MAAM,GAAKiI,OAAO,CAAE;;AAExB,GAAI,IAAI,CAACjB,GAAG,EAAI,CAAC,EAAKhH,MAAM,CAAC5C,IAAI,GAAK6K,OAAO,CAAC7K,IAAI,EAAI4C,MAAM,CAAC5C,IAAI,CAAC0N,IAAI,GAAK7C,OAAO,CAAC7K,IAAK,CAAE;AACzFwc,UAAU,CAAClU,IAAI,CAAC1F,MAAM,CAAC;AACxB;AACD;AACD,CAAC,IAAM,IAAIgP,MAAM,EAAIA,MAAM,CAAC5R,IAAI,GAAK6K,OAAO,CAAC7K,IAAI,CAAE;AAClDwc,UAAU,CAAClU,IAAI,CAACsJ,MAAM,CAAC;AACxB,CAAC,QAAAiL,IAAA,GAAAA,IAAA;;AAEiBL,UAAU,CAAArY,MAAA,CAAA0Y,IAAA,GAAE,CAAzB,GAAM,CAAApP,GAAG,CAAI+O,UAAU,CAAAK,IAAA,CAAd;AACb,GAAIpP,GAAG,EAAI,CAACA,GAAG,CAAClN,OAAO,EAAIkN,GAAG,CAACrB,gBAAgB,CAAC,CAAC,GAAK,UAAU,CAAE;AACjEvE,EAAE,EAAI,CAAC;AACR;AACD;AACD;AACA,GAAI,CAACmU,qBAAqB,CAAE;AAC3BnR,OAAO,CAAClD,YAAY,CAACC,QAAQ,CAAEC,EAAE,CAAC;AACnC,CAAC,IAAM;AACNgD,OAAO,CAAClD,YAAY,CAACqU,qBAAqB,CAAC/b,IAAI,CAAE4H,EAAE,CAAG,CAAC,CAAC;AACzD;AACD;AACAgD,OAAO,CAAC9I,QAAQ,CAAG+Z,IAAI,CAAC3U,EAAE;AAC1B,IAAI,CAACpF,QAAQ,CAAG+Z,IAAI,CAAC3U,EAAE;AACvB,GAAI2U,IAAI,CAAC3U,EAAE,GAAK,MAAM,EAAI2U,IAAI,CAAC3U,EAAE,GAAK,aAAa,CAAE;AACpD0D,OAAO,CAAC7K,IAAI,CAACmO,MAAM,CAAGtD,OAAO;AAC9B;AACD,CAAC,CAAA+L,OAAA;AACDkG,WAAW,CAAX,SAAAA,WAAWA,CAACjS,OAAgB,CAAEiR,IAAc,CAAElK,MAAsB,CAAEd,MAAc,CAAE;AACrF,IAAI,CAAC6B,kBAAkB,CAAG7B,MAAM,CAACiM,MAAM;AACvC,GAAI,IAAI,CAACrK,OAAO,GAAK,IAAI,EAAI5B,MAAM,CAACkM,KAAK,CAAE;;AAE3C,GAAI,CAACpL,MAAM,CAAEA,MAAM,CAAG/G,OAAO,CAAC7K,IAAI,CAACyN,GAAG,CAAC7K,MAAM,CAAC,CAAC,CAAC;AAChD,GAAI,CAACgP,MAAM,CAAEA,MAAM,CAAG/G,OAAO,CAAC7K,IAAI,CAACyN,GAAG,CAACS,aAAa;AACpD,GAAI4C,MAAM,CAACmM,IAAI,EAAIrL,MAAM,CAAC5R,IAAI,CAAE;AAC/B4R,MAAM,CAAGA,MAAM,CAAC5R,IAAI,CAACkO,aAAa;AACnC;AACA,GAAI4C,MAAM,CAACoM,QAAQ,CAAE;AACpB;AACD;;AAEA,GAAIpM,MAAM,CAACqM,OAAO,EAAIrM,MAAM,CAACsM,IAAI,GAAK,SAAS,CAAE;AAChD,IAAI,CAAC7a,KAAK,CAAC8a,cAAc,CAACvB,IAAI,CAAC3U,EAAE,CAAE0D,OAAO,CAAE+G,MAAM,CAAC;AACnD;AACD;;AAEA,GAAI,CAAA0L,QAAQ,CAAGxM,MAAM,CAACsM,IAAI,CAAGrV,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAAC8I,MAAM,CAACsM,IAAI,CAAC,CAAGtB,IAAI;AAC9D,GAAI,CAAChL,MAAM,CAACiM,MAAM,CAAE;AACnB,IAAI,CAACxa,KAAK,CAACgb,WAAW,CAACD,QAAQ,CAACnW,EAAE,CAAE,CAAC0D,OAAO,CAAE+G,MAAM,CAAC,CAAC;AACtD;AACD;;AAEA,GAAI,CAAA4L,OAAO,CAAG,CAAC3S,OAAO,CAAC;AACvB,GAAIiG,MAAM,CAACiM,MAAM,GAAK,GAAG,CAAE;;AAE1BS,OAAO,CAAClV,IAAI,CAACsJ,MAAM,CAAC5R,IAAI,CAACkO,aAAa,CAAC;AACxC,CAAC,IAAM,SAAAuP,IAAA,GAAAC,qBAAA;AACkB5M,MAAM,CAACiM,MAAM,CAACjR,KAAK,CAAC,GAAG,CAAC,CAAA2R,IAAA,CAAAC,qBAAA,CAAAvZ,MAAA,CAAAsZ,IAAA,GAAE,CAA7C,GAAM,CAAAE,SAAS,CAAAD,qBAAA,CAAAD,IAAA;AACnB,GAAM,CAAAG,SAAS,CAAG,IAAI,CAACC,UAAU,CAACF,SAAS,CAAG,KAAK,CAAC;AACpD,GAAI,CAACC,SAAS,CAAE;AACf,IAAI,CAAClM,GAAG,CAAC,CAAC,OAAO,kCAAkCiM,SAAS,MAAI,CAAC;AACjE;AACD;AACAH,OAAO,CAAClV,IAAI,CAACsV,SAAS,CAAC;AACxB;AACD;;AAEA,IAAI,CAACrb,KAAK,CAACgb,WAAW,CAACD,QAAQ,CAACnW,EAAE,CAAEqW,OAAO,CAAC;AAC7C,CAAC,CAAA5G,OAAA;AACDkH,WAAW,CAAX,SAAAA,WAAWA,CAACjT,OAAgB,CAAEyE,MAAkB,CAAEwM,IAAc,CAAEhL,MAAc,CAAE;AACjFjG,OAAO,CAACrD,iBAAiB,CAAC,CAAC;AAC3B,IAAI,CAACjF,KAAK,CAAC6E,aAAa,CAACyD,OAAO,CAAC;AACjC,GAAIyE,MAAM,CAACnI,EAAE,GAAI,CAAA4W,iBAAiB,CAAE;AACnC,IAAI,CAACxb,KAAK,CAACyb,aAAa,CAAC1O,MAAM,CAACnI,EAAE,CAAE,CAAC0D,OAAO,CAAC,CAAC;AAC/C;AACA,IAAI,CAAC6P,eAAe,CAAC7P,OAAO,CAAEyE,MAAM,CAAC;AACrC,GAAIwM,IAAI,CAAC3U,EAAE,CAAE0D,OAAO,CAAClD,YAAY,CAACmU,IAAI,CAAC7b,IAAI,CAAE,CAAC,CAAC;AAC/C,OAAQqP,MAAM,CAACnI,EAAE;AACjB,IAAK,KAAK;AACT,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,WAAW,CAAE,KAAK,CAAC;AAClD;AACD,IAAK,KAAK;AACT,IAAI,CAACtI,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC/C;AACD,IAAK,KAAK;AACT,IAAI,CAACtI,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC/CA,OAAO,CAAC5I,UAAU,CAACC,UAAU,EAAE;AAC/B;AACD,IAAK,QAAQ;AACZ,IAAI,CAACK,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,gBAAgB,CAAE,SAAS,CAAC;AAC3D;AACD,IAAK,UAAU;AACd,IAAI,CAACtI,KAAK,CAAC2b,YAAY,CAAC,YAAY,CAAQ,CAACrT,OAAO,CAAC,CAAC;AACtD,IAAI,CAACtI,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,eAAe,CAAE,SAAS,CAAC;AAC1D;AACD,IAAK,YAAY;AAChB,IAAI,CAACtI,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,YAAY,CAAE,SAAS,CAAC;AACvDA,OAAO,CAAC/D,gBAAgB,CAAC,YAAkB,CAAC;AAC5C;AACD,IAAK,WAAW;AACf,IAAI,CAACvE,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,aAAa,CAAE,SAAS,CAAC;AACxDA,OAAO,CAAC/D,gBAAgB,CAAC,WAAiB,CAAC;AAC3C;AACD,IAAK,QAAQ;AACZ,IAAI,CAACvE,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,UAAU,CAAE,SAAS,CAAC;AACrDA,OAAO,CAAC/D,gBAAgB,CAAC,YAAkB,CAAC;AAC5C;AACD,IAAK,SAAS;AACb,IAAI,CAACvE,KAAK,CAAC0b,UAAU,CAACpT,OAAO,CAAE,aAAa,CAAE,SAAS,CAAC;AACxD;AACD;AACA,IAAI,CAACtI,KAAK,CAAC4b,SAAS,CAACtT,OAAO,CAAC;AAC9B,CAAC,CAAA+L,OAAA;;AAED8D,eAAe,CAAf,SAAAA,eAAeA;AACf7P,OAAuB;AACvBuT,YAAiC;AACjC5V,SAAmB;;AAElB,IADD,CAAAlI,IAAW,CAAAkG,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC;AAEf,GAAI,CAACqE,OAAO,EAAI,CAACuT,YAAY,CAAE;AAC/B,GAAI,MAAO,CAAAA,YAAY,GAAK,QAAQ,CAAE;AACrC,GAAIA,YAAY,CAACC,UAAU,GAAK,SAAS,CAAE;AAC3CD,YAAY,CAAGA,YAAY,CAACne,IAAI;AACjC;AACA,IAAI,CAACsC,KAAK,CAAC+b,mBAAmB,CAACzT,OAAO,CAAEuT,YAAY,CAAC;AACrDvT,OAAO,CAACtC,eAAe,CAAC6V,YAAY,CAAE5V,SAAS,CAAElI,IAAI,CAAC;AACvD,CAAC,CAAAsW,OAAA;;AAEA2H,QAAQ,CAAR,SAAAA,QAAQA,CAAC9X,IAAU,CAAEqK,MAAc,CAAE0N,QAAe,CAAEC,UAAmB,CAAE;AAC1E,GAAID,QAAQ,EAAIC,UAAU,CAAE;AAC3B,GAAIhY,IAAI,CAAC,CAAC,CAAC,GAAK,QAAQ,EAAIA,IAAI,CAAC,CAAC,CAAC,GAAK,WAAW,CAAE;AACpDA,IAAI,CAAC,CAAC,CAAC,CAAG,iBAAiB;AAC5B;AACA,GAAI,CAAC,OAAO,CAAE,iBAAiB,CAAE,WAAW,CAAC,CAAC5D,QAAQ,CAAC4D,IAAI,CAAC,CAAC,CAAC,CAAC,EAAIA,IAAI,CAAC,CAAC,CAAC,GAAK,iBAAiB,CAAE;AACjGqK,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,SAAS,EAAI,CAACqK,MAAM,CAACE,IAAI,EAAIvK,IAAI,CAAC,CAAC,CAAC,GAAK+X,QAAQ,CAAC,CAAC,CAAC;AACnE,CAAC,OAAO,CAAE,iBAAiB,CAAE,WAAW,CAAC,CAAC3b,QAAQ,CAAC2b,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC9DA,QAAQ,CAAC,CAAC,CAAC,GAAK,SAAS,EAAI,CAACC,UAAU,CAACzN,IAAK,CAC/C;AAAE;AACFF,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,SAAS,EAAI+X,QAAQ,CAAC,CAAC,CAAC,GAAK,SAAS,EAAI1N,MAAM,CAACE,IAAI,EAAIF,MAAM,CAACE,IAAI,GAAKyN,UAAU,CAACzN,IAAI,CAAE;AACzGF,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,OAAO,EAAI+X,QAAQ,CAAC,CAAC,CAAC,GAAK,OAAO,EAAI1N,MAAM,CAACE,IAAI,EAAIF,MAAM,CAACE,IAAI,GAAKyN,UAAU,CAACzN,IAAI,CAAE;AACrGF,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,UAAU,GAAKA,IAAI,CAAC,CAAC,CAAC,GAAK,YAAY,EAAIA,IAAI,CAAC,CAAC,CAAC,GAAK,OAAO,CAAC,CAAE;AAChFqK,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,UAAU,EAAI+X,QAAQ,CAAC,CAAC,CAAC,GAAK,UAAU,CAAE;AACzD1N,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,QAAQ,EAAI+X,QAAQ,CAAC,CAAC,CAAC,GAAK,QAAQ,CAAE;AACrD1N,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,SAAS,EAAIqK,MAAM,CAACE,IAAI,GAAK,YAAY,EAAIwN,QAAQ,CAAC,CAAC,CAAC,GAAK,OAAO,EAAIC,UAAU,CAACE,MAAM,CAAE;AAC1G7N,MAAM,CAAC4N,IAAI,CAAG,GAAG;AAClB;AACA,GAAIjY,IAAI,CAAC,CAAC,CAAC,GAAK,eAAe,EAAI+X,QAAQ,CAAC,CAAC,CAAC,GAAK,OAAO,CAAE;AAC3D,GAAI,IAAI,CAACjc,KAAK,CAACqc,eAAe,CAAC,CAAC,CAAE;AACjC,IAAI,CAACnM,WAAW,EAAE;AAClB;AACD;AACA3B,MAAM,CAAC+N,MAAM,CAAG,GAAG;AACpB;AACD;AACA,GAAI/N,MAAM,CAAC4N,IAAI,CAAE,IAAI,CAAClM,iBAAiB,CAAG,KAAK;AAC/C,GAAI1B,MAAM,CAAC+N,MAAM,CAAE,IAAI,CAACrM,iBAAiB,CAAG,QAAQ;;AAEpD,GAAM,CAAAsM,QAAQ,CAAG,CAAC,OAAO,CAAE,QAAQ,CAAE,UAAU,CAAE,SAAS,CAAC;AAC3D,OAAQrY,IAAI,CAAC,CAAC,CAAC;AACf,IAAK,SAAS,CAAE;AACf,GAAI,CAAAqJ,IAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAvC,MAAM,CAAG4L,IAAI,CAACtL,WAAW,CAACiC,IAAI,CAAC,CAAC,CAAC,CAAE,IAAI,CAAC;AAC5C,GAAIvC,MAAM,GAAK,IAAI,CAAE;AACrB,GAAI,CAAAZ,KAAK,CAAGwM,IAAI,CAAC7L,cAAc,CAACC,MAAM,CAAC;;AAEvC,GAAI4M,MAAM,CAACE,IAAI,CAAE;AAChB,GAAI,CAAA1B,MAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,MAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,IAAI,CAACtE,eAAe,CAACqE,MAAM,CAAEzP,MAAM,CAAC;AACpC,GAAIA,MAAM,CAAC+O,UAAU,GAAK,MAAM,CAAE;AACjC,GAAM,CAAAY,QAAQ,CAAGF,MAAM,EAAIjP,IAAI;AAC/B,GAAImP,QAAQ,CAAC5d,QAAQ,GAAKiO,MAAM,CAACrP,IAAI,EAAI,CAAC6e,QAAQ,CAACjc,QAAQ,CAACoc,QAAQ,CAAC3d,cAAc,CAAC,CAAE;AACrF2d,QAAQ,CAAC9d,IAAI,CAAGmO,MAAM,CAACrP,IAAI;AAC5B;AACD;AACA,OAAQqP,MAAM,CAACnI,EAAE;AACjB,IAAK,KAAK;AACT,IAAI,CAAC5E,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,IAAI,CAAC,CAAC;AAC7C;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,IAAI,CAAC,CAAC;AAC7C;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,QAAQ,CAAQ,CAAClO,IAAI,CAAC,CAAC;AAChD;AACD,IAAK,OAAO;AACX,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,QAAQ,CAAQ,CAAClO,IAAI,CAAC,CAAC;AAChD;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,iBAAiB,CAAQ,CAAClO,IAAI,CAAC,CAAC;AACzD;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC2b,YAAY,CAAC,OAAO,CAAQ,CAACa,MAAM,CAAGjP,IAAI,CAAC,CAAC;AACvD;AACD,IAAK,MAAM;AACX,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC2b,YAAY,CAAC,OAAO,CAAQ,CAACpO,IAAI,CAAC,CAAC;AAC9C;AACD;AACD,CAAC,IAAM;AACN,GAAI,IAAI,CAACxD,GAAG,CAACxL,KAAK,CAACkH,GAAG,CAAC,IAAI,CAACjG,QAAQ,CAAC,CAACmd,QAAQ,GAAK,QAAQ,CAAE;AAC5DpP,IAAI,CAAC1N,aAAa,EAAE;AACrB;AACA,GAAI,CAAA+c,UAAU,CAAG,EAAE,CAAGrf,OAAO,CAACuD,iBAAiB,CAACC,KAAK,CAAEY,MAAM,CAAC,CAAC,CAAC,GAAK,GAAG,CAAG,CAAC,CAAG,CAAC,CAAE,QAAQ,CAAC;AAC3F,GAAIA,MAAM,CAAC,CAAC,CAAC,GAAK,GAAG,CAAE;AACtB,GAAI,CAAAkb,KAAK,KAAOlb,MAAM,CAAC,CAAC,CAAC,CAAG,CAAC,CAAI,QAAQ,CAAG,EAAE,EAAGR,IAAI,CAACC,GAAG,CAACO,MAAM,CAAC,CAAC,CAAC,CAAC,KAAIA,MAAM,CAAC,CAAC,CAAG;AACnF,GAAIA,MAAM,CAAC,CAAC,CAAC,GAAK,EAAE,CAAE;AACrBkb,KAAK,EAAI,SAAS;AACnB;;AAEAD,UAAU,CAAG,IAAI,CAAGC,KAAK,CAAG,IAAI,CAAGD,UAAU,CAAG,IAAI;AACrD;AACA1Y,IAAI,CAAC,CAAC,CAAC,CAAG0Y,UAAU;AACrB;AACA,IAAI,CAAC5c,KAAK,CAAC8c,UAAU,CAACvP,IAAI,CAAEhQ,OAAO,CAACuD,iBAAiB,CAACC,KAAK,CAAE,CAAC,CAAE,MAAM,CAAC,CAAC;AACxE,IAAI,CAACoO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,KAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAEsB,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC,CAAC7J,EAAE,GAAK,iBAAiB,CAAE;AACzF,GAAI,CAAAjD,OAAM,CAAG4L,KAAI,CAACtL,WAAW,CAACiC,IAAI,CAAC,CAAC,CAAC,CAAE,IAAI,CAAE,IAAI,CAAC;AAClD,GAAIvC,OAAM,GAAK,IAAI,CAAE;AACrB,GAAI,CAAAZ,MAAK,CAAGwM,KAAI,CAAC7L,cAAc,CAACC,OAAM,CAAC;;AAEvC,GAAI4M,MAAM,CAACE,IAAI,CAAE;AAChB,GAAI,CAAA1B,OAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,OAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,IAAI,CAACtE,eAAe,CAACqE,OAAM,EAAIjP,KAAI,CAAER,OAAM,CAAC;AAC5C,GAAIA,OAAM,CAAC+O,UAAU,GAAK,MAAM,EAAI,CAACS,QAAQ,CAACjc,QAAQ,CAACiN,KAAI,CAACxO,cAAc,CAAC,CAAE;AAC5E,GAAIwO,KAAI,CAACzO,QAAQ,GAAKiO,OAAM,CAACrP,IAAI,CAAE;AAClC6P,KAAI,CAAC3O,IAAI,CAAGmO,OAAM,CAACrP,IAAI;AACxB;AACD;AACA,OAAQqP,OAAM,CAACnI,EAAE;AACjB,IAAK,YAAY,SAAAmY,IAAA,GAAAC,gBAAA;AACQzP,KAAI,CAAC9N,SAAS,CAAAsd,IAAA,CAAAC,gBAAA,CAAApb,MAAA,CAAAmb,IAAA,GAAE,CAAnC,GAAI,CAAAE,WAAW,CAAAD,gBAAA,CAAAD,IAAA;AACnBE,WAAW,CAAC,CAAC,CAAC,CAAG,CAAC;AACnB;;AAED,IAAK,aAAa;AACjB,IAAI,CAACzd,QAAQ,CAAG,cAAc;AAC9B,IAAI,CAACQ,KAAK,CAACkd,eAAe,CAAC,aAAa,CAAQ3P,KAAI,CAAC;AACrDA,KAAI,CAAC9P,IAAI,CAACmO,MAAM,CAAG,IAAI;AACvB2B,KAAI,CAAC7N,UAAU,CAACC,UAAU,CAAG,CAAC;AAC9B4N,KAAI,CAAC7N,UAAU,CAACE,UAAU,CAAG,CAAC;AAC9B;AACD,IAAK,MAAM;AACV,IAAI,CAACI,KAAK,CAACkd,eAAe,CAAC,MAAM,CAAQ3P,KAAI,CAAC;AAC9C;AACD,IAAK,iBAAiB;AACrB,IAAI,CAACvN,KAAK,CAACkd,eAAe,CAAC,MAAM,CAAQ3P,KAAI,CAAC;AAC9C,IAAA4P,oBAAA,CAAkB,IAAI,CAACC,cAAc,CAAClZ,IAAI,CAAC,CAAC,CAAC,CAAC,CAAtCmZ,KAAK,CAAAF,oBAAA,CAALE,KAAK;AACb,GAAM,CAAA5f,IAAI,CAAG,IAAI,CAACmU,KAAK,CAACyL,KAAK,CAAC;AAC9B9P,KAAI,CAACvP,OAAO,CAAG,KAAK;AACpBuP,KAAI,CAACpO,MAAM,CAAG,EAAE;AAChB,IAAI,CAACa,KAAK,CAACqO,aAAa,CAAC5Q,IAAI,CAAC;AAC9B;AACD;AACD;AACA,IAAI,CAACuC,KAAK,CAAC2b,YAAY,CAAC,MAAM,CAAQ,CAACpO,KAAI,CAAC,CAAC;AAC7C,IAAI,CAACvN,KAAK,CAACsd,QAAQ,CAAC/P,KAAI,CAAEhQ,OAAO,CAACuD,iBAAiB,CAACC,MAAK,CAAE,CAAC,CAAE,MAAM,CAAC,CAAC;AACtE,IAAI,CAACoO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,QAAQ,CAAE;AACd,IAAK,GAAI,CAAAgP,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAE,CAAE;AAC3B,GAAI,CAAAC,KAAK,CAAG,IAAI,CAAClC,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAG,CAAC,CAAGqZ,CAAC,CAAC,CAAC;AAC5C,GAAIC,KAAK,CAAE;AACV,GAAI,CAAA7b,QAAM,CAAG6b,KAAK,CAACvb,WAAW,CAACiC,IAAI,CAAC,CAAC,CAAG,CAAC,CAAGqZ,CAAC,CAAC,CAAE;AAChD,GAAI,CAAAxc,OAAK,CAAGyc,KAAK,CAAC9b,cAAc,CAACC,QAAM,CAAC;AACxC,GAAI,CAAA8b,cAAc,CAAGlgB,OAAO,CAACuD,iBAAiB,CAACC,OAAK,CAAE,CAAC,CAAE,MAAM,CAAC;AAChE,GAAI,CAAA2c,IAAI,CAAG/b,QAAM,CAAC,CAAC,CAAC;AACpB,GAAI+b,IAAI,CAAG,CAAC,CAAE;AACb,IAAI,CAAC1d,KAAK,CAACsd,QAAQ,CAACE,KAAK,CAAEC,cAAc,CAAC;AAC3C,CAAC,IAAM;AACN,IAAI,CAACzd,KAAK,CAAC8c,UAAU,CAACU,KAAK,CAAEC,cAAc,CAAC;AAC7C;AACD;AACD;AACA,IAAI,CAACtO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,QAAQ,CAAE;AACd,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAyZ,IAAI,CAAGzZ,IAAI,CAAC,CAAC,CAAsB;AACvC,GAAI,IAAI,CAACmD,GAAG,GAAK,CAAC,EAAIsW,IAAI,GAAK,KAAK,CAAE;AACtC,GAAI,IAAI,CAACtW,GAAG,GAAK,CAAC,EAAIsW,IAAI,GAAK,KAAK,CAAEA,IAAI,CAAG,KAAK;AAClD,GAAI,CAAAC,MAAM,CAAGC,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAClC,GAAI0Z,MAAM,GAAK,CAAC,CAAE;AACjB,IAAI,CAAC5d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,UAAU,CAAGA,MAAI,CAAC9G,QAAQ,CAACkX,IAAI,CAAC,CAAE,SAAS,CAAC;AACxE,IAAI,CAACxO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,GAAI,CAAChB,MAAI,CAACrO,MAAM,CAACye,IAAI,CAAC,CAAE;AACvBpQ,MAAI,CAACrO,MAAM,CAACye,IAAI,CAAC,CAAG,CAAC;AACtB;AACApQ,MAAI,CAACrO,MAAM,CAACye,IAAI,CAAC,EAAIC,MAAM;;AAE3B,GAAI,CAACrP,MAAM,CAAC6N,MAAM,EAAI7N,MAAM,CAACE,IAAI,CAAE;AAClC,GAAI,CAAA1B,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAI,EAAE1P,QAAM,CAACnI,EAAE,GAAK,WAAW,EAAI+Y,IAAI,GAAK,KAAK,CAAC,CAAE;AACnD,IAAI,CAACxF,eAAe,CAACqE,QAAM,EAAIjP,MAAI,CAAER,QAAM,CAAC;AAC7C;AACD;AACA,IAAI,CAAC/M,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAEA,MAAI,CAAC9G,QAAQ,CAACkX,IAAI,CAAC,CAAE,MAAM,CAAC;AACxD,IAAI,CAACxO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAyZ,KAAI,CAAGzZ,IAAI,CAAC,CAAC,CAAsB;AACvC,GAAI,IAAI,CAACmD,GAAG,GAAK,CAAC,EAAIsW,KAAI,GAAK,KAAK,CAAE;AACtC,GAAI,IAAI,CAACtW,GAAG,GAAK,CAAC,EAAIsW,KAAI,GAAK,KAAK,CAAEA,KAAI,CAAG,KAAK;AAClD,GAAI,CAAAC,OAAM,CAAGC,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAClC,GAAI0Z,OAAM,GAAK,CAAC,CAAE;AACjB,IAAI,CAAC5d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,UAAU,CAAGA,MAAI,CAAC9G,QAAQ,CAACkX,KAAI,CAAC,CAAE,SAAS,CAAC;AACxE,IAAI,CAACxO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,GAAI,CAAChB,MAAI,CAACrO,MAAM,CAACye,KAAI,CAAC,CAAE;AACvBpQ,MAAI,CAACrO,MAAM,CAACye,KAAI,CAAC,CAAG,CAAC;AACtB;AACApQ,MAAI,CAACrO,MAAM,CAACye,KAAI,CAAC,EAAIC,OAAM;;AAE3B,GAAI,CAACrP,MAAM,CAAC6N,MAAM,EAAI7N,MAAM,CAACE,IAAI,CAAE;AAClC,GAAI,CAAA1B,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,IAAI,CAACtE,eAAe,CAACqE,QAAM,EAAIjP,MAAI,CAAER,QAAM,CAAC;AAC7C;AACA,IAAI,CAAC/M,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAEA,MAAI,CAAC9G,QAAQ,CAACkX,KAAI,CAAC,CAAE,KAAK,CAAC;AACvD,IAAI,CAACxO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAyZ,MAAI,CAAGzZ,IAAI,CAAC,CAAC,CAAsB;AACvC,GAAI,CAAA0Z,QAAM,CAAGC,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAClCqJ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAGC,QAAM;AAC1B,IAAI,CAAC5d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAEA,MAAI,CAAC9G,QAAQ,CAACkX,MAAI,CAAC,CAAGC,QAAM,CAAG,CAAC,CAAG,MAAM,CAAG,KAAM,CAAC;AAC/E,IAAI,CAACzO,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,YAAY,CAAE;AAClB,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA4J,KAAK,CAAG,IAAI,CAACwN,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACrC,GAAI,CAAA4Z,KAAK,CAAG5Z,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAACqF,KAAK,CAAC,IAAI,CAAC,CAAG,CAAC,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,UAAU,CAAE,SAAS,CAAC,CAAC,QAAAwU,IAAA,GAAAA,IAAA;AACpFD,KAAK,CAAAlc,MAAA,CAAAmc,IAAA,GAAE,CAArB,GAAM,CAAAJ,MAAI,CAAIG,KAAK,CAAAC,IAAA,CAAT;AACd,GAAI,CAAAC,GAAG,CAAGzQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AAC3BpQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAG7P,KAAK,CAAC5O,MAAM,CAACye,MAAI,CAAC;AACtC,GAAI,CAACpQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAE,MAAO,CAAApQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AAChD7P,KAAK,CAAC5O,MAAM,CAACye,MAAI,CAAC,CAAGK,GAAG;AACxB,GAAI,CAAClQ,KAAK,CAAC5O,MAAM,CAACye,MAAI,CAAC,CAAE,MAAO,CAAA7P,KAAK,CAAC5O,MAAM,CAACye,MAAI,CAAC;AACnD;AACA,IAAI,CAAC3d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,eAAe,CAAE,SAAS,CAAC;AACvD,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAAC5N,KAAK,CAAE,eAAe,CAAE,SAAS,CAAC;;AAExD,IAAI,CAACqB,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,qBAAqB,CAAE;AAC3B,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAsY,QAAM,CAAG,IAAI,CAAClB,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACrC,GAAI,CAAA6I,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,IAAK,GAAM,CAAAyZ,MAAI,GAAI,CAAApQ,MAAI,CAACrO,MAAM,CAAE;AAC/B,GAAIqO,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAG,CAAC,CAAE,MAAO,CAAApQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AACpD;AACA,IAAI,CAAC3d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,aAAa,CAAE,KAAK,CAAC;;AAEjD,GAAIR,QAAM,CAACnI,EAAE,CAAE;AACd,OAAQmI,QAAM,CAACnI,EAAE;AACjB,IAAK,eAAe;;AAEnB,IAAI,CAAC5E,KAAK,CAAC2b,YAAY,CAAC,oBAAoB,CAAQ,CAACa,QAAM,CAAGjP,MAAI,CAAC,CAAC;AACpE;AACD;AACD;AACA,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,qBAAqB,CAAE;AAC3B,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,IAAK,GAAM,CAAAyZ,MAAI,GAAI,CAAApQ,MAAI,CAACrO,MAAM,CAAE;AAC/B,GAAIqO,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAG,CAAC,CAAE,MAAO,CAAApQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AACpD;AACA,IAAI,CAAC3d,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,UAAU,CAAE,MAAM,CAAC;;AAE/C,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,YAAY,CAAE;AAClB,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA+Z,QAAQ,CAAG,IAAI,CAAC3C,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACxC,GAAI,CAACqK,MAAM,CAAC6N,MAAM,EAAI7N,MAAM,CAACE,IAAI,CAAE;AAClC,GAAI,CAAA1B,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,IAAI,CAAC0J,eAAe,CAAC5K,MAAI,CAAER,QAAM,CAAC;AACnC;AACA,GAAI,CAAA+Q,MAAK,CAAG5Z,IAAI,CAAC,CAAC,CAAC,CAAGA,IAAI,CAAC,CAAC,CAAC,CAACqF,KAAK,CAAC,IAAI,CAAC,CAAG,CAAC,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,UAAU,CAAE,SAAS,CAAC,CAAC,QAAA2U,IAAA,GAAAA,IAAA;AACpFJ,MAAK,CAAAlc,MAAA,CAAAsc,IAAA,GAAE,CAArB,GAAM,CAAAP,MAAI,CAAIG,MAAK,CAAAI,IAAA,CAAT;AACd3Q,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAGM,QAAQ,CAAC/e,MAAM,CAACye,MAAI,CAAC;AACzC,GAAI,CAACpQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAE,MAAO,CAAApQ,MAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AACjD;AACA,GAAI,IAAI,CAACtW,GAAG,EAAI,CAAC,CAAE;AAClB,GAAM,CAAA8W,eAAe,CAAG,CAAC,aAAa,CAAE,eAAe,CAAE,YAAY,CAAC,CAAC,QAAAC,IAAA,GAAAA,IAAA;AAChDD,eAAe,CAAAvc,MAAA,CAAAwc,IAAA,GAAE,CAAnC,GAAM,CAAAxa,QAAQ,CAAIua,eAAe,CAAAC,IAAA,CAAnB;AAClB,GAAIH,QAAQ,CAAC5e,SAAS,CAACuE,QAAQ,CAAC,CAAE;AACjC2J,MAAI,CAACxJ,WAAW,CAACH,QAAc,CAAC;AACjC,CAAC,IAAM;AACN2J,MAAI,CAAC5J,cAAc,CAACC,QAAc,CAAC;AACpC;AACD;AACD;AACA,IAAI,CAAC5D,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,cAAc,CAAE,SAAS,CAAC;;AAEtD,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;AACnB,GAAI,CAAAhB,MAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpCqJ,MAAI,CAACrO,MAAM,CAAG,CAAC,CAAC;AAChB,GAAI,CAACqP,MAAM,CAAC6N,MAAM,EAAI7N,MAAM,CAACE,IAAI,CAAE;AAClC,GAAI,CAAA1B,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,IAAI,CAACtE,eAAe,CAACqE,QAAM,EAAIjP,MAAI,CAAER,QAAM,CAAC;AAC7C;AACA,IAAI,CAAC/M,KAAK,CAAC0b,UAAU,CAACnO,MAAI,CAAE,aAAa,CAAE,SAAS,CAAC;;AAErD,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,cAAc,CAAE;AACpB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,IAAK,GAAM,CAAAyZ,MAAI,GAAI,CAAApQ,OAAI,CAACrO,MAAM,CAAE;AAC/BqO,OAAI,CAACrO,MAAM,CAACye,MAAI,CAAC,CAAG,CAACpQ,OAAI,CAACrO,MAAM,CAACye,MAAI,CAAC;AACvC;AACA,IAAI,CAAC3d,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,SAAS,CAAC;;AAExD,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,gBAAgB,CAAE;AACtB,GAAI,CAAA8P,UAAU,CAAG,IAAI,CAACre,KAAK,CAACqe,UAAU,CAAC,QAAAC,IAAA,GAAAC,mBAAA;AAClB,IAAI,CAACtJ,YAAY,CAAC,CAAC,CAAAqJ,IAAA,CAAAC,mBAAA,CAAA3c,MAAA,CAAA0c,IAAA,GAAE,CAArC,GAAM,CAAAje,MAAM,CAAAke,mBAAA,CAAAD,IAAA;AAChBje,MAAM,CAACnB,MAAM,CAAG,CAAC,CAAC;AAClB,IAAI,CAACc,KAAK,CAACqe,UAAU,CAAGA,UAAU;AAClC,IAAI,CAACre,KAAK,CAAC0b,UAAU,CAACrb,MAAM,CAAE,aAAa,CAAE,SAAS,CAAC;AACxD;;AAEA,IAAI,CAAC8O,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAIqJ,OAAI,CAAE,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,KAAK,CAAC;AAC5D,GAAI,IAAI,CAAC6C,kBAAkB,CAAE7B,MAAM,CAACiM,MAAM,CAAG,GAAG;AAChD,IAAI,CAACrL,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,iBAAiB,CAAE;AACvB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAIqJ,OAAI,CAAE;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,iBAAiB,CAAE,KAAK,CAAC;AACrD,GAAI/H,GAAG,CAACgZ,OAAO,GAAK,IAAI,CAAE;;AAEzB,IAAI,CAACxe,KAAK,CAAC2b,YAAY,CAAC,SAAS,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACjD;AACD;AACA,GAAI,IAAI,CAAC6C,kBAAkB,CAAE7B,MAAM,CAACiM,MAAM,CAAG,GAAG;AAChD,IAAI,CAACrL,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAIqJ,OAAI,CAAE,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,SAAS,CAAC;AAC5D,GAAI,IAAI,CAAC6C,kBAAkB,CAAE7B,MAAM,CAACiM,MAAM,CAAG,GAAG;AAChD,IAAI,CAACrL,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,SAAS,CAAE;AACf,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAsV,UAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3C,IAAI,CAAC0J,eAAe,CAAC,IAAI,CAACmD,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC,EAAIlP,OAAI,CAAEiM,UAAU,CAAC;AACpE,IAAI,CAACrK,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB,IAAI,CAACvO,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,SAAS,CAAC;AAChD;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAA8B,MAAM,CAAG,IAAI,CAACiM,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACrC,GAAImL,MAAM,CAAE;AACX,IAAI,CAACrP,KAAK,CAAC0b,UAAU,CAACrM,MAAM,CAAE,QAAQ,CAAE,SAAS,CAAC;AACnD;AACA,IAAI,CAACF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAsV,WAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3C,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAIjD,WAAU,CAAC5U,EAAE,GAAK,aAAa,CAAE;AACpC4X,QAAM,CAAE5d,IAAI,CAAG,cAAc;AAC9B,CAAC,IAAM;AACN,IAAI,CAACuZ,eAAe,CAACqE,QAAM,EAAIjP,OAAI,CAAEiM,WAAU,CAAC;AACjD;AACA,OAAQzM,QAAM,CAACnI,EAAE;AACjB,IAAK,KAAK;AACT,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,SAAS,CAAC;AACxD;AACD,IAAK,KAAK;AACV,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,SAAS,CAAC;AAC1D;AACD,IAAK,KAAK;AACT,GAAIiM,WAAU,CAAC5U,EAAE,GAAK,QAAQ,CAAE;AAC/B,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,SAAS,CAAC;AACjD,CAAC,IAAM;AACN,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,SAAS,CAAC;AACzD;AACA;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,SAAS,CAAC;AAC3D;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,SAAS,CAAC;AACxD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,SAAS,CAAC;AAC3D;AACD;AACC,GAAIA,OAAI,CAAE;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,SAAS,CAAC;AACjD;AACA;AACD;AACA,IAAI,CAACvN,KAAK,CAAC4b,SAAS,CAACrO,OAAI,CAAC;AAC1B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,QAAQ,CAAE;AACd,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAsY,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAI,CAAA1P,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,IAAI,CAACiU,eAAe,CAACqE,QAAM,EAAIjP,OAAI,CAAER,QAAM,CAAC;AAC5C,OAAQA,QAAM,CAACnI,EAAE;AACjB,IAAK,YAAY;AAChB2I,OAAI,CAAC9I,aAAa,CAAC,YAAkB,CAAC;AACtC,IAAI,CAACzE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,MAAM,CAAC;AAClD;AACD,IAAK,WAAW;AACfA,OAAI,CAAC9I,aAAa,CAAC,WAAiB,CAAC;AACrC,IAAI,CAACzE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,cAAc;AAClBA,OAAI,CAAC9I,aAAa,CAAC,cAAoB,CAAC;AACxC,IAAI,CAACzE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,eAAe,CAAE,MAAM,CAAC;AACpD;AACD,IAAK,SAAS;AACbA,OAAI,CAAC9I,aAAa,CAAC,SAAe,CAAC;AACnC,IAAI,CAACzE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;;AAED,IAAK,eAAe;AACnBA,OAAI,CAAC3O,IAAI,CAAG,gBAAgB;AAC5B;AACD,IAAK,gBAAgB;AACpB2O,OAAI,CAAC3O,IAAI,CAAG,iBAAiB;AAC7B;AACD,IAAK,eAAe;AACnB2O,OAAI,CAAC3O,IAAI,CAAG,gBAAgB;AAC5B;AACD;AACA,IAAI,CAACuQ,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,SAAS,CAAE,IAAK,WAAW,CAAE,IAAK,OAAO;AAC9C,IAAK,UAAU,CAAE,IAAK,WAAW,CAAE,IAAK,UAAU,CAAE,IAAK,UAAU,CAAE;AACpE,IAAI,CAACY,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,SAAS,CAAE;AACf,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,IAAI,CAAClE,KAAK,CAAC2b,YAAY,CAAC,QAAQ,CAAQ,CAACpO,OAAI,CAAC,CAAC;AAC/C,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAua,MAAM,CAAG/Z,IAAI,CAACR,IAAI,CAAC,CAAC,CAAC,CAAC;AAC1B,GAAI,CAAAmL,OAAM,CAAG,IAAI,CAACiM,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC,EAAIqJ,OAAI,CAAC9P,IAAI,CAACyN,GAAG,CAAC7K,MAAM,CAAC,CAAC,CAAC,EAAIkN,OAAI;AACxE,IAAI,CAACvN,KAAK,CAAC8a,cAAc,CAAC2D,MAAM,CAAElR,OAAI,CAAE8B,OAAM,CAAC;AAC/C,IAAI,CAACF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,eAAe,CAAE;AACrB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpCqJ,OAAI,CAACvI,aAAa,CAAC,cAAoB,CAAC;AACxC,IAAI,CAAChF,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B;AACD;AACA,IAAK,SAAS,CAAE;AACf,GAAI,CAAAA,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,QAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC,EAAIlP,OAAI;AAC/CA,OAAI,CAACpO,MAAM,CAAG+E,IAAI,CAAC,CAAC,CAAmB;AACvC,GAAIqJ,OAAI,CAACpO,MAAM,GAAK,MAAM,EAAIoP,MAAM,CAACmQ,IAAI,CAAE,CAAGnR,OAAI,CAASoR,QAAQ,CAAGC,MAAM,CAACrQ,MAAM,CAACmQ,IAAI,CAAC,EAAI,CAAC,CAAE;AAChG,IAAI,CAACvG,eAAe,CAACqE,QAAM,EAAIjP,OAAI,CAAER,QAAM,CAAC;AAC5C,GAAIA,QAAM,CAAC+O,UAAU,GAAK,MAAM,CAAE;AACjCU,QAAM,CAAC5d,IAAI,CAAGmO,QAAM,CAACrP,IAAI;AAC1B;;AAEA,OAAQwG,IAAI,CAAC,CAAC,CAAC;AACf,IAAK,KAAK;AACT,IAAI,CAAClE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC5C,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAC7C;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,KAAK,CAAC;AAClD,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAC7CA,OAAI,CAAC7N,UAAU,CAACE,UAAU,CAAImN,QAAM,CAACrP,IAAI,GAAK,WAAW,CAAG,CAAC,CAAC,CAAG,CAAE;AACnE;AACD,IAAK,KAAK;AACT,IAAI,CAACsC,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,KAAK,CAAC;AAC9C,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAC7C;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC5C,GAAIR,QAAM,CAACnI,EAAE,GAAK,MAAM,CAAE;AACzB2I,OAAI,CAAC7N,UAAU,CAACC,UAAU,CAAG,CAAC;AAC/B;AACA;AACD,IAAK,KAAK;AACT,IAAI,CAACK,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,KAAK,CAAC;AAC/C,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAC7C;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC5C,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,KAAK,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAC7C;AACD;AACC,IAAI,CAACvN,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B;AACD;AACA,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;AACnB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI1B,SAAM,CAACnI,EAAE,CAAE;AACd,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,YAAY;AACjB,IAAK,YAAY;AACjB,IAAK,aAAa;AAClB,IAAK,YAAY;AACjB,IAAK,OAAO;AACZ,IAAK,eAAe;AACnB2J,MAAM,CAACsQ,IAAI,CAAG,GAAG;AACjB;AACD;AACD;AACA,GAAItR,OAAI,CAAE;AACTA,OAAI,CAACpO,MAAM,CAAG,EAAE;;AAEhB,GAAI+E,IAAI,CAAC,CAAC,CAAC,GAAK,MAAM,CAAE;AACtBqJ,OAAI,CAASoR,QAAQ,CAAG,CAAC;AACzBpR,OAAI,CAASuR,aAAa,CAAG,CAAC;AAC9BvR,OAAI,CAASwR,YAAY,CAAG,CAAC;AAC/B;AACA,OAAQ7a,IAAI,CAAC,CAAC,CAAC;AACf,IAAK,KAAK;AACT,IAAI,CAAClE,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,KAAK;AACV,IAAK,KAAK;AACTA,OAAI,CAAC7N,UAAU,CAACE,UAAU,CAAG,CAAC;AAC9B,IAAI,CAACI,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,MAAM,CAAC;AACnD;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,MAAM,CAAC;AAC9CA,OAAI,CAAC7N,UAAU,CAACC,UAAU,CAAG,CAAC;AAC9B;AACD,IAAK,KAAK;AACT,IAAI,CAACK,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,iBAAiB,CAAE,MAAM,CAAC;AACtD;AACD,IAAK,KAAK;AACT,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,MAAM,CAAC;AAC7C;AACD;AACCA,OAAI,CAAC5J,cAAc,CAAC,WAAiB,CAAC;AACtC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,OAAO,CAAE,MAAM,CAAC;AAC7C;AACD;AACA,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE,CAAC,QAAA8a,IAAA,GAAAC,qBAAA;AAChB1R,OAAI,CAAC9P,IAAI,CAAC6K,OAAO,CAAA0W,IAAA,CAAAC,qBAAA,CAAArd,MAAA,CAAAod,IAAA,GAAE,CAAnC,GAAM,CAAA3P,QAAM,CAAA4P,qBAAA,CAAAD,IAAA;AAChB3P,QAAM,CAAClQ,MAAM,CAAG,EAAE;AAClB,IAAI,CAACa,KAAK,CAACkf,qBAAqB,CAAC7P,QAAM,CAAC;AACzC;;AAEA,IAAI,CAACrP,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAtF,IAAI,CAAG4G,GAAG,CAACmU,KAAK,CAAClU,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,QAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAI,CAAClP,OAAI,CAAE;AACV,GAAIR,SAAM,CAACnI,EAAE,GAAK,OAAO,CAAE;AAC1B,GAAM,CAAAua,eAAe,CAAG3C,QAAM,CAAE/e,IAAI,CAACyN,GAAG,CAAC7K,MAAM,CAACmJ,MAAM,CAAC,SAAA4V,CAAC,QAAI,CAAAA,CAAC,GAAK,IAAI,GAAC;AACvE,GAAID,eAAe,CAACvd,MAAM,GAAK,CAAC,CAAE;AACjC2L,OAAI,CAAG4R,eAAe,CAAC,CAAC,CAAE;AAC3B,CAAC,IAAM;AACN,IAAI,CAAChH,eAAe,CAACqE,QAAM,CAAE,OAAO,CAAC;AACrC,IAAI,CAACrN,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACD,CAAC,IAAM;AACN,KAAM,IAAI,CAAA2F,KAAK,CAAC,6BAA6B,CAAC;AAC/C;AACD;AACA3G,OAAI,CAAC3O,IAAI,CAAGA,IAAI,CAAClB,IAAI;AACrB6P,OAAI,CAAC1O,UAAU,CAAG,EAAE;AACpB0O,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC,GAAI/E,IAAI,CAACgG,EAAE,GAAK,YAAY,CAAE2I,OAAI,CAACxJ,WAAW,CAAC,YAAkB,CAAC;;AAElE,GAAIgJ,SAAM,CAACnI,EAAE,CAAE;AACd,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,QAAQ;AACZ,IAAI,CAACuT,eAAe,CAAC5K,OAAI,CAAE,QAAQ,CAAC;;AAErC,IAAK,SAAS;AACbA,OAAI,CAAC1O,UAAU,CAAG,OAAO;AACzB,IAAI,CAACmB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE3O,IAAI,CAAClB,IAAI,CAAE,SAAS,CAAC;AACjD;AACD,IAAK,OAAO;AACX,IAAI,CAACya,eAAe,CAACqE,QAAM,CAAE,OAAO,CAAC;AACrC,GAAIjP,OAAI,EAAIA,OAAI,GAAKiP,QAAM,CAAE;AAC5BjP,OAAI,CAAC1O,UAAU,CAAG,SAAS;AAC3B,IAAI,CAACmB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE3O,IAAI,CAAClB,IAAI,CAAE,SAAS,CAAC;AAClD;AACA;AACD,IAAK,UAAU;AACf,IAAK,YAAY;AAChB,IAAI,CAACya,eAAe,CAAC5K,OAAI,CAAER,SAAM,CAACrP,IAAI,CAAC;;AAExC,IAAK,OAAO;AACZ,IAAK,OAAO;;AAEX8e,QAAM,CAAE5d,IAAI,CAAG,EAAE;AACjB4d,QAAM,CAAE3d,UAAU,CAAG,EAAE;AACvB2d,QAAM,CAAE1d,QAAQ,CAAGF,IAAI,CAAClB,IAAI;AAC5B8e,QAAM,CAAEzd,cAAc,CAAG,QAAQ;AACjCyd,QAAM,CAAEzY,WAAW,CAAC,aAAmB,CAAC;AACxCwJ,OAAI,CAAC1O,UAAU,CAAG,QAAQ;AAC1B,IAAI,CAACmB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE3O,IAAI,CAAClB,IAAI,CAAE,SAAS,CAAC;AACjD,IAAI,CAACsC,KAAK,CAAC0b,UAAU,CAACc,QAAM,CAAG,aAAa,CAAE,KAAK,CAAC;AACpD;AACD,IAAK,SAAS;AACbjP,OAAI,CAAC1O,UAAU,CAAG,WAAW;AAC7B,IAAI,CAACsZ,eAAe,CAAC5K,OAAI,CAAE,SAAS,CAAC;AACrC,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE3O,IAAI,CAAClB,IAAI,CAAE,SAAS,CAAC;AACjD;AACD,IAAK,QAAQ;AACZ6P,OAAI,CAAC1O,UAAU,CAAG,UAAU;AAC5B,IAAI,CAACmB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE3O,IAAI,CAAClB,IAAI,CAAE,SAAS,CAAC;AACjD;AACD,IAAK,YAAY;AACjB,IAAK,OAAO;AACX6P,OAAI,CAAC1O,UAAU,CAAG,SAAS;;AAE5B;AACC;AACD;AACD,CAAC,IAAM;AACN,OAAQD,IAAI,CAACgG,EAAE;AACf,IAAK,YAAY;AAChB,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,MAAM,CAAC;AAC9C;AACD;AACD;AACA,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAtF,MAAI,CAAG4G,GAAG,CAACmU,KAAK,CAAClU,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,IAAI,CAACpH,GAAG,CAAG,CAAC,EAAI0F,SAAM,CAACnI,EAAE,GAAK,UAAU,CAAE;AAC7C2I,OAAI,CAAC3O,IAAI,CAAG,EAAE;AACd2O,OAAI,CAAC1O,UAAU,CAAG,EAAE;AACpB0O,OAAI,CAACzO,QAAQ,CAAGF,MAAI,CAAClB,IAAI;AACzB6P,OAAI,CAACxO,cAAc,CAAG,EAAE;AACzB;AACAwO,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC4J,OAAI,CAACxJ,WAAW,CAAC,aAAmB,CAAC;AACrC,GAAIwK,MAAM,CAAC8Q,GAAG,CAAE;AACf9R,OAAI,CAACxO,cAAc,CAAG,OAAO;AAC7B,IAAI,CAACiB,KAAK,CAAC2b,YAAY,CAAC,SAAS,CAAQ,CAACpO,OAAI,CAAC,CAAC;AAChD,IAAI,CAAC/N,QAAQ,CAAGZ,MAAI,CAACgG,EAAE;AACxB,CAAC,IAAM,IAAI2J,MAAM,CAAC+Q,MAAM,CAAE;AACzB/R,OAAI,CAACxO,cAAc,CAAG,OAAO;AAC7B,IAAI,CAACS,QAAQ,CAAGZ,MAAI,CAACgG,EAAE;AACxB,CAAC,IAAM,IAAImI,SAAM,CAACnI,EAAE,CAAE;AACrB,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,OAAO;AACX2I,OAAI,CAACxO,cAAc,CAAG,OAAO;AAC7B;AACD,IAAK,UAAU;AACd,GAAI,IAAI,CAACsI,GAAG,EAAI,CAAC,CAAE;AAClBkG,OAAI,CAAC1O,UAAU,CAAG,aAAa;AAChC,CAAC,IAAM;AACN0O,OAAI,CAACxO,cAAc,CAAG,aAAa;AACpC;AACA,IAAI,CAACiB,KAAK,CAAC2b,YAAY,CAAC,SAAS,CAAQ,CAACpO,OAAI,CAAC,CAAC;AAChD,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,SAAS,CAAC;AAC1D;AACD,IAAK,UAAU;AACdA,OAAI,CAACxO,cAAc,CAAG,QAAQ;AAC9B;AACD,IAAK,KAAK;AACTwO,OAAI,CAACxO,cAAc,CAAG,UAAU;AAChC;AACD,IAAK,YAAY;AAChBwO,OAAI,CAACxO,cAAc,CAAG,aAAa;AACnC;AACD;AACD,CAAC,IAAM;AACN,OAAQH,MAAI,CAACgG,EAAE;AACf,IAAK,YAAY;AAChB2I,OAAI,CAACxO,cAAc,CAAG,QAAQ;AAC9BwO,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,SAAS,CAAC;AACxD;AACD,IAAK,WAAW;AACfA,OAAI,CAACxO,cAAc,CAAG,UAAU;AAChC,IAAI,CAACiB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,MAAM,CAAE,SAAS,CAAC;AAC9C;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,SAAS,CAAC;AACpD;AACD,IAAK,SAAS;AACbA,OAAI,CAACxO,cAAc,CAAG,SAAS;AAC/B;AACD;AACCwO,OAAI,CAACxO,cAAc,CAAG,UAAU;AAChC;AACD;AACD;AACA,IAAI,CAACoQ,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA1F,OAAO,CAAGgH,GAAG,CAACU,SAAS,CAACT,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACxC,GAAI,CAAAqb,UAAU,CAAG/Z,GAAG,CAACU,SAAS,CAACT,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AAC3C,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAI,CAAA+N,SAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAI,CAAA1e,IAAW,CAAIwQ,MAAM,CAACxQ,IAAI,GAAK,GAAG,CAAG,CAAC,CAAG,CAAE;;AAE/C,GAAIgP,SAAM,CAACnI,EAAE,GAAK,MAAM,CAAE7G,IAAI,CAAG,CAAC;AAClC,GAAIgP,SAAM,CAACnI,EAAE,GAAK,OAAO,EAAImI,SAAM,CAACnI,EAAE,GAAK,gBAAgB,EAAImI,SAAM,CAACnI,EAAE,GAAK,iBAAiB,CAAE7G,IAAI,CAAG,CAAC;;AAExG,GAAI,CAACwQ,MAAM,CAACxQ,IAAI,CAAE;AACjB,GAAM,CAAAyhB,KAAK,CAAG9a,IAAI,CAAC6a,UAAU,CAAC7hB,IAAI,CAAC;AACnC,GAAM,CAAAmY,EAAE,CAAGnR,IAAI,CAAE6I,OAAI,CAAS7O,QAAQ,EAAI,EAAE,CAAC;AAC7C,GAAM,CAAA+gB,EAAE,CAAG/a,IAAI,CAAE6I,OAAI,CAAS5O,YAAY,EAAI,EAAE,CAAC;AACjD,GAAI6gB,KAAK,GAAKA,KAAK,GAAK3J,EAAE,EAAI2J,KAAK,GAAKC,EAAE,CAAC,CAAE1hB,IAAI,CAAG,CAAC;AACtD;;AAEA,GAAIgP,SAAM,CAACnI,EAAE,GAAK,OAAO,EAAImI,SAAM,CAACnI,EAAE,GAAK,gBAAgB,EAAImI,SAAM,CAACnI,EAAE,GAAK,UAAU,CAAE;AACxF,GAAM,CAAA8a,KAAK,CAAGhb,IAAI,CAACqI,SAAM,CAACnI,EAAE,CAAC;AAC7B,GAAM,CAAA+a,EAAE,CAAGjb,IAAI,CAAE6I,OAAI,CAAS7O,QAAQ,EAAK6O,OAAI,CAAS5O,YAAY,EAAI,EAAE,CAAC;AAC3EZ,IAAI,CAAI4hB,EAAE,GAAKD,KAAK,CAAG,CAAC,CAAG,CAAE;AAC9B;AACAnS,OAAI,CAACvH,eAAe,CAACxH,OAAO,CAACd,IAAI,CAAEqP,SAAM,CAACnI,EAAE,EAAI,CAAC2J,MAAM,CAACqR,IAAI,CAAE7hB,IAAI,CAAC;AACnE,GAAIwQ,MAAM,CAAC6N,MAAM,CAAE;;AAEnB,CAAC,IAAM,IAAImD,UAAU,CAAC3a,EAAE,CAAE;AACzB,IAAI,CAACuT,eAAe,CAAC5K,OAAI,CAAEgS,UAAU,CAAC7hB,IAAI,CAAEmE,SAAS,CAAE9D,IAAI,CAAC;AAC5D,IAAI,CAACiC,KAAK,CAAC6f,IAAI,CAAC,GAAG,CAAC;AACpB,IAAI,CAAC1H,eAAe,CAAC5K,OAAI,CAAE/O,OAAO,CAACd,IAAI,CAAE,IAAI,CAAEK,IAAI,CAAC;AACpDye,SAAM,QAANA,SAAM,CAAExW,eAAe,CAACxH,OAAO,CAACd,IAAI,CAAEmE,SAAS,CAAE9D,IAAI,CAAC;AACvD,CAAC,IAAM,IAAIgP,SAAM,CAACnI,EAAE,CAAE;AACrB,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,cAAc;AACnB,IAAK,eAAe;AACpB,IAAK,aAAa;AACjB,GAAI2J,MAAM,CAACqR,IAAI,CAAE;AAChB,IAAI,CAACzH,eAAe,CAAC5K,OAAI,CAAE/O,OAAO,CAACd,IAAI,CAAEmE,SAAS,CAAE9D,IAAI,CAAC,CAAC;AAC3D;AACA;AACD;AACC,IAAI,CAACoa,eAAe,CAAC5K,OAAI,CAAE/O,OAAO,CAACd,IAAI,CAAEmE,SAAS,CAAE9D,IAAI,CAAC,CAAC;AAC1D;AACD;AACD,CAAC,IAAM;AACN,IAAI,CAACoa,eAAe,CAAC5K,OAAI,CAAE/O,OAAO,CAACd,IAAI,CAAEmE,SAAS,CAAE9D,IAAI,CAAC,CAAC;AAC3D;AACA,IAAI,CAACiC,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC1B,IAAI,CAACtF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;;;AAGnB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA1F,QAAO,CAAGgH,GAAG,CAACU,SAAS,CAACT,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACxCqJ,OAAI,CAAC/O,OAAO,CAAG,cAAc;AAC7B+O,OAAI,CAAC7O,QAAQ,CAAG,cAAc;;AAE9B,GAAIF,QAAO,CAACoG,EAAE,CAAE;AACf,GAAI,CAAC2I,OAAI,CAAC9O,WAAW,CAAE8O,OAAI,CAAC9O,WAAW,CAAGD,QAAO,CAACd,IAAI;AACtD,GAAI,CAAC6P,OAAI,CAAC5O,YAAY,CAAE4O,OAAI,CAAC5O,YAAY,CAAGH,QAAO,CAACd,IAAI;AACzD;AACA,IAAI,CAACyR,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,eAAe,CAAE;AACrB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpCqJ,OAAI,CAAC5J,cAAc,CAAC,aAAmB,CAAC;AACxC4J,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC4J,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;;AAEvC,GAAI,CAAAmc,eAAe,CAAG5b,IAAI,CAAC,CAAC,CAAC;AAC7B,GAAI,CAAA6b,UAAU,CAAGD,eAAe,CAACE,OAAO,CAAC,GAAG,CAAC;AAC7C,GAAID,UAAU,GAAK,CAAC,CAAC,CAAE;AACtB,GAAI,CAAA5hB,KAAK,CAAG2hB,eAAe,CAACjd,MAAM,CAACkd,UAAU,CAAG,CAAC,CAAC,CAACE,IAAI,CAAC,CAAC;AACzD,GAAI9hB,KAAK,CAACuH,UAAU,CAAC,GAAG,CAAC,CAAE;AAC1B6H,OAAI,CAACpP,KAAK,CAAG0f,QAAQ,CAAC1f,KAAK,CAAC0E,MAAM,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAC3C;AACAid,eAAe,CAAG5b,IAAI,CAAC,CAAC,CAAC,CAACrB,MAAM,CAAC,CAAC,CAAEkd,UAAU,CAAC;AAChD;AACA,GAAI,CAAAzV,OAAO,CAAG,IAAI,CAACP,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAACqa,eAAe,CAAC;AACnD,GAAI7D,QAAQ,CAAE;AACb,GAAIA,QAAQ,CAAC,CAAC,CAAC,GAAK,OAAO,CAAE;AAC5B3R,OAAO,CAAG,IAAI,CAACP,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAAC,IAAI,CAACsE,GAAG,CAAC4P,KAAK,CAAClU,GAAG,CAACwW,QAAQ,CAAC,CAAC,CAAC,CAAC,CAACiE,SAAS,CAAC;AAC1E,CAAC,IAAM,IAAIjE,QAAQ,CAAC,CAAC,CAAC,GAAK,SAAS,EAAIA,QAAQ,CAACra,MAAM,CAAG,CAAC,CAAE;AAC5D,GAAIqa,QAAQ,CAAC,CAAC,CAAC,GAAK,SAAS,CAAE3R,OAAO,CAAG,IAAI,CAACP,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAAC,gBAAgB,CAAC;AAC/E,GAAIwW,QAAQ,CAAC,CAAC,CAAC,GAAK,UAAU,CAAE3R,OAAO,CAAG,IAAI,CAACP,GAAG,CAACO,OAAO,CAAC7E,GAAG,CAAC,eAAe,CAAC;AAChF;AACD;;AAEA8H,OAAI,CAAC5P,YAAY,CAAGmiB,eAAe;AACnCvS,OAAI,CAAC/O,OAAO,CAAG+O,OAAI,CAAC9O,WAAW,CAAI6L,OAAO,CAACpE,SAAS,CAAGoE,OAAO,CAACpE,SAAS,CAAC,GAAG,CAAC,CAAG,EAAG;;AAEnFqH,OAAI,CAAC1P,OAAO,CAAGqG,IAAI,CAAC,CAAC,CAAC;AACtBqJ,OAAI,CAACzP,QAAQ,CAAGoG,IAAI,CAAC,CAAC,CAAC,CAACrB,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAGqB,IAAI,CAAC,CAAC,CAAC,CAACrB,MAAM,CAACqB,IAAI,CAAC,CAAC,CAAC,CAAC8b,OAAO,CAAC,GAAG,CAAC,CAAC,CAAG,GAAG,CAAG9b,IAAI,CAAC,CAAC,CAAC;;AAE3F,IAAI,CAAClE,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAE,IAAI,CAAE,IAAI,CAAC;AAC1C,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,YAAY,CAAE;AAClB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAkc,KAAK,CAAG,IAAI,CAAC9E,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACrC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACvC,GAAIlB,OAAI,GAAK6S,KAAK,CAAE,KAAM,IAAI,CAAAlM,KAAK,CAAC,wBAAwB,CAAC;;AAE7D,GAAI,CAAC3F,MAAM,CAAC6N,MAAM,CAAE;AACnB,IAAI,CAACjE,eAAe,CAAC5K,OAAI,CAAER,SAAM,CAAC;AACnC;;AAEAQ,OAAI,CAACrO,MAAM,CAAA6P,MAAA,CAAAC,MAAA,IAAQoR,KAAK,CAAClhB,MAAM,CAAE;AACjCqO,OAAI,CAACxE,aAAa,CAACqX,KAAK,CAAE,IAAI,CAAC;AAC/B7S,OAAI,CAAC/O,OAAO,CAAG4hB,KAAK,CAAC5hB,OAAO;AAC5B+O,OAAI,CAAC1N,aAAa,CAAGugB,KAAK,CAACvgB,aAAa;AACxC,GAAM,CAAAwgB,WAAW,CAAGD,KAAK,CAAC/gB,SAAS,CAACgL,WAAW;AAC/C,GAAM,CAAA1M,YAAY,CAAI0iB,WAAW,EAAI,CAACA,WAAW,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,OAAO,CAAC,CAAID,WAAW,CAAC,CAAC,CAAC,CAAGD,KAAK,CAACziB,YAAY;AAC7G,GAAM,CAAA2K,OAAO,CAAG8X,KAAK;AACrB,GAAM,CAAA/hB,KAAK,CAAG+hB,KAAK,CAAC/hB,KAAK;AACzB,GAAM,CAAAD,MAAM,CAAGgiB,KAAK,CAAChiB,MAAM;AAC3B,GAAM,CAAAD,MAAK,CAAGiiB,KAAK,CAACjiB,KAAK;AACzBoP,OAAI,CAACxJ,WAAW,CAAC,WAAW,CAAQuE,OAAO,CAAEjK,KAAK,CAAED,MAAM,CAAED,MAAK,CAAC;AAClEoP,OAAI,CAACxJ,WAAW,CAAC,aAAa,CAAQpG,YAAY,CAAC,CAAC,QAAA4iB,IAAA,GAAAC,iBAAA;AAC1BJ,KAAK,CAAC3gB,SAAS,CAAA8gB,IAAA,CAAAC,iBAAA,CAAA5e,MAAA,CAAA2e,IAAA,GAAE,CAAtC,GAAM,CAAAtD,YAAW,CAAAuD,iBAAA,CAAAD,IAAA;AACrBhT,OAAI,CAACnI,YAAY,CAAC6X,YAAW,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC;AACrC;AACA,IAAI,CAACjd,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAC;AAC9B,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,MAAM,CAAC;AAClD,IAAI,CAAC4B,GAAG,CAAC,CAAC,YAAY,CAAEjL,IAAI,CAAC,CAAC,CAAC,CAAEA,IAAI,CAAC,CAAC,CAAC,CAAEkc,KAAK,CAACziB,YAAY,CAAC,CAAE4Q,MAAM,CAAC;AACtE;AACD;AACA,IAAK,cAAc,CAAE;AACpB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAoG,QAAO,CAAG9E,GAAG,CAAC8E,OAAO,CAAC7E,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACtC,GAAI,CAAAsV,YAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3C,GAAI,CAAClB,OAAI,CAACnD,eAAe,CAAC,CAAC,CAACkW,QAAQ,CAAC,OAAO,CAAC,EAAI,CAAChW,QAAO,CAAC5M,IAAI,CAAC4iB,QAAQ,CAAC,OAAO,CAAC,CAAE;AACjF/S,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC4J,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC,GAAI,IAAI,CAAC0D,GAAG,EAAI,CAAC,CAAEkG,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AAC3D;;AAEA,GAAI,CAAC4K,MAAM,CAAC6N,MAAM,CAAE;AACnB,IAAI,CAACjE,eAAe,CAAC5K,OAAI,CAAEiM,YAAU,CAAC;AACvC;AACAjM,OAAI,CAACxJ,WAAW,CAAC,aAAa,CAAQuG,QAAO,CAAC5M,IAAI,CAAC;AACnD,IAAI,CAACsC,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAE,IAAI,CAAC;AACpC,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAtF,MAAI,CAAG4G,GAAG,CAACmU,KAAK,CAAClU,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,GAAIA,IAAI,CAAC,CAAC,CAAC,CAAE;AACZqJ,OAAI,CAAC3O,IAAI,CAAGA,MAAI,CAAClB,IAAI;AACtB;AACA,IAAI,CAACyR,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,SAAS,CAAE,IAAK,QAAQ,CAAE;AAC9B,IAAI,CAACY,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,eAAe,CAAE;AACrB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA8V,IAAI,CAAGxU,GAAG,CAAC2D,KAAK,CAAC1D,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC,CAACxG,IAAI;AACtC,GAAI,CAAA+iB,SAAS,CAAG,KAAK;AACrBlT,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC4J,OAAI,CAACtO,QAAQ,CAAG+a,IAAI;AACpBzM,OAAI,CAACvO,aAAa,CAAGgb,IAAI;AACzBzM,OAAI,CAAC1P,OAAO,YAAcmc,IAAM;AAChCzM,OAAI,CAACzP,QAAQ,YAAckc,IAAM;AACjC,GAAIzM,OAAI,CAAC5P,YAAY,CAAC+H,UAAU,CAAC,SAAS,CAAC,CAAE;AAC5C+a,SAAS,CAAG,IAAI;AAChBlT,OAAI,CAAC5P,YAAY,CAAG4P,OAAI,CAACnD,eAAe,CAAC,CAAC;AAC1CmD,OAAI,CAAC1P,OAAO,CAAG0P,OAAI,CAAC1P,OAAO,CAAC2F,OAAO,CAAC,SAAS,CAAE+J,OAAI,CAAC5P,YAAY,CAAC;AACjE4P,OAAI,CAACzP,QAAQ,CAAMyP,OAAI,CAAC3P,KAAK,KAAI2P,OAAI,CAAC1P,OAAS;AAC/C,MAAO,CAAA0P,OAAI,CAAClO,SAAS,CAAC,aAAa,CAAC;AACrC;AACA,IAAI,CAACW,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAE,IAAI,CAAEkT,SAAS,CAAC;AAC/C,IAAI,CAACzgB,KAAK,CAAC0gB,YAAY,CAACnT,OAAI,CAAC;AAC7B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,QAAQ,CAAE;AACd,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAsY,SAAM,CAAG,IAAI,CAAClB,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACvC,GAAI,CAAAjD,YAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;;AAE3C,IAAI,CAAC0J,eAAe,CAAC5K,OAAI,CAAER,SAAM,CAAC;AAClC,IAAI,CAACoL,eAAe,CAACqE,SAAM,EAAIjP,OAAI,CAAEiM,YAAU,CAAC;AAChD,OAAQzM,SAAM,CAACnI,EAAE;AACjB,IAAK,YAAY;AAChB,GAAI2I,OAAI,CAACvO,aAAa,CAAE;AACxB,GAAIwd,SAAM,EAAIhD,YAAU,CAAC5U,EAAE,GAAK,aAAa,CAAE;AAC9C2I,OAAI,CAACxE,aAAa,CAACyT,SAAM,CAAC;AAC3B,CAAC,IAAM;AACN,GAAM,CAAArT,KAAK,CAAG3D,GAAG,CAACmb,YAAY,CAACzc,IAAI,CAAC,CAAC,CAAC,EAAI,KAAK,CAAC;AAChDqJ,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC4J,OAAI,CAACxJ,WAAW,CAAC,YAAY,CAAQoF,KAAK,CAAC;AAC3C,GAAI,CAACoF,MAAM,CAAC6N,MAAM,CAAE;AACnB,IAAI,CAACpc,KAAK,CAAC4gB,QAAQ,CAACrT,OAAI,CAAEpE,KAAK,CAAC;AACjC;AACD;AACA,IAAI,CAACnJ,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B;AACD,IAAK,SAAS;AACb,GAAM,CAAAyM,KAAI,CAAGxU,GAAG,CAACmb,YAAY,CAACzc,IAAI,CAAC,CAAC,CAAC,CAAC;AACtCqJ,OAAI,CAACxJ,WAAW,CAAC,SAAS,CAAQiW,KAAI,CAAC;AACvC,GAAIzL,MAAM,CAAC6N,MAAM,CAAE;AACnB,IAAI,CAACpc,KAAK,CAAC4gB,QAAQ,CAACrT,OAAI,CAAEyM,KAAI,CAAC;AAC/B;AACD,IAAK,SAAS;AACbzM,OAAI,CAACxJ,WAAW,CAAC,SAAS,CAAQ,CAAC,CAACG,IAAI,CAAC,CAAC,CAAC,CAAC;AAC5C,IAAI,CAAClE,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAE,IAAI,CAAC;AACpC;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,SAAS,CAAC;AACrD;AACD,IAAK,WAAW;AAChB,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,KAAK,CAAC;AAChD;AACD,IAAK,aAAa;AACjB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,SAAS,CAAC;AACrD;AACD,IAAK,WAAW;AACf,GAAI,CAACgB,MAAM,CAACsS,OAAO,CAAE;AACpB,IAAI,CAAC7gB,KAAK,CAACyb,aAAa,CAAC,UAAU,CAAQ,CAAClO,OAAI,CAAC,CAAC;AAClD,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,KAAK,CAAC;AAC/C;AACA;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,KAAK,CAAC;AAChD;AACD,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC5C;AACD,IAAK,OAAO;AACX,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,KAAK,CAAC;AAC7C;AACD,IAAK,UAAU;AACd,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,MAAM,CAAC;AAClD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,KAAK,CAAC;AAC9C;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,KAAK,CAAC;AAC7C;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,KAAK,CAAC;AAC/C;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;AACD,IAAK,UAAU;AACd,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;AACD,IAAK,YAAY;AAChBA,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,MAAM,CAAC;AACxD;AACD,IAAK,YAAY;AAChBA,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,MAAM,CAAC;AACxD;AACD,IAAK,SAAS;AACbA,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC;AACD,IAAK,SAAS;AACb4J,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,KAAK,CAAC;AACtD;AACD,IAAK,SAAS;AACbA,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,KAAK,CAAC;AACjD;AACD,IAAK,SAAS;AACb,GAAI,CAACgB,MAAM,CAAC6N,MAAM,CAAE,IAAI,CAACpc,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,KAAK,CAAC;AACrE;AACD,IAAK,QAAQ;AACZ,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,KAAK,CAAC;AAC7C;AACD,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,MAAM,CAAE,MAAM,CAAC;AAC3C;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,KAAK,CAAC;AAC/C;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD,GAAIA,OAAI,CAAClO,SAAS,CAACwI,UAAU,CAAE;AAC9B0F,OAAI,CAAClO,SAAS,CAACwI,UAAU,CAAC,CAAC,CAAC,EAAE;AAC/B,CAAC,IAAM;AACN0F,OAAI,CAACxJ,WAAW,CAAC,YAAY,CAAQ,CAAC,CAAC;AACxC;AACA;AACD,IAAK,aAAa;AACjB,IAAI,CAAC/D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,OAAO;AACX,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC5C;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,KAAK,CAAC;AAC/C;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,MAAM,CAAC;AAClD;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,KAAK,CAAC;AAClDA,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC4J,OAAI,CAAC5J,cAAc,CAAC,aAAmB,CAAC;AACxC,GAAI4J,OAAI,CAAC/N,QAAQ,GAAK,KAAK,EAAI+N,OAAI,CAAC/N,QAAQ,GAAK,QAAQ,CAAE,IAAI,CAACQ,KAAK,CAAC4b,SAAS,CAACrO,OAAI,CAAC;AACrF;AACD,IAAK,YAAY;AAChB,GAAIgB,MAAM,CAAC5M,MAAM,CAAE;AAClB,IAAI,CAAC3B,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC7C,CAAC,IAAM,IAAIgB,MAAM,CAACuS,KAAK,CAAE;AACxB,IAAI,CAAC9gB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,SAAS,CAAC;AAClD;AACA;;;AAGD,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,MAAM,CAAE,MAAM,CAAC;AAC3C;;AAED,IAAK,aAAa;AACjB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,MAAM,CAAC;AACnD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,MAAM,CAAC;AAC9C;AACD;AACA,GAAI,EAAER,SAAM,CAACnI,EAAE,GAAK,YAAY,EAAI2I,OAAI,CAACvO,aAAa,CAAC,CAAE;AACxDuO,OAAI,CAACxJ,WAAW,CAACgJ,SAAM,CAACnI,EAAE,CAAC;AAC5B;AACA,IAAI,CAAC5E,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAsV,YAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3ClB,OAAI,CAAC5J,cAAc,CAACoJ,SAAM,CAACnI,EAAE,CAAC;;AAE9B,GAAI2J,MAAM,CAAC6N,MAAM,EAAI,EAAErP,SAAM,CAACnI,EAAE,GAAK,gBAAgB,EAAImI,SAAM,CAACnI,EAAE,GAAK,YAAY,CAAC,CAAE;;AAEtF,CAAC,IAAM;AACN,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,SAAS;AACb,IAAI,CAAC5E,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAC;AAC9B;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,SAAS,CAAC;AACrD;AACD,IAAK,aAAa;AACjB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,wBAAwB,CAAE,SAAS,CAAC;AAChE;AACD,IAAK,SAAS;AACb,GAAIgB,MAAM,CAACwS,SAAS,CAAE;AACrB,IAAI,CAAC/gB,KAAK,CAAC6a,IAAI,CAACtN,OAAI,CAAE,CAAEmR,IAAI,CAAE,GAAI,CAAC,CAAC;AACrC;AACA;AACD,IAAK,WAAW;AACf,IAAI,CAAC1e,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,sBAAsB,CAAE,MAAM,CAAC;AAC3D;AACD,IAAK,WAAW;AACf,GAAIiM,YAAU,CAAC5U,EAAE,GAAK,WAAW,CAAE;AAClC,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AACjD;AACA;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,MAAM,CAAC;AACvD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,oBAAoB,CAAE,MAAM,CAAC;AACzD;AACD,IAAK,OAAO;AACX,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,MAAM,CAAC;AACvD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,oBAAoB,CAAE,MAAM,CAAC;AACzD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,eAAe,CAAE,MAAM,CAAC;AACpD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,oBAAoB,CAAE,MAAM,CAAC;AACzD;AACD,IAAK,QAAQ;AACZ,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,MAAM,CAAC;AACxD;AACD,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC2b,YAAY,CAAC,aAAa,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACpD;AACD,IAAK,UAAU;AACd,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,gBAAgB,CAAE,KAAK,CAAC;AACpDA,OAAI,CAACvH,eAAe,CAAC,UAAU,CAAC;AAChC;AACD,IAAK,WAAW;AACf,IAAI,CAAChG,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,kBAAkB,CAAE,MAAM,CAAC;AACvD;AACD,IAAK,YAAY;AAChBA,OAAI,CAAC5J,cAAc,CAAC,SAAe,CAAC;AACpC;AACD,IAAK,YAAY;AAChB,IAAI,CAAC3D,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,OAAO,CAAE,KAAK,CAAC;AAC3C;AACD,IAAK,WAAW;AACfA,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC4J,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC4J,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC;AACD,IAAK,gBAAgB;AACpB4J,OAAI,CAAC5J,cAAc,CAAC,mBAAyB,CAAC;AAC9C4J,OAAI,CAAC5J,cAAc,CAAC,mBAAyB,CAAC;AAC9C4J,OAAI,CAAC5J,cAAc,CAAC,mBAAyB,CAAC;AAC9C4J,OAAI,CAAC5J,cAAc,CAAC,mBAAyB,CAAC;AAC9C4J,OAAI,CAAC5J,cAAc,CAAC,mBAAyB,CAAC;AAC9C;AACD,IAAK,YAAY;AAChB4J,OAAI,CAAC5J,cAAc,CAAC,eAAqB,CAAC;AAC1C4J,OAAI,CAAC5J,cAAc,CAAC,eAAqB,CAAC;AAC1C4J,OAAI,CAAC5J,cAAc,CAAC,eAAqB,CAAC;AAC1C4J,OAAI,CAAC5J,cAAc,CAAC,eAAqB,CAAC;AAC1C4J,OAAI,CAAC5J,cAAc,CAAC,eAAqB,CAAC;AAC1C;AACD;AACC,GAAIoJ,SAAM,CAAC+O,UAAU,GAAK,MAAM,CAAE;AACjC,GAAI/O,SAAM,CAACrP,IAAI,GAAK,aAAa,CAAE;AAClC,IAAI,CAACsC,KAAK,CAAC2b,YAAY,CAAC,eAAe,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACvD;AACA,GAAIR,SAAM,CAACrP,IAAI,GAAK,cAAc,CAAE;AACnC,IAAI,CAACsC,KAAK,CAAC2b,YAAY,CAAC,gBAAgB,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACxD;AACD;AACD;AACD;AACA,IAAI,CAACvN,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;AACnB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI6I,SAAM,CAACnI,EAAE,GAAK,OAAO,EAAI,CAAC2I,OAAI,CAACzD,WAAW,CAAC,CAAC,CAACxJ,QAAQ,CAAC,QAAQ,CAAC,CAAE;AACpE;AACD;AACAiN,OAAI,CAAC9I,aAAa,CAACsI,SAAM,CAACnI,EAAE,CAAC;AAC7B,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,OAAO;AACX,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,SAAS,CAAC;AAChD;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,aAAa,CAAE,MAAM,CAAC;AAClD;AACD,IAAK,WAAW;AACf,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,cAAc;AAClB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,eAAe,CAAE,MAAM,CAAC;AACpD;AACD,IAAK,UAAU;AACd,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,WAAW,CAAE,MAAM,CAAC;AAChD;AACD,IAAK,QAAQ;AACZ,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,MAAM,CAAC;AAC/C;AACD,IAAK,aAAa;AACjB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,MAAM,CAAC;AACnD;AACD,IAAK,YAAY;AAChB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,SAAS,CAAC;AAClDA,OAAI,CAACnI,YAAY,CAAC2H,SAAM,CAACrP,IAAI,CAAE,CAAC,CAAC;AACjC;AACD,IAAK,WAAW;AACf,IAAI,CAACsC,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,UAAU,CAAE,SAAS,CAAC;AAClDA,OAAI,CAACnI,YAAY,CAAC2H,SAAM,CAACrP,IAAI,CAAE,CAAC,CAAC;AACjC;AACD,IAAK,WAAW;AACf,IAAI,CAACsC,KAAK,CAAC2b,YAAY,CAAC,YAAY,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACnD,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,SAAS,CAAC;AACpD;AACD;AACA,IAAI,CAACvN,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;AACnB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnCqJ,OAAI,CAACvI,aAAa,CAAC+H,SAAM,CAACnI,EAAE,CAAC;AAC7B,OAAQmI,SAAM,CAACnI,EAAE;AACjB,IAAK,QAAQ;AACZ,IAAI,CAAC5E,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,SAAS,CAAC;AAChD;AACD,IAAK,aAAa;AACjB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,cAAc,CAAE,SAAS,CAAC;AACtD;AACD;AACA,IAAI,CAACvN,KAAK,CAAC6E,aAAa,CAAC0I,OAAI,CAAC;AAC9B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAmL,QAAM,CAAG,IAAI,CAACiM,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACrC,IAAI,CAACiU,eAAe,CAAC5K,OAAI,CAAER,SAAM,CAAC;AAClC,OAAQA,SAAM,CAACnI,EAAE;AACjB,IAAK,aAAa;AACjB2I,OAAI,CAAC3O,IAAI,CAAG2P,MAAM,CAAC3P,IAAI;AACvB2O,OAAI,CAAC1O,UAAU,CAAG,WAAW;AAC7B;AACD,IAAK,WAAW;AACf0O,OAAI,CAAC3O,IAAI,CAAG,EAAE;AACd2O,OAAI,CAAC1O,UAAU,CAAG,EAAE;AACpB0O,OAAI,CAACzO,QAAQ,CAAGyP,MAAM,CAAC3P,IAAI;AAC3B2O,OAAI,CAACxO,cAAc,CAAG,YAAY;AAClCsQ,QAAM,CAAEzQ,IAAI,CAAG2P,MAAM,CAAC3P,IAAI;AAC1ByQ,QAAM,CAAExQ,UAAU,CAAG,QAAQ;AAC7B;AACD,IAAK,QAAQ;AACZ0O,OAAI,CAACnI,YAAY,CAACmJ,MAAM,CAACgL,IAAI,CAAE7C,QAAQ,CAAC;AACxC;AACD,IAAK,YAAY;AAChB,GAAInI,MAAM,CAAC5M,MAAM,CAAE;AAClB,IAAI,CAAC3B,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,QAAQ,CAAE,KAAK,CAAC;AAC7C,CAAC,IAAM,IAAIgB,MAAM,CAACuS,KAAK,CAAE;AACxB,IAAI,CAAC9gB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,SAAS,CAAE,SAAS,CAAC;AAClD;AACA;AACD,IAAK,SAAS;AACb,IAAI,CAACvN,KAAK,CAACyb,aAAa,CAAC,WAAW,CAAQ,CAAClO,OAAI,CAAC,CAAC;AACnD;AACD,IAAK,MAAM;AACV,IAAI,CAACvN,KAAK,CAAC2b,YAAY,CAAC,YAAY,CAAQ,CAACpO,OAAI,CAAC,CAAC;AACnD;;;AAGD,IAAK,cAAc;AAClB,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,UAAU;AACd,IAAI,CAACvN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,YAAY,CAAE,MAAM,CAAC;AACjD;AACD,IAAK,YAAY;AAChB8B,QAAM,CAAE5R,IAAI,CAACyP,mBAAmB,CAAC,SAAS,CAAC;AAC3CmC,QAAM,CAAE5R,IAAI,CAACyP,mBAAmB,CAAC,aAAa,CAAC;AAC/C;AACD,IAAK,gBAAgB;AACrB,IAAK,gBAAgB;AACrB,IAAK,cAAc;AACnB,IAAK,aAAa;AAClB,IAAK,OAAO;AACX,IAAI,CAAClN,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,KAAK,CAAC;AACvDA,OAAI,CAAChJ,gBAAgB,CAAC,SAAe,CAAC,CAAC,QAAAyc,IAAA,GAAAC,qBAAA;AACf1T,OAAI,CAAC9P,IAAI,CAAC6K,OAAO,CAAA0Y,IAAA,CAAAC,qBAAA,CAAArf,MAAA,CAAAof,IAAA,GAAE,CAAtC,GAAM,CAAA3F,SAAS,CAAA4F,qBAAA,CAAAD,IAAA;AACnB3F,SAAS,CAAC9W,gBAAgB,CAAC,WAAiB,CAAC;AAC7C8W,SAAS,CAAC9W,gBAAgB,CAAC,YAAkB,CAAC;AAC9C8W,SAAS,CAAC9W,gBAAgB,CAAC,cAAoB,CAAC;AAChD8W,SAAS,CAAC9W,gBAAgB,CAAC,UAAgB,CAAC;AAC5C,IAAI,CAACvE,KAAK,CAAC6E,aAAa,CAACwW,SAAS,CAAC;AACpC;AACA;AACD,IAAK,YAAY;AACjB,IAAK,eAAe;AACpB,IAAK,OAAO;AACX,GAAI,CAAA9B,IAAI,CAAG/T,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAAC8I,MAAM,CAACgL,IAAI,CAAC,CAAC7b,IAAI;AAC1C,GAAI,CAAA4H,EAAE,CAAGsZ,MAAM,CAACrQ,MAAM,CAAC2S,MAAM,CAAC;AAC9B,GAAIze,KAAK,CAAC6C,EAAE,CAAC,CAAEA,EAAE,CAAG,CAAC;AACrBiI,OAAI,CAACnI,YAAY,CAACmU,IAAI,CAAEjU,EAAE,CAAC;AAC3B;AACD,IAAK,SAAS;AACbiI,OAAI,CAAC5J,cAAc,CAAC,YAAkB,CAAC;AACvC4J,OAAI,CAAC5J,cAAc,CAAC,aAAmB,CAAC;AACxC,IAAI,CAAC3D,KAAK,CAAC6a,IAAI,CAACtN,OAAI,CAAE,CAAEmR,IAAI,CAAE,GAAI,CAAC,CAAC;AACpC;AACE,IAAK,WAAW;AAClB,GAAI,IAAI,CAACrX,GAAG,EAAI,CAAC,CAAE;AACnB,GAAIgI,QAAM,CAAE;;AAEX9B,OAAI,CAACpH,aAAa,CAACkJ,QAAM,CAAC;;AAE1B,GAAI9B,OAAI,CAAC9P,IAAI,GAAK4R,QAAM,CAAC5R,IAAI,CAAE;AAC9B,IAAI,CAAC0a,eAAe,CAAC5K,OAAI,CAAEA,OAAI,CAAC/O,OAAO,CAAE,IAAI,CAAC;AAC9C,IAAI,CAAC2Z,eAAe,CAAC9I,QAAM,CAAEA,QAAM,CAAC7Q,OAAO,CAAE,IAAI,CAAC;AACnD;AACD;AACA;;;AAGD,IAAK,kBAAkB;AACvB,IAAK,WAAW;AACf+O,OAAI,CAACvI,aAAa,CAAC,QAAc,CAAC;AAClC;AACD,IAAK,UAAU;AACd,GAAIqK,QAAM,CAAE;AACXA,QAAM,CAACjK,YAAY,CAACmJ,MAAM,CAACgL,IAAI,CAAE,CAAC,CAAC;AACpC,CAAC,IAAM;AACN,GAAI,CAAA4H,SAAS,CAAG,EAAe,CAAC,QAAAC,IAAA,GAAAC,sBAAA;AACN9T,OAAI,CAAC9P,IAAI,CAACyN,GAAG,CAAC7K,MAAM,CAAA+gB,IAAA,CAAAC,sBAAA,CAAAzf,MAAA,CAAAwf,IAAA,GAAE,CAA3C,GAAM,CAAAE,WAAW,CAAAD,sBAAA,CAAAD,IAAA;AACrB,GAAIE,WAAW,EAAI,CAACA,WAAW,CAACtjB,OAAO,CAAEmjB,SAAS,CAACpb,IAAI,CAACub,WAAW,CAAC;AACrE;AACA,GAAIH,SAAS,CAACvf,MAAM,GAAK,CAAC,CAAE;AAC3Buf,SAAS,CAAC,CAAC,CAAC,CAAC/b,YAAY,CAACmJ,MAAM,CAACgL,IAAI,CAAE,CAAC,CAAC;AAC1C;AACD;AACA;AACD,IAAK,gBAAgB;AACrB,IAAK,OAAO;AACZ,IAAK,iBAAiB;AACrB,GAAI,CAAChL,MAAM,CAAC/P,OAAO,CAAE;AACrB,GAAI,CAAAA,SAAO,CAAGgH,GAAG,CAACU,SAAS,CAACT,GAAG,CAAC8I,MAAM,CAAC/P,OAAO,CAAC;AAC/C,IAAI,CAAC2Z,eAAe,CAAC9I,QAAM,CAAE7Q,SAAO,CAACd,IAAI,CAAC;AAC1C,IAAI,CAACya,eAAe,CAAC5K,OAAI,CAAER,SAAM,CAACrP,IAAI,CAAC;AACvC,IAAI,CAACsC,KAAK,CAAC6f,IAAI,CAAC,GAAG,CAAC;AACpB,IAAI,CAAC1H,eAAe,CAAC9I,QAAM,CAAEtC,SAAM,CAACrP,IAAI,CAAE,IAAI,CAAC;AAC/C;;;AAGD,IAAK,YAAY;AACjB,IAAK,cAAc;AAClB6P,OAAI,CAACnI,YAAY,CAACmJ,MAAM,CAACgL,IAAI,CAAExM,SAAM,CAACnI,EAAE,GAAK,YAAY,CAAG,CAAC,EAAE,CAAG,CAAC,CAAC,CAAC;AACrE;AACD,IAAK,WAAW;AACf2I,OAAI,CAAC3O,IAAI,CAAG,YAAY;AACxB;AACD,IAAK,WAAW;AACf2O,OAAI,CAAC3O,IAAI,CAAG,YAAY;AACxB;AACD,IAAK,eAAe;AACnB2O,OAAI,CAAC3O,IAAI,CAAG,gBAAgB;AAC5B;AACD;AACC,GAAI2P,MAAM,CAACgT,MAAM,CAAE;AAClB,IAAI,CAACvhB,KAAK,CAAC0b,UAAU,CAACnO,OAAI,CAAE,mBAAmB,CAAE,KAAK,CAAC;AACxD;AACD;AACA,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,YAAY,CAAE;AAClB,GAAI,CAAA9Q,KAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;AAChC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnCzG,KAAI,CAACqP,gBAAgB,CAACC,SAAM,CAAE,CAAC,CAACwB,MAAM,CAACkT,UAAU,CAAC;;AAElD,OAAQ1U,SAAM,CAACnI,EAAE;AACjB,IAAK,UAAU;AACf,IAAK,YAAY;AACjB,IAAK,SAAS;AACd,IAAK,aAAa;AAClB,IAAK,WAAW;AAChB,IAAK,MAAM;AACX,IAAK,cAAc;AACnB,IAAK,eAAe;AACpB,IAAK,cAAc;AACnB,IAAK,eAAe;AACpB,IAAK,aAAa;AAClB,IAAK,YAAY;AACjB,IAAK,aAAa;AACjB,IAAI,CAAC5E,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC1B;AACD;AACA,IAAI,CAACtF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAA9Q,MAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;AAChC,GAAI,CAAA6I,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;;;AAGnCzG,MAAI,CAACyP,mBAAmB,CAACH,SAAM,CAACrP,IAAI,CAAC;AACrC,IAAI,CAACyR,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,qBAAqB,CAAE;AAC3B,IAAI,CAAC6J,kBAAkB,CAAC,CAAC;AACzB,IAAI,CAACpY,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC1B,IAAI,CAACtF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAxB,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAqJ,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC,EAAI5a,SAAS;AAClD,GAAI,CAAArD,SAAO,CAAGgH,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AACxC,GAAI,CAAC1B,SAAM,CAACnI,EAAE,EAAImI,SAAM,CAACnI,EAAE,GAAK,MAAM,CAAE;AACvC2J,MAAM,CAACE,IAAI,CAAG,IAAI,CAACuC,OAAO;AAC3B;AACA,IAAI,CAAC8G,aAAa,CAAC/K,SAAM,CAACrP,IAAI,CAAE6P,OAAI,CAAE,CAAC,CAACgB,MAAM,CAACmT,MAAM,CAAEljB,SAAO,CAAC;AAC/D,IAAI,CAAC2Q,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,aAAa,CAAE;AACnB,GAAI,CAAAxB,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAqJ,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAAC/M,MAAM,CAACkO,EAAE,CAAC;AACrC,GAAI,CAAAjD,YAAU,CAAGhU,GAAG,CAACgJ,SAAS,CAACD,MAAM,CAACE,IAAI,CAAC;AAC3C,IAAI,CAAC0J,eAAe,CAAC5K,OAAI,CAAEiM,YAAU,CAAC;AACtC,GAAI,CAAA7E,YAAW,CAAG,CAAC;AACnB,GAAI,CAAAgN,YAAW,CAAG,CAAC;AACnB,GAAI5U,SAAM,CAACnI,EAAE,CAAC0b,QAAQ,CAAC,SAAS,CAAC,CAAE;AAClC,IAAK,GAAI,CAAAnY,CAAC,CAAG,IAAI,CAAC8I,aAAa,CAACrP,MAAM,CAAG,CAAC,CAAEuG,CAAC,EAAI,CAAC,CAAEA,CAAC,EAAE,CAAE;AACxD,GAAI,CAAAyZ,IAAI,CAAGld,IAAI,CAAC,IAAI,CAACuM,aAAa,CAAC9I,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACzC,GAAIyZ,IAAI,CAACtB,QAAQ,CAAC,SAAS,CAAC,CAAE;AAC7B,IAAI,CAACrP,aAAa,CAAC7I,MAAM,CAACD,CAAC,CAAE,CAAC,CAAC;AAC/B;AACD;AACD;AACA,GAAI,IAAI,CAACd,GAAG,CAAG,CAAC,CAAEsa,YAAW,CAAG,CAAC;AAClC;AACA,GAAIpT,MAAM,CAACkT,UAAU,CAAE9M,YAAW,EAAI,CAAC;AACvC,IAAI,CAACD,gBAAgB,CAAC3H,SAAM,CAACrP,IAAI,CAAEiX,YAAW,CAAEgN,YAAW,CAAC;;AAE5D,OAAQ5U,SAAM,CAACnI,EAAE;AACjB,IAAK,SAAS;AACb,GAAI,IAAI,CAACuL,OAAO,GAAK,IAAI,CAAE,MAAM,QAAA0R,IAAA,GAAAC,oBAAA;AACZ,IAAI,CAAC7M,YAAY,CAAC,CAAC,CAAA4M,IAAA,CAAAC,oBAAA,CAAAlgB,MAAA,CAAAigB,IAAA,GAAE,CAArC,GAAM,CAAAxhB,OAAM,CAAAyhB,oBAAA,CAAAD,IAAA;AAChB,IAAI,CAAC7hB,KAAK,CAAC2b,YAAY,CAAC,SAAS,CAAQ,CAACtb,OAAM,CAAC,CAAC;AACnD;AACA;AACD;AACA,IAAI,CAAC8O,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,GAAI,CAAAxB,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;;AAEnC,IAAI,CAACsQ,mBAAmB,CAACzH,SAAM,CAACrP,IAAI,CAAC;AACrC,IAAI,CAACyR,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,gBAAgB,CAAE;AACtB,GAAI,CAAAxB,SAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,OAAQ6I,SAAM,CAACnI,EAAE;AACjB,IAAK,YAAY;AAChB,IAAI,CAAC5E,KAAK,CAACmX,cAAc,CAAC,CAAC;AAC3B;AACD;AACA,IAAI,CAAChI,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAqV,KAAI,CAAG/T,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,GAAI,IAAI,CAAC6d,WAAW,CAACxU,OAAI,CAAC,CAAE;AAC5B,GAAI,CAAAO,OAAK,CAAG,IAAI,CAACwN,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACpC,IAAI,CAAClE,KAAK,CAACgiB,UAAU,CAACzU,OAAI,CAAC;AAC3B,IAAI,CAACgN,WAAW,CAAChN,OAAI,CAAEgM,KAAI,CAAEzL,OAAK,CAAES,MAAM,CAAC;AAC3C,IAAI,CAACvO,KAAK,CAACiiB,SAAS,CAAC1U,OAAI,CAAC;AAC1B;AACD;AACA,IAAK,OAAO,CAAE,IAAK,UAAU,CAAE,IAAK,aAAa,CAAE;AAClD,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,QAAS;AACR,KAAM,IAAI,CAAA2F,KAAK,+BAA+BhQ,IAAI,CAAC,CAAC,CAAG,CAAC;AACxD;AACD;AACA;AACD,CAAC,CAAAmQ,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCD/G,YAAY,CAAZ,SAAAA,YAAYA,CAAC5P,IAAY,CAAEwkB,SAAiB,CAAErkB,OAAe,CAAsC,IAApC,CAAAskB,MAAsB,CAAAle,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC,CAAC;AACzF,GAAM,CAAAme,aAAa,CAAG,CAAC1kB,IAAI;AAC3BykB,MAAM,CAACtkB,OAAO,CAAGA,OAAO;AACxBskB,MAAM,CAACzkB,IAAI,CAAGA,IAAI;AAClBykB,MAAM,CAACxkB,YAAY,CAAGD,IAAI;AAC1BykB,MAAM,CAAChkB,KAAK,CAAG,GAAG;AAClBgkB,MAAM,CAAC9jB,KAAK,CAAG,KAAK;AACpB8jB,MAAM,CAAC/jB,MAAM,CAAG,EAAE;AAClB+jB,MAAM,CAACvkB,KAAK,CAAI,CAACwkB,aAAa,CAAGF,SAAS,CAAG,EAAG;AAChDC,MAAM,CAACrkB,QAAQ,CAAI,CAACskB,aAAa,CAAMF,SAAS,KAAIrkB,OAAO,CAAK,EAAG;AACnE,GAAI,CAAAwkB,YAAY,CAAGxkB,OAAO,CAAC0L,KAAK,CAAC,IAAI,CAAC;AACtC,GAAI8Y,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAC,CAAC8D,UAAU,CAAC,OAAO,CAAC,CAAE;AAC9Dyc,MAAM,CAACnjB,aAAa,CAAGqjB,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAC,CAACiY,KAAK,CAAC,CAAC,CAAC;AACrEwI,YAAY,CAACC,GAAG,CAAC,CAAC;AACnB;AACA,GAAID,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAC,GAAK,OAAO,CAAE;AACtDugB,MAAM,CAAC9jB,KAAK,CAAG,IAAI;AACnBgkB,YAAY,CAACC,GAAG,CAAC,CAAC;AACnB;AACA,GAAID,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAC,GAAK,GAAG,EAAIygB,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAC,GAAK,GAAG,CAAE;AACnGugB,MAAM,CAAC/jB,MAAM,CAAGikB,YAAY,CAACA,YAAY,CAACzgB,MAAM,CAAG,CAAC,CAAmB;AACvEygB,YAAY,CAACC,GAAG,CAAC,CAAC;AACnB;AACA,GAAID,YAAY,CAAC,CAAC,CAAC,CAAE;AACpBF,MAAM,CAAChkB,KAAK,CAAG0f,QAAQ,CAACwE,YAAY,CAAC,CAAC,CAAC,CAACxf,MAAM,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,EAAI,GAAG;AAC9D;AACA,GAAIwf,YAAY,CAAC,CAAC,CAAC,CAAE;AACpBF,MAAM,CAACxkB,YAAY,CAAG0kB,YAAY,CAAC,CAAC,CAAC;AACtC;AACA,MAAO,CAAAF,MAAM;AACd,CAAC,CAAA9N,OAAA;AACDlR,WAAW,CAAX,SAAAA,WAAWA,CAACjB,QAAgB,CAAqC,IAAnC,CAAAigB,MAAqB,CAAAle,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,CAAC,CAAC;AACvD,IAAAse,eAAA,CAAmBrgB,QAAQ,CAACqH,KAAK,CAAC,GAAG,CAAC,CAAjCtL,EAAE,CAAAskB,eAAA,IAAEpjB,MAAM,CAAAojB,eAAA;;;AAGfJ,MAAM,CAAC7jB,OAAO,CAAG,EAAE;AACnB,GAAIL,EAAE,GAAK,GAAG,EAAIA,EAAE,GAAK,KAAK,CAAE;AAC/B,GAAI,CAACkkB,MAAM,CAACjkB,KAAK,CAAEikB,MAAM,CAACjkB,KAAK,CAAG,GAAG;AACrCikB,MAAM,CAAClkB,EAAE,CAAG,CAAC;AACd,CAAC,IAAM,IAAIA,EAAE,CAAC+hB,OAAO,CAAC,GAAG,CAAC,CAAG,CAAC,CAAE;AAC/B,IAAAwC,SAAA,CAAqBvkB,EAAE,CAACsL,KAAK,CAAC,GAAG,CAAC,CAA7BkZ,KAAK,CAAAD,SAAA,IAAEtkB,KAAK,CAAAskB,SAAA;AACjB,GAAI/f,KAAK,CAACD,UAAU,CAACigB,KAAK,CAAC,CAAC,EAAIhgB,KAAK,CAACD,UAAU,CAACtE,KAAK,CAAC,CAAC,CAAE;AACzD,MAAO,KAAI;AACZ;AACAikB,MAAM,CAAClkB,EAAE,CAAGuE,UAAU,CAACigB,KAAK,CAAC;AAC7BN,MAAM,CAACjkB,KAAK,CAAGsE,UAAU,CAACtE,KAAK,CAAC;AAChC,GAAIikB,MAAM,CAAClkB,EAAE,CAAGkkB,MAAM,CAACjkB,KAAK,CAAEikB,MAAM,CAAClkB,EAAE,CAAGkkB,MAAM,CAACjkB,KAAK;AACtD,GAAM,CAAAwkB,SAAS,CAAGxkB,KAAK,CAAC2b,KAAK,CAAC,CAAC,CAAC,CAAC;AACjC,GAAI6I,SAAS,GAAK,GAAG,EAAIA,SAAS,GAAK,GAAG,EAAIA,SAAS,GAAK,GAAG,CAAE;AAChEP,MAAM,CAAC7jB,OAAO,CAAGokB,SAAS;AAC3B;AACD,CAAC,IAAM,IAAI,CAACjgB,KAAK,CAACD,UAAU,CAACvE,EAAE,CAAC,CAAC,CAAE;AAClC,GAAI,CAACkkB,MAAM,CAACjkB,KAAK,CAAEikB,MAAM,CAACjkB,KAAK,CAAG,GAAG;AACrCikB,MAAM,CAAClkB,EAAE,CAAGkkB,MAAM,CAACjkB,KAAK,CAAGsE,UAAU,CAACvE,EAAE,CAAC,CAAG,GAAG;AAChD;;;AAGA,GAAI,CAACkB,MAAM,CAAE;AACZgjB,MAAM,CAAChjB,MAAM,CAAG,EAAE;AACnB,CAAC,IAAM,IAAIA,MAAM,GAAK,KAAK,EAAIA,MAAM,GAAK,KAAK,EAAIA,MAAM,GAAK,KAAK,EAAIA,MAAM,GAAK,KAAK,EAAIA,MAAM,GAAK,KAAK,CAAE;AAC5GgjB,MAAM,CAAChjB,MAAM,CAAGA,MAAM;AACvB,CAAC,IAAM,IAAIA,MAAM,GAAK,KAAK,EAAIgjB,MAAM,CAAChjB,MAAM,GAAK,KAAK,CAAE;AACvDgjB,MAAM,CAAChjB,MAAM,CAAGA,MAAM;AACvB,CAAC,IAAM,IAAIA,MAAM,GAAK,KAAK,CAAE;AAC5BgjB,MAAM,CAAClkB,EAAE,CAAG,CAAC;AACbkkB,MAAM,CAACnkB,OAAO,CAAG,IAAI;AACtB;AACA,MAAO,CAAAmkB,MAAM;AACd,CAAC,CAAA9N,OAAA;AACD+I,cAAc,CAAd,SAAAA,cAAcA,CAAC8E,SAAiB,CAAE;AACjC,GAAI,CAAAxkB,IAAI,CAAGwkB,SAAS;;AAEpB,GAAI,CAAA7E,KAAK,CAAG,CAAC,CAAC;AACd,GAAI,CAAAtf,IAAI,CAAG,CAAC,CAAC;AACb,GAAI,eAAe,CAAC4kB,IAAI,CAACjlB,IAAI,CAAC,CAAE;AAC/B2f,KAAK,CAAGQ,QAAQ,CAACngB,IAAI,CAACklB,MAAM,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,CAAG,CAAC;AACxCllB,IAAI,CAAGA,IAAI,CAACmc,KAAK,CAAC,CAAC,CAAC;AACrB,CAAC,IAAM,IAAI,gBAAgB,CAAC8I,IAAI,CAACjlB,IAAI,CAAC,CAAE;AACvC,GAAM,CAAAmlB,SAAkC,CAAG,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAE,CAAC;AACjF9F,KAAK,CAAGQ,QAAQ,CAACngB,IAAI,CAACklB,MAAM,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,CAAG,CAAC;AACxC7kB,IAAI,CAAG8kB,SAAS,CAACnlB,IAAI,CAACklB,MAAM,CAAC,CAAC,CAAC,CAAC;AAChCllB,IAAI,CAAGA,IAAI,CAACmc,KAAK,CAAC,CAAC,CAAC;AACpBqI,SAAS,MAAO7E,KAAK,CAAG,CAAC,OAAK3f,IAAM;AACrC;AACA,MAAO,CAAEA,IAAI,CAAJA,IAAI,CAAE2f,KAAK,CAALA,KAAK,CAAEtf,IAAI,CAAJA,IAAI,CAAEmkB,SAAS,CAATA,SAAU,CAAC;AACxC,CAAC,CAAA7N,OAAA;AACD+O,kBAAkB,CAAlB,SAAAA,kBAAkBA,CAAClB,SAAiB,CAAErkB,OAAe,CAAE;AACtD,GAAIqkB,SAAS,GAAK,IAAI,CAAE,KAAM,IAAI,CAAAhO,KAAK,uBAAuB,CAAC;AAC/D,IAAAmP,qBAAA,CAA0D,IAAI,CAACjG,cAAc,CAAC8E,SAAS,CAAC,CAAhFxkB,IAAI,CAAA2lB,qBAAA,CAAJ3lB,IAAI,CAAE2f,KAAK,CAAAgG,qBAAA,CAALhG,KAAK,CAAEtf,IAAI,CAAAslB,qBAAA,CAAJtlB,IAAI,CAAaulB,eAAe,CAAAD,qBAAA,CAA1BnB,SAAS;AACpCA,SAAS,CAAGoB,eAAe;;AAE3B,GAAM,CAAAxlB,QAAQ,CAAMokB,SAAS,KAAIrkB,OAAS;AAC1C,GAAM,CAAAJ,IAAI,CAAG,IAAI,CAACmU,KAAK,CAACyL,KAAK,CAAC;;;AAG9B,IAAK,GAAI,CAAAlV,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG1K,IAAI,CAAC6K,OAAO,CAAC1G,MAAM,CAAEuG,CAAC,EAAE,CAAE;AAC7C,GAAI,CAAAG,QAAO,CAAG7K,IAAI,CAAC6K,OAAO,CAACH,CAAC,CAAC;AAC7B,GAAIG,QAAO,CAACtK,OAAO,CAAE;;AAErB,GAAIP,IAAI,CAAC4C,MAAM,CAACC,QAAQ,CAACgI,QAAO,CAAC,CAAE;;AAEnC,GAAIA,QAAO,GAAK7K,IAAI,CAACoO,WAAW,EAAI,CAACpO,IAAI,CAAC4C,MAAM,CAACtC,IAAI,CAAC,CAAE;;AAExD,GAAIuK,QAAO,CAACxK,QAAQ,GAAKA,QAAQ,CAAE;;AAElC,GAAIC,IAAI,EAAI,CAAC,CAAEuK,QAAO,CAACvK,IAAI,CAAGA,IAAI;AAClC,MAAO,CAAAuK,QAAO;AACf;AACA,GAAI,CAACA,QAAO,CAACxK,QAAQ,EAAIwK,QAAO,CAAC/E,YAAY,CAAC1F,OAAO,CAAC,CAAE;;AAEvDyK,QAAO,CAAG7K,IAAI,CAAC0P,UAAU,CAACzP,IAAI,CAAEwkB,SAAS,CAAErkB,OAAO,CAAEsK,CAAC,CAAC;AACtD,GAAIpK,IAAI,EAAI,CAAC,CAAEuK,QAAO,CAACvK,IAAI,CAAGA,IAAI;AAClC,MAAO,CAAAuK,QAAO;AACf;AACD;;;AAGA,GAAM,CAAAA,OAAO,CAAG7K,IAAI,CAAC0P,UAAU,CAACzP,IAAI,CAAEwkB,SAAS,CAAErkB,OAAO,CAAC;AACzD,GAAIE,IAAI,EAAI,CAAC,CAAEuK,OAAO,CAACvK,IAAI,CAAGA,IAAI;AAClC,MAAO,CAAAuK,OAAO;AACf,CAAC,CAAA+L,OAAA;AACDkP,0BAA0B,CAA1B,SAAAA,0BAA0BA,CAACvY,MAAc,CAAEnN,OAAe,CAAE;AAC3D,IAAA2lB,qBAAA,CAAkB,IAAI,CAACpG,cAAc,CAACpS,MAAM,CAAC,CAArCqS,KAAK,CAAAmG,qBAAA,CAALnG,KAAK;;AAEb,MAAO,KAAI,CAACzL,KAAK,CAACyL,KAAK,CAAC,CAAClQ,UAAU,CAAC,EAAE,CAAE,EAAE,CAAEtP,OAAO,CAAC;AACrD,CAAC,CAAAwW,OAAA;AACDoP,wBAAwB,CAAxB,SAAAA,wBAAwBA,CAAC/b,aAAiD,CAAE;AAC3E,IAAAgc,qBAAA,CAAkB,IAAI,CAACtG,cAAc,CAAC1V,aAAa,CAAC9J,KAAK,CAAC,CAAlDyf,KAAK,CAAAqG,qBAAA,CAALrG,KAAK;AACb,GAAM,CAAAvf,QAAQ,CAAM4J,aAAa,CAAC9J,KAAK,KAAI8J,aAAa,CAAC7J,OAAS,CAAC,QAAA8lB,IAAA,GAAAC,sBAAA;AAC7C,IAAI,CAAChS,KAAK,CAACyL,KAAK,CAAC,CAAC/U,OAAO,CAAAqb,IAAA,CAAAC,sBAAA,CAAAhiB,MAAA,CAAA+hB,IAAA,GAAE,CAA5C,GAAM,CAAArb,OAAO,CAAAsb,sBAAA,CAAAD,IAAA;AACjB,GAAIrb,OAAO,CAACxK,QAAQ,GAAKA,QAAQ,CAAE;AAClC,MAAO,CAAAwK,OAAO;AACf;AACD;AACA,MAAO,KAAI;AACZ,CAAC,CAAA+L,OAAA;AACDiH,UAAU,CAAV,SAAAA,UAAUA,CAAC4G,SAA6B,CAAuB,IAArB,CAAA2B,WAAW,CAAA5f,SAAA,CAAArC,MAAA,IAAAqC,SAAA,MAAApC,SAAA,CAAAoC,SAAA,IAAG,KAAK;AAC5D,GAAI,CAACie,SAAS,EAAIA,SAAS,GAAK,IAAI,EAAIA,SAAS,GAAK,MAAM,EAAIA,SAAS,GAAK,OAAO,CAAE;AACtF,MAAO,KAAI;AACZ;AACA,IAAA4B,qBAAA,CAAoD,IAAI,CAAC1G,cAAc,CAAC8E,SAAS,CAAC,CAA1E7E,KAAK,CAAAyG,qBAAA,CAALzG,KAAK,CAAEtf,IAAI,CAAA+lB,qBAAA,CAAJ/lB,IAAI,CAAaulB,eAAe,CAAAQ,qBAAA,CAA1B5B,SAAS;AAC9BA,SAAS,CAAGoB,eAAe;;;AAG3B,GAAM,CAAAS,UAAU,CAAIhmB,IAAI,CAAG,CAAE;AAC7B,GAAM,CAAAN,IAAI,CAAG,IAAI,CAACmU,KAAK,CAACyL,KAAK,CAAC;;;AAG9B,GAAI,CAAC0G,UAAU,EAAItmB,IAAI,CAAC4C,MAAM,CAACtC,IAAI,CAAC,CAAE,MAAO,CAAAN,IAAI,CAAC4C,MAAM,CAACtC,IAAI,CAAC,CAAC,QAAAimB,IAAA,GAAAC,cAAA;;AAEzCxmB,IAAI,CAAC6K,OAAO,CAAA0b,IAAA,CAAAC,cAAA,CAAAriB,MAAA,CAAAoiB,IAAA,GAAE,CAA/B,GAAM,CAAA1b,OAAO,CAAA2b,cAAA,CAAAD,IAAA;AACjB,GAAID,UAAU,EAAI,CAAC,IAAI,CAAC9R,UAAU,EAAIxU,IAAI,CAAC4C,MAAM,CAACC,QAAQ,CAACgI,OAAO,CAAC,CAAE;AACrE,GAAIub,WAAW,EAAIvb,OAAO,CAACrK,EAAE,CAAE;AAC/B,GAAIqK,OAAO,CAAC1K,KAAK,GAAKskB,SAAS,CAAE;AAChC,GAAInkB,IAAI,EAAI,CAAC,CAAEuK,OAAO,CAACvK,IAAI,CAAGA,IAAI;AAClC,MAAO,CAAAuK,OAAO;AACf;AACD;;AAEA,MAAO,KAAI;AACZ,CAAC,CAAA+L,OAAA;AACDmN,OAAO,CAAP,SAAAA,OAAOA,CAAC0C,QAAgB,CAAQ;AAC/B,GAAIA,QAAQ,GAAK,IAAI,EAAIA,QAAQ,CAACxe,UAAU,CAAC,KAAK,CAAC,CAAE,MAAO,KAAI,CAAC6L,EAAE;AACnE,GAAI2S,QAAQ,GAAK,IAAI,EAAIA,QAAQ,CAACxe,UAAU,CAAC,KAAK,CAAC,CAAE,MAAO,KAAI,CAAC8L,EAAE;AACnE,GAAI,CAAC0S,QAAQ,GAAK,IAAI,EAAIA,QAAQ,CAACxe,UAAU,CAAC,KAAK,CAAC,GAAK,IAAI,CAAC+L,EAAE,CAAE,MAAO,KAAI,CAACA,EAAE;AAChF,GAAI,CAACyS,QAAQ,GAAK,IAAI,EAAIA,QAAQ,CAACxe,UAAU,CAAC,KAAK,CAAC,GAAK,IAAI,CAACgM,EAAE,CAAE,MAAO,KAAI,CAACA,EAAE;AAChF,GAAI,IAAI,CAACL,QAAQ,CAACzM,EAAE,GAAKsf,QAAQ,CAAE,MAAO,KAAI,CAAC7S,QAAQ;AACvD,GAAI,IAAI,CAACC,OAAO,CAAC1M,EAAE,GAAKsf,QAAQ,CAAE,MAAO,KAAI,CAAC5S,OAAO;AACrD,GAAI,IAAI,CAACD,QAAQ,CAAC3T,IAAI,GAAKwmB,QAAQ,CAAE,MAAO,KAAI,CAAC7S,QAAQ;AACzD,GAAI,IAAI,CAACC,OAAO,CAAC5T,IAAI,GAAKwmB,QAAQ,CAAE,MAAO,KAAI,CAAC5S,OAAO;AACvD,MAAO;AACN5T,IAAI,CAAEwmB,QAAQ;AACdtf,EAAE,CAAEsf,QAAQ,CAAC1gB,OAAO,CAAC,IAAI,CAAE,EAAE;AAC9B,CAAC;AACF,CAAC,CAAA6Q,OAAA;;AAEDkC,GAAG,CAAH,SAAAA,GAAGA,CAAC4N,OAAgB,CAAE;AACrB,GAAIA,OAAO,CAAE,IAAI,CAACpU,SAAS,CAAChK,IAAI,CAACoe,OAAO,CAAC;;AAEzC,GAAI,IAAI,CAACxT,UAAU,EAAI,IAAI,CAACT,WAAW,CAAG,IAAI,CAACH,SAAS,CAACnO,MAAM,CAAE;AAChE,IAAI,CAAC+O,UAAU,CAAG,KAAK;AACvB,IAAI,CAACyF,QAAQ,CAAC,CAAC;AAChB;AACD,CAAC,CAAA/B,OAAA;;;;;;;;;AASD+P,UAAU,CAAV,SAAAA,UAAUA,CAACD,OAAe,CAAE;AAC3B,IAAI,CAACE,GAAG,CAACF,OAAO,CAAE,IAAI,CAAC;AACvB,IAAI,CAACnU,gBAAgB,CAACjK,IAAI,CAACoe,OAAO,CAAC;AACnC,IAAI,CAAC5N,GAAG,CAAC4N,OAAO,CAAC;AAClB,CAAC,CAAA9P,OAAA;AACDiQ,QAAQ,CAAR,SAAAA,QAAQA,CAACpgB,IAAU,CAAEqK,MAAc,CAAE+H,OAAiB,CAAE;AACvD,OAAQpS,IAAI,CAAC,CAAC,CAAC;AACf,IAAK,OAAO,CAAE;AACb,IAAI,CAACmN,QAAQ,CAAChR,MAAM,CAAC,CAAC,CAAC,CAAG,IAAI;AAC9B,IAAI,CAACiR,OAAO,CAACjR,MAAM,CAAC,CAAC,CAAC,CAAG,IAAI;AAC7B,IAAI,CAACL,KAAK,CAACukB,UAAU,CAAC,CAAC;AACvB,IAAI,CAAC1N,KAAK,CAAC,CAAC;AACZ;AACD;AACA,IAAK,QAAQ,CAAE;AACd,IAAI,CAAC9F,UAAU,CAAG,IAAI;AACtB,IAAI,CAAC0G,kBAAkB,CAAC,CAAC,CAAC,QAAA+M,IAAA,GAAAC,YAAA;;AAEP,IAAI,CAAC7S,KAAK,CAAA4S,IAAA,CAAAC,YAAA,CAAA7iB,MAAA,CAAA4iB,IAAA,GAAE,CAA1B,GAAM,CAAA/mB,IAAI,CAAAgnB,YAAA,CAAAD,IAAA;AACd/mB,IAAI,CAACoO,WAAW,CAAG,IAAI;AACxB;AACA;AACD;AACA,IAAK,MAAM,CAAE;AACZ,IAAI,CAAC0L,OAAO,CAACsG,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,CAAC;AACnC,IAAI,CAACiL,GAAG,CAACjL,IAAI,CAAC;AACd;AACD;AACA,IAAK,MAAM,CAAE;AACZ,IAAI,CAACoD,IAAI,CAAGpD,IAAI,CAAC,CAAC,CAAC;AACnB,GAAI,IAAI,CAACoD,IAAI,CAACgZ,QAAQ,CAAC,eAAe,CAAC,CAAE;AACxC,IAAI,CAAC9S,aAAa,CAAG,IAAI;AAC1B;AACA,GAAI,IAAI,CAAClG,IAAI,CAACgZ,QAAQ,CAAC,UAAU,CAAC,CAAE;AACnC,IAAI,CAAC/P,eAAe,CAAG,EAAE;AACzB,IAAI,CAAC6B,OAAO,CAAG,IAAI;AACpB;AACA,GAAI,IAAI,CAAC9K,IAAI,CAAChH,QAAQ,WAAW,CAAC,CAAE;AACnC,IAAI,CAACyJ,GAAG,CAAGvE,GAAG,CAACkf,GAAG,CAAC,YAAkB,CAAC;AACvC;AACA,GAAI,IAAI,CAACpd,IAAI,CAAChH,QAAQ,CAAC,kBAAkB,CAAC,CAAE;AAC3C,IAAI,CAACyJ,GAAG,CAAGvE,GAAG,CAACkf,GAAG,CAAC,SAAe,CAAC;AACpC;AACA;AACE,IAAI,CAACpd,IAAI,CAAChH,QAAQ,CAAC,kBAAkB,CAAC;AACtC,IAAI,CAACgH,IAAI,CAAChH,QAAQ,CAAC,oBAAoB,CAAC;AACxC;AACA,IAAI,CAACyJ,GAAG,CAAGvE,GAAG,CAACkf,GAAG,CAAC,qBAA2B,CAAC;AACjD;AACA,IAAI,CAACvV,GAAG,CAACjL,IAAI,CAAC;AACd;AACD;AACA,IAAK,UAAU,CAAE;AAChB,IAAI,CAAC8N,QAAQ,CAAG9N,IAAI,CAAC,CAAC,CAAQ;AAC9B,IAAI,CAAC+N,UAAU,CAAG,KAAK;AACvB,OAAQ/N,IAAI,CAAC,CAAC,CAAC;AACf,IAAK,OAAO;AACZ,IAAK,YAAY;AAChB,IAAI,CAACyN,iBAAiB,CAAG,CAAC;AAC1B,GAAI,CAAC,IAAI,CAACF,EAAE,CAAE,IAAI,CAACA,EAAE,CAAG,GAAI,CAAA3G,IAAI,CAAC,IAAI,CAAE,CAAC,CAAC;AACzC,GAAI,CAAC,IAAI,CAAC4G,EAAE,CAAE,IAAI,CAACA,EAAE,CAAG,GAAI,CAAA5G,IAAI,CAAC,IAAI,CAAE,CAAC,CAAC;AACzC,IAAI,CAAC2G,EAAE,CAACvG,GAAG,CAAG,IAAI,CAACsG,EAAE;AACrB,IAAI,CAACE,EAAE,CAACxG,GAAG,CAAG,IAAI,CAACqG,EAAE;;AAErB,GAAIrN,IAAI,CAAC,CAAC,CAAC,GAAK,OAAO,CAAE;AACxB,IAAI,CAACwN,EAAE,CAACvG,IAAI,CAAG,IAAI,CAACqG,EAAE;AACtB,IAAI,CAACC,EAAE,CAACtG,IAAI,CAAG,IAAI,CAACoG,EAAE;AACtB,IAAI,CAACA,EAAE,CAACpG,IAAI,CAAG,IAAI,CAACsG,EAAE;AACtB,IAAI,CAACD,EAAE,CAACrG,IAAI,CAAG,IAAI,CAACuG,EAAE;AACvB;;AAEA,IAAI,CAACD,EAAE,CAACxG,KAAK,CAAG,IAAI,CAACsG,EAAE,CAACtG,KAAK;AAC7B,IAAI,CAACyG,EAAE,CAACzG,KAAK,CAAG,IAAI,CAACuG,EAAE,CAACvG,KAAK;AAC7B,IAAI,CAAC2G,KAAK,CAAG,CAAC,IAAI,CAACL,EAAE,CAAE,IAAI,CAACC,EAAE,CAAE,IAAI,CAACC,EAAE,CAAE,IAAI,CAACC,EAAE,CAAC;;AAEjD,IAAI,CAACH,EAAE,CAAClR,MAAM,CAAG,IAAI,CAACoR,EAAE,CAACpR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAC;AAC9C,IAAI,CAACmR,EAAE,CAACnR,MAAM,CAAG,IAAI,CAACqR,EAAE,CAACrR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAC;AAC9C;AACD,IAAK,SAAS;AACb,IAAI,CAACgR,QAAQ,CAAChR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAC;AACnC,IAAI,CAACiR,OAAO,CAACjR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAC;AAClC;AACD,IAAK,SAAS;AACd,IAAK,UAAU;AACd,IAAI,CAACgR,QAAQ,CAAChR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAE,IAAI,CAAC;AACzC,IAAI,CAACiR,OAAO,CAACjR,MAAM,CAAG,CAAC,IAAI,CAAE,IAAI,CAAE,IAAI,CAAC;AACxC;AACD,gBAAAskB,IAAA,GAAAC,YAAA;AACoB,IAAI,CAAChT,KAAK,CAAA+S,IAAA,CAAAC,YAAA,CAAAhjB,MAAA,CAAA+iB,IAAA,IAAxB,GAAM,CAAAlnB,MAAI,CAAAmnB,YAAA,CAAAD,IAAA,EAAgBlnB,MAAI,CAAC4C,MAAM,CAAG,CAAC,IAAI,CAAC,CAAC;AACpD;AACD;AACA,GAAI,CAAC,IAAI,CAACsR,iBAAiB,CAAE,IAAI,CAACA,iBAAiB,CAAG,IAAI,CAACN,QAAQ,CAAChR,MAAM,CAACuB,MAAM;AACjF,IAAI,CAAC5B,KAAK,CAAC6kB,SAAS,CAAC,CAAC;AACtB,IAAI,CAAC7kB,KAAK,CAACukB,UAAU,CAAC,CAAC;AACvB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,GAAI,CAAAO,QAAQ,CAAG5gB,IAAI,CAAC,CAAC,CAAC,CAACqF,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACrC,GAAIub,QAAQ,GAAK,gBAAgB,CAAE,IAAI,CAACtX,aAAa,CAAG,IAAI;AAC5D,GAAIsX,QAAQ,GAAK,OAAO,CAAE;AACzB,IAAI,CAACvU,eAAe,CAAG,EAAE;AACzB,IAAI,CAAC6B,OAAO,CAAG,IAAI;AACpB;AACA,GAAI0S,QAAQ,GAAK,cAAc,CAAE,IAAI,CAACna,aAAa,CAAG,IAAI;AAC1D,IAAI,CAACwH,KAAK,CAAC2S,QAAQ,CAAC,CAAG,CAAC;AACxB,IAAI,CAAC3V,GAAG,CAACjL,IAAI,CAAC;AACd;AACD;AACA,IAAK,OAAO,CAAE;AACb,IAAI,CAACgO,KAAK,CAAGhO,IAAI,CAAC,CAAC,CAAC,EAAI,IAAI;AAC5B,IAAI,CAAClE,KAAK,CAAC6kB,SAAS,CAAC,CAAC;AACtB,IAAI,CAAC1V,GAAG,CAACjL,IAAI,CAAC;AACd;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAC,IAAI,CAACsO,eAAe,CAAE,IAAI,CAACA,eAAe,CAAG,IAAI;AACtD,GAAItO,IAAI,CAAC,CAAC,CAAC,CAACwB,UAAU,CAAC,aAAa,CAAC,CAAE;AACtC,IAAAqf,aAAA,CAAmC7gB,IAAI,CAAC,CAAC,CAAC,CAACqF,KAAK,CAAC,KAAK,CAAC,CAAlDmV,IAAI,CAAAqG,aAAA,IAAEC,SAAS,CAAAD,aAAA,IAAEE,SAAS,CAAAF,aAAA;AAC/B,IAAI,CAACvS,eAAe,CAAGqL,QAAQ,CAACa,IAAI,CAAC7E,KAAK,CAAC,EAAE,CAAC,CAAE,EAAE,CAAC,EAAI,IAAI;AAC3D,IAAI,CAACvH,aAAa,CAAGuL,QAAQ,CAACmH,SAAS,CAAE,EAAE,CAAC;AAC5C,IAAI,CAACzS,aAAa,CAAGsL,QAAQ,CAACoH,SAAS,EAAI,EAAE,CAAE,EAAE,CAAC,EAAI,CAAC;AACvD,GAAI,IAAI,CAAC3S,aAAa,GAAK,IAAI,CAACE,eAAe,CAAE,IAAI,CAACF,aAAa,CAAG,CAAC;AACvE;AACD,CAAC,IAAM,IAAIpO,IAAI,CAAC,CAAC,CAAC,CAACwB,UAAU,CAAC,WAAW,CAAC,CAAE;;;;AAI3C,IAAI,CAAC8M,eAAe,CAAGqL,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAC2V,KAAK,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,EAAI,IAAI;AAC7D;AACD,CAAC,IAAM,IAAI3V,IAAI,CAAC,CAAC,CAAC,CAACoc,QAAQ,CAAC,gBAAgB,CAAC,CAAE,KAAA4E,WAAA,CAAAC,UAAA;AAC9C,GAAI,CAAAC,QAAQ,CAAGlhB,IAAI,CAAC,CAAC,CAAC,CAAC8b,OAAO,CAAC,OAAO,CAAC;AACvC,GAAI,CAAAqF,MAAM,CAAG,EAAAH,WAAA,CAAA5R,MAAM,CAACgS,GAAG,UAAAJ,WAAA,CAAVA,WAAA,CAAYK,IAAI,eAAhBL,WAAA,CAAkBzf,GAAG,CAAC,QAAQ,CAAC,KAAA0f,UAAA,CAAI7R,MAAM,CAACkS,EAAE,eAATL,UAAA,CAAWI,IAAI,CAACF,MAAM;AACtE,GAAI3gB,IAAI,CAACR,IAAI,CAAC,CAAC,CAAC,CAAC2V,KAAK,CAAC,CAAC,CAAEuL,QAAQ,CAAC,CAAC,GAAKC,MAAM,CAAE;AAChD,IAAI,CAAC7S,eAAe,CAAGqL,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAC2V,KAAK,CAACuL,QAAQ,CAAG,CAAC,CAAC,CAAE,EAAE,CAAC,EAAI,IAAI;AACzE;AACD,CAAC,IAAM,IAAIlhB,IAAI,CAAC,CAAC,CAAC,CAACoc,QAAQ,CAAC,6BAA6B,CAAC,CAAE;AAC3D,GAAI,IAAI,CAAClO,OAAO,CAAE;AACnB;AACA,IAAI,CAACjD,GAAG,CAACjL,IAAI,CAAErC,SAAS,CAAEyU,OAAO,CAAC;AAClC;AACD;AACA,IAAK,aAAa,CAAE;AACnB,IAAI,CAAC9D,eAAe,CAAG,KAAK;AAC5B,IAAI,CAACrD,GAAG,CAACjL,IAAI,CAAErC,SAAS,CAAEyU,OAAO,CAAC;AAClC;AACD;AACA,IAAK,MAAM,CAAE,IAAK,GAAG,CAAE,IAAK,GAAG,CAAE;AAChC,GAAI,IAAI,CAAC7D,MAAM,CAAE;AAChB,GAAI,CAAAgT,IAAI,CAAGH,GAAG,CAAEI,KAAK,CAAC,IAAI,CAACjT,MAAM,CAAC;AAClC,GAAI,CAAA8S,IAAI,CAAGI,gBAAgB,CAACC,cAAc,CAAC1hB,IAAI,CAAC,CAAC,CAAC,CAAC;AACnD,GAAI,CAAAmhB,OAAM,CAAGQ,QAAQ,CAACN,IAAI,CAAC7nB,IAAI,CAAC;AAChC,GAAI,CAAC+nB,IAAI,CAACK,KAAK,CAACT,OAAM,CAAC,CAAEI,IAAI,CAACM,SAAS,CAACD,KAAK,EAAE;AAC/CL,IAAI,CAACK,KAAK,CAACT,OAAM,CAAC,CAAGE,IAAI;AACzBE,IAAI,CAACO,QAAQ,CAACzP,GAAG,CAAC8O,OAAM,CAAC;AACzBI,IAAI,CAACO,QAAQ,CAACC,eAAe,CAAC,CAAC;AAC/BR,IAAI,CAACO,QAAQ,CAACE,mBAAmB,CAAC,CAAC;AACpC;AACA,IAAI,CAAC/W,GAAG,CAACjL,IAAI,CAAErC,SAAS,CAAEyU,OAAO,CAAC;AAClC;AACD;AACA,IAAK,OAAO,CAAE,IAAK,GAAG,CAAE,IAAK,GAAG,CAAE;AACjC,GAAI,IAAI,CAAC7D,MAAM,CAAE;AAChB,GAAI,CAAAgT,KAAI,CAAGH,GAAG,CAAEI,KAAK,CAAC,IAAI,CAACjT,MAAM,CAAC;AAClC,GAAI,CAAA8S,KAAI,CAAGrhB,IAAI,CAAC,CAAC,CAAC;AAClB,GAAI,CAAAmhB,QAAM,CAAGQ,QAAQ,CAACN,KAAI,CAAC;AAC3B,GAAIE,KAAI,CAACK,KAAK,CAACT,QAAM,CAAC,CAAEI,KAAI,CAACM,SAAS,CAACD,KAAK,EAAE;AAC9C,MAAO,CAAAL,KAAI,CAACK,KAAK,CAACT,QAAM,CAAC;AACzBI,KAAI,CAACO,QAAQ,CAACG,MAAM,CAACd,QAAM,CAAC;AAC5BI,KAAI,CAACO,QAAQ,CAACC,eAAe,CAAC,CAAC;AAC/BR,KAAI,CAACO,QAAQ,CAACE,mBAAmB,CAAC,CAAC;AACpC;AACA,IAAI,CAAC/W,GAAG,CAACjL,IAAI,CAAErC,SAAS,CAAEyU,OAAO,CAAC;AAClC;AACD;AACA,IAAK,MAAM,CAAE,IAAK,GAAG,CAAE,IAAK,GAAG,CAAE;AAChC,GAAI,IAAI,CAAC7D,MAAM,CAAE;AAChB,GAAI,CAAAgT,MAAI,CAAGH,GAAG,CAAEI,KAAK,CAAC,IAAI,CAACjT,MAAM,CAAC;AAClC,GAAI,CAAA8S,MAAI,CAAGI,gBAAgB,CAACC,cAAc,CAAC1hB,IAAI,CAAC,CAAC,CAAC,CAAC;AACnD,GAAI,CAAAkiB,KAAK,CAAGliB,IAAI,CAAC,CAAC,CAAC;AACnB,GAAI2hB,QAAQ,CAACO,KAAK,CAAC,GAAKd,GAAG,CAAEC,IAAI,CAAC9f,GAAG,CAAC,QAAQ,CAAC,CAAE;AAChD6f,GAAG,CAAEC,IAAI,CAACc,GAAG,CAAC;AACbC,IAAI,CAAEf,MAAI,CAACe,IAAI;AACfnnB,MAAM,CAAEomB,MAAI,CAACpmB;AACd,CAAC,CAAC;AACH;AACA,GAAI,CAAAkmB,QAAM,CAAGQ,QAAQ,CAACN,MAAI,CAAC7nB,IAAI,CAAC;AAChC+nB,MAAI,CAACK,KAAK,CAACT,QAAM,CAAC,CAAGE,MAAI;AACzBE,MAAI,CAACO,QAAQ,CAACG,MAAM,CAACC,KAAK,CAAC;AAC3BX,MAAI,CAACO,QAAQ,CAACzP,GAAG,CAAC8O,QAAM,CAAC;AAC1B;AACA,GAAI,CAAC,IAAI,CAACvS,YAAY,CAAE;AACvB,IAAI,CAAC3D,GAAG,CAACjL,IAAI,CAAErC,SAAS,CAAEyU,OAAO,CAAC;AACnC;AACA;AACD;AACA,IAAK,QAAQ,CAAE;AACd,GAAI,CAAA7Y,MAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;AAChCzG,MAAI,CAACoP,OAAO,CAAC3I,IAAI,CAAC,CAAC,CAAC,CAAC;AACrB,GAAIA,IAAI,CAAC,CAAC,CAAC,CAAEzG,MAAI,CAACmP,SAAS,CAAC1I,IAAI,CAAC,CAAC,CAAC,CAAC;AACpC,GAAIA,IAAI,CAAC,CAAC,CAAC,CAAEzG,MAAI,CAAC6N,MAAM,CAAGpH,IAAI,CAAC,CAAC,CAAC;AAClC,GAAI,IAAI,CAAC8O,WAAW,CAAE,IAAI,CAAChT,KAAK,CAACumB,eAAe,CAAC,CAAC;AAClD,IAAI,CAACpX,GAAG,CAACjL,IAAI,CAAC;AACd,IAAI,CAAClE,KAAK,CAACqO,aAAa,CAAC5Q,MAAI,CAAC;AAC9B;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAA,MAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;;AAEhC,GAAM,CAAAsiB,KAAK,CAAGtiB,IAAI,CAAC2V,KAAK,CAAC,CAAC,CAAC,CAACxQ,IAAI,CAAC,GAAG,CAAC;;AAErC,GAAI,CAAC5L,MAAI,CAAC4N,MAAM,CAAC/K,QAAQ,CAACkmB,KAAK,CAAC,CAAE/oB,MAAI,CAAC4N,MAAM,CAACtF,IAAI,CAACygB,KAAK,CAAC;AACzD,IAAI,CAACxmB,KAAK,CAACqO,aAAa,CAAC5Q,MAAI,CAAC;AAC9B;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAI,CAAAA,MAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;AAChCzG,MAAI,CAAC8N,YAAY,CAAGsS,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AACzC,IAAI,CAAClE,KAAK,CAACqO,aAAa,CAAC5Q,MAAI,CAAC;AAC9B;AACD;AACA,IAAK,KAAK,CAAE,IAAK,KAAK,CAAE;AACvB,IAAI,CAACqZ,MAAM,CAAC5S,IAAI,CAAC,CAAC,CAAC,GAAK,KAAK,CAAGrC,SAAS,CAAGqC,IAAI,CAAC,CAAC,CAAC,CAAC;AACpD;AACD;AACA,IAAK,cAAc,CAAE;AACpB,IAAI,CAAC8S,YAAY,CAAC,CAAC;AACnB;AACD;AACA,IAAK,WAAW,CAAE;AACjB,IAAI,CAACzF,EAAE,CAAC9E,YAAY,CAAC,CAAC;AACtB,IAAI,CAAC+E,EAAE,CAAC/E,YAAY,CAAC,CAAC;AACtB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,GAAI,CAAAnE,OAAO,CAAG,IAAI,CAACib,0BAA0B,CAACrf,IAAI,CAAC,CAAC,CAAC,CAAEA,IAAI,CAAC,CAAC,CAAC,CAAC;AAC/D,GAAIA,IAAI,CAAC,CAAC,CAAC,GAAK,MAAM,CAAE;AACvBoE,OAAO,CAAC1J,IAAI,CAAG,QAAQ;AACxB,CAAC,IAAM,IAAIsF,IAAI,CAAC,CAAC,CAAC,GAAK,MAAM,CAAE;AAC9BoE,OAAO,CAAC1J,IAAI,CAAG,UAAU;AAC1B;AACA;AACD;AACA,IAAK,YAAY,CAAE;AAClB,IAAA6nB,qBAAA,CAAkB,IAAI,CAACrJ,cAAc,CAAClZ,IAAI,CAAC,CAAC,CAAC,CAAC,CAAtCmZ,KAAK,CAAAoJ,qBAAA,CAALpJ,KAAK;AACb,GAAM,CAAA5f,MAAI,CAAG,IAAI,CAACmU,KAAK,CAACyL,KAAK,CAAC;AAC9B,IAAK,GAAI,CAAAlV,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG1K,MAAI,CAAC6K,OAAO,CAAC1G,MAAM,CAAEuG,CAAC,EAAE,CAAE;AAC7C,GAAM,CAAAG,SAAO,CAAG7K,MAAI,CAAC6K,OAAO,CAACH,CAAC,CAAC;AAC/B,GAAIG,SAAO,CAACzK,OAAO,GAAKqG,IAAI,CAAC,CAAC,CAAC,EAAIoE,SAAO,CAAC/E,YAAY,CAACW,IAAI,CAAC,CAAC,CAAC,CAAC,CAAE;AACjEzG,MAAI,CAAC0P,UAAU,CAAC,EAAE,CAAE,EAAE,CAAEjJ,IAAI,CAAC,CAAC,CAAC,CAAEiE,CAAC,CAAC;AACnC;AACD;AACD;AACA;AACD;AACA,IAAK,aAAa,CAAE;AACnB,IAAI,CAAC4J,gBAAgB,CAAG8L,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAC7C,IAAI,CAAClE,KAAK,CAAC0mB,WAAW,CAAC,CAAC;AACxB;AACD;AACA,IAAK,UAAU,CAAE;AAChB,GAAM,CAAAC,IAAI,CAAGC,KAAK,CAACC,MAAM,CAAC3iB,IAAI,CAAC,CAAC,CAAC,CAAC;AAClC,GAAI,CAACyiB,IAAI,CAAC/kB,MAAM,CAAE;AAClB,GAAM,CAAAnE,MAAI,CAAG,IAAI,CAAC+jB,OAAO,CAACtd,IAAI,CAAC,CAAC,CAAC,CAAC;AAClCzG,MAAI,CAACgP,YAAY,CAAC,CAAC,CAAC,QAAAqa,IAAA,GAAAA,IAAA;AACFH,IAAI,CAAA/kB,MAAA,CAAAklB,IAAA,GAAE,CAAnB,GAAM,CAAAT,GAAG,CAAIM,IAAI,CAAAG,IAAA,CAAR;AACb,GAAM,CAAAjpB,OAAO,CAAGwoB,GAAG,CAAC/b,OAAO,EAAI,CAAC+b,GAAG,CAACloB,KAAK,EAAIkoB,GAAG,CAACloB,KAAK,GAAK,GAAG,CAAG,EAAE,OAASkoB,GAAG,CAACloB,KAAO,CAAC;AACtF,CAACkoB,GAAG,CAACjoB,MAAM,EAAIioB,GAAG,CAACjoB,MAAM,GAAK,GAAG,CAAG,EAAE,MAAQioB,GAAG,CAACjoB,MAAQ,CAAC,EAAIioB,GAAG,CAAChoB,KAAK,CAAG,SAAS,CAAG,EAAE,CAAC;AAC5F,GAAM,CAAAiK,SAAO,CAAG7K,MAAI,CAAC0P,UAAU,CAAC,EAAE,CAAE,EAAE,CAAEtP,OAAO,CAAC;AAChD,GAAIwoB,GAAG,CAACznB,IAAI,CAAE0J,SAAO,CAAC1J,IAAI,CAAGynB,GAAG,CAACznB,IAAI;AACrC,GAAIynB,GAAG,CAAC7nB,OAAO,CAAE8J,SAAO,CAACtC,eAAe,CAACqgB,GAAG,CAAC7nB,OAAO,CAAC,CAAC,QAAAuoB,IAAA,GAAAC,WAAA;AACnCX,GAAG,CAAC9nB,KAAK,CAAAwoB,IAAA,CAAAC,WAAA,CAAAplB,MAAA,CAAAmlB,IAAA,GAAE,CAAzB,GAAM,CAAAxN,IAAI,CAAAyN,WAAA,CAAAD,IAAA;AACdze,SAAO,CAAClD,YAAY,CAACmU,IAAI,CAAE,CAAC,CAAC;AAC9B;AACA,GAAI8M,GAAG,CAACpnB,QAAQ,CAAEqJ,SAAO,CAACrJ,QAAQ,CAAGonB,GAAG,CAACpnB,QAAQ;AAClD;AACA,IAAI,CAACkQ,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,QAAQ,CAAE,IAAK,MAAM,CAAE,IAAK,SAAS,CAAE,KAAA0Y,KAAA;AAC3C,IAAI,CAAC/P,WAAW,CAAC,CAAC;AAClB,GAAI,CAAA3J,IAAI,CAAG,IAAI,CAAC6V,kBAAkB,CAAClf,IAAI,CAAC,CAAC,CAAC,CAAEA,IAAI,CAAC,CAAC,CAAC,CAAC;AACpD,GAAI,CAAAnG,IAAI,CAAGwP,IAAI,CAACxP,IAAI;AACpBwP,IAAI,CAACtL,WAAW,CAACiC,IAAI,CAAC,CAAC,CAAC,CAAC;AACzBqJ,IAAI,CAAC5J,cAAc,CAAC,aAAmB,CAAC;AACxC4J,IAAI,CAACvO,aAAa,CAAG,EAAAioB,KAAA,CAAC,iBAAiB,CAACC,IAAI,CAAChjB,IAAI,CAAC,CAAC,CAAC,CAAC,eAAhC+iB,KAAA,CAAoC,CAAC,CAAC,GAAI,EAAE;AACjE,GAAI/iB,IAAI,CAAC,CAAC,CAAC,GAAK,QAAQ,CAAE;AACzB,GAAIqJ,IAAI,CAAC9P,IAAI,CAAC4C,MAAM,CAACtC,IAAI,CAAC,CAAE;AAC3BwP,IAAI,CAAC9P,IAAI,CAACyR,SAAS,CAAC3B,IAAI,CAAC9P,IAAI,CAAC4C,MAAM,CAACtC,IAAI,CAAC,CAAEwQ,MAAM,CAAC;AACpD;AACAhB,IAAI,CAAC9P,IAAI,CAAC6Q,QAAQ,CAACf,IAAI,CAAEgB,MAAM,CAAC;AACjC,CAAC,IAAM,IAAIrK,IAAI,CAAC,CAAC,CAAC,GAAK,SAAS,CAAE;AACjCqJ,IAAI,CAAC9P,IAAI,CAAC+F,OAAO,CAAC+J,IAAI,CAAC;AACxB,CAAC,IAAM;AACNA,IAAI,CAAC9P,IAAI,CAACkR,MAAM,CAACpB,IAAI,CAAC;AACvB;AACA,IAAI,CAACvN,KAAK,CAACyU,aAAa,CAAC,CAAC;AAC1B,IAAI,CAACtF,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,OAAO,CAAE;AACb,GAAI,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpCqJ,OAAI,CAAC9P,IAAI,CAACgS,KAAK,CAAClC,OAAI,CAAC;AACrB,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,GAAI9L,KAAK,CAACmc,MAAM,CAAC1a,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE;AAC3B,GAAM,CAAAqJ,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACtCqJ,OAAI,CAAC9P,IAAI,CAAC8R,QAAQ,CAAChC,OAAI,CAAE,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC,CAAGqK,MAAM,CAAC;AAC5D,CAAC,IAAM;AACN,GAAM,CAAAhB,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACtC,GAAM,CAAAijB,WAAW,CAAGtJ,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AACzC,GAAIqK,MAAM,CAACE,IAAI,CAAE;AAChB,GAAM,CAAAY,MAAM,CAAG9B,OAAI,CAAC9P,IAAI,CAAC4C,MAAM,CAAC8mB,WAAW,CAAC;AAC5C,GAAI9X,MAAM,CAAEnL,IAAI,CAAC,CAAC,CAAC,CAAGmL,MAAM,CAACzR,KAAK;AACnC;AACA2P,OAAI,CAAC9P,IAAI,CAAC2R,MAAM,CAAC7B,OAAI,CAAE4Z,WAAW,CAAC;AACpC;AACA,IAAI,CAAChY,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,IAAI,CAAC2I,WAAW,CAAC,CAAC;AAClB,IAAI,CAACf,oBAAoB,CAAC,CAAC;AAC3B,GAAI,CAAA5I,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAAqV,MAAI,CAAG/T,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,GAAI,IAAI,CAAC6d,WAAW,CAACxU,OAAI,CAAC,CAAE;AAC5B,GAAI,CAAAO,KAAK,CAAG,IAAI,CAACwN,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAC;AACpC,IAAI,CAAClE,KAAK,CAACgiB,UAAU,CAACzU,OAAI,CAAC;AAC3B,IAAI,CAAC+L,OAAO,CAAC/L,OAAI,CAAEgM,MAAI,CAAEzL,KAAK,CAAES,MAAM,CAAC;AACvC,IAAI,CAACgM,WAAW,CAAChN,OAAI,CAAEgM,MAAI,CAAEzL,KAAK,CAAES,MAAM,CAAC;AAC3C,IAAI,CAACvO,KAAK,CAACiiB,SAAS,CAAC1U,OAAI,CAAC;AAC1B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,MAAM,CAAE;AACZ,IAAI,CAAC2I,WAAW,CAAC,CAAC;AAClB,IAAI,CAACf,oBAAoB,CAAC,CAAC;AAC3B,GAAI,CAAA5I,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpC,GAAI,CAAA6I,MAAM,CAAGvH,GAAG,CAACgJ,SAAS,CAACtK,IAAI,CAAC,CAAC,CAAC,CAAC;AACnC,GAAI,CAAAqV,MAAI,CAAG/T,GAAG,CAACjH,KAAK,CAACkH,GAAG,CAACvB,IAAI,CAAC,CAAC,CAAC,CAAC;AACjC,IAAI,CAACqX,WAAW,CAAChO,OAAI,CAAER,MAAM,CAAEwM,MAAI,CAAEhL,MAAM,CAAC;AAC5C,IAAI,CAACY,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACtB;AACD;AACA,IAAK,KAAK,CAAE;AACX,IAAI,CAAClH,GAAG,CAAGwW,QAAQ,CAAC3Z,IAAI,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAChC,IAAI,CAAC6F,GAAG,CAAGvE,GAAG,CAAC4hB,MAAM,CAAC,IAAI,CAAC/f,GAAG,CAAC;AAC/B,IAAI,CAACrH,KAAK,CAAC6kB,SAAS,CAAC,CAAC;AACtB,IAAI,CAAC1V,GAAG,CAACjL,IAAI,CAAC;AACd;AACD;AACA,IAAK,UAAU,CAAE,KAAAmjB,mBAAA;AAChB,CAAAA,mBAAA,KAAI,CAAChX,YAAY,SAAjBgX,mBAAA,CAAArR,IAAA,KAAI,CAAgB,UAAU,CAAC;AAC/B;AACD;AACA,IAAK,WAAW,CAAE;AACjB,IAAI,CAAChW,KAAK,CAACsnB,YAAY,CAACC,SAAS,CAACC,YAAY,CAACtjB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACxD;AACD;AACA,IAAK,cAAc,CAAE;AACpB,IAAI,CAAClE,KAAK,CAACynB,eAAe,CAACF,SAAS,CAACC,YAAY,CAACtjB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D;AACD;AACA,IAAK,QAAQ,CAAE;;AAEd,GAAIA,IAAI,CAAC,CAAC,CAAC,GAAK,kBAAkB,CAAE;AACnC,GAAI,CAAAqJ,OAAI,CAAG,IAAI,CAAC+N,UAAU,CAACpX,IAAI,CAAC,CAAC,CAAC,CAAE;AACpCqJ,OAAI,CAAC5J,cAAc,CAAC,cAAoB,CAAC;AACzC4J,OAAI,CAACtO,QAAQ,CAAG,EAAE;AAClBsO,OAAI,CAACvO,aAAa,CAAG,EAAE;AACvBuO,OAAI,CAAC1P,OAAO,CAAG0P,OAAI,CAAC1P,OAAO,CAAC2F,OAAO,CAAC,gBAAgB,CAAE,EAAE,CAAC;AACzD+J,OAAI,CAACzP,QAAQ,CAAGyP,OAAI,CAACzP,QAAQ,CAAC0F,OAAO,CAAC,gBAAgB,CAAE,EAAE,CAAC;AAC3D,IAAI,CAACxD,KAAK,CAACmgB,aAAa,CAAC5S,OAAI,CAAC;AAC9B,IAAI,CAACvN,KAAK,CAAC0gB,YAAY,CAACnT,OAAI,CAAC;AAC7B,IAAI,CAAC4B,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAC;AACvB;AACA;AACD;AACA,QAAS;AACR,IAAI,CAACY,GAAG,CAACjL,IAAI,CAAEqK,MAAM,CAAE+H,OAAO,CAAC;AAC/B;AACD;AACA;AACD,CAAC,CAAAjC,OAAA;;AAEDgQ,GAAG,CAAH,SAAAA,GAAGA,CAACqD,GAAW,CAAEpR,OAAiB,CAAE;AACnC,GAAI,CAACA,OAAO,EAAI,IAAI,CAACtG,gBAAgB,CAACpO,MAAM,EAAI8lB,GAAG,GAAK,IAAI,CAAC1X,gBAAgB,CAAC,CAAC,CAAC,CAAE;AACjF,IAAI,CAACA,gBAAgB,CAAC2X,KAAK,CAAC,CAAC;AAC7B,IAAI,CAAC3nB,KAAK,CAAC4nB,cAAc,CAAC,CAAC;AAC3B;AACD;AACA,GAAI,CAACF,GAAG,CAAE;AACV,IAAAG,qBAAA,CAAyBlC,gBAAgB,CAACmC,eAAe,CAACJ,GAAG,CAAC,CAAtDxjB,IAAI,CAAA2jB,qBAAA,CAAJ3jB,IAAI,CAAEqK,MAAM,CAAAsZ,qBAAA,CAANtZ,MAAM;;AAEpB,GAAI,IAAI,CAACvO,KAAK,CAAC+nB,oBAAoB,CAAC7jB,IAAI,CAAEqK,MAAM,CAAC,CAAE;AAClD,IAAI,CAAC2B,WAAW,EAAE;AAClB,IAAI,CAACE,kBAAkB,CAAG,IAAI;AAC9B;AACD;;;AAGA,GAAI,CAAA6L,QAAc,CAAG,CAAC,EAAE,CAAC;AACzB,GAAI,CAAAC,UAAkB,CAAG,CAAC,CAAC;AAC3B,GAAM,CAAA8L,QAAQ,CAAG,IAAI,CAACjY,SAAS,CAAC,IAAI,CAACG,WAAW,CAAG,CAAC,CAAC,EAAI,EAAE;AAC3D,GAAI8X,QAAQ,CAACtiB,UAAU,CAAC,IAAI,CAAC,CAAE,KAAAuiB,sBAAA;AACYtC,gBAAgB,CAACmC,eAAe,CAACE,QAAQ,CAAC,CAA3E/L,QAAQ,CAAAgM,sBAAA,CAAd/jB,IAAI,CAAoBgY,UAAU,CAAA+L,sBAAA,CAAlB1Z,MAAM;AAC1B;;AAEA,GAAI,IAAI,CAACwE,KAAK,CAAE;AACf,GAAI7O,IAAI,CAAC,CAAC,CAAC,CAACwB,UAAU,CAAC,GAAG,CAAC,EAAIxB,IAAI,CAAC,CAAC,CAAC,GAAK,eAAe,CAAE;AAC3D,IAAI,CAAC8X,QAAQ,CAAC9X,IAAI,CAAEqK,MAAM,CAAE0N,QAAQ,CAAEC,UAAU,CAAC;AAClD,CAAC,IAAM;AACN,IAAI,CAACoI,QAAQ,CAACpgB,IAAI,CAAEqK,MAAM,CAAE+H,OAAO,CAAC;AACrC;AACD,CAAC,IAAM;AACN,GAAI;AACH,GAAIpS,IAAI,CAAC,CAAC,CAAC,CAACwB,UAAU,CAAC,GAAG,CAAC,EAAIxB,IAAI,CAAC,CAAC,CAAC,GAAK,eAAe,CAAE;AAC3D,IAAI,CAAC8X,QAAQ,CAAC9X,IAAI,CAAEqK,MAAM,CAAE0N,QAAQ,CAAEC,UAAU,CAAC;AAClD,CAAC,IAAM;AACN,IAAI,CAACoI,QAAQ,CAACpgB,IAAI,CAAEqK,MAAM,CAAE+H,OAAO,CAAC;AACrC;AACD,CAAE,MAAO4R,GAAQ,CAAE,KAAAC,mBAAA;AAClB,IAAI,CAAChZ,GAAG,CAAC,CAAC,YAAY,CAAE,iBAAiB,CAAGuY,GAAG,CAAG,IAAI,CAAGQ,GAAG,CAAG,GAAG,CAAC,CAAC;AACpE,GAAIA,GAAG,CAACE,KAAK,CAAE;AACd,GAAI,CAAAA,KAAK,CAAG,CAAC,EAAE,CAAGF,GAAG,CAACE,KAAK,EAAE7e,KAAK,CAAC,IAAI,CAAC,CAAC,QAAA8e,IAAA,GAAAA,IAAA;AACtBD,KAAK,CAAAxmB,MAAA,CAAAymB,IAAA,GAAE,CAArB,GAAM,CAAAC,IAAI,CAAIF,KAAK,CAAAC,IAAA,CAAT;AACd,GAAI,SAAS,CAAC1F,IAAI,CAAC2F,IAAI,CAAC,CAAE;AACzB;AACD;AACA,IAAI,CAACnZ,GAAG,CAAC,CAAC,OAAO,CAAEmZ,IAAI,CAAC,CAAC;AAC1B;AACD;AACA,CAAAH,mBAAA,KAAI,CAAC9X,YAAY,SAAjB8X,mBAAA,CAAAnS,IAAA,KAAI,CAAgB,OAAO,CAAC;AAC7B;AACD;;AAEA,GAAIgS,QAAQ,CAACtiB,UAAU,CAAC,QAAQ,CAAC,EAAIxB,IAAI,CAAC,CAAC,CAAC,GAAK,aAAa,CAAE;AAC/D,GAAI,IAAI,CAACwM,IAAI,GAAK,CAAC,CAAC,CAAE;AACrB,IAAI,CAACA,IAAI,CAAG,CAAC;AACb,IAAI,CAAC1Q,KAAK,CAACuoB,SAAS,CAAC,CAAC;AACvB;AACD;AACD,CAAC,CAAAlU,OAAA;AACD0N,WAAW,CAAX,SAAAA,WAAWA,CAACxU,IAAa,CAAE;AAC1B,GAAI,CAACA,IAAI,CAAC9P,IAAI,CAAC4C,MAAM,CAACkN,IAAI,CAACxP,IAAI,CAAC,CAAE;;AAEjCwP,IAAI,CAAC9P,IAAI,CAAC+F,OAAO,CAAC+J,IAAI,CAAC;AACxB;AACA,MAAO,MAAK;AACb,CAAC,CAAA8G,OAAA;;AAED0B,KAAK,CAAL,SAAAA,KAAKA,CAAA,CAAG,KAAAyS,mBAAA;AACP,IAAI,CAACtV,MAAM,CAAG,IAAI;AAClB,IAAI,CAAClT,KAAK,CAAC+V,KAAK,CAAC,CAAC;AAClB,CAAAyS,mBAAA,KAAI,CAACnY,YAAY,SAAjBmY,mBAAA,CAAAxS,IAAA,KAAI,CAAgB,QAAQ,CAAC;AAC9B,CAAC,CAAA3B,OAAA;;;;;;;;;AASDoU,IAAI,CAAJ,SAAAA,IAAIA,CAAA,CAAG,KAAAC,mBAAA;AACN,IAAI,CAACxV,MAAM,CAAG,KAAK;AACnB,IAAI,CAACtC,OAAO,CAAG,IAAI;AACnB,IAAI,CAAC5Q,KAAK,CAAC2oB,MAAM,CAAC,CAAC;AACnB,IAAI,CAACvS,QAAQ,CAAC,CAAC;AACf,CAAAsS,mBAAA,KAAI,CAACrY,YAAY,SAAjBqY,mBAAA,CAAA1S,IAAA,KAAI,CAAgB,SAAS,CAAC;AAC/B,CAAC,CAAA3B,OAAA;AACDuU,QAAQ,CAAR,SAAAA,QAAQA,CAAA,CAAG;AACV,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;AACf,CAAC,CAAAxU,OAAA;AACDwU,MAAM,CAAN,SAAAA,MAAMA,CAACC,SAAiB,CAAE,KAAAC,aAAA;AACzB,GAAI,IAAI,CAAC5Y,OAAO,GAAKuG,QAAQ,EAAIoS,SAAS,CAAG,CAAC,CAAE;AAC/C,MAAO,KAAI,CAACrS,QAAQ,CAAC,IAAI,CAAC/F,IAAI,CAAG,CAAC,CAAC;AACpC;AACA,IAAI,CAAC+F,QAAQ,CAAC,EAAAsS,aAAA,CAAC,IAAI,CAAC5Y,OAAO,QAAA4Y,aAAA,CAAI,IAAI,CAACrY,IAAI,EAAIoY,SAAS,CAAC;AACvD,CAAC,CAAAzU,OAAA;AACDoC,QAAQ,CAAR,SAAAA,QAAQA,CAAC/F,IAAY,CAAEsY,UAAoB,CAAE;AAC5C,GAAIvmB,KAAK,CAACiO,IAAI,CAAC,CAAE;AACjBA,IAAI,CAAGvP,IAAI,CAAC2G,GAAG,CAAC3G,IAAI,CAACE,KAAK,CAACqP,IAAI,CAAC,CAAE,CAAC,CAAC;;AAEpC,GAAI,IAAI,CAACP,OAAO,GAAK,IAAI,EAAIO,IAAI,CAAG,IAAI,CAACA,IAAI,EAAI,CAACsY,UAAU,CAAE;AAC7D,IAAI,CAAC7Y,OAAO,CAAGO,IAAI;AACnB;AACD;;AAEA,GAAIA,IAAI,GAAK,CAAC,CAAE,KAAAuY,mBAAA;AACf,IAAI,CAAC9Y,OAAO,CAAG,IAAI;AACnB,IAAI,CAACgE,SAAS,CAAC,CAAC;AAChB,IAAI,CAACnU,KAAK,CAACkpB,WAAW,CAAC,CAAC;AACxB,GAAI,IAAI,CAAChW,MAAM,CAAE,CAAA+V,mBAAA,KAAI,CAAC5Y,YAAY,SAAjB4Y,mBAAA,CAAAjT,IAAA,KAAI,CAAgB,QAAQ,CAAC;AAC9C;AACD;;AAEA,IAAI,CAAC7F,OAAO,CAAGO,IAAI;;AAEnB,GAAIA,IAAI,EAAI,IAAI,CAACA,IAAI,EAAIsY,UAAU,CAAE;AACpC,IAAI,CAAChpB,KAAK,CAACmpB,YAAY,CAAC,CAAC;AACzB,IAAI,CAAChV,SAAS,CAAC,CAAC;AACjB,CAAC,IAAM,IAAI,IAAI,CAACxD,UAAU,CAAE;AAC3B,IAAI,CAAC3Q,KAAK,CAACkpB,WAAW,CAAC,CAAC;AACxB,IAAI,CAAC/Y,OAAO,CAAG,IAAI;AACpB,CAAC,IAAM;AACN,IAAI,CAACnQ,KAAK,CAACmpB,YAAY,CAAC,CAAC;AACzB,IAAI,CAAC/S,QAAQ,CAAC,CAAC;AAChB;AACD,CAAC,CAAA/B,OAAA;AACDsD,WAAW,CAAX,SAAAA,WAAWA,CAAA,CAAG,KAAAyR,oBAAA;AACb,IAAI,CAACjZ,OAAO,CAAG,IAAI;AACnB,IAAI,CAACnQ,KAAK,CAACkpB,WAAW,CAAC,CAAC;AACxB,CAAAE,oBAAA,KAAI,CAAC/Y,YAAY,SAAjB+Y,oBAAA,CAAApT,IAAA,KAAI,CAAgB,IAAI,CAAC9C,MAAM,CAAG,QAAQ,CAAG,SAAS,CAAC;AACxD,CAAC,CAAAmB,OAAA;AACDgV,UAAU,CAAV,SAAAA,UAAUA,CAAA,CAAG;AACZ,GAAI,IAAI,CAAC1Y,UAAU,CAAE,MAAO,MAAK;AACjC,GAAI,IAAI,CAACR,OAAO,GAAK,IAAI,CAAE,MAAO,KAAI;AACtC,MAAO,EAAE,IAAI,CAAC+C,MAAM,EAAI,IAAI,CAACxC,IAAI,EAAI,CAAC,CAAC;AACxC,CAAC,CAAA2D,OAAA;AACD+B,QAAQ,CAAR,SAAAA,QAAQA,CAAA,CAAG,KAAAkT,MAAA;AACV,GAAI,CAAC,IAAI,CAACD,UAAU,CAAC,CAAC,CAAE;;AAExB,GAAI,CAAA3K,IAAI,CAAG6K,IAAI,CAACC,GAAG,CAAC,CAAC;AACrB,IAAI,CAACxpB,KAAK,CAACypB,eAAe,CAAC,CAAC;AAC5B,GAAI,CAAAC,UAAU,CAAG7nB,SAAS;;AAE1B,GAAI,CAAA8nB,iBAAyB;AAC7B,EAAG;;AAEF,IAAI,CAAC1Z,iBAAiB,CAAG,IAAiC;AAC1D,GAAI,IAAI,CAACC,WAAW,EAAI,IAAI,CAACH,SAAS,CAACnO,MAAM,CAAE,KAAAgoB,oBAAA;AAC9C,IAAI,CAACjZ,UAAU,CAAG,IAAI;AACtB,GAAI,CAAC,IAAI,CAACE,KAAK,EAAI,IAAI,CAACC,QAAQ,CAAE,IAAI,CAACkG,YAAY,CAAC,CAAC;AACrD,IAAI,CAACW,WAAW,CAAC,CAAC;AAClB,GAAI,IAAI,CAAC9G,KAAK,CAAE;AACf,IAAI,CAAC7Q,KAAK,CAACuoB,SAAS,CAAC,CAAC;AACvB;AACA,CAAAqB,oBAAA,KAAI,CAACvZ,YAAY,SAAjBuZ,oBAAA,CAAA5T,IAAA,KAAI,CAAgB,YAAY,CAAC;AACjC;AACD;;AAEA,IAAI,CAACqO,GAAG,CAAC,IAAI,CAACtU,SAAS,CAAC,IAAI,CAACG,WAAW,CAAC,CAAC;AAC1C,IAAI,CAACA,WAAW,EAAE;AAClB,GAAI,IAAI,CAACD,iBAAiB,GAAK,IAAI,CAAE;AACpCyZ,UAAU,CAAG,IAAI,CAAC1pB,KAAK,CAAC6pB,gBAAgB,CAAC,CAAC;AAC3C,CAAC,IAAM,IAAI,IAAI,CAAC5Z,iBAAiB,GAAK,QAAQ,CAAE;AAC/C,IAAI,CAACjQ,KAAK,CAACqe,UAAU,CAAG,CAAC;AAC1B;;AAEA,GAAIkL,IAAI,CAACC,GAAG,CAAC,CAAC,CAAG9K,IAAI,CAAG,GAAG,CAAE;AAC5BiL,iBAAiB,CAAG,IAAI,CAAC3pB,KAAK,CAAC2pB,iBAAiB;AAChDG,UAAU,CAAC,UAAM;AAChB,GAAIH,iBAAiB,GAAKL,MAAI,CAACtpB,KAAK,CAAC2pB,iBAAiB,CAAE;AACvDL,MAAI,CAAClT,QAAQ,CAAC,CAAC;AAChB;AACD,CAAC,CAAE,CAAC,CAAC;AACL;AACD;AACD,CAAC,MAAQ,CAACsT,UAAU,EAAI,IAAI,CAACL,UAAU,CAAC,CAAC;;AAEzC,GAAI,IAAI,CAACnW,MAAM,EAAI,IAAI,CAACxC,IAAI,EAAI,CAAC,EAAI,IAAI,CAACP,OAAO,GAAK,IAAI,CAAE;;AAE3D,IAAI,CAACnQ,KAAK,CAAC+V,KAAK,CAAC,CAAC;AAClB;AACD;;AAEA,GAAI,CAAC2T,UAAU,CAAE;;AAEjBC,iBAAiB,CAAG,IAAI,CAAC3pB,KAAK,CAAC2pB,iBAAiB;AAChDD,UAAU,CAACK,IAAI,CAAC,UAAM;AACrB,GAAIJ,iBAAiB,GAAKL,MAAI,CAACtpB,KAAK,CAAC2pB,iBAAiB,CAAE;AACvDL,MAAI,CAAClT,QAAQ,CAAC,CAAC;AAChB;AACD,CAAC,CAAC;AACH,CAAC,CAAA/B,OAAA;;AAED2V,QAAQ,CAAR,SAAAA,QAAQA,CAACC,KAAe,CAAE;AACzB,IAAI,CAACla,SAAS,CAAGka,KAAK;AACtB,IAAI,CAAC9V,SAAS,CAAC,CAAC;AACjB,CAAC,CAAAE,OAAA;;AAED6V,OAAO,CAAP,SAAAA,OAAOA,CAAC5Z,IAAa,CAAE;AACtB,IAAI,CAACtQ,KAAK,CAACkqB,OAAO,CAAC5Z,IAAI,CAAC;AACzB,CAAC,QAAAX,MAAA;;;;;AAKF,GAAI,MAAO,CAAAwa,OAAO,GAAK,UAAU,CAAE;;AAElCC,MAAM,CAACza,MAAM,CAAGA,MAAM;AACtBya,MAAM,CAAC7sB,OAAO,CAAGA,OAAO;AACzB","ignoreList":[]}